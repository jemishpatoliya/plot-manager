var dM=i=>{throw TypeError(i)};var vT=(i,l,h)=>l.has(i)||dM("Cannot "+h);var Vt=(i,l,h)=>(vT(i,l,"read from private field"),h?h.call(i):l.get(i)),yr=(i,l,h)=>l.has(i)?dM("Cannot add the same private member more than once"):l instanceof WeakSet?l.add(i):l.set(i,h),zi=(i,l,h,g)=>(vT(i,l,"write to private field"),g?g.call(i,h):l.set(i,h),h),ls=(i,l,h)=>(vT(i,l,"access private method"),h);var nx=(i,l,h,g)=>({set _(w){zi(i,l,w,h)},get _(){return Vt(i,l,g)}});function _j(i,l){for(var h=0;h<l.length;h++){const g=l[h];if(typeof g!="string"&&!Array.isArray(g)){for(const w in g)if(w!=="default"&&!(w in i)){const S=Object.getOwnPropertyDescriptor(g,w);S&&Object.defineProperty(i,w,S.get?S:{enumerable:!0,get:()=>g[w]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))g(w);new MutationObserver(w=>{for(const S of w)if(S.type==="childList")for(const R of S.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&g(R)}).observe(document,{childList:!0,subtree:!0});function h(w){const S={};return w.integrity&&(S.integrity=w.integrity),w.referrerPolicy&&(S.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?S.credentials="include":w.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function g(w){if(w.ep)return;w.ep=!0;const S=h(w);fetch(w.href,S)}})();var yj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RS(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var VD={exports:{}},D1={},$D={exports:{}},Qi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wy=Symbol.for("react.element"),vj=Symbol.for("react.portal"),xj=Symbol.for("react.fragment"),wj=Symbol.for("react.strict_mode"),bj=Symbol.for("react.profiler"),Tj=Symbol.for("react.provider"),Sj=Symbol.for("react.context"),Ej=Symbol.for("react.forward_ref"),Ij=Symbol.for("react.suspense"),Cj=Symbol.for("react.memo"),Aj=Symbol.for("react.lazy"),hM=Symbol.iterator;function Pj(i){return i===null||typeof i!="object"?null:(i=hM&&i[hM]||i["@@iterator"],typeof i=="function"?i:null)}var GD={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HD=Object.assign,WD={};function Bm(i,l,h){this.props=i,this.context=l,this.refs=WD,this.updater=h||GD}Bm.prototype.isReactComponent={};Bm.prototype.setState=function(i,l){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,l,"setState")};Bm.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function qD(){}qD.prototype=Bm.prototype;function DS(i,l,h){this.props=i,this.context=l,this.refs=WD,this.updater=h||GD}var LS=DS.prototype=new qD;LS.constructor=DS;HD(LS,Bm.prototype);LS.isPureReactComponent=!0;var fM=Array.isArray,ZD=Object.prototype.hasOwnProperty,kS={current:null},XD={key:!0,ref:!0,__self:!0,__source:!0};function YD(i,l,h){var g,w={},S=null,R=null;if(l!=null)for(g in l.ref!==void 0&&(R=l.ref),l.key!==void 0&&(S=""+l.key),l)ZD.call(l,g)&&!XD.hasOwnProperty(g)&&(w[g]=l[g]);var o=arguments.length-2;if(o===1)w.children=h;else if(1<o){for(var N=Array(o),B=0;B<o;B++)N[B]=arguments[B+2];w.children=N}if(i&&i.defaultProps)for(g in o=i.defaultProps,o)w[g]===void 0&&(w[g]=o[g]);return{$$typeof:Wy,type:i,key:S,ref:R,props:w,_owner:kS.current}}function Mj(i,l){return{$$typeof:Wy,type:i.type,key:l,ref:i.ref,props:i.props,_owner:i._owner}}function zS(i){return typeof i=="object"&&i!==null&&i.$$typeof===Wy}function Rj(i){var l={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return l[h]})}var pM=/\/+/g;function xT(i,l){return typeof i=="object"&&i!==null&&i.key!=null?Rj(""+i.key):l.toString(36)}function Lx(i,l,h,g,w){var S=typeof i;(S==="undefined"||S==="boolean")&&(i=null);var R=!1;if(i===null)R=!0;else switch(S){case"string":case"number":R=!0;break;case"object":switch(i.$$typeof){case Wy:case vj:R=!0}}if(R)return R=i,w=w(R),i=g===""?"."+xT(R,0):g,fM(w)?(h="",i!=null&&(h=i.replace(pM,"$&/")+"/"),Lx(w,l,h,"",function(B){return B})):w!=null&&(zS(w)&&(w=Mj(w,h+(!w.key||R&&R.key===w.key?"":(""+w.key).replace(pM,"$&/")+"/")+i)),l.push(w)),1;if(R=0,g=g===""?".":g+":",fM(i))for(var o=0;o<i.length;o++){S=i[o];var N=g+xT(S,o);R+=Lx(S,l,h,N,w)}else if(N=Pj(i),typeof N=="function")for(i=N.call(i),o=0;!(S=i.next()).done;)S=S.value,N=g+xT(S,o++),R+=Lx(S,l,h,N,w);else if(S==="object")throw l=String(i),Error("Objects are not valid as a React child (found: "+(l==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":l)+"). If you meant to render a collection of children, use an array instead.");return R}function ix(i,l,h){if(i==null)return i;var g=[],w=0;return Lx(i,g,"","",function(S){return l.call(h,S,w++)}),g}function Dj(i){if(i._status===-1){var l=i._result;l=l(),l.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=l)}if(i._status===1)return i._result.default;throw i._result}var As={current:null},kx={transition:null},Lj={ReactCurrentDispatcher:As,ReactCurrentBatchConfig:kx,ReactCurrentOwner:kS};function KD(){throw Error("act(...) is not supported in production builds of React.")}Qi.Children={map:ix,forEach:function(i,l,h){ix(i,function(){l.apply(this,arguments)},h)},count:function(i){var l=0;return ix(i,function(){l++}),l},toArray:function(i){return ix(i,function(l){return l})||[]},only:function(i){if(!zS(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Qi.Component=Bm;Qi.Fragment=xj;Qi.Profiler=bj;Qi.PureComponent=DS;Qi.StrictMode=wj;Qi.Suspense=Ij;Qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lj;Qi.act=KD;Qi.cloneElement=function(i,l,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var g=HD({},i.props),w=i.key,S=i.ref,R=i._owner;if(l!=null){if(l.ref!==void 0&&(S=l.ref,R=kS.current),l.key!==void 0&&(w=""+l.key),i.type&&i.type.defaultProps)var o=i.type.defaultProps;for(N in l)ZD.call(l,N)&&!XD.hasOwnProperty(N)&&(g[N]=l[N]===void 0&&o!==void 0?o[N]:l[N])}var N=arguments.length-2;if(N===1)g.children=h;else if(1<N){o=Array(N);for(var B=0;B<N;B++)o[B]=arguments[B+2];g.children=o}return{$$typeof:Wy,type:i.type,key:w,ref:S,props:g,_owner:R}};Qi.createContext=function(i){return i={$$typeof:Sj,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Tj,_context:i},i.Consumer=i};Qi.createElement=YD;Qi.createFactory=function(i){var l=YD.bind(null,i);return l.type=i,l};Qi.createRef=function(){return{current:null}};Qi.forwardRef=function(i){return{$$typeof:Ej,render:i}};Qi.isValidElement=zS;Qi.lazy=function(i){return{$$typeof:Aj,_payload:{_status:-1,_result:i},_init:Dj}};Qi.memo=function(i,l){return{$$typeof:Cj,type:i,compare:l===void 0?null:l}};Qi.startTransition=function(i){var l=kx.transition;kx.transition={};try{i()}finally{kx.transition=l}};Qi.unstable_act=KD;Qi.useCallback=function(i,l){return As.current.useCallback(i,l)};Qi.useContext=function(i){return As.current.useContext(i)};Qi.useDebugValue=function(){};Qi.useDeferredValue=function(i){return As.current.useDeferredValue(i)};Qi.useEffect=function(i,l){return As.current.useEffect(i,l)};Qi.useId=function(){return As.current.useId()};Qi.useImperativeHandle=function(i,l,h){return As.current.useImperativeHandle(i,l,h)};Qi.useInsertionEffect=function(i,l){return As.current.useInsertionEffect(i,l)};Qi.useLayoutEffect=function(i,l){return As.current.useLayoutEffect(i,l)};Qi.useMemo=function(i,l){return As.current.useMemo(i,l)};Qi.useReducer=function(i,l,h){return As.current.useReducer(i,l,h)};Qi.useRef=function(i){return As.current.useRef(i)};Qi.useState=function(i){return As.current.useState(i)};Qi.useSyncExternalStore=function(i,l,h){return As.current.useSyncExternalStore(i,l,h)};Qi.useTransition=function(){return As.current.useTransition()};Qi.version="18.3.1";$D.exports=Qi;var G=$D.exports;const pn=RS(G),OS=_j({__proto__:null,default:pn},[G]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kj=G,zj=Symbol.for("react.element"),Oj=Symbol.for("react.fragment"),Fj=Object.prototype.hasOwnProperty,Nj=kj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bj={key:!0,ref:!0,__self:!0,__source:!0};function QD(i,l,h){var g,w={},S=null,R=null;h!==void 0&&(S=""+h),l.key!==void 0&&(S=""+l.key),l.ref!==void 0&&(R=l.ref);for(g in l)Fj.call(l,g)&&!Bj.hasOwnProperty(g)&&(w[g]=l[g]);if(i&&i.defaultProps)for(g in l=i.defaultProps,l)w[g]===void 0&&(w[g]=l[g]);return{$$typeof:zj,type:i,key:S,ref:R,props:w,_owner:Nj.current}}D1.Fragment=Oj;D1.jsx=QD;D1.jsxs=QD;VD.exports=D1;var L=VD.exports,JD={exports:{}},xa={},eL={exports:{}},tL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function l(ze,He){var mt=ze.length;ze.push(He);e:for(;0<mt;){var $t=mt-1>>>1,Gt=ze[$t];if(0<w(Gt,He))ze[$t]=He,ze[mt]=Gt,mt=$t;else break e}}function h(ze){return ze.length===0?null:ze[0]}function g(ze){if(ze.length===0)return null;var He=ze[0],mt=ze.pop();if(mt!==He){ze[0]=mt;e:for(var $t=0,Gt=ze.length,Kt=Gt>>>1;$t<Kt;){var mn=2*($t+1)-1,Yn=ze[mn],hi=mn+1,nn=ze[hi];if(0>w(Yn,mt))hi<Gt&&0>w(nn,Yn)?(ze[$t]=nn,ze[hi]=mt,$t=hi):(ze[$t]=Yn,ze[mn]=mt,$t=mn);else if(hi<Gt&&0>w(nn,mt))ze[$t]=nn,ze[hi]=mt,$t=hi;else break e}}return He}function w(ze,He){var mt=ze.sortIndex-He.sortIndex;return mt!==0?mt:ze.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;i.unstable_now=function(){return S.now()}}else{var R=Date,o=R.now();i.unstable_now=function(){return R.now()-o}}var N=[],B=[],q=1,Y=null,J=3,ie=!1,be=!1,te=!1,le=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(ze){for(var He=h(B);He!==null;){if(He.callback===null)g(B);else if(He.startTime<=ze)g(B),He.sortIndex=He.expirationTime,l(N,He);else break;He=h(B)}}function Me(ze){if(te=!1,ue(ze),!be)if(h(N)!==null)be=!0,xt(Ne);else{var He=h(B);He!==null&&kt(Me,He.startTime-ze)}}function Ne(ze,He){be=!1,te&&(te=!1,ce(Ve),Ve=-1),ie=!0;var mt=J;try{for(ue(He),Y=h(N);Y!==null&&(!(Y.expirationTime>He)||ze&&!cn());){var $t=Y.callback;if(typeof $t=="function"){Y.callback=null,J=Y.priorityLevel;var Gt=$t(Y.expirationTime<=He);He=i.unstable_now(),typeof Gt=="function"?Y.callback=Gt:Y===h(N)&&g(N),ue(He)}else g(N);Y=h(N)}if(Y!==null)var Kt=!0;else{var mn=h(B);mn!==null&&kt(Me,mn.startTime-He),Kt=!1}return Kt}finally{Y=null,J=mt,ie=!1}}var je=!1,Te=null,Ve=-1,nt=5,At=-1;function cn(){return!(i.unstable_now()-At<nt)}function qt(){if(Te!==null){var ze=i.unstable_now();At=ze;var He=!0;try{He=Te(!0,ze)}finally{He?Ht():(je=!1,Te=null)}}else je=!1}var Ht;if(typeof oe=="function")Ht=function(){oe(qt)};else if(typeof MessageChannel<"u"){var st=new MessageChannel,Tt=st.port2;st.port1.onmessage=qt,Ht=function(){Tt.postMessage(null)}}else Ht=function(){le(qt,0)};function xt(ze){Te=ze,je||(je=!0,Ht())}function kt(ze,He){Ve=le(function(){ze(i.unstable_now())},He)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ze){ze.callback=null},i.unstable_continueExecution=function(){be||ie||(be=!0,xt(Ne))},i.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):nt=0<ze?Math.floor(1e3/ze):5},i.unstable_getCurrentPriorityLevel=function(){return J},i.unstable_getFirstCallbackNode=function(){return h(N)},i.unstable_next=function(ze){switch(J){case 1:case 2:case 3:var He=3;break;default:He=J}var mt=J;J=He;try{return ze()}finally{J=mt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ze,He){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var mt=J;J=ze;try{return He()}finally{J=mt}},i.unstable_scheduleCallback=function(ze,He,mt){var $t=i.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?$t+mt:$t):mt=$t,ze){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=mt+Gt,ze={id:q++,callback:He,priorityLevel:ze,startTime:mt,expirationTime:Gt,sortIndex:-1},mt>$t?(ze.sortIndex=mt,l(B,ze),h(N)===null&&ze===h(B)&&(te?(ce(Ve),Ve=-1):te=!0,kt(Me,mt-$t))):(ze.sortIndex=Gt,l(N,ze),be||ie||(be=!0,xt(Ne))),ze},i.unstable_shouldYield=cn,i.unstable_wrapCallback=function(ze){var He=J;return function(){var mt=J;J=He;try{return ze.apply(this,arguments)}finally{J=mt}}}})(tL);eL.exports=tL;var jj=eL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uj=G,va=jj;function an(i){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nL=new Set,yy={};function Qh(i,l){Cm(i,l),Cm(i+"Capture",l)}function Cm(i,l){for(yy[i]=l,i=0;i<l.length;i++)nL.add(l[i])}var nu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u2=Object.prototype.hasOwnProperty,Vj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,mM={},gM={};function $j(i){return u2.call(gM,i)?!0:u2.call(mM,i)?!1:Vj.test(i)?gM[i]=!0:(mM[i]=!0,!1)}function Gj(i,l,h,g){if(h!==null&&h.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return g?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Hj(i,l,h,g){if(l===null||typeof l>"u"||Gj(i,l,h,g))return!0;if(g)return!1;if(h!==null)switch(h.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function Ps(i,l,h,g,w,S,R){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=g,this.attributeNamespace=w,this.mustUseProperty=h,this.propertyName=i,this.type=l,this.sanitizeURL=S,this.removeEmptyString=R}var is={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){is[i]=new Ps(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var l=i[0];is[l]=new Ps(l,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){is[i]=new Ps(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){is[i]=new Ps(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){is[i]=new Ps(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){is[i]=new Ps(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){is[i]=new Ps(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){is[i]=new Ps(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){is[i]=new Ps(i,5,!1,i.toLowerCase(),null,!1,!1)});var FS=/[\-:]([a-z])/g;function NS(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var l=i.replace(FS,NS);is[l]=new Ps(l,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var l=i.replace(FS,NS);is[l]=new Ps(l,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var l=i.replace(FS,NS);is[l]=new Ps(l,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){is[i]=new Ps(i,1,!1,i.toLowerCase(),null,!1,!1)});is.xlinkHref=new Ps("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){is[i]=new Ps(i,1,!1,i.toLowerCase(),null,!0,!0)});function BS(i,l,h,g){var w=is.hasOwnProperty(l)?is[l]:null;(w!==null?w.type!==0:g||!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(Hj(l,h,w,g)&&(h=null),g||w===null?$j(l)&&(h===null?i.removeAttribute(l):i.setAttribute(l,""+h)):w.mustUseProperty?i[w.propertyName]=h===null?w.type===3?!1:"":h:(l=w.attributeName,g=w.attributeNamespace,h===null?i.removeAttribute(l):(w=w.type,h=w===3||w===4&&h===!0?"":""+h,g?i.setAttributeNS(g,l,h):i.setAttribute(l,h))))}var lu=Uj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rx=Symbol.for("react.element"),Yp=Symbol.for("react.portal"),Kp=Symbol.for("react.fragment"),jS=Symbol.for("react.strict_mode"),d2=Symbol.for("react.profiler"),iL=Symbol.for("react.provider"),rL=Symbol.for("react.context"),US=Symbol.for("react.forward_ref"),h2=Symbol.for("react.suspense"),f2=Symbol.for("react.suspense_list"),VS=Symbol.for("react.memo"),Xu=Symbol.for("react.lazy"),oL=Symbol.for("react.offscreen"),_M=Symbol.iterator;function H_(i){return i===null||typeof i!="object"?null:(i=_M&&i[_M]||i["@@iterator"],typeof i=="function"?i:null)}var ro=Object.assign,wT;function ty(i){if(wT===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);wT=l&&l[1]||""}return`
`+wT+i}var bT=!1;function TT(i,l){if(!i||bT)return"";bT=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(B){var g=B}Reflect.construct(i,[],l)}else{try{l.call()}catch(B){g=B}i.call(l.prototype)}else{try{throw Error()}catch(B){g=B}i()}}catch(B){if(B&&g&&typeof B.stack=="string"){for(var w=B.stack.split(`
`),S=g.stack.split(`
`),R=w.length-1,o=S.length-1;1<=R&&0<=o&&w[R]!==S[o];)o--;for(;1<=R&&0<=o;R--,o--)if(w[R]!==S[o]){if(R!==1||o!==1)do if(R--,o--,0>o||w[R]!==S[o]){var N=`
`+w[R].replace(" at new "," at ");return i.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",i.displayName)),N}while(1<=R&&0<=o);break}}}finally{bT=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?ty(i):""}function Wj(i){switch(i.tag){case 5:return ty(i.type);case 16:return ty("Lazy");case 13:return ty("Suspense");case 19:return ty("SuspenseList");case 0:case 2:case 15:return i=TT(i.type,!1),i;case 11:return i=TT(i.type.render,!1),i;case 1:return i=TT(i.type,!0),i;default:return""}}function p2(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Kp:return"Fragment";case Yp:return"Portal";case d2:return"Profiler";case jS:return"StrictMode";case h2:return"Suspense";case f2:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case rL:return(i.displayName||"Context")+".Consumer";case iL:return(i._context.displayName||"Context")+".Provider";case US:var l=i.render;return i=i.displayName,i||(i=l.displayName||l.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case VS:return l=i.displayName||null,l!==null?l:p2(i.type)||"Memo";case Xu:l=i._payload,i=i._init;try{return p2(i(l))}catch{}}return null}function qj(i){var l=i.type;switch(i.tag){case 24:return"Cache";case 9:return(l.displayName||"Context")+".Consumer";case 10:return(l._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=l.render,i=i.displayName||i.name||"",l.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return l;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return p2(l);case 8:return l===jS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l}return null}function _d(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function sL(i){var l=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Zj(i){var l=sL(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,l),g=""+i[l];if(!i.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var w=h.get,S=h.set;return Object.defineProperty(i,l,{configurable:!0,get:function(){return w.call(this)},set:function(R){g=""+R,S.call(this,R)}}),Object.defineProperty(i,l,{enumerable:h.enumerable}),{getValue:function(){return g},setValue:function(R){g=""+R},stopTracking:function(){i._valueTracker=null,delete i[l]}}}}function ox(i){i._valueTracker||(i._valueTracker=Zj(i))}function aL(i){if(!i)return!1;var l=i._valueTracker;if(!l)return!0;var h=l.getValue(),g="";return i&&(g=sL(i)?i.checked?"true":"false":i.value),i=g,i!==h?(l.setValue(i),!0):!1}function Yx(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function m2(i,l){var h=l.checked;return ro({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function yM(i,l){var h=l.defaultValue==null?"":l.defaultValue,g=l.checked!=null?l.checked:l.defaultChecked;h=_d(l.value!=null?l.value:h),i._wrapperState={initialChecked:g,initialValue:h,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function lL(i,l){l=l.checked,l!=null&&BS(i,"checked",l,!1)}function g2(i,l){lL(i,l);var h=_d(l.value),g=l.type;if(h!=null)g==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(g==="submit"||g==="reset"){i.removeAttribute("value");return}l.hasOwnProperty("value")?_2(i,l.type,h):l.hasOwnProperty("defaultValue")&&_2(i,l.type,_d(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(i.defaultChecked=!!l.defaultChecked)}function vM(i,l,h){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var g=l.type;if(!(g!=="submit"&&g!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+i._wrapperState.initialValue,h||l===i.value||(i.value=l),i.defaultValue=l}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function _2(i,l,h){(l!=="number"||Yx(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var ny=Array.isArray;function lm(i,l,h,g){if(i=i.options,l){l={};for(var w=0;w<h.length;w++)l["$"+h[w]]=!0;for(h=0;h<i.length;h++)w=l.hasOwnProperty("$"+i[h].value),i[h].selected!==w&&(i[h].selected=w),w&&g&&(i[h].defaultSelected=!0)}else{for(h=""+_d(h),l=null,w=0;w<i.length;w++){if(i[w].value===h){i[w].selected=!0,g&&(i[w].defaultSelected=!0);return}l!==null||i[w].disabled||(l=i[w])}l!==null&&(l.selected=!0)}}function y2(i,l){if(l.dangerouslySetInnerHTML!=null)throw Error(an(91));return ro({},l,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function xM(i,l){var h=l.value;if(h==null){if(h=l.children,l=l.defaultValue,h!=null){if(l!=null)throw Error(an(92));if(ny(h)){if(1<h.length)throw Error(an(93));h=h[0]}l=h}l==null&&(l=""),h=l}i._wrapperState={initialValue:_d(h)}}function cL(i,l){var h=_d(l.value),g=_d(l.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),l.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),g!=null&&(i.defaultValue=""+g)}function wM(i){var l=i.textContent;l===i._wrapperState.initialValue&&l!==""&&l!==null&&(i.value=l)}function uL(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function v2(i,l){return i==null||i==="http://www.w3.org/1999/xhtml"?uL(l):i==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var sx,dL=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,h,g,w){MSApp.execUnsafeLocalFunction(function(){return i(l,h,g,w)})}:i}(function(i,l){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=l;else{for(sx=sx||document.createElement("div"),sx.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=sx.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;l.firstChild;)i.appendChild(l.firstChild)}});function vy(i,l){if(l){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=l;return}}i.textContent=l}var ay={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xj=["Webkit","ms","Moz","O"];Object.keys(ay).forEach(function(i){Xj.forEach(function(l){l=l+i.charAt(0).toUpperCase()+i.substring(1),ay[l]=ay[i]})});function hL(i,l,h){return l==null||typeof l=="boolean"||l===""?"":h||typeof l!="number"||l===0||ay.hasOwnProperty(i)&&ay[i]?(""+l).trim():l+"px"}function fL(i,l){i=i.style;for(var h in l)if(l.hasOwnProperty(h)){var g=h.indexOf("--")===0,w=hL(h,l[h],g);h==="float"&&(h="cssFloat"),g?i.setProperty(h,w):i[h]=w}}var Yj=ro({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function x2(i,l){if(l){if(Yj[i]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(an(137,i));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(an(60));if(typeof l.dangerouslySetInnerHTML!="object"||!("__html"in l.dangerouslySetInnerHTML))throw Error(an(61))}if(l.style!=null&&typeof l.style!="object")throw Error(an(62))}}function w2(i,l){if(i.indexOf("-")===-1)return typeof l.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var b2=null;function $S(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var T2=null,cm=null,um=null;function bM(i){if(i=Xy(i)){if(typeof T2!="function")throw Error(an(280));var l=i.stateNode;l&&(l=F1(l),T2(i.stateNode,i.type,l))}}function pL(i){cm?um?um.push(i):um=[i]:cm=i}function mL(){if(cm){var i=cm,l=um;if(um=cm=null,bM(i),l)for(i=0;i<l.length;i++)bM(l[i])}}function gL(i,l){return i(l)}function _L(){}var ST=!1;function yL(i,l,h){if(ST)return i(l,h);ST=!0;try{return gL(i,l,h)}finally{ST=!1,(cm!==null||um!==null)&&(_L(),mL())}}function xy(i,l){var h=i.stateNode;if(h===null)return null;var g=F1(h);if(g===null)return null;h=g[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(i=i.type,g=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!g;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(an(231,l,typeof h));return h}var S2=!1;if(nu)try{var W_={};Object.defineProperty(W_,"passive",{get:function(){S2=!0}}),window.addEventListener("test",W_,W_),window.removeEventListener("test",W_,W_)}catch{S2=!1}function Kj(i,l,h,g,w,S,R,o,N){var B=Array.prototype.slice.call(arguments,3);try{l.apply(h,B)}catch(q){this.onError(q)}}var ly=!1,Kx=null,Qx=!1,E2=null,Qj={onError:function(i){ly=!0,Kx=i}};function Jj(i,l,h,g,w,S,R,o,N){ly=!1,Kx=null,Kj.apply(Qj,arguments)}function eU(i,l,h,g,w,S,R,o,N){if(Jj.apply(this,arguments),ly){if(ly){var B=Kx;ly=!1,Kx=null}else throw Error(an(198));Qx||(Qx=!0,E2=B)}}function Jh(i){var l=i,h=i;if(i.alternate)for(;l.return;)l=l.return;else{i=l;do l=i,l.flags&4098&&(h=l.return),i=l.return;while(i)}return l.tag===3?h:null}function vL(i){if(i.tag===13){var l=i.memoizedState;if(l===null&&(i=i.alternate,i!==null&&(l=i.memoizedState)),l!==null)return l.dehydrated}return null}function TM(i){if(Jh(i)!==i)throw Error(an(188))}function tU(i){var l=i.alternate;if(!l){if(l=Jh(i),l===null)throw Error(an(188));return l!==i?null:i}for(var h=i,g=l;;){var w=h.return;if(w===null)break;var S=w.alternate;if(S===null){if(g=w.return,g!==null){h=g;continue}break}if(w.child===S.child){for(S=w.child;S;){if(S===h)return TM(w),i;if(S===g)return TM(w),l;S=S.sibling}throw Error(an(188))}if(h.return!==g.return)h=w,g=S;else{for(var R=!1,o=w.child;o;){if(o===h){R=!0,h=w,g=S;break}if(o===g){R=!0,g=w,h=S;break}o=o.sibling}if(!R){for(o=S.child;o;){if(o===h){R=!0,h=S,g=w;break}if(o===g){R=!0,g=S,h=w;break}o=o.sibling}if(!R)throw Error(an(189))}}if(h.alternate!==g)throw Error(an(190))}if(h.tag!==3)throw Error(an(188));return h.stateNode.current===h?i:l}function xL(i){return i=tU(i),i!==null?wL(i):null}function wL(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var l=wL(i);if(l!==null)return l;i=i.sibling}return null}var bL=va.unstable_scheduleCallback,SM=va.unstable_cancelCallback,nU=va.unstable_shouldYield,iU=va.unstable_requestPaint,yo=va.unstable_now,rU=va.unstable_getCurrentPriorityLevel,GS=va.unstable_ImmediatePriority,TL=va.unstable_UserBlockingPriority,Jx=va.unstable_NormalPriority,oU=va.unstable_LowPriority,SL=va.unstable_IdlePriority,L1=null,fc=null;function sU(i){if(fc&&typeof fc.onCommitFiberRoot=="function")try{fc.onCommitFiberRoot(L1,i,void 0,(i.current.flags&128)===128)}catch{}}var Ml=Math.clz32?Math.clz32:cU,aU=Math.log,lU=Math.LN2;function cU(i){return i>>>=0,i===0?32:31-(aU(i)/lU|0)|0}var ax=64,lx=4194304;function iy(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function e1(i,l){var h=i.pendingLanes;if(h===0)return 0;var g=0,w=i.suspendedLanes,S=i.pingedLanes,R=h&268435455;if(R!==0){var o=R&~w;o!==0?g=iy(o):(S&=R,S!==0&&(g=iy(S)))}else R=h&~w,R!==0?g=iy(R):S!==0&&(g=iy(S));if(g===0)return 0;if(l!==0&&l!==g&&!(l&w)&&(w=g&-g,S=l&-l,w>=S||w===16&&(S&4194240)!==0))return l;if(g&4&&(g|=h&16),l=i.entangledLanes,l!==0)for(i=i.entanglements,l&=g;0<l;)h=31-Ml(l),w=1<<h,g|=i[h],l&=~w;return g}function uU(i,l){switch(i){case 1:case 2:case 4:return l+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dU(i,l){for(var h=i.suspendedLanes,g=i.pingedLanes,w=i.expirationTimes,S=i.pendingLanes;0<S;){var R=31-Ml(S),o=1<<R,N=w[R];N===-1?(!(o&h)||o&g)&&(w[R]=uU(o,l)):N<=l&&(i.expiredLanes|=o),S&=~o}}function I2(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function EL(){var i=ax;return ax<<=1,!(ax&4194240)&&(ax=64),i}function ET(i){for(var l=[],h=0;31>h;h++)l.push(i);return l}function qy(i,l,h){i.pendingLanes|=l,l!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,l=31-Ml(l),i[l]=h}function hU(i,l){var h=i.pendingLanes&~l;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=l,i.mutableReadLanes&=l,i.entangledLanes&=l,l=i.entanglements;var g=i.eventTimes;for(i=i.expirationTimes;0<h;){var w=31-Ml(h),S=1<<w;l[w]=0,g[w]=-1,i[w]=-1,h&=~S}}function HS(i,l){var h=i.entangledLanes|=l;for(i=i.entanglements;h;){var g=31-Ml(h),w=1<<g;w&l|i[g]&l&&(i[g]|=l),h&=~w}}var Cr=0;function IL(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var CL,WS,AL,PL,ML,C2=!1,cx=[],ad=null,ld=null,cd=null,wy=new Map,by=new Map,Ku=[],fU="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function EM(i,l){switch(i){case"focusin":case"focusout":ad=null;break;case"dragenter":case"dragleave":ld=null;break;case"mouseover":case"mouseout":cd=null;break;case"pointerover":case"pointerout":wy.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":by.delete(l.pointerId)}}function q_(i,l,h,g,w,S){return i===null||i.nativeEvent!==S?(i={blockedOn:l,domEventName:h,eventSystemFlags:g,nativeEvent:S,targetContainers:[w]},l!==null&&(l=Xy(l),l!==null&&WS(l)),i):(i.eventSystemFlags|=g,l=i.targetContainers,w!==null&&l.indexOf(w)===-1&&l.push(w),i)}function pU(i,l,h,g,w){switch(l){case"focusin":return ad=q_(ad,i,l,h,g,w),!0;case"dragenter":return ld=q_(ld,i,l,h,g,w),!0;case"mouseover":return cd=q_(cd,i,l,h,g,w),!0;case"pointerover":var S=w.pointerId;return wy.set(S,q_(wy.get(S)||null,i,l,h,g,w)),!0;case"gotpointercapture":return S=w.pointerId,by.set(S,q_(by.get(S)||null,i,l,h,g,w)),!0}return!1}function RL(i){var l=Ch(i.target);if(l!==null){var h=Jh(l);if(h!==null){if(l=h.tag,l===13){if(l=vL(h),l!==null){i.blockedOn=l,ML(i.priority,function(){AL(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function zx(i){if(i.blockedOn!==null)return!1;for(var l=i.targetContainers;0<l.length;){var h=A2(i.domEventName,i.eventSystemFlags,l[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var g=new h.constructor(h.type,h);b2=g,h.target.dispatchEvent(g),b2=null}else return l=Xy(h),l!==null&&WS(l),i.blockedOn=h,!1;l.shift()}return!0}function IM(i,l,h){zx(i)&&h.delete(l)}function mU(){C2=!1,ad!==null&&zx(ad)&&(ad=null),ld!==null&&zx(ld)&&(ld=null),cd!==null&&zx(cd)&&(cd=null),wy.forEach(IM),by.forEach(IM)}function Z_(i,l){i.blockedOn===l&&(i.blockedOn=null,C2||(C2=!0,va.unstable_scheduleCallback(va.unstable_NormalPriority,mU)))}function Ty(i){function l(w){return Z_(w,i)}if(0<cx.length){Z_(cx[0],i);for(var h=1;h<cx.length;h++){var g=cx[h];g.blockedOn===i&&(g.blockedOn=null)}}for(ad!==null&&Z_(ad,i),ld!==null&&Z_(ld,i),cd!==null&&Z_(cd,i),wy.forEach(l),by.forEach(l),h=0;h<Ku.length;h++)g=Ku[h],g.blockedOn===i&&(g.blockedOn=null);for(;0<Ku.length&&(h=Ku[0],h.blockedOn===null);)RL(h),h.blockedOn===null&&Ku.shift()}var dm=lu.ReactCurrentBatchConfig,t1=!0;function gU(i,l,h,g){var w=Cr,S=dm.transition;dm.transition=null;try{Cr=1,qS(i,l,h,g)}finally{Cr=w,dm.transition=S}}function _U(i,l,h,g){var w=Cr,S=dm.transition;dm.transition=null;try{Cr=4,qS(i,l,h,g)}finally{Cr=w,dm.transition=S}}function qS(i,l,h,g){if(t1){var w=A2(i,l,h,g);if(w===null)zT(i,l,g,n1,h),EM(i,g);else if(pU(w,i,l,h,g))g.stopPropagation();else if(EM(i,g),l&4&&-1<fU.indexOf(i)){for(;w!==null;){var S=Xy(w);if(S!==null&&CL(S),S=A2(i,l,h,g),S===null&&zT(i,l,g,n1,h),S===w)break;w=S}w!==null&&g.stopPropagation()}else zT(i,l,g,null,h)}}var n1=null;function A2(i,l,h,g){if(n1=null,i=$S(g),i=Ch(i),i!==null)if(l=Jh(i),l===null)i=null;else if(h=l.tag,h===13){if(i=vL(l),i!==null)return i;i=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;i=null}else l!==i&&(i=null);return n1=i,null}function DL(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rU()){case GS:return 1;case TL:return 4;case Jx:case oU:return 16;case SL:return 536870912;default:return 16}default:return 16}}var rd=null,ZS=null,Ox=null;function LL(){if(Ox)return Ox;var i,l=ZS,h=l.length,g,w="value"in rd?rd.value:rd.textContent,S=w.length;for(i=0;i<h&&l[i]===w[i];i++);var R=h-i;for(g=1;g<=R&&l[h-g]===w[S-g];g++);return Ox=w.slice(i,1<g?1-g:void 0)}function Fx(i){var l=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&l===13&&(i=13)):i=l,i===10&&(i=13),32<=i||i===13?i:0}function ux(){return!0}function CM(){return!1}function wa(i){function l(h,g,w,S,R){this._reactName=h,this._targetInst=w,this.type=g,this.nativeEvent=S,this.target=R,this.currentTarget=null;for(var o in i)i.hasOwnProperty(o)&&(h=i[o],this[o]=h?h(S):S[o]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?ux:CM,this.isPropagationStopped=CM,this}return ro(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ux)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ux)},persist:function(){},isPersistent:ux}),l}var jm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},XS=wa(jm),Zy=ro({},jm,{view:0,detail:0}),yU=wa(Zy),IT,CT,X_,k1=ro({},Zy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:YS,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==X_&&(X_&&i.type==="mousemove"?(IT=i.screenX-X_.screenX,CT=i.screenY-X_.screenY):CT=IT=0,X_=i),IT)},movementY:function(i){return"movementY"in i?i.movementY:CT}}),AM=wa(k1),vU=ro({},k1,{dataTransfer:0}),xU=wa(vU),wU=ro({},Zy,{relatedTarget:0}),AT=wa(wU),bU=ro({},jm,{animationName:0,elapsedTime:0,pseudoElement:0}),TU=wa(bU),SU=ro({},jm,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),EU=wa(SU),IU=ro({},jm,{data:0}),PM=wa(IU),CU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},PU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MU(i){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(i):(i=PU[i])?!!l[i]:!1}function YS(){return MU}var RU=ro({},Zy,{key:function(i){if(i.key){var l=CU[i.key]||i.key;if(l!=="Unidentified")return l}return i.type==="keypress"?(i=Fx(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?AU[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:YS,charCode:function(i){return i.type==="keypress"?Fx(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Fx(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),DU=wa(RU),LU=ro({},k1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),MM=wa(LU),kU=ro({},Zy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:YS}),zU=wa(kU),OU=ro({},jm,{propertyName:0,elapsedTime:0,pseudoElement:0}),FU=wa(OU),NU=ro({},k1,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),BU=wa(NU),jU=[9,13,27,32],KS=nu&&"CompositionEvent"in window,cy=null;nu&&"documentMode"in document&&(cy=document.documentMode);var UU=nu&&"TextEvent"in window&&!cy,kL=nu&&(!KS||cy&&8<cy&&11>=cy),RM=" ",DM=!1;function zL(i,l){switch(i){case"keyup":return jU.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OL(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Qp=!1;function VU(i,l){switch(i){case"compositionend":return OL(l);case"keypress":return l.which!==32?null:(DM=!0,RM);case"textInput":return i=l.data,i===RM&&DM?null:i;default:return null}}function $U(i,l){if(Qp)return i==="compositionend"||!KS&&zL(i,l)?(i=LL(),Ox=ZS=rd=null,Qp=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return kL&&l.locale!=="ko"?null:l.data;default:return null}}var GU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function LM(i){var l=i&&i.nodeName&&i.nodeName.toLowerCase();return l==="input"?!!GU[i.type]:l==="textarea"}function FL(i,l,h,g){pL(g),l=i1(l,"onChange"),0<l.length&&(h=new XS("onChange","change",null,h,g),i.push({event:h,listeners:l}))}var uy=null,Sy=null;function HU(i){ZL(i,0)}function z1(i){var l=tm(i);if(aL(l))return i}function WU(i,l){if(i==="change")return l}var NL=!1;if(nu){var PT;if(nu){var MT="oninput"in document;if(!MT){var kM=document.createElement("div");kM.setAttribute("oninput","return;"),MT=typeof kM.oninput=="function"}PT=MT}else PT=!1;NL=PT&&(!document.documentMode||9<document.documentMode)}function zM(){uy&&(uy.detachEvent("onpropertychange",BL),Sy=uy=null)}function BL(i){if(i.propertyName==="value"&&z1(Sy)){var l=[];FL(l,Sy,i,$S(i)),yL(HU,l)}}function qU(i,l,h){i==="focusin"?(zM(),uy=l,Sy=h,uy.attachEvent("onpropertychange",BL)):i==="focusout"&&zM()}function ZU(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return z1(Sy)}function XU(i,l){if(i==="click")return z1(l)}function YU(i,l){if(i==="input"||i==="change")return z1(l)}function KU(i,l){return i===l&&(i!==0||1/i===1/l)||i!==i&&l!==l}var Dl=typeof Object.is=="function"?Object.is:KU;function Ey(i,l){if(Dl(i,l))return!0;if(typeof i!="object"||i===null||typeof l!="object"||l===null)return!1;var h=Object.keys(i),g=Object.keys(l);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var w=h[g];if(!u2.call(l,w)||!Dl(i[w],l[w]))return!1}return!0}function OM(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function FM(i,l){var h=OM(i);i=0;for(var g;h;){if(h.nodeType===3){if(g=i+h.textContent.length,i<=l&&g>=l)return{node:h,offset:l-i};i=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=OM(h)}}function jL(i,l){return i&&l?i===l?!0:i&&i.nodeType===3?!1:l&&l.nodeType===3?jL(i,l.parentNode):"contains"in i?i.contains(l):i.compareDocumentPosition?!!(i.compareDocumentPosition(l)&16):!1:!1}function UL(){for(var i=window,l=Yx();l instanceof i.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)i=l.contentWindow;else break;l=Yx(i.document)}return l}function QS(i){var l=i&&i.nodeName&&i.nodeName.toLowerCase();return l&&(l==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||l==="textarea"||i.contentEditable==="true")}function QU(i){var l=UL(),h=i.focusedElem,g=i.selectionRange;if(l!==h&&h&&h.ownerDocument&&jL(h.ownerDocument.documentElement,h)){if(g!==null&&QS(h)){if(l=g.start,i=g.end,i===void 0&&(i=l),"selectionStart"in h)h.selectionStart=l,h.selectionEnd=Math.min(i,h.value.length);else if(i=(l=h.ownerDocument||document)&&l.defaultView||window,i.getSelection){i=i.getSelection();var w=h.textContent.length,S=Math.min(g.start,w);g=g.end===void 0?S:Math.min(g.end,w),!i.extend&&S>g&&(w=g,g=S,S=w),w=FM(h,S);var R=FM(h,g);w&&R&&(i.rangeCount!==1||i.anchorNode!==w.node||i.anchorOffset!==w.offset||i.focusNode!==R.node||i.focusOffset!==R.offset)&&(l=l.createRange(),l.setStart(w.node,w.offset),i.removeAllRanges(),S>g?(i.addRange(l),i.extend(R.node,R.offset)):(l.setEnd(R.node,R.offset),i.addRange(l)))}}for(l=[],i=h;i=i.parentNode;)i.nodeType===1&&l.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<l.length;h++)i=l[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var JU=nu&&"documentMode"in document&&11>=document.documentMode,Jp=null,P2=null,dy=null,M2=!1;function NM(i,l,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;M2||Jp==null||Jp!==Yx(g)||(g=Jp,"selectionStart"in g&&QS(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),dy&&Ey(dy,g)||(dy=g,g=i1(P2,"onSelect"),0<g.length&&(l=new XS("onSelect","select",null,l,h),i.push({event:l,listeners:g}),l.target=Jp)))}function dx(i,l){var h={};return h[i.toLowerCase()]=l.toLowerCase(),h["Webkit"+i]="webkit"+l,h["Moz"+i]="moz"+l,h}var em={animationend:dx("Animation","AnimationEnd"),animationiteration:dx("Animation","AnimationIteration"),animationstart:dx("Animation","AnimationStart"),transitionend:dx("Transition","TransitionEnd")},RT={},VL={};nu&&(VL=document.createElement("div").style,"AnimationEvent"in window||(delete em.animationend.animation,delete em.animationiteration.animation,delete em.animationstart.animation),"TransitionEvent"in window||delete em.transitionend.transition);function O1(i){if(RT[i])return RT[i];if(!em[i])return i;var l=em[i],h;for(h in l)if(l.hasOwnProperty(h)&&h in VL)return RT[i]=l[h];return i}var $L=O1("animationend"),GL=O1("animationiteration"),HL=O1("animationstart"),WL=O1("transitionend"),qL=new Map,BM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wd(i,l){qL.set(i,l),Qh(l,[i])}for(var DT=0;DT<BM.length;DT++){var LT=BM[DT],eV=LT.toLowerCase(),tV=LT[0].toUpperCase()+LT.slice(1);wd(eV,"on"+tV)}wd($L,"onAnimationEnd");wd(GL,"onAnimationIteration");wd(HL,"onAnimationStart");wd("dblclick","onDoubleClick");wd("focusin","onFocus");wd("focusout","onBlur");wd(WL,"onTransitionEnd");Cm("onMouseEnter",["mouseout","mouseover"]);Cm("onMouseLeave",["mouseout","mouseover"]);Cm("onPointerEnter",["pointerout","pointerover"]);Cm("onPointerLeave",["pointerout","pointerover"]);Qh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ry="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nV=new Set("cancel close invalid load scroll toggle".split(" ").concat(ry));function jM(i,l,h){var g=i.type||"unknown-event";i.currentTarget=h,eU(g,l,void 0,i),i.currentTarget=null}function ZL(i,l){l=(l&4)!==0;for(var h=0;h<i.length;h++){var g=i[h],w=g.event;g=g.listeners;e:{var S=void 0;if(l)for(var R=g.length-1;0<=R;R--){var o=g[R],N=o.instance,B=o.currentTarget;if(o=o.listener,N!==S&&w.isPropagationStopped())break e;jM(w,o,B),S=N}else for(R=0;R<g.length;R++){if(o=g[R],N=o.instance,B=o.currentTarget,o=o.listener,N!==S&&w.isPropagationStopped())break e;jM(w,o,B),S=N}}}if(Qx)throw i=E2,Qx=!1,E2=null,i}function Gr(i,l){var h=l[z2];h===void 0&&(h=l[z2]=new Set);var g=i+"__bubble";h.has(g)||(XL(l,i,2,!1),h.add(g))}function kT(i,l,h){var g=0;l&&(g|=4),XL(h,i,g,l)}var hx="_reactListening"+Math.random().toString(36).slice(2);function Iy(i){if(!i[hx]){i[hx]=!0,nL.forEach(function(h){h!=="selectionchange"&&(nV.has(h)||kT(h,!1,i),kT(h,!0,i))});var l=i.nodeType===9?i:i.ownerDocument;l===null||l[hx]||(l[hx]=!0,kT("selectionchange",!1,l))}}function XL(i,l,h,g){switch(DL(l)){case 1:var w=gU;break;case 4:w=_U;break;default:w=qS}h=w.bind(null,l,h,i),w=void 0,!S2||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(w=!0),g?w!==void 0?i.addEventListener(l,h,{capture:!0,passive:w}):i.addEventListener(l,h,!0):w!==void 0?i.addEventListener(l,h,{passive:w}):i.addEventListener(l,h,!1)}function zT(i,l,h,g,w){var S=g;if(!(l&1)&&!(l&2)&&g!==null)e:for(;;){if(g===null)return;var R=g.tag;if(R===3||R===4){var o=g.stateNode.containerInfo;if(o===w||o.nodeType===8&&o.parentNode===w)break;if(R===4)for(R=g.return;R!==null;){var N=R.tag;if((N===3||N===4)&&(N=R.stateNode.containerInfo,N===w||N.nodeType===8&&N.parentNode===w))return;R=R.return}for(;o!==null;){if(R=Ch(o),R===null)return;if(N=R.tag,N===5||N===6){g=S=R;continue e}o=o.parentNode}}g=g.return}yL(function(){var B=S,q=$S(h),Y=[];e:{var J=qL.get(i);if(J!==void 0){var ie=XS,be=i;switch(i){case"keypress":if(Fx(h)===0)break e;case"keydown":case"keyup":ie=DU;break;case"focusin":be="focus",ie=AT;break;case"focusout":be="blur",ie=AT;break;case"beforeblur":case"afterblur":ie=AT;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=AM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=xU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=zU;break;case $L:case GL:case HL:ie=TU;break;case WL:ie=FU;break;case"scroll":ie=yU;break;case"wheel":ie=BU;break;case"copy":case"cut":case"paste":ie=EU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=MM}var te=(l&4)!==0,le=!te&&i==="scroll",ce=te?J!==null?J+"Capture":null:J;te=[];for(var oe=B,ue;oe!==null;){ue=oe;var Me=ue.stateNode;if(ue.tag===5&&Me!==null&&(ue=Me,ce!==null&&(Me=xy(oe,ce),Me!=null&&te.push(Cy(oe,Me,ue)))),le)break;oe=oe.return}0<te.length&&(J=new ie(J,be,null,h,q),Y.push({event:J,listeners:te}))}}if(!(l&7)){e:{if(J=i==="mouseover"||i==="pointerover",ie=i==="mouseout"||i==="pointerout",J&&h!==b2&&(be=h.relatedTarget||h.fromElement)&&(Ch(be)||be[iu]))break e;if((ie||J)&&(J=q.window===q?q:(J=q.ownerDocument)?J.defaultView||J.parentWindow:window,ie?(be=h.relatedTarget||h.toElement,ie=B,be=be?Ch(be):null,be!==null&&(le=Jh(be),be!==le||be.tag!==5&&be.tag!==6)&&(be=null)):(ie=null,be=B),ie!==be)){if(te=AM,Me="onMouseLeave",ce="onMouseEnter",oe="mouse",(i==="pointerout"||i==="pointerover")&&(te=MM,Me="onPointerLeave",ce="onPointerEnter",oe="pointer"),le=ie==null?J:tm(ie),ue=be==null?J:tm(be),J=new te(Me,oe+"leave",ie,h,q),J.target=le,J.relatedTarget=ue,Me=null,Ch(q)===B&&(te=new te(ce,oe+"enter",be,h,q),te.target=ue,te.relatedTarget=le,Me=te),le=Me,ie&&be)t:{for(te=ie,ce=be,oe=0,ue=te;ue;ue=Wp(ue))oe++;for(ue=0,Me=ce;Me;Me=Wp(Me))ue++;for(;0<oe-ue;)te=Wp(te),oe--;for(;0<ue-oe;)ce=Wp(ce),ue--;for(;oe--;){if(te===ce||ce!==null&&te===ce.alternate)break t;te=Wp(te),ce=Wp(ce)}te=null}else te=null;ie!==null&&UM(Y,J,ie,te,!1),be!==null&&le!==null&&UM(Y,le,be,te,!0)}}e:{if(J=B?tm(B):window,ie=J.nodeName&&J.nodeName.toLowerCase(),ie==="select"||ie==="input"&&J.type==="file")var Ne=WU;else if(LM(J))if(NL)Ne=YU;else{Ne=ZU;var je=qU}else(ie=J.nodeName)&&ie.toLowerCase()==="input"&&(J.type==="checkbox"||J.type==="radio")&&(Ne=XU);if(Ne&&(Ne=Ne(i,B))){FL(Y,Ne,h,q);break e}je&&je(i,J,B),i==="focusout"&&(je=J._wrapperState)&&je.controlled&&J.type==="number"&&_2(J,"number",J.value)}switch(je=B?tm(B):window,i){case"focusin":(LM(je)||je.contentEditable==="true")&&(Jp=je,P2=B,dy=null);break;case"focusout":dy=P2=Jp=null;break;case"mousedown":M2=!0;break;case"contextmenu":case"mouseup":case"dragend":M2=!1,NM(Y,h,q);break;case"selectionchange":if(JU)break;case"keydown":case"keyup":NM(Y,h,q)}var Te;if(KS)e:{switch(i){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else Qp?zL(i,h)&&(Ve="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(Ve="onCompositionStart");Ve&&(kL&&h.locale!=="ko"&&(Qp||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&Qp&&(Te=LL()):(rd=q,ZS="value"in rd?rd.value:rd.textContent,Qp=!0)),je=i1(B,Ve),0<je.length&&(Ve=new PM(Ve,i,null,h,q),Y.push({event:Ve,listeners:je}),Te?Ve.data=Te:(Te=OL(h),Te!==null&&(Ve.data=Te)))),(Te=UU?VU(i,h):$U(i,h))&&(B=i1(B,"onBeforeInput"),0<B.length&&(q=new PM("onBeforeInput","beforeinput",null,h,q),Y.push({event:q,listeners:B}),q.data=Te))}ZL(Y,l)})}function Cy(i,l,h){return{instance:i,listener:l,currentTarget:h}}function i1(i,l){for(var h=l+"Capture",g=[];i!==null;){var w=i,S=w.stateNode;w.tag===5&&S!==null&&(w=S,S=xy(i,h),S!=null&&g.unshift(Cy(i,S,w)),S=xy(i,l),S!=null&&g.push(Cy(i,S,w))),i=i.return}return g}function Wp(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function UM(i,l,h,g,w){for(var S=l._reactName,R=[];h!==null&&h!==g;){var o=h,N=o.alternate,B=o.stateNode;if(N!==null&&N===g)break;o.tag===5&&B!==null&&(o=B,w?(N=xy(h,S),N!=null&&R.unshift(Cy(h,N,o))):w||(N=xy(h,S),N!=null&&R.push(Cy(h,N,o)))),h=h.return}R.length!==0&&i.push({event:l,listeners:R})}var iV=/\r\n?/g,rV=/\u0000|\uFFFD/g;function VM(i){return(typeof i=="string"?i:""+i).replace(iV,`
`).replace(rV,"")}function fx(i,l,h){if(l=VM(l),VM(i)!==l&&h)throw Error(an(425))}function r1(){}var R2=null,D2=null;function L2(i,l){return i==="textarea"||i==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var k2=typeof setTimeout=="function"?setTimeout:void 0,oV=typeof clearTimeout=="function"?clearTimeout:void 0,$M=typeof Promise=="function"?Promise:void 0,sV=typeof queueMicrotask=="function"?queueMicrotask:typeof $M<"u"?function(i){return $M.resolve(null).then(i).catch(aV)}:k2;function aV(i){setTimeout(function(){throw i})}function OT(i,l){var h=l,g=0;do{var w=h.nextSibling;if(i.removeChild(h),w&&w.nodeType===8)if(h=w.data,h==="/$"){if(g===0){i.removeChild(w),Ty(l);return}g--}else h!=="$"&&h!=="$?"&&h!=="$!"||g++;h=w}while(h);Ty(l)}function ud(i){for(;i!=null;i=i.nextSibling){var l=i.nodeType;if(l===1||l===3)break;if(l===8){if(l=i.data,l==="$"||l==="$!"||l==="$?")break;if(l==="/$")return null}}return i}function GM(i){i=i.previousSibling;for(var l=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return i;l--}else h==="/$"&&l++}i=i.previousSibling}return null}var Um=Math.random().toString(36).slice(2),uc="__reactFiber$"+Um,Ay="__reactProps$"+Um,iu="__reactContainer$"+Um,z2="__reactEvents$"+Um,lV="__reactListeners$"+Um,cV="__reactHandles$"+Um;function Ch(i){var l=i[uc];if(l)return l;for(var h=i.parentNode;h;){if(l=h[iu]||h[uc]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(i=GM(i);i!==null;){if(h=i[uc])return h;i=GM(i)}return l}i=h,h=i.parentNode}return null}function Xy(i){return i=i[uc]||i[iu],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function tm(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(an(33))}function F1(i){return i[Ay]||null}var O2=[],nm=-1;function bd(i){return{current:i}}function Hr(i){0>nm||(i.current=O2[nm],O2[nm]=null,nm--)}function Br(i,l){nm++,O2[nm]=i.current,i.current=l}var yd={},fs=bd(yd),Ys=bd(!1),jh=yd;function Am(i,l){var h=i.type.contextTypes;if(!h)return yd;var g=i.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===l)return g.__reactInternalMemoizedMaskedChildContext;var w={},S;for(S in h)w[S]=l[S];return g&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=l,i.__reactInternalMemoizedMaskedChildContext=w),w}function Ks(i){return i=i.childContextTypes,i!=null}function o1(){Hr(Ys),Hr(fs)}function HM(i,l,h){if(fs.current!==yd)throw Error(an(168));Br(fs,l),Br(Ys,h)}function YL(i,l,h){var g=i.stateNode;if(l=l.childContextTypes,typeof g.getChildContext!="function")return h;g=g.getChildContext();for(var w in g)if(!(w in l))throw Error(an(108,qj(i)||"Unknown",w));return ro({},h,g)}function s1(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||yd,jh=fs.current,Br(fs,i),Br(Ys,Ys.current),!0}function WM(i,l,h){var g=i.stateNode;if(!g)throw Error(an(169));h?(i=YL(i,l,jh),g.__reactInternalMemoizedMergedChildContext=i,Hr(Ys),Hr(fs),Br(fs,i)):Hr(Ys),Br(Ys,h)}var Xc=null,N1=!1,FT=!1;function KL(i){Xc===null?Xc=[i]:Xc.push(i)}function uV(i){N1=!0,KL(i)}function Td(){if(!FT&&Xc!==null){FT=!0;var i=0,l=Cr;try{var h=Xc;for(Cr=1;i<h.length;i++){var g=h[i];do g=g(!0);while(g!==null)}Xc=null,N1=!1}catch(w){throw Xc!==null&&(Xc=Xc.slice(i+1)),bL(GS,Td),w}finally{Cr=l,FT=!1}}return null}var im=[],rm=0,a1=null,l1=0,Va=[],$a=0,Uh=null,Kc=1,Qc="";function Th(i,l){im[rm++]=l1,im[rm++]=a1,a1=i,l1=l}function QL(i,l,h){Va[$a++]=Kc,Va[$a++]=Qc,Va[$a++]=Uh,Uh=i;var g=Kc;i=Qc;var w=32-Ml(g)-1;g&=~(1<<w),h+=1;var S=32-Ml(l)+w;if(30<S){var R=w-w%5;S=(g&(1<<R)-1).toString(32),g>>=R,w-=R,Kc=1<<32-Ml(l)+w|h<<w|g,Qc=S+i}else Kc=1<<S|h<<w|g,Qc=i}function JS(i){i.return!==null&&(Th(i,1),QL(i,1,0))}function eE(i){for(;i===a1;)a1=im[--rm],im[rm]=null,l1=im[--rm],im[rm]=null;for(;i===Uh;)Uh=Va[--$a],Va[$a]=null,Qc=Va[--$a],Va[$a]=null,Kc=Va[--$a],Va[$a]=null}var _a=null,ga=null,Kr=!1,Pl=null;function JL(i,l){var h=Ga(5,null,null,0);h.elementType="DELETED",h.stateNode=l,h.return=i,l=i.deletions,l===null?(i.deletions=[h],i.flags|=16):l.push(h)}function qM(i,l){switch(i.tag){case 5:var h=i.type;return l=l.nodeType!==1||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(i.stateNode=l,_a=i,ga=ud(l.firstChild),!0):!1;case 6:return l=i.pendingProps===""||l.nodeType!==3?null:l,l!==null?(i.stateNode=l,_a=i,ga=null,!0):!1;case 13:return l=l.nodeType!==8?null:l,l!==null?(h=Uh!==null?{id:Kc,overflow:Qc}:null,i.memoizedState={dehydrated:l,treeContext:h,retryLane:1073741824},h=Ga(18,null,null,0),h.stateNode=l,h.return=i,i.child=h,_a=i,ga=null,!0):!1;default:return!1}}function F2(i){return(i.mode&1)!==0&&(i.flags&128)===0}function N2(i){if(Kr){var l=ga;if(l){var h=l;if(!qM(i,l)){if(F2(i))throw Error(an(418));l=ud(h.nextSibling);var g=_a;l&&qM(i,l)?JL(g,h):(i.flags=i.flags&-4097|2,Kr=!1,_a=i)}}else{if(F2(i))throw Error(an(418));i.flags=i.flags&-4097|2,Kr=!1,_a=i}}}function ZM(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;_a=i}function px(i){if(i!==_a)return!1;if(!Kr)return ZM(i),Kr=!0,!1;var l;if((l=i.tag!==3)&&!(l=i.tag!==5)&&(l=i.type,l=l!=="head"&&l!=="body"&&!L2(i.type,i.memoizedProps)),l&&(l=ga)){if(F2(i))throw ek(),Error(an(418));for(;l;)JL(i,l),l=ud(l.nextSibling)}if(ZM(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(an(317));e:{for(i=i.nextSibling,l=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(l===0){ga=ud(i.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++}i=i.nextSibling}ga=null}}else ga=_a?ud(i.stateNode.nextSibling):null;return!0}function ek(){for(var i=ga;i;)i=ud(i.nextSibling)}function Pm(){ga=_a=null,Kr=!1}function tE(i){Pl===null?Pl=[i]:Pl.push(i)}var dV=lu.ReactCurrentBatchConfig;function Y_(i,l,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(an(309));var g=h.stateNode}if(!g)throw Error(an(147,i));var w=g,S=""+i;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===S?l.ref:(l=function(R){var o=w.refs;R===null?delete o[S]:o[S]=R},l._stringRef=S,l)}if(typeof i!="string")throw Error(an(284));if(!h._owner)throw Error(an(290,i))}return i}function mx(i,l){throw i=Object.prototype.toString.call(l),Error(an(31,i==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":i))}function XM(i){var l=i._init;return l(i._payload)}function tk(i){function l(ce,oe){if(i){var ue=ce.deletions;ue===null?(ce.deletions=[oe],ce.flags|=16):ue.push(oe)}}function h(ce,oe){if(!i)return null;for(;oe!==null;)l(ce,oe),oe=oe.sibling;return null}function g(ce,oe){for(ce=new Map;oe!==null;)oe.key!==null?ce.set(oe.key,oe):ce.set(oe.index,oe),oe=oe.sibling;return ce}function w(ce,oe){return ce=pd(ce,oe),ce.index=0,ce.sibling=null,ce}function S(ce,oe,ue){return ce.index=ue,i?(ue=ce.alternate,ue!==null?(ue=ue.index,ue<oe?(ce.flags|=2,oe):ue):(ce.flags|=2,oe)):(ce.flags|=1048576,oe)}function R(ce){return i&&ce.alternate===null&&(ce.flags|=2),ce}function o(ce,oe,ue,Me){return oe===null||oe.tag!==6?(oe=GT(ue,ce.mode,Me),oe.return=ce,oe):(oe=w(oe,ue),oe.return=ce,oe)}function N(ce,oe,ue,Me){var Ne=ue.type;return Ne===Kp?q(ce,oe,ue.props.children,Me,ue.key):oe!==null&&(oe.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Xu&&XM(Ne)===oe.type)?(Me=w(oe,ue.props),Me.ref=Y_(ce,oe,ue),Me.return=ce,Me):(Me=Gx(ue.type,ue.key,ue.props,null,ce.mode,Me),Me.ref=Y_(ce,oe,ue),Me.return=ce,Me)}function B(ce,oe,ue,Me){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==ue.containerInfo||oe.stateNode.implementation!==ue.implementation?(oe=HT(ue,ce.mode,Me),oe.return=ce,oe):(oe=w(oe,ue.children||[]),oe.return=ce,oe)}function q(ce,oe,ue,Me,Ne){return oe===null||oe.tag!==7?(oe=Fh(ue,ce.mode,Me,Ne),oe.return=ce,oe):(oe=w(oe,ue),oe.return=ce,oe)}function Y(ce,oe,ue){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=GT(""+oe,ce.mode,ue),oe.return=ce,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case rx:return ue=Gx(oe.type,oe.key,oe.props,null,ce.mode,ue),ue.ref=Y_(ce,null,oe),ue.return=ce,ue;case Yp:return oe=HT(oe,ce.mode,ue),oe.return=ce,oe;case Xu:var Me=oe._init;return Y(ce,Me(oe._payload),ue)}if(ny(oe)||H_(oe))return oe=Fh(oe,ce.mode,ue,null),oe.return=ce,oe;mx(ce,oe)}return null}function J(ce,oe,ue,Me){var Ne=oe!==null?oe.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return Ne!==null?null:o(ce,oe,""+ue,Me);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case rx:return ue.key===Ne?N(ce,oe,ue,Me):null;case Yp:return ue.key===Ne?B(ce,oe,ue,Me):null;case Xu:return Ne=ue._init,J(ce,oe,Ne(ue._payload),Me)}if(ny(ue)||H_(ue))return Ne!==null?null:q(ce,oe,ue,Me,null);mx(ce,ue)}return null}function ie(ce,oe,ue,Me,Ne){if(typeof Me=="string"&&Me!==""||typeof Me=="number")return ce=ce.get(ue)||null,o(oe,ce,""+Me,Ne);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case rx:return ce=ce.get(Me.key===null?ue:Me.key)||null,N(oe,ce,Me,Ne);case Yp:return ce=ce.get(Me.key===null?ue:Me.key)||null,B(oe,ce,Me,Ne);case Xu:var je=Me._init;return ie(ce,oe,ue,je(Me._payload),Ne)}if(ny(Me)||H_(Me))return ce=ce.get(ue)||null,q(oe,ce,Me,Ne,null);mx(oe,Me)}return null}function be(ce,oe,ue,Me){for(var Ne=null,je=null,Te=oe,Ve=oe=0,nt=null;Te!==null&&Ve<ue.length;Ve++){Te.index>Ve?(nt=Te,Te=null):nt=Te.sibling;var At=J(ce,Te,ue[Ve],Me);if(At===null){Te===null&&(Te=nt);break}i&&Te&&At.alternate===null&&l(ce,Te),oe=S(At,oe,Ve),je===null?Ne=At:je.sibling=At,je=At,Te=nt}if(Ve===ue.length)return h(ce,Te),Kr&&Th(ce,Ve),Ne;if(Te===null){for(;Ve<ue.length;Ve++)Te=Y(ce,ue[Ve],Me),Te!==null&&(oe=S(Te,oe,Ve),je===null?Ne=Te:je.sibling=Te,je=Te);return Kr&&Th(ce,Ve),Ne}for(Te=g(ce,Te);Ve<ue.length;Ve++)nt=ie(Te,ce,Ve,ue[Ve],Me),nt!==null&&(i&&nt.alternate!==null&&Te.delete(nt.key===null?Ve:nt.key),oe=S(nt,oe,Ve),je===null?Ne=nt:je.sibling=nt,je=nt);return i&&Te.forEach(function(cn){return l(ce,cn)}),Kr&&Th(ce,Ve),Ne}function te(ce,oe,ue,Me){var Ne=H_(ue);if(typeof Ne!="function")throw Error(an(150));if(ue=Ne.call(ue),ue==null)throw Error(an(151));for(var je=Ne=null,Te=oe,Ve=oe=0,nt=null,At=ue.next();Te!==null&&!At.done;Ve++,At=ue.next()){Te.index>Ve?(nt=Te,Te=null):nt=Te.sibling;var cn=J(ce,Te,At.value,Me);if(cn===null){Te===null&&(Te=nt);break}i&&Te&&cn.alternate===null&&l(ce,Te),oe=S(cn,oe,Ve),je===null?Ne=cn:je.sibling=cn,je=cn,Te=nt}if(At.done)return h(ce,Te),Kr&&Th(ce,Ve),Ne;if(Te===null){for(;!At.done;Ve++,At=ue.next())At=Y(ce,At.value,Me),At!==null&&(oe=S(At,oe,Ve),je===null?Ne=At:je.sibling=At,je=At);return Kr&&Th(ce,Ve),Ne}for(Te=g(ce,Te);!At.done;Ve++,At=ue.next())At=ie(Te,ce,Ve,At.value,Me),At!==null&&(i&&At.alternate!==null&&Te.delete(At.key===null?Ve:At.key),oe=S(At,oe,Ve),je===null?Ne=At:je.sibling=At,je=At);return i&&Te.forEach(function(qt){return l(ce,qt)}),Kr&&Th(ce,Ve),Ne}function le(ce,oe,ue,Me){if(typeof ue=="object"&&ue!==null&&ue.type===Kp&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case rx:e:{for(var Ne=ue.key,je=oe;je!==null;){if(je.key===Ne){if(Ne=ue.type,Ne===Kp){if(je.tag===7){h(ce,je.sibling),oe=w(je,ue.props.children),oe.return=ce,ce=oe;break e}}else if(je.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===Xu&&XM(Ne)===je.type){h(ce,je.sibling),oe=w(je,ue.props),oe.ref=Y_(ce,je,ue),oe.return=ce,ce=oe;break e}h(ce,je);break}else l(ce,je);je=je.sibling}ue.type===Kp?(oe=Fh(ue.props.children,ce.mode,Me,ue.key),oe.return=ce,ce=oe):(Me=Gx(ue.type,ue.key,ue.props,null,ce.mode,Me),Me.ref=Y_(ce,oe,ue),Me.return=ce,ce=Me)}return R(ce);case Yp:e:{for(je=ue.key;oe!==null;){if(oe.key===je)if(oe.tag===4&&oe.stateNode.containerInfo===ue.containerInfo&&oe.stateNode.implementation===ue.implementation){h(ce,oe.sibling),oe=w(oe,ue.children||[]),oe.return=ce,ce=oe;break e}else{h(ce,oe);break}else l(ce,oe);oe=oe.sibling}oe=HT(ue,ce.mode,Me),oe.return=ce,ce=oe}return R(ce);case Xu:return je=ue._init,le(ce,oe,je(ue._payload),Me)}if(ny(ue))return be(ce,oe,ue,Me);if(H_(ue))return te(ce,oe,ue,Me);mx(ce,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,oe!==null&&oe.tag===6?(h(ce,oe.sibling),oe=w(oe,ue),oe.return=ce,ce=oe):(h(ce,oe),oe=GT(ue,ce.mode,Me),oe.return=ce,ce=oe),R(ce)):h(ce,oe)}return le}var Mm=tk(!0),nk=tk(!1),c1=bd(null),u1=null,om=null,nE=null;function iE(){nE=om=u1=null}function rE(i){var l=c1.current;Hr(c1),i._currentValue=l}function B2(i,l,h){for(;i!==null;){var g=i.alternate;if((i.childLanes&l)!==l?(i.childLanes|=l,g!==null&&(g.childLanes|=l)):g!==null&&(g.childLanes&l)!==l&&(g.childLanes|=l),i===h)break;i=i.return}}function hm(i,l){u1=i,nE=om=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&l&&(Xs=!0),i.firstContext=null)}function qa(i){var l=i._currentValue;if(nE!==i)if(i={context:i,memoizedValue:l,next:null},om===null){if(u1===null)throw Error(an(308));om=i,u1.dependencies={lanes:0,firstContext:i}}else om=om.next=i;return l}var Ah=null;function oE(i){Ah===null?Ah=[i]:Ah.push(i)}function ik(i,l,h,g){var w=l.interleaved;return w===null?(h.next=h,oE(l)):(h.next=w.next,w.next=h),l.interleaved=h,ru(i,g)}function ru(i,l){i.lanes|=l;var h=i.alternate;for(h!==null&&(h.lanes|=l),h=i,i=i.return;i!==null;)i.childLanes|=l,h=i.alternate,h!==null&&(h.childLanes|=l),h=i,i=i.return;return h.tag===3?h.stateNode:null}var Yu=!1;function sE(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function rk(i,l){i=i.updateQueue,l.updateQueue===i&&(l.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function eu(i,l){return{eventTime:i,lane:l,tag:0,payload:null,callback:null,next:null}}function dd(i,l,h){var g=i.updateQueue;if(g===null)return null;if(g=g.shared,fr&2){var w=g.pending;return w===null?l.next=l:(l.next=w.next,w.next=l),g.pending=l,ru(i,h)}return w=g.interleaved,w===null?(l.next=l,oE(g)):(l.next=w.next,w.next=l),g.interleaved=l,ru(i,h)}function Nx(i,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194240)!==0)){var g=l.lanes;g&=i.pendingLanes,h|=g,l.lanes=h,HS(i,h)}}function YM(i,l){var h=i.updateQueue,g=i.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var w=null,S=null;if(h=h.firstBaseUpdate,h!==null){do{var R={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};S===null?w=S=R:S=S.next=R,h=h.next}while(h!==null);S===null?w=S=l:S=S.next=l}else w=S=l;h={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:S,shared:g.shared,effects:g.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=l:i.next=l,h.lastBaseUpdate=l}function d1(i,l,h,g){var w=i.updateQueue;Yu=!1;var S=w.firstBaseUpdate,R=w.lastBaseUpdate,o=w.shared.pending;if(o!==null){w.shared.pending=null;var N=o,B=N.next;N.next=null,R===null?S=B:R.next=B,R=N;var q=i.alternate;q!==null&&(q=q.updateQueue,o=q.lastBaseUpdate,o!==R&&(o===null?q.firstBaseUpdate=B:o.next=B,q.lastBaseUpdate=N))}if(S!==null){var Y=w.baseState;R=0,q=B=N=null,o=S;do{var J=o.lane,ie=o.eventTime;if((g&J)===J){q!==null&&(q=q.next={eventTime:ie,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var be=i,te=o;switch(J=l,ie=h,te.tag){case 1:if(be=te.payload,typeof be=="function"){Y=be.call(ie,Y,J);break e}Y=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=te.payload,J=typeof be=="function"?be.call(ie,Y,J):be,J==null)break e;Y=ro({},Y,J);break e;case 2:Yu=!0}}o.callback!==null&&o.lane!==0&&(i.flags|=64,J=w.effects,J===null?w.effects=[o]:J.push(o))}else ie={eventTime:ie,lane:J,tag:o.tag,payload:o.payload,callback:o.callback,next:null},q===null?(B=q=ie,N=Y):q=q.next=ie,R|=J;if(o=o.next,o===null){if(o=w.shared.pending,o===null)break;J=o,o=J.next,J.next=null,w.lastBaseUpdate=J,w.shared.pending=null}}while(!0);if(q===null&&(N=Y),w.baseState=N,w.firstBaseUpdate=B,w.lastBaseUpdate=q,l=w.shared.interleaved,l!==null){w=l;do R|=w.lane,w=w.next;while(w!==l)}else S===null&&(w.shared.lanes=0);$h|=R,i.lanes=R,i.memoizedState=Y}}function KM(i,l,h){if(i=l.effects,l.effects=null,i!==null)for(l=0;l<i.length;l++){var g=i[l],w=g.callback;if(w!==null){if(g.callback=null,g=h,typeof w!="function")throw Error(an(191,w));w.call(g)}}}var Yy={},pc=bd(Yy),Py=bd(Yy),My=bd(Yy);function Ph(i){if(i===Yy)throw Error(an(174));return i}function aE(i,l){switch(Br(My,l),Br(Py,i),Br(pc,Yy),i=l.nodeType,i){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:v2(null,"");break;default:i=i===8?l.parentNode:l,l=i.namespaceURI||null,i=i.tagName,l=v2(l,i)}Hr(pc),Br(pc,l)}function Rm(){Hr(pc),Hr(Py),Hr(My)}function ok(i){Ph(My.current);var l=Ph(pc.current),h=v2(l,i.type);l!==h&&(Br(Py,i),Br(pc,h))}function lE(i){Py.current===i&&(Hr(pc),Hr(Py))}var no=bd(0);function h1(i){for(var l=i;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if(l.flags&128)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var NT=[];function cE(){for(var i=0;i<NT.length;i++)NT[i]._workInProgressVersionPrimary=null;NT.length=0}var Bx=lu.ReactCurrentDispatcher,BT=lu.ReactCurrentBatchConfig,Vh=0,io=null,ko=null,Ho=null,f1=!1,hy=!1,Ry=0,hV=0;function cs(){throw Error(an(321))}function uE(i,l){if(l===null)return!1;for(var h=0;h<l.length&&h<i.length;h++)if(!Dl(i[h],l[h]))return!1;return!0}function dE(i,l,h,g,w,S){if(Vh=S,io=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,Bx.current=i===null||i.memoizedState===null?gV:_V,i=h(g,w),hy){S=0;do{if(hy=!1,Ry=0,25<=S)throw Error(an(301));S+=1,Ho=ko=null,l.updateQueue=null,Bx.current=yV,i=h(g,w)}while(hy)}if(Bx.current=p1,l=ko!==null&&ko.next!==null,Vh=0,Ho=ko=io=null,f1=!1,l)throw Error(an(300));return i}function hE(){var i=Ry!==0;return Ry=0,i}function sc(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ho===null?io.memoizedState=Ho=i:Ho=Ho.next=i,Ho}function Za(){if(ko===null){var i=io.alternate;i=i!==null?i.memoizedState:null}else i=ko.next;var l=Ho===null?io.memoizedState:Ho.next;if(l!==null)Ho=l,ko=i;else{if(i===null)throw Error(an(310));ko=i,i={memoizedState:ko.memoizedState,baseState:ko.baseState,baseQueue:ko.baseQueue,queue:ko.queue,next:null},Ho===null?io.memoizedState=Ho=i:Ho=Ho.next=i}return Ho}function Dy(i,l){return typeof l=="function"?l(i):l}function jT(i){var l=Za(),h=l.queue;if(h===null)throw Error(an(311));h.lastRenderedReducer=i;var g=ko,w=g.baseQueue,S=h.pending;if(S!==null){if(w!==null){var R=w.next;w.next=S.next,S.next=R}g.baseQueue=w=S,h.pending=null}if(w!==null){S=w.next,g=g.baseState;var o=R=null,N=null,B=S;do{var q=B.lane;if((Vh&q)===q)N!==null&&(N=N.next={lane:0,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null}),g=B.hasEagerState?B.eagerState:i(g,B.action);else{var Y={lane:q,action:B.action,hasEagerState:B.hasEagerState,eagerState:B.eagerState,next:null};N===null?(o=N=Y,R=g):N=N.next=Y,io.lanes|=q,$h|=q}B=B.next}while(B!==null&&B!==S);N===null?R=g:N.next=o,Dl(g,l.memoizedState)||(Xs=!0),l.memoizedState=g,l.baseState=R,l.baseQueue=N,h.lastRenderedState=g}if(i=h.interleaved,i!==null){w=i;do S=w.lane,io.lanes|=S,$h|=S,w=w.next;while(w!==i)}else w===null&&(h.lanes=0);return[l.memoizedState,h.dispatch]}function UT(i){var l=Za(),h=l.queue;if(h===null)throw Error(an(311));h.lastRenderedReducer=i;var g=h.dispatch,w=h.pending,S=l.memoizedState;if(w!==null){h.pending=null;var R=w=w.next;do S=i(S,R.action),R=R.next;while(R!==w);Dl(S,l.memoizedState)||(Xs=!0),l.memoizedState=S,l.baseQueue===null&&(l.baseState=S),h.lastRenderedState=S}return[S,g]}function sk(){}function ak(i,l){var h=io,g=Za(),w=l(),S=!Dl(g.memoizedState,w);if(S&&(g.memoizedState=w,Xs=!0),g=g.queue,fE(uk.bind(null,h,g,i),[i]),g.getSnapshot!==l||S||Ho!==null&&Ho.memoizedState.tag&1){if(h.flags|=2048,Ly(9,ck.bind(null,h,g,w,l),void 0,null),Wo===null)throw Error(an(349));Vh&30||lk(h,l,w)}return w}function lk(i,l,h){i.flags|=16384,i={getSnapshot:l,value:h},l=io.updateQueue,l===null?(l={lastEffect:null,stores:null},io.updateQueue=l,l.stores=[i]):(h=l.stores,h===null?l.stores=[i]:h.push(i))}function ck(i,l,h,g){l.value=h,l.getSnapshot=g,dk(l)&&hk(i)}function uk(i,l,h){return h(function(){dk(l)&&hk(i)})}function dk(i){var l=i.getSnapshot;i=i.value;try{var h=l();return!Dl(i,h)}catch{return!0}}function hk(i){var l=ru(i,1);l!==null&&Rl(l,i,1,-1)}function QM(i){var l=sc();return typeof i=="function"&&(i=i()),l.memoizedState=l.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dy,lastRenderedState:i},l.queue=i,i=i.dispatch=mV.bind(null,io,i),[l.memoizedState,i]}function Ly(i,l,h,g){return i={tag:i,create:l,destroy:h,deps:g,next:null},l=io.updateQueue,l===null?(l={lastEffect:null,stores:null},io.updateQueue=l,l.lastEffect=i.next=i):(h=l.lastEffect,h===null?l.lastEffect=i.next=i:(g=h.next,h.next=i,i.next=g,l.lastEffect=i)),i}function fk(){return Za().memoizedState}function jx(i,l,h,g){var w=sc();io.flags|=i,w.memoizedState=Ly(1|l,h,void 0,g===void 0?null:g)}function B1(i,l,h,g){var w=Za();g=g===void 0?null:g;var S=void 0;if(ko!==null){var R=ko.memoizedState;if(S=R.destroy,g!==null&&uE(g,R.deps)){w.memoizedState=Ly(l,h,S,g);return}}io.flags|=i,w.memoizedState=Ly(1|l,h,S,g)}function JM(i,l){return jx(8390656,8,i,l)}function fE(i,l){return B1(2048,8,i,l)}function pk(i,l){return B1(4,2,i,l)}function mk(i,l){return B1(4,4,i,l)}function gk(i,l){if(typeof l=="function")return i=i(),l(i),function(){l(null)};if(l!=null)return i=i(),l.current=i,function(){l.current=null}}function _k(i,l,h){return h=h!=null?h.concat([i]):null,B1(4,4,gk.bind(null,l,i),h)}function pE(){}function yk(i,l){var h=Za();l=l===void 0?null:l;var g=h.memoizedState;return g!==null&&l!==null&&uE(l,g[1])?g[0]:(h.memoizedState=[i,l],i)}function vk(i,l){var h=Za();l=l===void 0?null:l;var g=h.memoizedState;return g!==null&&l!==null&&uE(l,g[1])?g[0]:(i=i(),h.memoizedState=[i,l],i)}function xk(i,l,h){return Vh&21?(Dl(h,l)||(h=EL(),io.lanes|=h,$h|=h,i.baseState=!0),l):(i.baseState&&(i.baseState=!1,Xs=!0),i.memoizedState=h)}function fV(i,l){var h=Cr;Cr=h!==0&&4>h?h:4,i(!0);var g=BT.transition;BT.transition={};try{i(!1),l()}finally{Cr=h,BT.transition=g}}function wk(){return Za().memoizedState}function pV(i,l,h){var g=fd(i);if(h={lane:g,action:h,hasEagerState:!1,eagerState:null,next:null},bk(i))Tk(l,h);else if(h=ik(i,l,h,g),h!==null){var w=Cs();Rl(h,i,g,w),Sk(h,l,g)}}function mV(i,l,h){var g=fd(i),w={lane:g,action:h,hasEagerState:!1,eagerState:null,next:null};if(bk(i))Tk(l,w);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=l.lastRenderedReducer,S!==null))try{var R=l.lastRenderedState,o=S(R,h);if(w.hasEagerState=!0,w.eagerState=o,Dl(o,R)){var N=l.interleaved;N===null?(w.next=w,oE(l)):(w.next=N.next,N.next=w),l.interleaved=w;return}}catch{}finally{}h=ik(i,l,w,g),h!==null&&(w=Cs(),Rl(h,i,g,w),Sk(h,l,g))}}function bk(i){var l=i.alternate;return i===io||l!==null&&l===io}function Tk(i,l){hy=f1=!0;var h=i.pending;h===null?l.next=l:(l.next=h.next,h.next=l),i.pending=l}function Sk(i,l,h){if(h&4194240){var g=l.lanes;g&=i.pendingLanes,h|=g,l.lanes=h,HS(i,h)}}var p1={readContext:qa,useCallback:cs,useContext:cs,useEffect:cs,useImperativeHandle:cs,useInsertionEffect:cs,useLayoutEffect:cs,useMemo:cs,useReducer:cs,useRef:cs,useState:cs,useDebugValue:cs,useDeferredValue:cs,useTransition:cs,useMutableSource:cs,useSyncExternalStore:cs,useId:cs,unstable_isNewReconciler:!1},gV={readContext:qa,useCallback:function(i,l){return sc().memoizedState=[i,l===void 0?null:l],i},useContext:qa,useEffect:JM,useImperativeHandle:function(i,l,h){return h=h!=null?h.concat([i]):null,jx(4194308,4,gk.bind(null,l,i),h)},useLayoutEffect:function(i,l){return jx(4194308,4,i,l)},useInsertionEffect:function(i,l){return jx(4,2,i,l)},useMemo:function(i,l){var h=sc();return l=l===void 0?null:l,i=i(),h.memoizedState=[i,l],i},useReducer:function(i,l,h){var g=sc();return l=h!==void 0?h(l):l,g.memoizedState=g.baseState=l,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:l},g.queue=i,i=i.dispatch=pV.bind(null,io,i),[g.memoizedState,i]},useRef:function(i){var l=sc();return i={current:i},l.memoizedState=i},useState:QM,useDebugValue:pE,useDeferredValue:function(i){return sc().memoizedState=i},useTransition:function(){var i=QM(!1),l=i[0];return i=fV.bind(null,i[1]),sc().memoizedState=i,[l,i]},useMutableSource:function(){},useSyncExternalStore:function(i,l,h){var g=io,w=sc();if(Kr){if(h===void 0)throw Error(an(407));h=h()}else{if(h=l(),Wo===null)throw Error(an(349));Vh&30||lk(g,l,h)}w.memoizedState=h;var S={value:h,getSnapshot:l};return w.queue=S,JM(uk.bind(null,g,S,i),[i]),g.flags|=2048,Ly(9,ck.bind(null,g,S,h,l),void 0,null),h},useId:function(){var i=sc(),l=Wo.identifierPrefix;if(Kr){var h=Qc,g=Kc;h=(g&~(1<<32-Ml(g)-1)).toString(32)+h,l=":"+l+"R"+h,h=Ry++,0<h&&(l+="H"+h.toString(32)),l+=":"}else h=hV++,l=":"+l+"r"+h.toString(32)+":";return i.memoizedState=l},unstable_isNewReconciler:!1},_V={readContext:qa,useCallback:yk,useContext:qa,useEffect:fE,useImperativeHandle:_k,useInsertionEffect:pk,useLayoutEffect:mk,useMemo:vk,useReducer:jT,useRef:fk,useState:function(){return jT(Dy)},useDebugValue:pE,useDeferredValue:function(i){var l=Za();return xk(l,ko.memoizedState,i)},useTransition:function(){var i=jT(Dy)[0],l=Za().memoizedState;return[i,l]},useMutableSource:sk,useSyncExternalStore:ak,useId:wk,unstable_isNewReconciler:!1},yV={readContext:qa,useCallback:yk,useContext:qa,useEffect:fE,useImperativeHandle:_k,useInsertionEffect:pk,useLayoutEffect:mk,useMemo:vk,useReducer:UT,useRef:fk,useState:function(){return UT(Dy)},useDebugValue:pE,useDeferredValue:function(i){var l=Za();return ko===null?l.memoizedState=i:xk(l,ko.memoizedState,i)},useTransition:function(){var i=UT(Dy)[0],l=Za().memoizedState;return[i,l]},useMutableSource:sk,useSyncExternalStore:ak,useId:wk,unstable_isNewReconciler:!1};function Sl(i,l){if(i&&i.defaultProps){l=ro({},l),i=i.defaultProps;for(var h in i)l[h]===void 0&&(l[h]=i[h]);return l}return l}function j2(i,l,h,g){l=i.memoizedState,h=h(g,l),h=h==null?l:ro({},l,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var j1={isMounted:function(i){return(i=i._reactInternals)?Jh(i)===i:!1},enqueueSetState:function(i,l,h){i=i._reactInternals;var g=Cs(),w=fd(i),S=eu(g,w);S.payload=l,h!=null&&(S.callback=h),l=dd(i,S,w),l!==null&&(Rl(l,i,w,g),Nx(l,i,w))},enqueueReplaceState:function(i,l,h){i=i._reactInternals;var g=Cs(),w=fd(i),S=eu(g,w);S.tag=1,S.payload=l,h!=null&&(S.callback=h),l=dd(i,S,w),l!==null&&(Rl(l,i,w,g),Nx(l,i,w))},enqueueForceUpdate:function(i,l){i=i._reactInternals;var h=Cs(),g=fd(i),w=eu(h,g);w.tag=2,l!=null&&(w.callback=l),l=dd(i,w,g),l!==null&&(Rl(l,i,g,h),Nx(l,i,g))}};function eR(i,l,h,g,w,S,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(g,S,R):l.prototype&&l.prototype.isPureReactComponent?!Ey(h,g)||!Ey(w,S):!0}function Ek(i,l,h){var g=!1,w=yd,S=l.contextType;return typeof S=="object"&&S!==null?S=qa(S):(w=Ks(l)?jh:fs.current,g=l.contextTypes,S=(g=g!=null)?Am(i,w):yd),l=new l(h,S),i.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=j1,i.stateNode=l,l._reactInternals=i,g&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=w,i.__reactInternalMemoizedMaskedChildContext=S),l}function tR(i,l,h,g){i=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,g),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,g),l.state!==i&&j1.enqueueReplaceState(l,l.state,null)}function U2(i,l,h,g){var w=i.stateNode;w.props=h,w.state=i.memoizedState,w.refs={},sE(i);var S=l.contextType;typeof S=="object"&&S!==null?w.context=qa(S):(S=Ks(l)?jh:fs.current,w.context=Am(i,S)),w.state=i.memoizedState,S=l.getDerivedStateFromProps,typeof S=="function"&&(j2(i,l,S,h),w.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(l=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),l!==w.state&&j1.enqueueReplaceState(w,w.state,null),d1(i,h,w,g),w.state=i.memoizedState),typeof w.componentDidMount=="function"&&(i.flags|=4194308)}function Dm(i,l){try{var h="",g=l;do h+=Wj(g),g=g.return;while(g);var w=h}catch(S){w=`
Error generating stack: `+S.message+`
`+S.stack}return{value:i,source:l,stack:w,digest:null}}function VT(i,l,h){return{value:i,source:null,stack:h??null,digest:l??null}}function V2(i,l){try{console.error(l.value)}catch(h){setTimeout(function(){throw h})}}var vV=typeof WeakMap=="function"?WeakMap:Map;function Ik(i,l,h){h=eu(-1,h),h.tag=3,h.payload={element:null};var g=l.value;return h.callback=function(){g1||(g1=!0,Q2=g),V2(i,l)},h}function Ck(i,l,h){h=eu(-1,h),h.tag=3;var g=i.type.getDerivedStateFromError;if(typeof g=="function"){var w=l.value;h.payload=function(){return g(w)},h.callback=function(){V2(i,l)}}var S=i.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(h.callback=function(){V2(i,l),typeof g!="function"&&(hd===null?hd=new Set([this]):hd.add(this));var R=l.stack;this.componentDidCatch(l.value,{componentStack:R!==null?R:""})}),h}function nR(i,l,h){var g=i.pingCache;if(g===null){g=i.pingCache=new vV;var w=new Set;g.set(l,w)}else w=g.get(l),w===void 0&&(w=new Set,g.set(l,w));w.has(h)||(w.add(h),i=LV.bind(null,i,l,h),l.then(i,i))}function iR(i){do{var l;if((l=i.tag===13)&&(l=i.memoizedState,l=l!==null?l.dehydrated!==null:!0),l)return i;i=i.return}while(i!==null);return null}function rR(i,l,h,g,w){return i.mode&1?(i.flags|=65536,i.lanes=w,i):(i===l?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(l=eu(-1,1),l.tag=2,dd(h,l,1))),h.lanes|=1),i)}var xV=lu.ReactCurrentOwner,Xs=!1;function Es(i,l,h,g){l.child=i===null?nk(l,null,h,g):Mm(l,i.child,h,g)}function oR(i,l,h,g,w){h=h.render;var S=l.ref;return hm(l,w),g=dE(i,l,h,g,S,w),h=hE(),i!==null&&!Xs?(l.updateQueue=i.updateQueue,l.flags&=-2053,i.lanes&=~w,ou(i,l,w)):(Kr&&h&&JS(l),l.flags|=1,Es(i,l,g,w),l.child)}function sR(i,l,h,g,w){if(i===null){var S=h.type;return typeof S=="function"&&!bE(S)&&S.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(l.tag=15,l.type=S,Ak(i,l,S,g,w)):(i=Gx(h.type,null,g,l,l.mode,w),i.ref=l.ref,i.return=l,l.child=i)}if(S=i.child,!(i.lanes&w)){var R=S.memoizedProps;if(h=h.compare,h=h!==null?h:Ey,h(R,g)&&i.ref===l.ref)return ou(i,l,w)}return l.flags|=1,i=pd(S,g),i.ref=l.ref,i.return=l,l.child=i}function Ak(i,l,h,g,w){if(i!==null){var S=i.memoizedProps;if(Ey(S,g)&&i.ref===l.ref)if(Xs=!1,l.pendingProps=g=S,(i.lanes&w)!==0)i.flags&131072&&(Xs=!0);else return l.lanes=i.lanes,ou(i,l,w)}return $2(i,l,h,g,w)}function Pk(i,l,h){var g=l.pendingProps,w=g.children,S=i!==null?i.memoizedState:null;if(g.mode==="hidden")if(!(l.mode&1))l.memoizedState={baseLanes:0,cachePool:null,transitions:null},Br(am,pa),pa|=h;else{if(!(h&1073741824))return i=S!==null?S.baseLanes|h:h,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:i,cachePool:null,transitions:null},l.updateQueue=null,Br(am,pa),pa|=i,null;l.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=S!==null?S.baseLanes:h,Br(am,pa),pa|=g}else S!==null?(g=S.baseLanes|h,l.memoizedState=null):g=h,Br(am,pa),pa|=g;return Es(i,l,w,h),l.child}function Mk(i,l){var h=l.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(l.flags|=512,l.flags|=2097152)}function $2(i,l,h,g,w){var S=Ks(h)?jh:fs.current;return S=Am(l,S),hm(l,w),h=dE(i,l,h,g,S,w),g=hE(),i!==null&&!Xs?(l.updateQueue=i.updateQueue,l.flags&=-2053,i.lanes&=~w,ou(i,l,w)):(Kr&&g&&JS(l),l.flags|=1,Es(i,l,h,w),l.child)}function aR(i,l,h,g,w){if(Ks(h)){var S=!0;s1(l)}else S=!1;if(hm(l,w),l.stateNode===null)Ux(i,l),Ek(l,h,g),U2(l,h,g,w),g=!0;else if(i===null){var R=l.stateNode,o=l.memoizedProps;R.props=o;var N=R.context,B=h.contextType;typeof B=="object"&&B!==null?B=qa(B):(B=Ks(h)?jh:fs.current,B=Am(l,B));var q=h.getDerivedStateFromProps,Y=typeof q=="function"||typeof R.getSnapshotBeforeUpdate=="function";Y||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(o!==g||N!==B)&&tR(l,R,g,B),Yu=!1;var J=l.memoizedState;R.state=J,d1(l,g,R,w),N=l.memoizedState,o!==g||J!==N||Ys.current||Yu?(typeof q=="function"&&(j2(l,h,q,g),N=l.memoizedState),(o=Yu||eR(l,h,o,g,J,N,B))?(Y||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(l.flags|=4194308)):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=g,l.memoizedState=N),R.props=g,R.state=N,R.context=B,g=o):(typeof R.componentDidMount=="function"&&(l.flags|=4194308),g=!1)}else{R=l.stateNode,rk(i,l),o=l.memoizedProps,B=l.type===l.elementType?o:Sl(l.type,o),R.props=B,Y=l.pendingProps,J=R.context,N=h.contextType,typeof N=="object"&&N!==null?N=qa(N):(N=Ks(h)?jh:fs.current,N=Am(l,N));var ie=h.getDerivedStateFromProps;(q=typeof ie=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(o!==Y||J!==N)&&tR(l,R,g,N),Yu=!1,J=l.memoizedState,R.state=J,d1(l,g,R,w);var be=l.memoizedState;o!==Y||J!==be||Ys.current||Yu?(typeof ie=="function"&&(j2(l,h,ie,g),be=l.memoizedState),(B=Yu||eR(l,h,B,g,J,be,N)||!1)?(q||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(g,be,N),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(g,be,N)),typeof R.componentDidUpdate=="function"&&(l.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof R.componentDidUpdate!="function"||o===i.memoizedProps&&J===i.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&J===i.memoizedState||(l.flags|=1024),l.memoizedProps=g,l.memoizedState=be),R.props=g,R.state=be,R.context=N,g=B):(typeof R.componentDidUpdate!="function"||o===i.memoizedProps&&J===i.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&J===i.memoizedState||(l.flags|=1024),g=!1)}return G2(i,l,h,g,S,w)}function G2(i,l,h,g,w,S){Mk(i,l);var R=(l.flags&128)!==0;if(!g&&!R)return w&&WM(l,h,!1),ou(i,l,S);g=l.stateNode,xV.current=l;var o=R&&typeof h.getDerivedStateFromError!="function"?null:g.render();return l.flags|=1,i!==null&&R?(l.child=Mm(l,i.child,null,S),l.child=Mm(l,null,o,S)):Es(i,l,o,S),l.memoizedState=g.state,w&&WM(l,h,!0),l.child}function Rk(i){var l=i.stateNode;l.pendingContext?HM(i,l.pendingContext,l.pendingContext!==l.context):l.context&&HM(i,l.context,!1),aE(i,l.containerInfo)}function lR(i,l,h,g,w){return Pm(),tE(w),l.flags|=256,Es(i,l,h,g),l.child}var H2={dehydrated:null,treeContext:null,retryLane:0};function W2(i){return{baseLanes:i,cachePool:null,transitions:null}}function Dk(i,l,h){var g=l.pendingProps,w=no.current,S=!1,R=(l.flags&128)!==0,o;if((o=R)||(o=i!==null&&i.memoizedState===null?!1:(w&2)!==0),o?(S=!0,l.flags&=-129):(i===null||i.memoizedState!==null)&&(w|=1),Br(no,w&1),i===null)return N2(l),i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(l.mode&1?i.data==="$!"?l.lanes=8:l.lanes=1073741824:l.lanes=1,null):(R=g.children,i=g.fallback,S?(g=l.mode,S=l.child,R={mode:"hidden",children:R},!(g&1)&&S!==null?(S.childLanes=0,S.pendingProps=R):S=$1(R,g,0,null),i=Fh(i,g,h,null),S.return=l,i.return=l,S.sibling=i,l.child=S,l.child.memoizedState=W2(h),l.memoizedState=H2,i):mE(l,R));if(w=i.memoizedState,w!==null&&(o=w.dehydrated,o!==null))return wV(i,l,R,g,o,w,h);if(S){S=g.fallback,R=l.mode,w=i.child,o=w.sibling;var N={mode:"hidden",children:g.children};return!(R&1)&&l.child!==w?(g=l.child,g.childLanes=0,g.pendingProps=N,l.deletions=null):(g=pd(w,N),g.subtreeFlags=w.subtreeFlags&14680064),o!==null?S=pd(o,S):(S=Fh(S,R,h,null),S.flags|=2),S.return=l,g.return=l,g.sibling=S,l.child=g,g=S,S=l.child,R=i.child.memoizedState,R=R===null?W2(h):{baseLanes:R.baseLanes|h,cachePool:null,transitions:R.transitions},S.memoizedState=R,S.childLanes=i.childLanes&~h,l.memoizedState=H2,g}return S=i.child,i=S.sibling,g=pd(S,{mode:"visible",children:g.children}),!(l.mode&1)&&(g.lanes=h),g.return=l,g.sibling=null,i!==null&&(h=l.deletions,h===null?(l.deletions=[i],l.flags|=16):h.push(i)),l.child=g,l.memoizedState=null,g}function mE(i,l){return l=$1({mode:"visible",children:l},i.mode,0,null),l.return=i,i.child=l}function gx(i,l,h,g){return g!==null&&tE(g),Mm(l,i.child,null,h),i=mE(l,l.pendingProps.children),i.flags|=2,l.memoizedState=null,i}function wV(i,l,h,g,w,S,R){if(h)return l.flags&256?(l.flags&=-257,g=VT(Error(an(422))),gx(i,l,R,g)):l.memoizedState!==null?(l.child=i.child,l.flags|=128,null):(S=g.fallback,w=l.mode,g=$1({mode:"visible",children:g.children},w,0,null),S=Fh(S,w,R,null),S.flags|=2,g.return=l,S.return=l,g.sibling=S,l.child=g,l.mode&1&&Mm(l,i.child,null,R),l.child.memoizedState=W2(R),l.memoizedState=H2,S);if(!(l.mode&1))return gx(i,l,R,null);if(w.data==="$!"){if(g=w.nextSibling&&w.nextSibling.dataset,g)var o=g.dgst;return g=o,S=Error(an(419)),g=VT(S,g,void 0),gx(i,l,R,g)}if(o=(R&i.childLanes)!==0,Xs||o){if(g=Wo,g!==null){switch(R&-R){case 4:w=2;break;case 16:w=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:w=32;break;case 536870912:w=268435456;break;default:w=0}w=w&(g.suspendedLanes|R)?0:w,w!==0&&w!==S.retryLane&&(S.retryLane=w,ru(i,w),Rl(g,i,w,-1))}return wE(),g=VT(Error(an(421))),gx(i,l,R,g)}return w.data==="$?"?(l.flags|=128,l.child=i.child,l=kV.bind(null,i),w._reactRetry=l,null):(i=S.treeContext,ga=ud(w.nextSibling),_a=l,Kr=!0,Pl=null,i!==null&&(Va[$a++]=Kc,Va[$a++]=Qc,Va[$a++]=Uh,Kc=i.id,Qc=i.overflow,Uh=l),l=mE(l,g.children),l.flags|=4096,l)}function cR(i,l,h){i.lanes|=l;var g=i.alternate;g!==null&&(g.lanes|=l),B2(i.return,l,h)}function $T(i,l,h,g,w){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:w}:(S.isBackwards=l,S.rendering=null,S.renderingStartTime=0,S.last=g,S.tail=h,S.tailMode=w)}function Lk(i,l,h){var g=l.pendingProps,w=g.revealOrder,S=g.tail;if(Es(i,l,g.children,h),g=no.current,g&2)g=g&1|2,l.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=l.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&cR(i,h,l);else if(i.tag===19)cR(i,h,l);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===l)break e;for(;i.sibling===null;){if(i.return===null||i.return===l)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}g&=1}if(Br(no,g),!(l.mode&1))l.memoizedState=null;else switch(w){case"forwards":for(h=l.child,w=null;h!==null;)i=h.alternate,i!==null&&h1(i)===null&&(w=h),h=h.sibling;h=w,h===null?(w=l.child,l.child=null):(w=h.sibling,h.sibling=null),$T(l,!1,w,h,S);break;case"backwards":for(h=null,w=l.child,l.child=null;w!==null;){if(i=w.alternate,i!==null&&h1(i)===null){l.child=w;break}i=w.sibling,w.sibling=h,h=w,w=i}$T(l,!0,h,null,S);break;case"together":$T(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function Ux(i,l){!(l.mode&1)&&i!==null&&(i.alternate=null,l.alternate=null,l.flags|=2)}function ou(i,l,h){if(i!==null&&(l.dependencies=i.dependencies),$h|=l.lanes,!(h&l.childLanes))return null;if(i!==null&&l.child!==i.child)throw Error(an(153));if(l.child!==null){for(i=l.child,h=pd(i,i.pendingProps),l.child=h,h.return=l;i.sibling!==null;)i=i.sibling,h=h.sibling=pd(i,i.pendingProps),h.return=l;h.sibling=null}return l.child}function bV(i,l,h){switch(l.tag){case 3:Rk(l),Pm();break;case 5:ok(l);break;case 1:Ks(l.type)&&s1(l);break;case 4:aE(l,l.stateNode.containerInfo);break;case 10:var g=l.type._context,w=l.memoizedProps.value;Br(c1,g._currentValue),g._currentValue=w;break;case 13:if(g=l.memoizedState,g!==null)return g.dehydrated!==null?(Br(no,no.current&1),l.flags|=128,null):h&l.child.childLanes?Dk(i,l,h):(Br(no,no.current&1),i=ou(i,l,h),i!==null?i.sibling:null);Br(no,no.current&1);break;case 19:if(g=(h&l.childLanes)!==0,i.flags&128){if(g)return Lk(i,l,h);l.flags|=128}if(w=l.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),Br(no,no.current),g)break;return null;case 22:case 23:return l.lanes=0,Pk(i,l,h)}return ou(i,l,h)}var kk,q2,zk,Ok;kk=function(i,l){for(var h=l.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};q2=function(){};zk=function(i,l,h,g){var w=i.memoizedProps;if(w!==g){i=l.stateNode,Ph(pc.current);var S=null;switch(h){case"input":w=m2(i,w),g=m2(i,g),S=[];break;case"select":w=ro({},w,{value:void 0}),g=ro({},g,{value:void 0}),S=[];break;case"textarea":w=y2(i,w),g=y2(i,g),S=[];break;default:typeof w.onClick!="function"&&typeof g.onClick=="function"&&(i.onclick=r1)}x2(h,g);var R;h=null;for(B in w)if(!g.hasOwnProperty(B)&&w.hasOwnProperty(B)&&w[B]!=null)if(B==="style"){var o=w[B];for(R in o)o.hasOwnProperty(R)&&(h||(h={}),h[R]="")}else B!=="dangerouslySetInnerHTML"&&B!=="children"&&B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(yy.hasOwnProperty(B)?S||(S=[]):(S=S||[]).push(B,null));for(B in g){var N=g[B];if(o=w!=null?w[B]:void 0,g.hasOwnProperty(B)&&N!==o&&(N!=null||o!=null))if(B==="style")if(o){for(R in o)!o.hasOwnProperty(R)||N&&N.hasOwnProperty(R)||(h||(h={}),h[R]="");for(R in N)N.hasOwnProperty(R)&&o[R]!==N[R]&&(h||(h={}),h[R]=N[R])}else h||(S||(S=[]),S.push(B,h)),h=N;else B==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,o=o?o.__html:void 0,N!=null&&o!==N&&(S=S||[]).push(B,N)):B==="children"?typeof N!="string"&&typeof N!="number"||(S=S||[]).push(B,""+N):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&(yy.hasOwnProperty(B)?(N!=null&&B==="onScroll"&&Gr("scroll",i),S||o===N||(S=[])):(S=S||[]).push(B,N))}h&&(S=S||[]).push("style",h);var B=S;(l.updateQueue=B)&&(l.flags|=4)}};Ok=function(i,l,h,g){h!==g&&(l.flags|=4)};function K_(i,l){if(!Kr)switch(i.tailMode){case"hidden":l=i.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?l||i.tail===null?i.tail=null:i.tail.sibling=null:g.sibling=null}}function us(i){var l=i.alternate!==null&&i.alternate.child===i.child,h=0,g=0;if(l)for(var w=i.child;w!==null;)h|=w.lanes|w.childLanes,g|=w.subtreeFlags&14680064,g|=w.flags&14680064,w.return=i,w=w.sibling;else for(w=i.child;w!==null;)h|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=i,w=w.sibling;return i.subtreeFlags|=g,i.childLanes=h,l}function TV(i,l,h){var g=l.pendingProps;switch(eE(l),l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return us(l),null;case 1:return Ks(l.type)&&o1(),us(l),null;case 3:return g=l.stateNode,Rm(),Hr(Ys),Hr(fs),cE(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(i===null||i.child===null)&&(px(l)?l.flags|=4:i===null||i.memoizedState.isDehydrated&&!(l.flags&256)||(l.flags|=1024,Pl!==null&&(tS(Pl),Pl=null))),q2(i,l),us(l),null;case 5:lE(l);var w=Ph(My.current);if(h=l.type,i!==null&&l.stateNode!=null)zk(i,l,h,g,w),i.ref!==l.ref&&(l.flags|=512,l.flags|=2097152);else{if(!g){if(l.stateNode===null)throw Error(an(166));return us(l),null}if(i=Ph(pc.current),px(l)){g=l.stateNode,h=l.type;var S=l.memoizedProps;switch(g[uc]=l,g[Ay]=S,i=(l.mode&1)!==0,h){case"dialog":Gr("cancel",g),Gr("close",g);break;case"iframe":case"object":case"embed":Gr("load",g);break;case"video":case"audio":for(w=0;w<ry.length;w++)Gr(ry[w],g);break;case"source":Gr("error",g);break;case"img":case"image":case"link":Gr("error",g),Gr("load",g);break;case"details":Gr("toggle",g);break;case"input":yM(g,S),Gr("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!S.multiple},Gr("invalid",g);break;case"textarea":xM(g,S),Gr("invalid",g)}x2(h,S),w=null;for(var R in S)if(S.hasOwnProperty(R)){var o=S[R];R==="children"?typeof o=="string"?g.textContent!==o&&(S.suppressHydrationWarning!==!0&&fx(g.textContent,o,i),w=["children",o]):typeof o=="number"&&g.textContent!==""+o&&(S.suppressHydrationWarning!==!0&&fx(g.textContent,o,i),w=["children",""+o]):yy.hasOwnProperty(R)&&o!=null&&R==="onScroll"&&Gr("scroll",g)}switch(h){case"input":ox(g),vM(g,S,!0);break;case"textarea":ox(g),wM(g);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(g.onclick=r1)}g=w,l.updateQueue=g,g!==null&&(l.flags|=4)}else{R=w.nodeType===9?w:w.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=uL(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=R.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof g.is=="string"?i=R.createElement(h,{is:g.is}):(i=R.createElement(h),h==="select"&&(R=i,g.multiple?R.multiple=!0:g.size&&(R.size=g.size))):i=R.createElementNS(i,h),i[uc]=l,i[Ay]=g,kk(i,l,!1,!1),l.stateNode=i;e:{switch(R=w2(h,g),h){case"dialog":Gr("cancel",i),Gr("close",i),w=g;break;case"iframe":case"object":case"embed":Gr("load",i),w=g;break;case"video":case"audio":for(w=0;w<ry.length;w++)Gr(ry[w],i);w=g;break;case"source":Gr("error",i),w=g;break;case"img":case"image":case"link":Gr("error",i),Gr("load",i),w=g;break;case"details":Gr("toggle",i),w=g;break;case"input":yM(i,g),w=m2(i,g),Gr("invalid",i);break;case"option":w=g;break;case"select":i._wrapperState={wasMultiple:!!g.multiple},w=ro({},g,{value:void 0}),Gr("invalid",i);break;case"textarea":xM(i,g),w=y2(i,g),Gr("invalid",i);break;default:w=g}x2(h,w),o=w;for(S in o)if(o.hasOwnProperty(S)){var N=o[S];S==="style"?fL(i,N):S==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&dL(i,N)):S==="children"?typeof N=="string"?(h!=="textarea"||N!=="")&&vy(i,N):typeof N=="number"&&vy(i,""+N):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(yy.hasOwnProperty(S)?N!=null&&S==="onScroll"&&Gr("scroll",i):N!=null&&BS(i,S,N,R))}switch(h){case"input":ox(i),vM(i,g,!1);break;case"textarea":ox(i),wM(i);break;case"option":g.value!=null&&i.setAttribute("value",""+_d(g.value));break;case"select":i.multiple=!!g.multiple,S=g.value,S!=null?lm(i,!!g.multiple,S,!1):g.defaultValue!=null&&lm(i,!!g.multiple,g.defaultValue,!0);break;default:typeof w.onClick=="function"&&(i.onclick=r1)}switch(h){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(l.flags|=4)}l.ref!==null&&(l.flags|=512,l.flags|=2097152)}return us(l),null;case 6:if(i&&l.stateNode!=null)Ok(i,l,i.memoizedProps,g);else{if(typeof g!="string"&&l.stateNode===null)throw Error(an(166));if(h=Ph(My.current),Ph(pc.current),px(l)){if(g=l.stateNode,h=l.memoizedProps,g[uc]=l,(S=g.nodeValue!==h)&&(i=_a,i!==null))switch(i.tag){case 3:fx(g.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&fx(g.nodeValue,h,(i.mode&1)!==0)}S&&(l.flags|=4)}else g=(h.nodeType===9?h:h.ownerDocument).createTextNode(g),g[uc]=l,l.stateNode=g}return us(l),null;case 13:if(Hr(no),g=l.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Kr&&ga!==null&&l.mode&1&&!(l.flags&128))ek(),Pm(),l.flags|=98560,S=!1;else if(S=px(l),g!==null&&g.dehydrated!==null){if(i===null){if(!S)throw Error(an(318));if(S=l.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(an(317));S[uc]=l}else Pm(),!(l.flags&128)&&(l.memoizedState=null),l.flags|=4;us(l),S=!1}else Pl!==null&&(tS(Pl),Pl=null),S=!0;if(!S)return l.flags&65536?l:null}return l.flags&128?(l.lanes=h,l):(g=g!==null,g!==(i!==null&&i.memoizedState!==null)&&g&&(l.child.flags|=8192,l.mode&1&&(i===null||no.current&1?zo===0&&(zo=3):wE())),l.updateQueue!==null&&(l.flags|=4),us(l),null);case 4:return Rm(),q2(i,l),i===null&&Iy(l.stateNode.containerInfo),us(l),null;case 10:return rE(l.type._context),us(l),null;case 17:return Ks(l.type)&&o1(),us(l),null;case 19:if(Hr(no),S=l.memoizedState,S===null)return us(l),null;if(g=(l.flags&128)!==0,R=S.rendering,R===null)if(g)K_(S,!1);else{if(zo!==0||i!==null&&i.flags&128)for(i=l.child;i!==null;){if(R=h1(i),R!==null){for(l.flags|=128,K_(S,!1),g=R.updateQueue,g!==null&&(l.updateQueue=g,l.flags|=4),l.subtreeFlags=0,g=h,h=l.child;h!==null;)S=h,i=g,S.flags&=14680066,R=S.alternate,R===null?(S.childLanes=0,S.lanes=i,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=R.childLanes,S.lanes=R.lanes,S.child=R.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=R.memoizedProps,S.memoizedState=R.memoizedState,S.updateQueue=R.updateQueue,S.type=R.type,i=R.dependencies,S.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return Br(no,no.current&1|2),l.child}i=i.sibling}S.tail!==null&&yo()>Lm&&(l.flags|=128,g=!0,K_(S,!1),l.lanes=4194304)}else{if(!g)if(i=h1(R),i!==null){if(l.flags|=128,g=!0,h=i.updateQueue,h!==null&&(l.updateQueue=h,l.flags|=4),K_(S,!0),S.tail===null&&S.tailMode==="hidden"&&!R.alternate&&!Kr)return us(l),null}else 2*yo()-S.renderingStartTime>Lm&&h!==1073741824&&(l.flags|=128,g=!0,K_(S,!1),l.lanes=4194304);S.isBackwards?(R.sibling=l.child,l.child=R):(h=S.last,h!==null?h.sibling=R:l.child=R,S.last=R)}return S.tail!==null?(l=S.tail,S.rendering=l,S.tail=l.sibling,S.renderingStartTime=yo(),l.sibling=null,h=no.current,Br(no,g?h&1|2:h&1),l):(us(l),null);case 22:case 23:return xE(),g=l.memoizedState!==null,i!==null&&i.memoizedState!==null!==g&&(l.flags|=8192),g&&l.mode&1?pa&1073741824&&(us(l),l.subtreeFlags&6&&(l.flags|=8192)):us(l),null;case 24:return null;case 25:return null}throw Error(an(156,l.tag))}function SV(i,l){switch(eE(l),l.tag){case 1:return Ks(l.type)&&o1(),i=l.flags,i&65536?(l.flags=i&-65537|128,l):null;case 3:return Rm(),Hr(Ys),Hr(fs),cE(),i=l.flags,i&65536&&!(i&128)?(l.flags=i&-65537|128,l):null;case 5:return lE(l),null;case 13:if(Hr(no),i=l.memoizedState,i!==null&&i.dehydrated!==null){if(l.alternate===null)throw Error(an(340));Pm()}return i=l.flags,i&65536?(l.flags=i&-65537|128,l):null;case 19:return Hr(no),null;case 4:return Rm(),null;case 10:return rE(l.type._context),null;case 22:case 23:return xE(),null;case 24:return null;default:return null}}var _x=!1,hs=!1,EV=typeof WeakSet=="function"?WeakSet:Set,Nn=null;function sm(i,l){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(g){lo(i,l,g)}else h.current=null}function Z2(i,l,h){try{h()}catch(g){lo(i,l,g)}}var uR=!1;function IV(i,l){if(R2=t1,i=UL(),QS(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var w=g.anchorOffset,S=g.focusNode;g=g.focusOffset;try{h.nodeType,S.nodeType}catch{h=null;break e}var R=0,o=-1,N=-1,B=0,q=0,Y=i,J=null;t:for(;;){for(var ie;Y!==h||w!==0&&Y.nodeType!==3||(o=R+w),Y!==S||g!==0&&Y.nodeType!==3||(N=R+g),Y.nodeType===3&&(R+=Y.nodeValue.length),(ie=Y.firstChild)!==null;)J=Y,Y=ie;for(;;){if(Y===i)break t;if(J===h&&++B===w&&(o=R),J===S&&++q===g&&(N=R),(ie=Y.nextSibling)!==null)break;Y=J,J=Y.parentNode}Y=ie}h=o===-1||N===-1?null:{start:o,end:N}}else h=null}h=h||{start:0,end:0}}else h=null;for(D2={focusedElem:i,selectionRange:h},t1=!1,Nn=l;Nn!==null;)if(l=Nn,i=l.child,(l.subtreeFlags&1028)!==0&&i!==null)i.return=l,Nn=i;else for(;Nn!==null;){l=Nn;try{var be=l.alternate;if(l.flags&1024)switch(l.tag){case 0:case 11:case 15:break;case 1:if(be!==null){var te=be.memoizedProps,le=be.memoizedState,ce=l.stateNode,oe=ce.getSnapshotBeforeUpdate(l.elementType===l.type?te:Sl(l.type,te),le);ce.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var ue=l.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(an(163))}}catch(Me){lo(l,l.return,Me)}if(i=l.sibling,i!==null){i.return=l.return,Nn=i;break}Nn=l.return}return be=uR,uR=!1,be}function fy(i,l,h){var g=l.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var w=g=g.next;do{if((w.tag&i)===i){var S=w.destroy;w.destroy=void 0,S!==void 0&&Z2(l,h,S)}w=w.next}while(w!==g)}}function U1(i,l){if(l=l.updateQueue,l=l!==null?l.lastEffect:null,l!==null){var h=l=l.next;do{if((h.tag&i)===i){var g=h.create;h.destroy=g()}h=h.next}while(h!==l)}}function X2(i){var l=i.ref;if(l!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof l=="function"?l(i):l.current=i}}function Fk(i){var l=i.alternate;l!==null&&(i.alternate=null,Fk(l)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(l=i.stateNode,l!==null&&(delete l[uc],delete l[Ay],delete l[z2],delete l[lV],delete l[cV])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Nk(i){return i.tag===5||i.tag===3||i.tag===4}function dR(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Nk(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Y2(i,l,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,l?h.nodeType===8?h.parentNode.insertBefore(i,l):h.insertBefore(i,l):(h.nodeType===8?(l=h.parentNode,l.insertBefore(i,h)):(l=h,l.appendChild(i)),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=r1));else if(g!==4&&(i=i.child,i!==null))for(Y2(i,l,h),i=i.sibling;i!==null;)Y2(i,l,h),i=i.sibling}function K2(i,l,h){var g=i.tag;if(g===5||g===6)i=i.stateNode,l?h.insertBefore(i,l):h.appendChild(i);else if(g!==4&&(i=i.child,i!==null))for(K2(i,l,h),i=i.sibling;i!==null;)K2(i,l,h),i=i.sibling}var ts=null,Al=!1;function Gu(i,l,h){for(h=h.child;h!==null;)Bk(i,l,h),h=h.sibling}function Bk(i,l,h){if(fc&&typeof fc.onCommitFiberUnmount=="function")try{fc.onCommitFiberUnmount(L1,h)}catch{}switch(h.tag){case 5:hs||sm(h,l);case 6:var g=ts,w=Al;ts=null,Gu(i,l,h),ts=g,Al=w,ts!==null&&(Al?(i=ts,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):ts.removeChild(h.stateNode));break;case 18:ts!==null&&(Al?(i=ts,h=h.stateNode,i.nodeType===8?OT(i.parentNode,h):i.nodeType===1&&OT(i,h),Ty(i)):OT(ts,h.stateNode));break;case 4:g=ts,w=Al,ts=h.stateNode.containerInfo,Al=!0,Gu(i,l,h),ts=g,Al=w;break;case 0:case 11:case 14:case 15:if(!hs&&(g=h.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){w=g=g.next;do{var S=w,R=S.destroy;S=S.tag,R!==void 0&&(S&2||S&4)&&Z2(h,l,R),w=w.next}while(w!==g)}Gu(i,l,h);break;case 1:if(!hs&&(sm(h,l),g=h.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=h.memoizedProps,g.state=h.memoizedState,g.componentWillUnmount()}catch(o){lo(h,l,o)}Gu(i,l,h);break;case 21:Gu(i,l,h);break;case 22:h.mode&1?(hs=(g=hs)||h.memoizedState!==null,Gu(i,l,h),hs=g):Gu(i,l,h);break;default:Gu(i,l,h)}}function hR(i){var l=i.updateQueue;if(l!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new EV),l.forEach(function(g){var w=zV.bind(null,i,g);h.has(g)||(h.add(g),g.then(w,w))})}}function wl(i,l){var h=l.deletions;if(h!==null)for(var g=0;g<h.length;g++){var w=h[g];try{var S=i,R=l,o=R;e:for(;o!==null;){switch(o.tag){case 5:ts=o.stateNode,Al=!1;break e;case 3:ts=o.stateNode.containerInfo,Al=!0;break e;case 4:ts=o.stateNode.containerInfo,Al=!0;break e}o=o.return}if(ts===null)throw Error(an(160));Bk(S,R,w),ts=null,Al=!1;var N=w.alternate;N!==null&&(N.return=null),w.return=null}catch(B){lo(w,l,B)}}if(l.subtreeFlags&12854)for(l=l.child;l!==null;)jk(l,i),l=l.sibling}function jk(i,l){var h=i.alternate,g=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(wl(l,i),rc(i),g&4){try{fy(3,i,i.return),U1(3,i)}catch(te){lo(i,i.return,te)}try{fy(5,i,i.return)}catch(te){lo(i,i.return,te)}}break;case 1:wl(l,i),rc(i),g&512&&h!==null&&sm(h,h.return);break;case 5:if(wl(l,i),rc(i),g&512&&h!==null&&sm(h,h.return),i.flags&32){var w=i.stateNode;try{vy(w,"")}catch(te){lo(i,i.return,te)}}if(g&4&&(w=i.stateNode,w!=null)){var S=i.memoizedProps,R=h!==null?h.memoizedProps:S,o=i.type,N=i.updateQueue;if(i.updateQueue=null,N!==null)try{o==="input"&&S.type==="radio"&&S.name!=null&&lL(w,S),w2(o,R);var B=w2(o,S);for(R=0;R<N.length;R+=2){var q=N[R],Y=N[R+1];q==="style"?fL(w,Y):q==="dangerouslySetInnerHTML"?dL(w,Y):q==="children"?vy(w,Y):BS(w,q,Y,B)}switch(o){case"input":g2(w,S);break;case"textarea":cL(w,S);break;case"select":var J=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!S.multiple;var ie=S.value;ie!=null?lm(w,!!S.multiple,ie,!1):J!==!!S.multiple&&(S.defaultValue!=null?lm(w,!!S.multiple,S.defaultValue,!0):lm(w,!!S.multiple,S.multiple?[]:"",!1))}w[Ay]=S}catch(te){lo(i,i.return,te)}}break;case 6:if(wl(l,i),rc(i),g&4){if(i.stateNode===null)throw Error(an(162));w=i.stateNode,S=i.memoizedProps;try{w.nodeValue=S}catch(te){lo(i,i.return,te)}}break;case 3:if(wl(l,i),rc(i),g&4&&h!==null&&h.memoizedState.isDehydrated)try{Ty(l.containerInfo)}catch(te){lo(i,i.return,te)}break;case 4:wl(l,i),rc(i);break;case 13:wl(l,i),rc(i),w=i.child,w.flags&8192&&(S=w.memoizedState!==null,w.stateNode.isHidden=S,!S||w.alternate!==null&&w.alternate.memoizedState!==null||(yE=yo())),g&4&&hR(i);break;case 22:if(q=h!==null&&h.memoizedState!==null,i.mode&1?(hs=(B=hs)||q,wl(l,i),hs=B):wl(l,i),rc(i),g&8192){if(B=i.memoizedState!==null,(i.stateNode.isHidden=B)&&!q&&i.mode&1)for(Nn=i,q=i.child;q!==null;){for(Y=Nn=q;Nn!==null;){switch(J=Nn,ie=J.child,J.tag){case 0:case 11:case 14:case 15:fy(4,J,J.return);break;case 1:sm(J,J.return);var be=J.stateNode;if(typeof be.componentWillUnmount=="function"){g=J,h=J.return;try{l=g,be.props=l.memoizedProps,be.state=l.memoizedState,be.componentWillUnmount()}catch(te){lo(g,h,te)}}break;case 5:sm(J,J.return);break;case 22:if(J.memoizedState!==null){pR(Y);continue}}ie!==null?(ie.return=J,Nn=ie):pR(Y)}q=q.sibling}e:for(q=null,Y=i;;){if(Y.tag===5){if(q===null){q=Y;try{w=Y.stateNode,B?(S=w.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(o=Y.stateNode,N=Y.memoizedProps.style,R=N!=null&&N.hasOwnProperty("display")?N.display:null,o.style.display=hL("display",R))}catch(te){lo(i,i.return,te)}}}else if(Y.tag===6){if(q===null)try{Y.stateNode.nodeValue=B?"":Y.memoizedProps}catch(te){lo(i,i.return,te)}}else if((Y.tag!==22&&Y.tag!==23||Y.memoizedState===null||Y===i)&&Y.child!==null){Y.child.return=Y,Y=Y.child;continue}if(Y===i)break e;for(;Y.sibling===null;){if(Y.return===null||Y.return===i)break e;q===Y&&(q=null),Y=Y.return}q===Y&&(q=null),Y.sibling.return=Y.return,Y=Y.sibling}}break;case 19:wl(l,i),rc(i),g&4&&hR(i);break;case 21:break;default:wl(l,i),rc(i)}}function rc(i){var l=i.flags;if(l&2){try{e:{for(var h=i.return;h!==null;){if(Nk(h)){var g=h;break e}h=h.return}throw Error(an(160))}switch(g.tag){case 5:var w=g.stateNode;g.flags&32&&(vy(w,""),g.flags&=-33);var S=dR(i);K2(i,S,w);break;case 3:case 4:var R=g.stateNode.containerInfo,o=dR(i);Y2(i,o,R);break;default:throw Error(an(161))}}catch(N){lo(i,i.return,N)}i.flags&=-3}l&4096&&(i.flags&=-4097)}function CV(i,l,h){Nn=i,Uk(i)}function Uk(i,l,h){for(var g=(i.mode&1)!==0;Nn!==null;){var w=Nn,S=w.child;if(w.tag===22&&g){var R=w.memoizedState!==null||_x;if(!R){var o=w.alternate,N=o!==null&&o.memoizedState!==null||hs;o=_x;var B=hs;if(_x=R,(hs=N)&&!B)for(Nn=w;Nn!==null;)R=Nn,N=R.child,R.tag===22&&R.memoizedState!==null?mR(w):N!==null?(N.return=R,Nn=N):mR(w);for(;S!==null;)Nn=S,Uk(S),S=S.sibling;Nn=w,_x=o,hs=B}fR(i)}else w.subtreeFlags&8772&&S!==null?(S.return=w,Nn=S):fR(i)}}function fR(i){for(;Nn!==null;){var l=Nn;if(l.flags&8772){var h=l.alternate;try{if(l.flags&8772)switch(l.tag){case 0:case 11:case 15:hs||U1(5,l);break;case 1:var g=l.stateNode;if(l.flags&4&&!hs)if(h===null)g.componentDidMount();else{var w=l.elementType===l.type?h.memoizedProps:Sl(l.type,h.memoizedProps);g.componentDidUpdate(w,h.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var S=l.updateQueue;S!==null&&KM(l,S,g);break;case 3:var R=l.updateQueue;if(R!==null){if(h=null,l.child!==null)switch(l.child.tag){case 5:h=l.child.stateNode;break;case 1:h=l.child.stateNode}KM(l,R,h)}break;case 5:var o=l.stateNode;if(h===null&&l.flags&4){h=o;var N=l.memoizedProps;switch(l.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&h.focus();break;case"img":N.src&&(h.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(l.memoizedState===null){var B=l.alternate;if(B!==null){var q=B.memoizedState;if(q!==null){var Y=q.dehydrated;Y!==null&&Ty(Y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(an(163))}hs||l.flags&512&&X2(l)}catch(J){lo(l,l.return,J)}}if(l===i){Nn=null;break}if(h=l.sibling,h!==null){h.return=l.return,Nn=h;break}Nn=l.return}}function pR(i){for(;Nn!==null;){var l=Nn;if(l===i){Nn=null;break}var h=l.sibling;if(h!==null){h.return=l.return,Nn=h;break}Nn=l.return}}function mR(i){for(;Nn!==null;){var l=Nn;try{switch(l.tag){case 0:case 11:case 15:var h=l.return;try{U1(4,l)}catch(N){lo(l,h,N)}break;case 1:var g=l.stateNode;if(typeof g.componentDidMount=="function"){var w=l.return;try{g.componentDidMount()}catch(N){lo(l,w,N)}}var S=l.return;try{X2(l)}catch(N){lo(l,S,N)}break;case 5:var R=l.return;try{X2(l)}catch(N){lo(l,R,N)}}}catch(N){lo(l,l.return,N)}if(l===i){Nn=null;break}var o=l.sibling;if(o!==null){o.return=l.return,Nn=o;break}Nn=l.return}}var AV=Math.ceil,m1=lu.ReactCurrentDispatcher,gE=lu.ReactCurrentOwner,Ha=lu.ReactCurrentBatchConfig,fr=0,Wo=null,Po=null,ns=0,pa=0,am=bd(0),zo=0,ky=null,$h=0,V1=0,_E=0,py=null,Zs=null,yE=0,Lm=1/0,Zc=null,g1=!1,Q2=null,hd=null,yx=!1,od=null,_1=0,my=0,J2=null,Vx=-1,$x=0;function Cs(){return fr&6?yo():Vx!==-1?Vx:Vx=yo()}function fd(i){return i.mode&1?fr&2&&ns!==0?ns&-ns:dV.transition!==null?($x===0&&($x=EL()),$x):(i=Cr,i!==0||(i=window.event,i=i===void 0?16:DL(i.type)),i):1}function Rl(i,l,h,g){if(50<my)throw my=0,J2=null,Error(an(185));qy(i,h,g),(!(fr&2)||i!==Wo)&&(i===Wo&&(!(fr&2)&&(V1|=h),zo===4&&Qu(i,ns)),Qs(i,g),h===1&&fr===0&&!(l.mode&1)&&(Lm=yo()+500,N1&&Td()))}function Qs(i,l){var h=i.callbackNode;dU(i,l);var g=e1(i,i===Wo?ns:0);if(g===0)h!==null&&SM(h),i.callbackNode=null,i.callbackPriority=0;else if(l=g&-g,i.callbackPriority!==l){if(h!=null&&SM(h),l===1)i.tag===0?uV(gR.bind(null,i)):KL(gR.bind(null,i)),sV(function(){!(fr&6)&&Td()}),h=null;else{switch(IL(g)){case 1:h=GS;break;case 4:h=TL;break;case 16:h=Jx;break;case 536870912:h=SL;break;default:h=Jx}h=Xk(h,Vk.bind(null,i))}i.callbackPriority=l,i.callbackNode=h}}function Vk(i,l){if(Vx=-1,$x=0,fr&6)throw Error(an(327));var h=i.callbackNode;if(fm()&&i.callbackNode!==h)return null;var g=e1(i,i===Wo?ns:0);if(g===0)return null;if(g&30||g&i.expiredLanes||l)l=y1(i,g);else{l=g;var w=fr;fr|=2;var S=Gk();(Wo!==i||ns!==l)&&(Zc=null,Lm=yo()+500,Oh(i,l));do try{RV();break}catch(o){$k(i,o)}while(!0);iE(),m1.current=S,fr=w,Po!==null?l=0:(Wo=null,ns=0,l=zo)}if(l!==0){if(l===2&&(w=I2(i),w!==0&&(g=w,l=eS(i,w))),l===1)throw h=ky,Oh(i,0),Qu(i,g),Qs(i,yo()),h;if(l===6)Qu(i,g);else{if(w=i.current.alternate,!(g&30)&&!PV(w)&&(l=y1(i,g),l===2&&(S=I2(i),S!==0&&(g=S,l=eS(i,S))),l===1))throw h=ky,Oh(i,0),Qu(i,g),Qs(i,yo()),h;switch(i.finishedWork=w,i.finishedLanes=g,l){case 0:case 1:throw Error(an(345));case 2:Sh(i,Zs,Zc);break;case 3:if(Qu(i,g),(g&130023424)===g&&(l=yE+500-yo(),10<l)){if(e1(i,0)!==0)break;if(w=i.suspendedLanes,(w&g)!==g){Cs(),i.pingedLanes|=i.suspendedLanes&w;break}i.timeoutHandle=k2(Sh.bind(null,i,Zs,Zc),l);break}Sh(i,Zs,Zc);break;case 4:if(Qu(i,g),(g&4194240)===g)break;for(l=i.eventTimes,w=-1;0<g;){var R=31-Ml(g);S=1<<R,R=l[R],R>w&&(w=R),g&=~S}if(g=w,g=yo()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*AV(g/1960))-g,10<g){i.timeoutHandle=k2(Sh.bind(null,i,Zs,Zc),g);break}Sh(i,Zs,Zc);break;case 5:Sh(i,Zs,Zc);break;default:throw Error(an(329))}}}return Qs(i,yo()),i.callbackNode===h?Vk.bind(null,i):null}function eS(i,l){var h=py;return i.current.memoizedState.isDehydrated&&(Oh(i,l).flags|=256),i=y1(i,l),i!==2&&(l=Zs,Zs=h,l!==null&&tS(l)),i}function tS(i){Zs===null?Zs=i:Zs.push.apply(Zs,i)}function PV(i){for(var l=i;;){if(l.flags&16384){var h=l.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var g=0;g<h.length;g++){var w=h[g],S=w.getSnapshot;w=w.value;try{if(!Dl(S(),w))return!1}catch{return!1}}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Qu(i,l){for(l&=~_E,l&=~V1,i.suspendedLanes|=l,i.pingedLanes&=~l,i=i.expirationTimes;0<l;){var h=31-Ml(l),g=1<<h;i[h]=-1,l&=~g}}function gR(i){if(fr&6)throw Error(an(327));fm();var l=e1(i,0);if(!(l&1))return Qs(i,yo()),null;var h=y1(i,l);if(i.tag!==0&&h===2){var g=I2(i);g!==0&&(l=g,h=eS(i,g))}if(h===1)throw h=ky,Oh(i,0),Qu(i,l),Qs(i,yo()),h;if(h===6)throw Error(an(345));return i.finishedWork=i.current.alternate,i.finishedLanes=l,Sh(i,Zs,Zc),Qs(i,yo()),null}function vE(i,l){var h=fr;fr|=1;try{return i(l)}finally{fr=h,fr===0&&(Lm=yo()+500,N1&&Td())}}function Gh(i){od!==null&&od.tag===0&&!(fr&6)&&fm();var l=fr;fr|=1;var h=Ha.transition,g=Cr;try{if(Ha.transition=null,Cr=1,i)return i()}finally{Cr=g,Ha.transition=h,fr=l,!(fr&6)&&Td()}}function xE(){pa=am.current,Hr(am)}function Oh(i,l){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,oV(h)),Po!==null)for(h=Po.return;h!==null;){var g=h;switch(eE(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&o1();break;case 3:Rm(),Hr(Ys),Hr(fs),cE();break;case 5:lE(g);break;case 4:Rm();break;case 13:Hr(no);break;case 19:Hr(no);break;case 10:rE(g.type._context);break;case 22:case 23:xE()}h=h.return}if(Wo=i,Po=i=pd(i.current,null),ns=pa=l,zo=0,ky=null,_E=V1=$h=0,Zs=py=null,Ah!==null){for(l=0;l<Ah.length;l++)if(h=Ah[l],g=h.interleaved,g!==null){h.interleaved=null;var w=g.next,S=h.pending;if(S!==null){var R=S.next;S.next=w,g.next=R}h.pending=g}Ah=null}return i}function $k(i,l){do{var h=Po;try{if(iE(),Bx.current=p1,f1){for(var g=io.memoizedState;g!==null;){var w=g.queue;w!==null&&(w.pending=null),g=g.next}f1=!1}if(Vh=0,Ho=ko=io=null,hy=!1,Ry=0,gE.current=null,h===null||h.return===null){zo=1,ky=l,Po=null;break}e:{var S=i,R=h.return,o=h,N=l;if(l=ns,o.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var B=N,q=o,Y=q.tag;if(!(q.mode&1)&&(Y===0||Y===11||Y===15)){var J=q.alternate;J?(q.updateQueue=J.updateQueue,q.memoizedState=J.memoizedState,q.lanes=J.lanes):(q.updateQueue=null,q.memoizedState=null)}var ie=iR(R);if(ie!==null){ie.flags&=-257,rR(ie,R,o,S,l),ie.mode&1&&nR(S,B,l),l=ie,N=B;var be=l.updateQueue;if(be===null){var te=new Set;te.add(N),l.updateQueue=te}else be.add(N);break e}else{if(!(l&1)){nR(S,B,l),wE();break e}N=Error(an(426))}}else if(Kr&&o.mode&1){var le=iR(R);if(le!==null){!(le.flags&65536)&&(le.flags|=256),rR(le,R,o,S,l),tE(Dm(N,o));break e}}S=N=Dm(N,o),zo!==4&&(zo=2),py===null?py=[S]:py.push(S),S=R;do{switch(S.tag){case 3:S.flags|=65536,l&=-l,S.lanes|=l;var ce=Ik(S,N,l);YM(S,ce);break e;case 1:o=N;var oe=S.type,ue=S.stateNode;if(!(S.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(hd===null||!hd.has(ue)))){S.flags|=65536,l&=-l,S.lanes|=l;var Me=Ck(S,o,l);YM(S,Me);break e}}S=S.return}while(S!==null)}Wk(h)}catch(Ne){l=Ne,Po===h&&h!==null&&(Po=h=h.return);continue}break}while(!0)}function Gk(){var i=m1.current;return m1.current=p1,i===null?p1:i}function wE(){(zo===0||zo===3||zo===2)&&(zo=4),Wo===null||!($h&268435455)&&!(V1&268435455)||Qu(Wo,ns)}function y1(i,l){var h=fr;fr|=2;var g=Gk();(Wo!==i||ns!==l)&&(Zc=null,Oh(i,l));do try{MV();break}catch(w){$k(i,w)}while(!0);if(iE(),fr=h,m1.current=g,Po!==null)throw Error(an(261));return Wo=null,ns=0,zo}function MV(){for(;Po!==null;)Hk(Po)}function RV(){for(;Po!==null&&!nU();)Hk(Po)}function Hk(i){var l=Zk(i.alternate,i,pa);i.memoizedProps=i.pendingProps,l===null?Wk(i):Po=l,gE.current=null}function Wk(i){var l=i;do{var h=l.alternate;if(i=l.return,l.flags&32768){if(h=SV(h,l),h!==null){h.flags&=32767,Po=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{zo=6,Po=null;return}}else if(h=TV(h,l,pa),h!==null){Po=h;return}if(l=l.sibling,l!==null){Po=l;return}Po=l=i}while(l!==null);zo===0&&(zo=5)}function Sh(i,l,h){var g=Cr,w=Ha.transition;try{Ha.transition=null,Cr=1,DV(i,l,h,g)}finally{Ha.transition=w,Cr=g}return null}function DV(i,l,h,g){do fm();while(od!==null);if(fr&6)throw Error(an(327));h=i.finishedWork;var w=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(an(177));i.callbackNode=null,i.callbackPriority=0;var S=h.lanes|h.childLanes;if(hU(i,S),i===Wo&&(Po=Wo=null,ns=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||yx||(yx=!0,Xk(Jx,function(){return fm(),null})),S=(h.flags&15990)!==0,h.subtreeFlags&15990||S){S=Ha.transition,Ha.transition=null;var R=Cr;Cr=1;var o=fr;fr|=4,gE.current=null,IV(i,h),jk(h,i),QU(D2),t1=!!R2,D2=R2=null,i.current=h,CV(h),iU(),fr=o,Cr=R,Ha.transition=S}else i.current=h;if(yx&&(yx=!1,od=i,_1=w),S=i.pendingLanes,S===0&&(hd=null),sU(h.stateNode),Qs(i,yo()),l!==null)for(g=i.onRecoverableError,h=0;h<l.length;h++)w=l[h],g(w.value,{componentStack:w.stack,digest:w.digest});if(g1)throw g1=!1,i=Q2,Q2=null,i;return _1&1&&i.tag!==0&&fm(),S=i.pendingLanes,S&1?i===J2?my++:(my=0,J2=i):my=0,Td(),null}function fm(){if(od!==null){var i=IL(_1),l=Ha.transition,h=Cr;try{if(Ha.transition=null,Cr=16>i?16:i,od===null)var g=!1;else{if(i=od,od=null,_1=0,fr&6)throw Error(an(331));var w=fr;for(fr|=4,Nn=i.current;Nn!==null;){var S=Nn,R=S.child;if(Nn.flags&16){var o=S.deletions;if(o!==null){for(var N=0;N<o.length;N++){var B=o[N];for(Nn=B;Nn!==null;){var q=Nn;switch(q.tag){case 0:case 11:case 15:fy(8,q,S)}var Y=q.child;if(Y!==null)Y.return=q,Nn=Y;else for(;Nn!==null;){q=Nn;var J=q.sibling,ie=q.return;if(Fk(q),q===B){Nn=null;break}if(J!==null){J.return=ie,Nn=J;break}Nn=ie}}}var be=S.alternate;if(be!==null){var te=be.child;if(te!==null){be.child=null;do{var le=te.sibling;te.sibling=null,te=le}while(te!==null)}}Nn=S}}if(S.subtreeFlags&2064&&R!==null)R.return=S,Nn=R;else e:for(;Nn!==null;){if(S=Nn,S.flags&2048)switch(S.tag){case 0:case 11:case 15:fy(9,S,S.return)}var ce=S.sibling;if(ce!==null){ce.return=S.return,Nn=ce;break e}Nn=S.return}}var oe=i.current;for(Nn=oe;Nn!==null;){R=Nn;var ue=R.child;if(R.subtreeFlags&2064&&ue!==null)ue.return=R,Nn=ue;else e:for(R=oe;Nn!==null;){if(o=Nn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:U1(9,o)}}catch(Ne){lo(o,o.return,Ne)}if(o===R){Nn=null;break e}var Me=o.sibling;if(Me!==null){Me.return=o.return,Nn=Me;break e}Nn=o.return}}if(fr=w,Td(),fc&&typeof fc.onPostCommitFiberRoot=="function")try{fc.onPostCommitFiberRoot(L1,i)}catch{}g=!0}return g}finally{Cr=h,Ha.transition=l}}return!1}function _R(i,l,h){l=Dm(h,l),l=Ik(i,l,1),i=dd(i,l,1),l=Cs(),i!==null&&(qy(i,1,l),Qs(i,l))}function lo(i,l,h){if(i.tag===3)_R(i,i,h);else for(;l!==null;){if(l.tag===3){_R(l,i,h);break}else if(l.tag===1){var g=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(hd===null||!hd.has(g))){i=Dm(h,i),i=Ck(l,i,1),l=dd(l,i,1),i=Cs(),l!==null&&(qy(l,1,i),Qs(l,i));break}}l=l.return}}function LV(i,l,h){var g=i.pingCache;g!==null&&g.delete(l),l=Cs(),i.pingedLanes|=i.suspendedLanes&h,Wo===i&&(ns&h)===h&&(zo===4||zo===3&&(ns&130023424)===ns&&500>yo()-yE?Oh(i,0):_E|=h),Qs(i,l)}function qk(i,l){l===0&&(i.mode&1?(l=lx,lx<<=1,!(lx&130023424)&&(lx=4194304)):l=1);var h=Cs();i=ru(i,l),i!==null&&(qy(i,l,h),Qs(i,h))}function kV(i){var l=i.memoizedState,h=0;l!==null&&(h=l.retryLane),qk(i,h)}function zV(i,l){var h=0;switch(i.tag){case 13:var g=i.stateNode,w=i.memoizedState;w!==null&&(h=w.retryLane);break;case 19:g=i.stateNode;break;default:throw Error(an(314))}g!==null&&g.delete(l),qk(i,h)}var Zk;Zk=function(i,l,h){if(i!==null)if(i.memoizedProps!==l.pendingProps||Ys.current)Xs=!0;else{if(!(i.lanes&h)&&!(l.flags&128))return Xs=!1,bV(i,l,h);Xs=!!(i.flags&131072)}else Xs=!1,Kr&&l.flags&1048576&&QL(l,l1,l.index);switch(l.lanes=0,l.tag){case 2:var g=l.type;Ux(i,l),i=l.pendingProps;var w=Am(l,fs.current);hm(l,h),w=dE(null,l,g,i,w,h);var S=hE();return l.flags|=1,typeof w=="object"&&w!==null&&typeof w.render=="function"&&w.$$typeof===void 0?(l.tag=1,l.memoizedState=null,l.updateQueue=null,Ks(g)?(S=!0,s1(l)):S=!1,l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,sE(l),w.updater=j1,l.stateNode=w,w._reactInternals=l,U2(l,g,i,h),l=G2(null,l,g,!0,S,h)):(l.tag=0,Kr&&S&&JS(l),Es(null,l,w,h),l=l.child),l;case 16:g=l.elementType;e:{switch(Ux(i,l),i=l.pendingProps,w=g._init,g=w(g._payload),l.type=g,w=l.tag=FV(g),i=Sl(g,i),w){case 0:l=$2(null,l,g,i,h);break e;case 1:l=aR(null,l,g,i,h);break e;case 11:l=oR(null,l,g,i,h);break e;case 14:l=sR(null,l,g,Sl(g.type,i),h);break e}throw Error(an(306,g,""))}return l;case 0:return g=l.type,w=l.pendingProps,w=l.elementType===g?w:Sl(g,w),$2(i,l,g,w,h);case 1:return g=l.type,w=l.pendingProps,w=l.elementType===g?w:Sl(g,w),aR(i,l,g,w,h);case 3:e:{if(Rk(l),i===null)throw Error(an(387));g=l.pendingProps,S=l.memoizedState,w=S.element,rk(i,l),d1(l,g,null,h);var R=l.memoizedState;if(g=R.element,S.isDehydrated)if(S={element:g,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},l.updateQueue.baseState=S,l.memoizedState=S,l.flags&256){w=Dm(Error(an(423)),l),l=lR(i,l,g,h,w);break e}else if(g!==w){w=Dm(Error(an(424)),l),l=lR(i,l,g,h,w);break e}else for(ga=ud(l.stateNode.containerInfo.firstChild),_a=l,Kr=!0,Pl=null,h=nk(l,null,g,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Pm(),g===w){l=ou(i,l,h);break e}Es(i,l,g,h)}l=l.child}return l;case 5:return ok(l),i===null&&N2(l),g=l.type,w=l.pendingProps,S=i!==null?i.memoizedProps:null,R=w.children,L2(g,w)?R=null:S!==null&&L2(g,S)&&(l.flags|=32),Mk(i,l),Es(i,l,R,h),l.child;case 6:return i===null&&N2(l),null;case 13:return Dk(i,l,h);case 4:return aE(l,l.stateNode.containerInfo),g=l.pendingProps,i===null?l.child=Mm(l,null,g,h):Es(i,l,g,h),l.child;case 11:return g=l.type,w=l.pendingProps,w=l.elementType===g?w:Sl(g,w),oR(i,l,g,w,h);case 7:return Es(i,l,l.pendingProps,h),l.child;case 8:return Es(i,l,l.pendingProps.children,h),l.child;case 12:return Es(i,l,l.pendingProps.children,h),l.child;case 10:e:{if(g=l.type._context,w=l.pendingProps,S=l.memoizedProps,R=w.value,Br(c1,g._currentValue),g._currentValue=R,S!==null)if(Dl(S.value,R)){if(S.children===w.children&&!Ys.current){l=ou(i,l,h);break e}}else for(S=l.child,S!==null&&(S.return=l);S!==null;){var o=S.dependencies;if(o!==null){R=S.child;for(var N=o.firstContext;N!==null;){if(N.context===g){if(S.tag===1){N=eu(-1,h&-h),N.tag=2;var B=S.updateQueue;if(B!==null){B=B.shared;var q=B.pending;q===null?N.next=N:(N.next=q.next,q.next=N),B.pending=N}}S.lanes|=h,N=S.alternate,N!==null&&(N.lanes|=h),B2(S.return,h,l),o.lanes|=h;break}N=N.next}}else if(S.tag===10)R=S.type===l.type?null:S.child;else if(S.tag===18){if(R=S.return,R===null)throw Error(an(341));R.lanes|=h,o=R.alternate,o!==null&&(o.lanes|=h),B2(R,h,l),R=S.sibling}else R=S.child;if(R!==null)R.return=S;else for(R=S;R!==null;){if(R===l){R=null;break}if(S=R.sibling,S!==null){S.return=R.return,R=S;break}R=R.return}S=R}Es(i,l,w.children,h),l=l.child}return l;case 9:return w=l.type,g=l.pendingProps.children,hm(l,h),w=qa(w),g=g(w),l.flags|=1,Es(i,l,g,h),l.child;case 14:return g=l.type,w=Sl(g,l.pendingProps),w=Sl(g.type,w),sR(i,l,g,w,h);case 15:return Ak(i,l,l.type,l.pendingProps,h);case 17:return g=l.type,w=l.pendingProps,w=l.elementType===g?w:Sl(g,w),Ux(i,l),l.tag=1,Ks(g)?(i=!0,s1(l)):i=!1,hm(l,h),Ek(l,g,w),U2(l,g,w,h),G2(null,l,g,!0,i,h);case 19:return Lk(i,l,h);case 22:return Pk(i,l,h)}throw Error(an(156,l.tag))};function Xk(i,l){return bL(i,l)}function OV(i,l,h,g){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ga(i,l,h,g){return new OV(i,l,h,g)}function bE(i){return i=i.prototype,!(!i||!i.isReactComponent)}function FV(i){if(typeof i=="function")return bE(i)?1:0;if(i!=null){if(i=i.$$typeof,i===US)return 11;if(i===VS)return 14}return 2}function pd(i,l){var h=i.alternate;return h===null?(h=Ga(i.tag,l,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=l,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,l=i.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Gx(i,l,h,g,w,S){var R=2;if(g=i,typeof i=="function")bE(i)&&(R=1);else if(typeof i=="string")R=5;else e:switch(i){case Kp:return Fh(h.children,w,S,l);case jS:R=8,w|=8;break;case d2:return i=Ga(12,h,l,w|2),i.elementType=d2,i.lanes=S,i;case h2:return i=Ga(13,h,l,w),i.elementType=h2,i.lanes=S,i;case f2:return i=Ga(19,h,l,w),i.elementType=f2,i.lanes=S,i;case oL:return $1(h,w,S,l);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case iL:R=10;break e;case rL:R=9;break e;case US:R=11;break e;case VS:R=14;break e;case Xu:R=16,g=null;break e}throw Error(an(130,i==null?i:typeof i,""))}return l=Ga(R,h,l,w),l.elementType=i,l.type=g,l.lanes=S,l}function Fh(i,l,h,g){return i=Ga(7,i,g,l),i.lanes=h,i}function $1(i,l,h,g){return i=Ga(22,i,g,l),i.elementType=oL,i.lanes=h,i.stateNode={isHidden:!1},i}function GT(i,l,h){return i=Ga(6,i,null,l),i.lanes=h,i}function HT(i,l,h){return l=Ga(4,i.children!==null?i.children:[],i.key,l),l.lanes=h,l.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},l}function NV(i,l,h,g,w){this.tag=l,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ET(0),this.expirationTimes=ET(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ET(0),this.identifierPrefix=g,this.onRecoverableError=w,this.mutableSourceEagerHydrationData=null}function TE(i,l,h,g,w,S,R,o,N){return i=new NV(i,l,h,o,N),l===1?(l=1,S===!0&&(l|=8)):l=0,S=Ga(3,null,null,l),i.current=S,S.stateNode=i,S.memoizedState={element:g,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},sE(S),i}function BV(i,l,h){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yp,key:g==null?null:""+g,children:i,containerInfo:l,implementation:h}}function Yk(i){if(!i)return yd;i=i._reactInternals;e:{if(Jh(i)!==i||i.tag!==1)throw Error(an(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break e;case 1:if(Ks(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break e}}l=l.return}while(l!==null);throw Error(an(171))}if(i.tag===1){var h=i.type;if(Ks(h))return YL(i,h,l)}return l}function Kk(i,l,h,g,w,S,R,o,N){return i=TE(h,g,!0,i,w,S,R,o,N),i.context=Yk(null),h=i.current,g=Cs(),w=fd(h),S=eu(g,w),S.callback=l??null,dd(h,S,w),i.current.lanes=w,qy(i,w,g),Qs(i,g),i}function G1(i,l,h,g){var w=l.current,S=Cs(),R=fd(w);return h=Yk(h),l.context===null?l.context=h:l.pendingContext=h,l=eu(S,R),l.payload={element:i},g=g===void 0?null:g,g!==null&&(l.callback=g),i=dd(w,l,R),i!==null&&(Rl(i,w,R,S),Nx(i,w,R)),R}function v1(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function yR(i,l){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<l?h:l}}function SE(i,l){yR(i,l),(i=i.alternate)&&yR(i,l)}function jV(){return null}var Qk=typeof reportError=="function"?reportError:function(i){console.error(i)};function EE(i){this._internalRoot=i}H1.prototype.render=EE.prototype.render=function(i){var l=this._internalRoot;if(l===null)throw Error(an(409));G1(i,l,null,null)};H1.prototype.unmount=EE.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var l=i.containerInfo;Gh(function(){G1(null,i,null,null)}),l[iu]=null}};function H1(i){this._internalRoot=i}H1.prototype.unstable_scheduleHydration=function(i){if(i){var l=PL();i={blockedOn:null,target:i,priority:l};for(var h=0;h<Ku.length&&l!==0&&l<Ku[h].priority;h++);Ku.splice(h,0,i),h===0&&RL(i)}};function IE(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function W1(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function vR(){}function UV(i,l,h,g,w){if(w){if(typeof g=="function"){var S=g;g=function(){var B=v1(R);S.call(B)}}var R=Kk(l,g,i,0,null,!1,!1,"",vR);return i._reactRootContainer=R,i[iu]=R.current,Iy(i.nodeType===8?i.parentNode:i),Gh(),R}for(;w=i.lastChild;)i.removeChild(w);if(typeof g=="function"){var o=g;g=function(){var B=v1(N);o.call(B)}}var N=TE(i,0,!1,null,null,!1,!1,"",vR);return i._reactRootContainer=N,i[iu]=N.current,Iy(i.nodeType===8?i.parentNode:i),Gh(function(){G1(l,N,h,g)}),N}function q1(i,l,h,g,w){var S=h._reactRootContainer;if(S){var R=S;if(typeof w=="function"){var o=w;w=function(){var N=v1(R);o.call(N)}}G1(l,R,i,w)}else R=UV(h,l,i,w,g);return v1(R)}CL=function(i){switch(i.tag){case 3:var l=i.stateNode;if(l.current.memoizedState.isDehydrated){var h=iy(l.pendingLanes);h!==0&&(HS(l,h|1),Qs(l,yo()),!(fr&6)&&(Lm=yo()+500,Td()))}break;case 13:Gh(function(){var g=ru(i,1);if(g!==null){var w=Cs();Rl(g,i,1,w)}}),SE(i,1)}};WS=function(i){if(i.tag===13){var l=ru(i,134217728);if(l!==null){var h=Cs();Rl(l,i,134217728,h)}SE(i,134217728)}};AL=function(i){if(i.tag===13){var l=fd(i),h=ru(i,l);if(h!==null){var g=Cs();Rl(h,i,l,g)}SE(i,l)}};PL=function(){return Cr};ML=function(i,l){var h=Cr;try{return Cr=i,l()}finally{Cr=h}};T2=function(i,l,h){switch(l){case"input":if(g2(i,h),l=h.name,h.type==="radio"&&l!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<h.length;l++){var g=h[l];if(g!==i&&g.form===i.form){var w=F1(g);if(!w)throw Error(an(90));aL(g),g2(g,w)}}}break;case"textarea":cL(i,h);break;case"select":l=h.value,l!=null&&lm(i,!!h.multiple,l,!1)}};gL=vE;_L=Gh;var VV={usingClientEntryPoint:!1,Events:[Xy,tm,F1,pL,mL,vE]},Q_={findFiberByHostInstance:Ch,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$V={bundleType:Q_.bundleType,version:Q_.version,rendererPackageName:Q_.rendererPackageName,rendererConfig:Q_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:lu.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=xL(i),i===null?null:i.stateNode},findFiberByHostInstance:Q_.findFiberByHostInstance||jV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vx.isDisabled&&vx.supportsFiber)try{L1=vx.inject($V),fc=vx}catch{}}xa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VV;xa.createPortal=function(i,l){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!IE(l))throw Error(an(200));return BV(i,l,null,h)};xa.createRoot=function(i,l){if(!IE(i))throw Error(an(299));var h=!1,g="",w=Qk;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(g=l.identifierPrefix),l.onRecoverableError!==void 0&&(w=l.onRecoverableError)),l=TE(i,1,!1,null,null,h,!1,g,w),i[iu]=l.current,Iy(i.nodeType===8?i.parentNode:i),new EE(l)};xa.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var l=i._reactInternals;if(l===void 0)throw typeof i.render=="function"?Error(an(188)):(i=Object.keys(i).join(","),Error(an(268,i)));return i=xL(l),i=i===null?null:i.stateNode,i};xa.flushSync=function(i){return Gh(i)};xa.hydrate=function(i,l,h){if(!W1(l))throw Error(an(200));return q1(null,i,l,!0,h)};xa.hydrateRoot=function(i,l,h){if(!IE(i))throw Error(an(405));var g=h!=null&&h.hydratedSources||null,w=!1,S="",R=Qk;if(h!=null&&(h.unstable_strictMode===!0&&(w=!0),h.identifierPrefix!==void 0&&(S=h.identifierPrefix),h.onRecoverableError!==void 0&&(R=h.onRecoverableError)),l=Kk(l,null,i,1,h??null,w,!1,S,R),i[iu]=l.current,Iy(i),g)for(i=0;i<g.length;i++)h=g[i],w=h._getVersion,w=w(h._source),l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,w]:l.mutableSourceEagerHydrationData.push(h,w);return new H1(l)};xa.render=function(i,l,h){if(!W1(l))throw Error(an(200));return q1(null,i,l,!1,h)};xa.unmountComponentAtNode=function(i){if(!W1(i))throw Error(an(40));return i._reactRootContainer?(Gh(function(){q1(null,null,i,!1,function(){i._reactRootContainer=null,i[iu]=null})}),!0):!1};xa.unstable_batchedUpdates=vE;xa.unstable_renderSubtreeIntoContainer=function(i,l,h,g){if(!W1(h))throw Error(an(200));if(i==null||i._reactInternals===void 0)throw Error(an(38));return q1(i,l,h,!1,g)};xa.version="18.3.1-next-f1338f8080-20240426";function Jk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Jk)}catch(i){console.error(i)}}Jk(),JD.exports=xa;var ef=JD.exports;const ez=RS(ef);var tz,xR=ef;tz=xR.createRoot,xR.hydrateRoot;const GV=1,HV=1e6;let WT=0;function WV(){return WT=(WT+1)%Number.MAX_SAFE_INTEGER,WT.toString()}const qT=new Map,wR=i=>{if(qT.has(i))return;const l=setTimeout(()=>{qT.delete(i),gy({type:"REMOVE_TOAST",toastId:i})},HV);qT.set(i,l)},qV=(i,l)=>{switch(l.type){case"ADD_TOAST":return{...i,toasts:[l.toast,...i.toasts].slice(0,GV)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(h=>h.id===l.toast.id?{...h,...l.toast}:h)};case"DISMISS_TOAST":{const{toastId:h}=l;return h?wR(h):i.toasts.forEach(g=>{wR(g.id)}),{...i,toasts:i.toasts.map(g=>g.id===h||h===void 0?{...g,open:!1}:g)}}case"REMOVE_TOAST":return l.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(h=>h.id!==l.toastId)}}},Hx=[];let Wx={toasts:[]};function gy(i){Wx=qV(Wx,i),Hx.forEach(l=>{l(Wx)})}function ZV({...i}){const l=WV(),h=w=>gy({type:"UPDATE_TOAST",toast:{...w,id:l}}),g=()=>gy({type:"DISMISS_TOAST",toastId:l});return gy({type:"ADD_TOAST",toast:{...i,id:l,open:!0,onOpenChange:w=>{w||g()}}}),{id:l,dismiss:g,update:h}}function XV(){const[i,l]=G.useState(Wx);return G.useEffect(()=>(Hx.push(l),()=>{const h=Hx.indexOf(l);h>-1&&Hx.splice(h,1)}),[i]),{...i,toast:ZV,dismiss:h=>gy({type:"DISMISS_TOAST",toastId:h})}}function bn(i,l,{checkForDefaultPrevented:h=!0}={}){return function(w){if(i==null||i(w),h===!1||!w.defaultPrevented)return l==null?void 0:l(w)}}function bR(i,l){if(typeof i=="function")return i(l);i!=null&&(i.current=l)}function Z1(...i){return l=>{let h=!1;const g=i.map(w=>{const S=bR(w,l);return!h&&typeof S=="function"&&(h=!0),S});if(h)return()=>{for(let w=0;w<g.length;w++){const S=g[w];typeof S=="function"?S():bR(i[w],null)}}}}function $i(...i){return G.useCallback(Z1(...i),i)}function YV(i,l){const h=G.createContext(l),g=S=>{const{children:R,...o}=S,N=G.useMemo(()=>o,Object.values(o));return L.jsx(h.Provider,{value:N,children:R})};g.displayName=i+"Provider";function w(S){const R=G.useContext(h);if(R)return R;if(l!==void 0)return l;throw new Error(`\`${S}\` must be used within \`${i}\``)}return[g,w]}function cu(i,l=[]){let h=[];function g(S,R){const o=G.createContext(R),N=h.length;h=[...h,R];const B=Y=>{var ce;const{scope:J,children:ie,...be}=Y,te=((ce=J==null?void 0:J[i])==null?void 0:ce[N])||o,le=G.useMemo(()=>be,Object.values(be));return L.jsx(te.Provider,{value:le,children:ie})};B.displayName=S+"Provider";function q(Y,J){var te;const ie=((te=J==null?void 0:J[i])==null?void 0:te[N])||o,be=G.useContext(ie);if(be)return be;if(R!==void 0)return R;throw new Error(`\`${Y}\` must be used within \`${S}\``)}return[B,q]}const w=()=>{const S=h.map(R=>G.createContext(R));return function(o){const N=(o==null?void 0:o[i])||S;return G.useMemo(()=>({[`__scope${i}`]:{...o,[i]:N}}),[o,N])}};return w.scopeName=i,[g,KV(w,...l)]}function KV(...i){const l=i[0];if(i.length===1)return l;const h=()=>{const g=i.map(w=>({useScope:w(),scopeName:w.scopeName}));return function(S){const R=g.reduce((o,{useScope:N,scopeName:B})=>{const Y=N(S)[`__scope${B}`];return{...o,...Y}},{});return G.useMemo(()=>({[`__scope${l.scopeName}`]:R}),[R])}};return h.scopeName=l.scopeName,h}function Hh(i){const l=JV(i),h=G.forwardRef((g,w)=>{const{children:S,...R}=g,o=G.Children.toArray(S),N=o.find(t6);if(N){const B=N.props.children,q=o.map(Y=>Y===N?G.Children.count(B)>1?G.Children.only(null):G.isValidElement(B)?B.props.children:null:Y);return L.jsx(l,{...R,ref:w,children:G.isValidElement(B)?G.cloneElement(B,void 0,q):null})}return L.jsx(l,{...R,ref:w,children:S})});return h.displayName=`${i}.Slot`,h}var QV=Hh("Slot");function JV(i){const l=G.forwardRef((h,g)=>{const{children:w,...S}=h;if(G.isValidElement(w)){const R=i6(w),o=n6(S,w.props);return w.type!==G.Fragment&&(o.ref=g?Z1(g,R):R),G.cloneElement(w,o)}return G.Children.count(w)>1?G.Children.only(null):null});return l.displayName=`${i}.SlotClone`,l}var nz=Symbol("radix.slottable");function e6(i){const l=({children:h})=>L.jsx(L.Fragment,{children:h});return l.displayName=`${i}.Slottable`,l.__radixId=nz,l}function t6(i){return G.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===nz}function n6(i,l){const h={...l};for(const g in l){const w=i[g],S=l[g];/^on[A-Z]/.test(g)?w&&S?h[g]=(...o)=>{const N=S(...o);return w(...o),N}:w&&(h[g]=w):g==="style"?h[g]={...w,...S}:g==="className"&&(h[g]=[w,S].filter(Boolean).join(" "))}return{...i,...h}}function i6(i){var g,w;let l=(g=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:g.get,h=l&&"isReactWarning"in l&&l.isReactWarning;return h?i.ref:(l=(w=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:w.get,h=l&&"isReactWarning"in l&&l.isReactWarning,h?i.props.ref:i.props.ref||i.ref)}function X1(i){const l=i+"CollectionProvider",[h,g]=cu(l),[w,S]=h(l,{collectionRef:{current:null},itemMap:new Map}),R=te=>{const{scope:le,children:ce}=te,oe=pn.useRef(null),ue=pn.useRef(new Map).current;return L.jsx(w,{scope:le,itemMap:ue,collectionRef:oe,children:ce})};R.displayName=l;const o=i+"CollectionSlot",N=Hh(o),B=pn.forwardRef((te,le)=>{const{scope:ce,children:oe}=te,ue=S(o,ce),Me=$i(le,ue.collectionRef);return L.jsx(N,{ref:Me,children:oe})});B.displayName=o;const q=i+"CollectionItemSlot",Y="data-radix-collection-item",J=Hh(q),ie=pn.forwardRef((te,le)=>{const{scope:ce,children:oe,...ue}=te,Me=pn.useRef(null),Ne=$i(le,Me),je=S(q,ce);return pn.useEffect(()=>(je.itemMap.set(Me,{ref:Me,...ue}),()=>void je.itemMap.delete(Me))),L.jsx(J,{[Y]:"",ref:Ne,children:oe})});ie.displayName=q;function be(te){const le=S(i+"CollectionConsumer",te);return pn.useCallback(()=>{const oe=le.collectionRef.current;if(!oe)return[];const ue=Array.from(oe.querySelectorAll(`[${Y}]`));return Array.from(le.itemMap.values()).sort((je,Te)=>ue.indexOf(je.ref.current)-ue.indexOf(Te.ref.current))},[le.collectionRef,le.itemMap])}return[{Provider:R,Slot:B,ItemSlot:ie},be,g]}var r6=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],_i=r6.reduce((i,l)=>{const h=Hh(`Primitive.${l}`),g=G.forwardRef((w,S)=>{const{asChild:R,...o}=w,N=R?h:l;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),L.jsx(N,{...o,ref:S})});return g.displayName=`Primitive.${l}`,{...i,[l]:g}},{});function tf(i,l){i&&ef.flushSync(()=>i.dispatchEvent(l))}function co(i){const l=G.useRef(i);return G.useEffect(()=>{l.current=i}),G.useMemo(()=>(...h)=>{var g;return(g=l.current)==null?void 0:g.call(l,...h)},[])}function Ky(i,l=globalThis==null?void 0:globalThis.document){const h=co(i);G.useEffect(()=>{const g=w=>{w.key==="Escape"&&h(w)};return l.addEventListener("keydown",g,{capture:!0}),()=>l.removeEventListener("keydown",g,{capture:!0})},[h,l])}var o6="DismissableLayer",nS="dismissableLayer.update",s6="dismissableLayer.pointerDownOutside",a6="dismissableLayer.focusOutside",TR,iz=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),rz=G.forwardRef((i,l)=>{const{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:g,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:R,onDismiss:o,...N}=i,B=G.useContext(iz),[q,Y]=G.useState(null),J=(q==null?void 0:q.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=G.useState({}),be=$i(l,Te=>Y(Te)),te=Array.from(B.layers),[le]=[...B.layersWithOutsidePointerEventsDisabled].slice(-1),ce=te.indexOf(le),oe=q?te.indexOf(q):-1,ue=B.layersWithOutsidePointerEventsDisabled.size>0,Me=oe>=ce,Ne=c6(Te=>{const Ve=Te.target,nt=[...B.branches].some(At=>At.contains(Ve));!Me||nt||(w==null||w(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J),je=u6(Te=>{const Ve=Te.target;[...B.branches].some(At=>At.contains(Ve))||(S==null||S(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J);return Ky(Te=>{oe===B.layers.size-1&&(g==null||g(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},J),G.useEffect(()=>{if(q)return h&&(B.layersWithOutsidePointerEventsDisabled.size===0&&(TR=J.body.style.pointerEvents,J.body.style.pointerEvents="none"),B.layersWithOutsidePointerEventsDisabled.add(q)),B.layers.add(q),SR(),()=>{h&&B.layersWithOutsidePointerEventsDisabled.size===1&&(J.body.style.pointerEvents=TR)}},[q,J,h,B]),G.useEffect(()=>()=>{q&&(B.layers.delete(q),B.layersWithOutsidePointerEventsDisabled.delete(q),SR())},[q,B]),G.useEffect(()=>{const Te=()=>ie({});return document.addEventListener(nS,Te),()=>document.removeEventListener(nS,Te)},[]),L.jsx(_i.div,{...N,ref:be,style:{pointerEvents:ue?Me?"auto":"none":void 0,...i.style},onFocusCapture:bn(i.onFocusCapture,je.onFocusCapture),onBlurCapture:bn(i.onBlurCapture,je.onBlurCapture),onPointerDownCapture:bn(i.onPointerDownCapture,Ne.onPointerDownCapture)})});rz.displayName=o6;var l6="DismissableLayerBranch",oz=G.forwardRef((i,l)=>{const h=G.useContext(iz),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return h.branches.add(S),()=>{h.branches.delete(S)}},[h.branches]),L.jsx(_i.div,{...i,ref:w})});oz.displayName=l6;function c6(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1),w=G.useRef(()=>{});return G.useEffect(()=>{const S=o=>{if(o.target&&!g.current){let N=function(){sz(s6,h,B,{discrete:!0})};const B={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",w.current),w.current=N,l.addEventListener("click",w.current,{once:!0})):N()}else l.removeEventListener("click",w.current);g.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",S),l.removeEventListener("click",w.current)}},[l,h]),{onPointerDownCapture:()=>g.current=!0}}function u6(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1);return G.useEffect(()=>{const w=S=>{S.target&&!g.current&&sz(a6,h,{originalEvent:S},{discrete:!1})};return l.addEventListener("focusin",w),()=>l.removeEventListener("focusin",w)},[l,h]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function SR(){const i=new CustomEvent(nS);document.dispatchEvent(i)}function sz(i,l,h,{discrete:g}){const w=h.originalEvent.target,S=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}var d6=rz,h6=oz,Oo=globalThis!=null&&globalThis.document?G.useLayoutEffect:()=>{},f6="Portal",Qy=G.forwardRef((i,l)=>{var o;const{container:h,...g}=i,[w,S]=G.useState(!1);Oo(()=>S(!0),[]);const R=h||w&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return R?ez.createPortal(L.jsx(_i.div,{...g,ref:l}),R):null});Qy.displayName=f6;function p6(i,l){return G.useReducer((h,g)=>l[h][g]??h,i)}var nf=i=>{const{present:l,children:h}=i,g=m6(l),w=typeof h=="function"?h({present:g.isPresent}):G.Children.only(h),S=$i(g.ref,g6(w));return typeof h=="function"||g.isPresent?G.cloneElement(w,{ref:S}):null};nf.displayName="Presence";function m6(i){const[l,h]=G.useState(),g=G.useRef(null),w=G.useRef(i),S=G.useRef("none"),R=i?"mounted":"unmounted",[o,N]=p6(R,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const B=xx(g.current);S.current=o==="mounted"?B:"none"},[o]),Oo(()=>{const B=g.current,q=w.current;if(q!==i){const J=S.current,ie=xx(B);i?N("MOUNT"):ie==="none"||(B==null?void 0:B.display)==="none"?N("UNMOUNT"):N(q&&J!==ie?"ANIMATION_OUT":"UNMOUNT"),w.current=i}},[i,N]),Oo(()=>{if(l){let B;const q=l.ownerDocument.defaultView??window,Y=ie=>{const te=xx(g.current).includes(ie.animationName);if(ie.target===l&&te&&(N("ANIMATION_END"),!w.current)){const le=l.style.animationFillMode;l.style.animationFillMode="forwards",B=q.setTimeout(()=>{l.style.animationFillMode==="forwards"&&(l.style.animationFillMode=le)})}},J=ie=>{ie.target===l&&(S.current=xx(g.current))};return l.addEventListener("animationstart",J),l.addEventListener("animationcancel",Y),l.addEventListener("animationend",Y),()=>{q.clearTimeout(B),l.removeEventListener("animationstart",J),l.removeEventListener("animationcancel",Y),l.removeEventListener("animationend",Y)}}else N("ANIMATION_END")},[l,N]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:G.useCallback(B=>{g.current=B?getComputedStyle(B):null,h(B)},[])}}function xx(i){return(i==null?void 0:i.animationName)||"none"}function g6(i){var g,w;let l=(g=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:g.get,h=l&&"isReactWarning"in l&&l.isReactWarning;return h?i.ref:(l=(w=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:w.get,h=l&&"isReactWarning"in l&&l.isReactWarning,h?i.props.ref:i.props.ref||i.ref)}var _6=OS[" useInsertionEffect ".trim().toString()]||Oo;function km({prop:i,defaultProp:l,onChange:h=()=>{},caller:g}){const[w,S,R]=y6({defaultProp:l,onChange:h}),o=i!==void 0,N=o?i:w;{const q=G.useRef(i!==void 0);G.useEffect(()=>{const Y=q.current;Y!==o&&console.warn(`${g} is changing from ${Y?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),q.current=o},[o,g])}const B=G.useCallback(q=>{var Y;if(o){const J=v6(q)?q(i):q;J!==i&&((Y=R.current)==null||Y.call(R,J))}else S(q)},[o,i,S,R]);return[N,B]}function y6({defaultProp:i,onChange:l}){const[h,g]=G.useState(i),w=G.useRef(h),S=G.useRef(l);return _6(()=>{S.current=l},[l]),G.useEffect(()=>{var R;w.current!==h&&((R=S.current)==null||R.call(S,h),w.current=h)},[h,w]),[h,g,S]}function v6(i){return typeof i=="function"}var az=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),x6="VisuallyHidden",Y1=G.forwardRef((i,l)=>L.jsx(_i.span,{...i,ref:l,style:{...az,...i.style}}));Y1.displayName=x6;var w6=Y1,CE="ToastProvider",[AE,b6,T6]=X1("Toast"),[lz,XZ]=cu("Toast",[T6]),[S6,K1]=lz(CE),cz=i=>{const{__scopeToast:l,label:h="Notification",duration:g=5e3,swipeDirection:w="right",swipeThreshold:S=50,children:R}=i,[o,N]=G.useState(null),[B,q]=G.useState(0),Y=G.useRef(!1),J=G.useRef(!1);return h.trim()||console.error(`Invalid prop \`label\` supplied to \`${CE}\`. Expected non-empty \`string\`.`),L.jsx(AE.Provider,{scope:l,children:L.jsx(S6,{scope:l,label:h,duration:g,swipeDirection:w,swipeThreshold:S,toastCount:B,viewport:o,onViewportChange:N,onToastAdd:G.useCallback(()=>q(ie=>ie+1),[]),onToastRemove:G.useCallback(()=>q(ie=>ie-1),[]),isFocusedToastEscapeKeyDownRef:Y,isClosePausedRef:J,children:R})})};cz.displayName=CE;var uz="ToastViewport",E6=["F8"],iS="toast.viewportPause",rS="toast.viewportResume",dz=G.forwardRef((i,l)=>{const{__scopeToast:h,hotkey:g=E6,label:w="Notifications ({hotkey})",...S}=i,R=K1(uz,h),o=b6(h),N=G.useRef(null),B=G.useRef(null),q=G.useRef(null),Y=G.useRef(null),J=$i(l,Y,R.onViewportChange),ie=g.join("+").replace(/Key/g,"").replace(/Digit/g,""),be=R.toastCount>0;G.useEffect(()=>{const le=ce=>{var ue;g.length!==0&&g.every(Me=>ce[Me]||ce.code===Me)&&((ue=Y.current)==null||ue.focus())};return document.addEventListener("keydown",le),()=>document.removeEventListener("keydown",le)},[g]),G.useEffect(()=>{const le=N.current,ce=Y.current;if(be&&le&&ce){const oe=()=>{if(!R.isClosePausedRef.current){const je=new CustomEvent(iS);ce.dispatchEvent(je),R.isClosePausedRef.current=!0}},ue=()=>{if(R.isClosePausedRef.current){const je=new CustomEvent(rS);ce.dispatchEvent(je),R.isClosePausedRef.current=!1}},Me=je=>{!le.contains(je.relatedTarget)&&ue()},Ne=()=>{le.contains(document.activeElement)||ue()};return le.addEventListener("focusin",oe),le.addEventListener("focusout",Me),le.addEventListener("pointermove",oe),le.addEventListener("pointerleave",Ne),window.addEventListener("blur",oe),window.addEventListener("focus",ue),()=>{le.removeEventListener("focusin",oe),le.removeEventListener("focusout",Me),le.removeEventListener("pointermove",oe),le.removeEventListener("pointerleave",Ne),window.removeEventListener("blur",oe),window.removeEventListener("focus",ue)}}},[be,R.isClosePausedRef]);const te=G.useCallback(({tabbingDirection:le})=>{const oe=o().map(ue=>{const Me=ue.ref.current,Ne=[Me,...N6(Me)];return le==="forwards"?Ne:Ne.reverse()});return(le==="forwards"?oe.reverse():oe).flat()},[o]);return G.useEffect(()=>{const le=Y.current;if(le){const ce=oe=>{var Ne,je,Te;const ue=oe.altKey||oe.ctrlKey||oe.metaKey;if(oe.key==="Tab"&&!ue){const Ve=document.activeElement,nt=oe.shiftKey;if(oe.target===le&&nt){(Ne=B.current)==null||Ne.focus();return}const qt=te({tabbingDirection:nt?"backwards":"forwards"}),Ht=qt.findIndex(st=>st===Ve);ZT(qt.slice(Ht+1))?oe.preventDefault():nt?(je=B.current)==null||je.focus():(Te=q.current)==null||Te.focus()}};return le.addEventListener("keydown",ce),()=>le.removeEventListener("keydown",ce)}},[o,te]),L.jsxs(h6,{ref:N,role:"region","aria-label":w.replace("{hotkey}",ie),tabIndex:-1,style:{pointerEvents:be?void 0:"none"},children:[be&&L.jsx(oS,{ref:B,onFocusFromOutsideViewport:()=>{const le=te({tabbingDirection:"forwards"});ZT(le)}}),L.jsx(AE.Slot,{scope:h,children:L.jsx(_i.ol,{tabIndex:-1,...S,ref:J})}),be&&L.jsx(oS,{ref:q,onFocusFromOutsideViewport:()=>{const le=te({tabbingDirection:"backwards"});ZT(le)}})]})});dz.displayName=uz;var hz="ToastFocusProxy",oS=G.forwardRef((i,l)=>{const{__scopeToast:h,onFocusFromOutsideViewport:g,...w}=i,S=K1(hz,h);return L.jsx(Y1,{"aria-hidden":!0,tabIndex:0,...w,ref:l,style:{position:"fixed"},onFocus:R=>{var B;const o=R.relatedTarget;!((B=S.viewport)!=null&&B.contains(o))&&g()}})});oS.displayName=hz;var Jy="Toast",I6="toast.swipeStart",C6="toast.swipeMove",A6="toast.swipeCancel",P6="toast.swipeEnd",fz=G.forwardRef((i,l)=>{const{forceMount:h,open:g,defaultOpen:w,onOpenChange:S,...R}=i,[o,N]=km({prop:g,defaultProp:w??!0,onChange:S,caller:Jy});return L.jsx(nf,{present:h||o,children:L.jsx(D6,{open:o,...R,ref:l,onClose:()=>N(!1),onPause:co(i.onPause),onResume:co(i.onResume),onSwipeStart:bn(i.onSwipeStart,B=>{B.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:bn(i.onSwipeMove,B=>{const{x:q,y:Y}=B.detail.delta;B.currentTarget.setAttribute("data-swipe","move"),B.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${q}px`),B.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${Y}px`)}),onSwipeCancel:bn(i.onSwipeCancel,B=>{B.currentTarget.setAttribute("data-swipe","cancel"),B.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),B.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),B.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),B.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:bn(i.onSwipeEnd,B=>{const{x:q,y:Y}=B.detail.delta;B.currentTarget.setAttribute("data-swipe","end"),B.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),B.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),B.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${q}px`),B.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${Y}px`),N(!1)})})})});fz.displayName=Jy;var[M6,R6]=lz(Jy,{onClose(){}}),D6=G.forwardRef((i,l)=>{const{__scopeToast:h,type:g="foreground",duration:w,open:S,onClose:R,onEscapeKeyDown:o,onPause:N,onResume:B,onSwipeStart:q,onSwipeMove:Y,onSwipeCancel:J,onSwipeEnd:ie,...be}=i,te=K1(Jy,h),[le,ce]=G.useState(null),oe=$i(l,st=>ce(st)),ue=G.useRef(null),Me=G.useRef(null),Ne=w||te.duration,je=G.useRef(0),Te=G.useRef(Ne),Ve=G.useRef(0),{onToastAdd:nt,onToastRemove:At}=te,cn=co(()=>{var Tt;(le==null?void 0:le.contains(document.activeElement))&&((Tt=te.viewport)==null||Tt.focus()),R()}),qt=G.useCallback(st=>{!st||st===1/0||(window.clearTimeout(Ve.current),je.current=new Date().getTime(),Ve.current=window.setTimeout(cn,st))},[cn]);G.useEffect(()=>{const st=te.viewport;if(st){const Tt=()=>{qt(Te.current),B==null||B()},xt=()=>{const kt=new Date().getTime()-je.current;Te.current=Te.current-kt,window.clearTimeout(Ve.current),N==null||N()};return st.addEventListener(iS,xt),st.addEventListener(rS,Tt),()=>{st.removeEventListener(iS,xt),st.removeEventListener(rS,Tt)}}},[te.viewport,Ne,N,B,qt]),G.useEffect(()=>{S&&!te.isClosePausedRef.current&&qt(Ne)},[S,Ne,te.isClosePausedRef,qt]),G.useEffect(()=>(nt(),()=>At()),[nt,At]);const Ht=G.useMemo(()=>le?xz(le):null,[le]);return te.viewport?L.jsxs(L.Fragment,{children:[Ht&&L.jsx(L6,{__scopeToast:h,role:"status","aria-live":g==="foreground"?"assertive":"polite","aria-atomic":!0,children:Ht}),L.jsx(M6,{scope:h,onClose:cn,children:ef.createPortal(L.jsx(AE.ItemSlot,{scope:h,children:L.jsx(d6,{asChild:!0,onEscapeKeyDown:bn(o,()=>{te.isFocusedToastEscapeKeyDownRef.current||cn(),te.isFocusedToastEscapeKeyDownRef.current=!1}),children:L.jsx(_i.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":S?"open":"closed","data-swipe-direction":te.swipeDirection,...be,ref:oe,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:bn(i.onKeyDown,st=>{st.key==="Escape"&&(o==null||o(st.nativeEvent),st.nativeEvent.defaultPrevented||(te.isFocusedToastEscapeKeyDownRef.current=!0,cn()))}),onPointerDown:bn(i.onPointerDown,st=>{st.button===0&&(ue.current={x:st.clientX,y:st.clientY})}),onPointerMove:bn(i.onPointerMove,st=>{if(!ue.current)return;const Tt=st.clientX-ue.current.x,xt=st.clientY-ue.current.y,kt=!!Me.current,ze=["left","right"].includes(te.swipeDirection),He=["left","up"].includes(te.swipeDirection)?Math.min:Math.max,mt=ze?He(0,Tt):0,$t=ze?0:He(0,xt),Gt=st.pointerType==="touch"?10:2,Kt={x:mt,y:$t},mn={originalEvent:st,delta:Kt};kt?(Me.current=Kt,wx(C6,Y,mn,{discrete:!1})):ER(Kt,te.swipeDirection,Gt)?(Me.current=Kt,wx(I6,q,mn,{discrete:!1}),st.target.setPointerCapture(st.pointerId)):(Math.abs(Tt)>Gt||Math.abs(xt)>Gt)&&(ue.current=null)}),onPointerUp:bn(i.onPointerUp,st=>{const Tt=Me.current,xt=st.target;if(xt.hasPointerCapture(st.pointerId)&&xt.releasePointerCapture(st.pointerId),Me.current=null,ue.current=null,Tt){const kt=st.currentTarget,ze={originalEvent:st,delta:Tt};ER(Tt,te.swipeDirection,te.swipeThreshold)?wx(P6,ie,ze,{discrete:!0}):wx(A6,J,ze,{discrete:!0}),kt.addEventListener("click",He=>He.preventDefault(),{once:!0})}})})})}),te.viewport)})]}):null}),L6=i=>{const{__scopeToast:l,children:h,...g}=i,w=K1(Jy,l),[S,R]=G.useState(!1),[o,N]=G.useState(!1);return O6(()=>R(!0)),G.useEffect(()=>{const B=window.setTimeout(()=>N(!0),1e3);return()=>window.clearTimeout(B)},[]),o?null:L.jsx(Qy,{asChild:!0,children:L.jsx(Y1,{...g,children:S&&L.jsxs(L.Fragment,{children:[w.label," ",h]})})})},k6="ToastTitle",pz=G.forwardRef((i,l)=>{const{__scopeToast:h,...g}=i;return L.jsx(_i.div,{...g,ref:l})});pz.displayName=k6;var z6="ToastDescription",mz=G.forwardRef((i,l)=>{const{__scopeToast:h,...g}=i;return L.jsx(_i.div,{...g,ref:l})});mz.displayName=z6;var gz="ToastAction",_z=G.forwardRef((i,l)=>{const{altText:h,...g}=i;return h.trim()?L.jsx(vz,{altText:h,asChild:!0,children:L.jsx(PE,{...g,ref:l})}):(console.error(`Invalid prop \`altText\` supplied to \`${gz}\`. Expected non-empty \`string\`.`),null)});_z.displayName=gz;var yz="ToastClose",PE=G.forwardRef((i,l)=>{const{__scopeToast:h,...g}=i,w=R6(yz,h);return L.jsx(vz,{asChild:!0,children:L.jsx(_i.button,{type:"button",...g,ref:l,onClick:bn(i.onClick,w.onClose)})})});PE.displayName=yz;var vz=G.forwardRef((i,l)=>{const{__scopeToast:h,altText:g,...w}=i;return L.jsx(_i.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":g||void 0,...w,ref:l})});function xz(i){const l=[];return Array.from(i.childNodes).forEach(g=>{if(g.nodeType===g.TEXT_NODE&&g.textContent&&l.push(g.textContent),F6(g)){const w=g.ariaHidden||g.hidden||g.style.display==="none",S=g.dataset.radixToastAnnounceExclude==="";if(!w)if(S){const R=g.dataset.radixToastAnnounceAlt;R&&l.push(R)}else l.push(...xz(g))}}),l}function wx(i,l,h,{discrete:g}){const w=h.originalEvent.currentTarget,S=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}var ER=(i,l,h=0)=>{const g=Math.abs(i.x),w=Math.abs(i.y),S=g>w;return l==="left"||l==="right"?S&&g>h:!S&&w>h};function O6(i=()=>{}){const l=co(i);Oo(()=>{let h=0,g=0;return h=window.requestAnimationFrame(()=>g=window.requestAnimationFrame(l)),()=>{window.cancelAnimationFrame(h),window.cancelAnimationFrame(g)}},[l])}function F6(i){return i.nodeType===i.ELEMENT_NODE}function N6(i){const l=[],h=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const w=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||w?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;h.nextNode();)l.push(h.currentNode);return l}function ZT(i){const l=document.activeElement;return i.some(h=>h===l?!0:(h.focus(),document.activeElement!==l))}var B6=cz,wz=dz,bz=fz,Tz=pz,Sz=mz,Ez=_z,Iz=PE;function Cz(i){var l,h,g="";if(typeof i=="string"||typeof i=="number")g+=i;else if(typeof i=="object")if(Array.isArray(i)){var w=i.length;for(l=0;l<w;l++)i[l]&&(h=Cz(i[l]))&&(g&&(g+=" "),g+=h)}else for(h in i)i[h]&&(g&&(g+=" "),g+=h);return g}function Az(){for(var i,l,h=0,g="",w=arguments.length;h<w;h++)(i=arguments[h])&&(l=Cz(i))&&(g&&(g+=" "),g+=l);return g}const IR=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,CR=Az,ME=(i,l)=>h=>{var g;if((l==null?void 0:l.variants)==null)return CR(i,h==null?void 0:h.class,h==null?void 0:h.className);const{variants:w,defaultVariants:S}=l,R=Object.keys(w).map(B=>{const q=h==null?void 0:h[B],Y=S==null?void 0:S[B];if(q===null)return null;const J=IR(q)||IR(Y);return w[B][J]}),o=h&&Object.entries(h).reduce((B,q)=>{let[Y,J]=q;return J===void 0||(B[Y]=J),B},{}),N=l==null||(g=l.compoundVariants)===null||g===void 0?void 0:g.reduce((B,q)=>{let{class:Y,className:J,...ie}=q;return Object.entries(ie).every(be=>{let[te,le]=be;return Array.isArray(le)?le.includes({...S,...o}[te]):{...S,...o}[te]===le})?[...B,Y,J]:B},[]);return CR(i,R,N,h==null?void 0:h.class,h==null?void 0:h.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j6=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Pz=(...i)=>i.filter((l,h,g)=>!!l&&l.trim()!==""&&g.indexOf(l)===h).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var U6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V6=G.forwardRef(({color:i="currentColor",size:l=24,strokeWidth:h=2,absoluteStrokeWidth:g,className:w="",children:S,iconNode:R,...o},N)=>G.createElement("svg",{ref:N,...U6,width:l,height:l,stroke:i,strokeWidth:g?Number(h)*24/Number(l):h,className:Pz("lucide",w),...o},[...R.map(([B,q])=>G.createElement(B,q)),...Array.isArray(S)?S:[S]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ji=(i,l)=>{const h=G.forwardRef(({className:g,...w},S)=>G.createElement(V6,{ref:S,iconNode:l,className:Pz(`lucide-${j6(i)}`,g),...w}));return h.displayName=`${i}`,h};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RE=Ji("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zm=Ji("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mz=Ji("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rz=Ji("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dz=Ji("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $6=Ji("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=Ji("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H6=Ji("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=Ji("Compass",[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=Ji("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lz=Ji("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DE=Ji("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=Ji("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kz=Ji("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zz=Ji("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=Ji("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=Ji("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=Ji("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LE=Ji("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=Ji("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=Ji("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oz=Ji("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=Ji("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=Ji("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e8=Ji("Move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zy=Ji("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fz=Ji("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Ji("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PR=Ji("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t8=Ji("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n8=Ji("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nz=Ji("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Om=Ji("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Ji("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i8=Ji("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bz=Ji("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kE=Ji("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),zE="-",r8=i=>{const l=s8(i),{conflictingClassGroups:h,conflictingClassGroupModifiers:g}=i;return{getClassGroupId:R=>{const o=R.split(zE);return o[0]===""&&o.length!==1&&o.shift(),jz(o,l)||o8(R)},getConflictingClassGroupIds:(R,o)=>{const N=h[R]||[];return o&&g[R]?[...N,...g[R]]:N}}},jz=(i,l)=>{var R;if(i.length===0)return l.classGroupId;const h=i[0],g=l.nextPart.get(h),w=g?jz(i.slice(1),g):void 0;if(w)return w;if(l.validators.length===0)return;const S=i.join(zE);return(R=l.validators.find(({validator:o})=>o(S)))==null?void 0:R.classGroupId},MR=/^\[(.+)\]$/,o8=i=>{if(MR.test(i)){const l=MR.exec(i)[1],h=l==null?void 0:l.substring(0,l.indexOf(":"));if(h)return"arbitrary.."+h}},s8=i=>{const{theme:l,prefix:h}=i,g={nextPart:new Map,validators:[]};return l8(Object.entries(i.classGroups),h).forEach(([S,R])=>{lS(R,g,S,l)}),g},lS=(i,l,h,g)=>{i.forEach(w=>{if(typeof w=="string"){const S=w===""?l:RR(l,w);S.classGroupId=h;return}if(typeof w=="function"){if(a8(w)){lS(w(g),l,h,g);return}l.validators.push({validator:w,classGroupId:h});return}Object.entries(w).forEach(([S,R])=>{lS(R,RR(l,S),h,g)})})},RR=(i,l)=>{let h=i;return l.split(zE).forEach(g=>{h.nextPart.has(g)||h.nextPart.set(g,{nextPart:new Map,validators:[]}),h=h.nextPart.get(g)}),h},a8=i=>i.isThemeGetter,l8=(i,l)=>l?i.map(([h,g])=>{const w=g.map(S=>typeof S=="string"?l+S:typeof S=="object"?Object.fromEntries(Object.entries(S).map(([R,o])=>[l+R,o])):S);return[h,w]}):i,c8=i=>{if(i<1)return{get:()=>{},set:()=>{}};let l=0,h=new Map,g=new Map;const w=(S,R)=>{h.set(S,R),l++,l>i&&(l=0,g=h,h=new Map)};return{get(S){let R=h.get(S);if(R!==void 0)return R;if((R=g.get(S))!==void 0)return w(S,R),R},set(S,R){h.has(S)?h.set(S,R):w(S,R)}}},Uz="!",u8=i=>{const{separator:l,experimentalParseClassName:h}=i,g=l.length===1,w=l[0],S=l.length,R=o=>{const N=[];let B=0,q=0,Y;for(let le=0;le<o.length;le++){let ce=o[le];if(B===0){if(ce===w&&(g||o.slice(le,le+S)===l)){N.push(o.slice(q,le)),q=le+S;continue}if(ce==="/"){Y=le;continue}}ce==="["?B++:ce==="]"&&B--}const J=N.length===0?o:o.substring(q),ie=J.startsWith(Uz),be=ie?J.substring(1):J,te=Y&&Y>q?Y-q:void 0;return{modifiers:N,hasImportantModifier:ie,baseClassName:be,maybePostfixModifierPosition:te}};return h?o=>h({className:o,parseClassName:R}):R},d8=i=>{if(i.length<=1)return i;const l=[];let h=[];return i.forEach(g=>{g[0]==="["?(l.push(...h.sort(),g),h=[]):h.push(g)}),l.push(...h.sort()),l},h8=i=>({cache:c8(i.cacheSize),parseClassName:u8(i),...r8(i)}),f8=/\s+/,p8=(i,l)=>{const{parseClassName:h,getClassGroupId:g,getConflictingClassGroupIds:w}=l,S=[],R=i.trim().split(f8);let o="";for(let N=R.length-1;N>=0;N-=1){const B=R[N],{modifiers:q,hasImportantModifier:Y,baseClassName:J,maybePostfixModifierPosition:ie}=h(B);let be=!!ie,te=g(be?J.substring(0,ie):J);if(!te){if(!be){o=B+(o.length>0?" "+o:o);continue}if(te=g(J),!te){o=B+(o.length>0?" "+o:o);continue}be=!1}const le=d8(q).join(":"),ce=Y?le+Uz:le,oe=ce+te;if(S.includes(oe))continue;S.push(oe);const ue=w(te,be);for(let Me=0;Me<ue.length;++Me){const Ne=ue[Me];S.push(ce+Ne)}o=B+(o.length>0?" "+o:o)}return o};function m8(){let i=0,l,h,g="";for(;i<arguments.length;)(l=arguments[i++])&&(h=Vz(l))&&(g&&(g+=" "),g+=h);return g}const Vz=i=>{if(typeof i=="string")return i;let l,h="";for(let g=0;g<i.length;g++)i[g]&&(l=Vz(i[g]))&&(h&&(h+=" "),h+=l);return h};function g8(i,...l){let h,g,w,S=R;function R(N){const B=l.reduce((q,Y)=>Y(q),i());return h=h8(B),g=h.cache.get,w=h.cache.set,S=o,o(N)}function o(N){const B=g(N);if(B)return B;const q=p8(N,h);return w(N,q),q}return function(){return S(m8.apply(null,arguments))}}const $r=i=>{const l=h=>h[i]||[];return l.isThemeGetter=!0,l},$z=/^\[(?:([a-z-]+):)?(.+)\]$/i,_8=/^\d+\/\d+$/,y8=new Set(["px","full","screen"]),v8=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,x8=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,w8=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,b8=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,T8=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Hc=i=>pm(i)||y8.has(i)||_8.test(i),Hu=i=>Vm(i,"length",R8),pm=i=>!!i&&!Number.isNaN(Number(i)),XT=i=>Vm(i,"number",pm),J_=i=>!!i&&Number.isInteger(Number(i)),S8=i=>i.endsWith("%")&&pm(i.slice(0,-1)),Ui=i=>$z.test(i),Wu=i=>v8.test(i),E8=new Set(["length","size","percentage"]),I8=i=>Vm(i,E8,Gz),C8=i=>Vm(i,"position",Gz),A8=new Set(["image","url"]),P8=i=>Vm(i,A8,L8),M8=i=>Vm(i,"",D8),ey=()=>!0,Vm=(i,l,h)=>{const g=$z.exec(i);return g?g[1]?typeof l=="string"?g[1]===l:l.has(g[1]):h(g[2]):!1},R8=i=>x8.test(i)&&!w8.test(i),Gz=()=>!1,D8=i=>b8.test(i),L8=i=>T8.test(i),k8=()=>{const i=$r("colors"),l=$r("spacing"),h=$r("blur"),g=$r("brightness"),w=$r("borderColor"),S=$r("borderRadius"),R=$r("borderSpacing"),o=$r("borderWidth"),N=$r("contrast"),B=$r("grayscale"),q=$r("hueRotate"),Y=$r("invert"),J=$r("gap"),ie=$r("gradientColorStops"),be=$r("gradientColorStopPositions"),te=$r("inset"),le=$r("margin"),ce=$r("opacity"),oe=$r("padding"),ue=$r("saturate"),Me=$r("scale"),Ne=$r("sepia"),je=$r("skew"),Te=$r("space"),Ve=$r("translate"),nt=()=>["auto","contain","none"],At=()=>["auto","hidden","clip","visible","scroll"],cn=()=>["auto",Ui,l],qt=()=>[Ui,l],Ht=()=>["",Hc,Hu],st=()=>["auto",pm,Ui],Tt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],xt=()=>["solid","dashed","dotted","double","none"],kt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ze=()=>["start","end","center","between","around","evenly","stretch"],He=()=>["","0",Ui],mt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],$t=()=>[pm,Ui];return{cacheSize:500,separator:":",theme:{colors:[ey],spacing:[Hc,Hu],blur:["none","",Wu,Ui],brightness:$t(),borderColor:[i],borderRadius:["none","","full",Wu,Ui],borderSpacing:qt(),borderWidth:Ht(),contrast:$t(),grayscale:He(),hueRotate:$t(),invert:He(),gap:qt(),gradientColorStops:[i],gradientColorStopPositions:[S8,Hu],inset:cn(),margin:cn(),opacity:$t(),padding:qt(),saturate:$t(),scale:$t(),sepia:He(),skew:$t(),space:qt(),translate:qt()},classGroups:{aspect:[{aspect:["auto","square","video",Ui]}],container:["container"],columns:[{columns:[Wu]}],"break-after":[{"break-after":mt()}],"break-before":[{"break-before":mt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Tt(),Ui]}],overflow:[{overflow:At()}],"overflow-x":[{"overflow-x":At()}],"overflow-y":[{"overflow-y":At()}],overscroll:[{overscroll:nt()}],"overscroll-x":[{"overscroll-x":nt()}],"overscroll-y":[{"overscroll-y":nt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[te]}],"inset-x":[{"inset-x":[te]}],"inset-y":[{"inset-y":[te]}],start:[{start:[te]}],end:[{end:[te]}],top:[{top:[te]}],right:[{right:[te]}],bottom:[{bottom:[te]}],left:[{left:[te]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",J_,Ui]}],basis:[{basis:cn()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Ui]}],grow:[{grow:He()}],shrink:[{shrink:He()}],order:[{order:["first","last","none",J_,Ui]}],"grid-cols":[{"grid-cols":[ey]}],"col-start-end":[{col:["auto",{span:["full",J_,Ui]},Ui]}],"col-start":[{"col-start":st()}],"col-end":[{"col-end":st()}],"grid-rows":[{"grid-rows":[ey]}],"row-start-end":[{row:["auto",{span:[J_,Ui]},Ui]}],"row-start":[{"row-start":st()}],"row-end":[{"row-end":st()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Ui]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Ui]}],gap:[{gap:[J]}],"gap-x":[{"gap-x":[J]}],"gap-y":[{"gap-y":[J]}],"justify-content":[{justify:["normal",...ze()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ze(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ze(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[oe]}],px:[{px:[oe]}],py:[{py:[oe]}],ps:[{ps:[oe]}],pe:[{pe:[oe]}],pt:[{pt:[oe]}],pr:[{pr:[oe]}],pb:[{pb:[oe]}],pl:[{pl:[oe]}],m:[{m:[le]}],mx:[{mx:[le]}],my:[{my:[le]}],ms:[{ms:[le]}],me:[{me:[le]}],mt:[{mt:[le]}],mr:[{mr:[le]}],mb:[{mb:[le]}],ml:[{ml:[le]}],"space-x":[{"space-x":[Te]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Te]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Ui,l]}],"min-w":[{"min-w":[Ui,l,"min","max","fit"]}],"max-w":[{"max-w":[Ui,l,"none","full","min","max","fit","prose",{screen:[Wu]},Wu]}],h:[{h:[Ui,l,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Ui,l,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Ui,l,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Ui,l,"auto","min","max","fit"]}],"font-size":[{text:["base",Wu,Hu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",XT]}],"font-family":[{font:[ey]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Ui]}],"line-clamp":[{"line-clamp":["none",pm,XT]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Hc,Ui]}],"list-image":[{"list-image":["none",Ui]}],"list-style-type":[{list:["none","disc","decimal",Ui]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[ce]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[ce]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...xt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Hc,Hu]}],"underline-offset":[{"underline-offset":["auto",Hc,Ui]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:qt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Ui]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Ui]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ce]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Tt(),C8]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",I8]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},P8]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[be]}],"gradient-via-pos":[{via:[be]}],"gradient-to-pos":[{to:[be]}],"gradient-from":[{from:[ie]}],"gradient-via":[{via:[ie]}],"gradient-to":[{to:[ie]}],rounded:[{rounded:[S]}],"rounded-s":[{"rounded-s":[S]}],"rounded-e":[{"rounded-e":[S]}],"rounded-t":[{"rounded-t":[S]}],"rounded-r":[{"rounded-r":[S]}],"rounded-b":[{"rounded-b":[S]}],"rounded-l":[{"rounded-l":[S]}],"rounded-ss":[{"rounded-ss":[S]}],"rounded-se":[{"rounded-se":[S]}],"rounded-ee":[{"rounded-ee":[S]}],"rounded-es":[{"rounded-es":[S]}],"rounded-tl":[{"rounded-tl":[S]}],"rounded-tr":[{"rounded-tr":[S]}],"rounded-br":[{"rounded-br":[S]}],"rounded-bl":[{"rounded-bl":[S]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[ce]}],"border-style":[{border:[...xt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ce]}],"divide-style":[{divide:xt()}],"border-color":[{border:[w]}],"border-color-x":[{"border-x":[w]}],"border-color-y":[{"border-y":[w]}],"border-color-s":[{"border-s":[w]}],"border-color-e":[{"border-e":[w]}],"border-color-t":[{"border-t":[w]}],"border-color-r":[{"border-r":[w]}],"border-color-b":[{"border-b":[w]}],"border-color-l":[{"border-l":[w]}],"divide-color":[{divide:[w]}],"outline-style":[{outline:["",...xt()]}],"outline-offset":[{"outline-offset":[Hc,Ui]}],"outline-w":[{outline:[Hc,Hu]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Ht()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[ce]}],"ring-offset-w":[{"ring-offset":[Hc,Hu]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Wu,M8]}],"shadow-color":[{shadow:[ey]}],opacity:[{opacity:[ce]}],"mix-blend":[{"mix-blend":[...kt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":kt()}],filter:[{filter:["","none"]}],blur:[{blur:[h]}],brightness:[{brightness:[g]}],contrast:[{contrast:[N]}],"drop-shadow":[{"drop-shadow":["","none",Wu,Ui]}],grayscale:[{grayscale:[B]}],"hue-rotate":[{"hue-rotate":[q]}],invert:[{invert:[Y]}],saturate:[{saturate:[ue]}],sepia:[{sepia:[Ne]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[h]}],"backdrop-brightness":[{"backdrop-brightness":[g]}],"backdrop-contrast":[{"backdrop-contrast":[N]}],"backdrop-grayscale":[{"backdrop-grayscale":[B]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[q]}],"backdrop-invert":[{"backdrop-invert":[Y]}],"backdrop-opacity":[{"backdrop-opacity":[ce]}],"backdrop-saturate":[{"backdrop-saturate":[ue]}],"backdrop-sepia":[{"backdrop-sepia":[Ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[R]}],"border-spacing-x":[{"border-spacing-x":[R]}],"border-spacing-y":[{"border-spacing-y":[R]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Ui]}],duration:[{duration:$t()}],ease:[{ease:["linear","in","out","in-out",Ui]}],delay:[{delay:$t()}],animate:[{animate:["none","spin","ping","pulse","bounce",Ui]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Me]}],"scale-x":[{"scale-x":[Me]}],"scale-y":[{"scale-y":[Me]}],rotate:[{rotate:[J_,Ui]}],"translate-x":[{"translate-x":[Ve]}],"translate-y":[{"translate-y":[Ve]}],"skew-x":[{"skew-x":[je]}],"skew-y":[{"skew-y":[je]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Ui]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Ui]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":qt()}],"scroll-mx":[{"scroll-mx":qt()}],"scroll-my":[{"scroll-my":qt()}],"scroll-ms":[{"scroll-ms":qt()}],"scroll-me":[{"scroll-me":qt()}],"scroll-mt":[{"scroll-mt":qt()}],"scroll-mr":[{"scroll-mr":qt()}],"scroll-mb":[{"scroll-mb":qt()}],"scroll-ml":[{"scroll-ml":qt()}],"scroll-p":[{"scroll-p":qt()}],"scroll-px":[{"scroll-px":qt()}],"scroll-py":[{"scroll-py":qt()}],"scroll-ps":[{"scroll-ps":qt()}],"scroll-pe":[{"scroll-pe":qt()}],"scroll-pt":[{"scroll-pt":qt()}],"scroll-pr":[{"scroll-pr":qt()}],"scroll-pb":[{"scroll-pb":qt()}],"scroll-pl":[{"scroll-pl":qt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Ui]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[Hc,Hu,XT]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},z8=g8(k8);function vr(...i){return z8(Az(i))}const O8=B6,Hz=G.forwardRef(({className:i,...l},h)=>L.jsx(wz,{ref:h,className:vr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...l}));Hz.displayName=wz.displayName;const F8=ME("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Wz=G.forwardRef(({className:i,variant:l,...h},g)=>L.jsx(bz,{ref:g,className:vr(F8({variant:l}),i),...h}));Wz.displayName=bz.displayName;const N8=G.forwardRef(({className:i,...l},h)=>L.jsx(Ez,{ref:h,className:vr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",i),...l}));N8.displayName=Ez.displayName;const qz=G.forwardRef(({className:i,...l},h)=>L.jsx(Iz,{ref:h,className:vr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...l,children:L.jsx(kE,{className:"h-4 w-4"})}));qz.displayName=Iz.displayName;const Zz=G.forwardRef(({className:i,...l},h)=>L.jsx(Tz,{ref:h,className:vr("text-sm font-semibold",i),...l}));Zz.displayName=Tz.displayName;const Xz=G.forwardRef(({className:i,...l},h)=>L.jsx(Sz,{ref:h,className:vr("text-sm opacity-90",i),...l}));Xz.displayName=Sz.displayName;function B8(){const{toasts:i}=XV();return L.jsxs(O8,{children:[i.map(function({id:l,title:h,description:g,action:w,...S}){return L.jsxs(Wz,{...S,children:[L.jsxs("div",{className:"grid gap-1",children:[h&&L.jsx(Zz,{children:h}),g&&L.jsx(Xz,{children:g})]}),w,L.jsx(qz,{})]},l)}),L.jsx(Hz,{})]})}var DR=["light","dark"],j8="(prefers-color-scheme: dark)",U8=G.createContext(void 0),V8={setTheme:i=>{},themes:[]},$8=()=>{var i;return(i=G.useContext(U8))!=null?i:V8};G.memo(({forcedTheme:i,storageKey:l,attribute:h,enableSystem:g,enableColorScheme:w,defaultTheme:S,value:R,attrs:o,nonce:N})=>{let B=S==="system",q=h==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(be=>`'${be}'`).join(",")})`};`:`var d=document.documentElement,n='${h}',s='setAttribute';`,Y=w?DR.includes(S)&&S?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${S}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",J=(be,te=!1,le=!0)=>{let ce=R?R[be]:be,oe=te?be+"|| ''":`'${ce}'`,ue="";return w&&le&&!te&&DR.includes(be)&&(ue+=`d.style.colorScheme = '${be}';`),h==="class"?te||ce?ue+=`c.add(${oe})`:ue+="null":ce&&(ue+=`d[s](n,${oe})`),ue},ie=i?`!function(){${q}${J(i)}}()`:g?`!function(){try{${q}var e=localStorage.getItem('${l}');if('system'===e||(!e&&${B})){var t='${j8}',m=window.matchMedia(t);if(m.media!==t||m.matches){${J("dark")}}else{${J("light")}}}else if(e){${R?`var x=${JSON.stringify(R)};`:""}${J(R?"x[e]":"e",!0)}}${B?"":"else{"+J(S,!1,!1)+"}"}${Y}}catch(e){}}()`:`!function(){try{${q}var e=localStorage.getItem('${l}');if(e){${R?`var x=${JSON.stringify(R)};`:""}${J(R?"x[e]":"e",!0)}}else{${J(S,!1,!1)};}${Y}}catch(t){}}();`;return G.createElement("script",{nonce:N,dangerouslySetInnerHTML:{__html:ie}})});var G8=i=>{switch(i){case"success":return q8;case"info":return X8;case"warning":return Z8;case"error":return Y8;default:return null}},H8=Array(12).fill(0),W8=({visible:i,className:l})=>pn.createElement("div",{className:["sonner-loading-wrapper",l].filter(Boolean).join(" "),"data-visible":i},pn.createElement("div",{className:"sonner-spinner"},H8.map((h,g)=>pn.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${g}`})))),q8=pn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pn.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Z8=pn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},pn.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),X8=pn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Y8=pn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},pn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),K8=pn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},pn.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),pn.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Q8=()=>{let[i,l]=pn.useState(document.hidden);return pn.useEffect(()=>{let h=()=>{l(document.hidden)};return document.addEventListener("visibilitychange",h),()=>window.removeEventListener("visibilitychange",h)},[]),i},cS=1,J8=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let l=this.subscribers.indexOf(i);this.subscribers.splice(l,1)}),this.publish=i=>{this.subscribers.forEach(l=>l(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var l;let{message:h,...g}=i,w=typeof(i==null?void 0:i.id)=="number"||((l=i.id)==null?void 0:l.length)>0?i.id:cS++,S=this.toasts.find(o=>o.id===w),R=i.dismissible===void 0?!0:i.dismissible;return this.dismissedToasts.has(w)&&this.dismissedToasts.delete(w),S?this.toasts=this.toasts.map(o=>o.id===w?(this.publish({...o,...i,id:w,title:h}),{...o,...i,id:w,dismissible:R,title:h}):o):this.addToast({title:h,...g,dismissible:R,id:w}),w},this.dismiss=i=>(this.dismissedToasts.add(i),i||this.toasts.forEach(l=>{this.subscribers.forEach(h=>h({id:l.id,dismiss:!0}))}),this.subscribers.forEach(l=>l({id:i,dismiss:!0})),i),this.message=(i,l)=>this.create({...l,message:i}),this.error=(i,l)=>this.create({...l,message:i,type:"error"}),this.success=(i,l)=>this.create({...l,type:"success",message:i}),this.info=(i,l)=>this.create({...l,type:"info",message:i}),this.warning=(i,l)=>this.create({...l,type:"warning",message:i}),this.loading=(i,l)=>this.create({...l,type:"loading",message:i}),this.promise=(i,l)=>{if(!l)return;let h;l.loading!==void 0&&(h=this.create({...l,promise:i,type:"loading",message:l.loading,description:typeof l.description!="function"?l.description:void 0}));let g=i instanceof Promise?i:i(),w=h!==void 0,S,R=g.then(async N=>{if(S=["resolve",N],pn.isValidElement(N))w=!1,this.create({id:h,type:"default",message:N});else if(t$(N)&&!N.ok){w=!1;let B=typeof l.error=="function"?await l.error(`HTTP error! status: ${N.status}`):l.error,q=typeof l.description=="function"?await l.description(`HTTP error! status: ${N.status}`):l.description;this.create({id:h,type:"error",message:B,description:q})}else if(l.success!==void 0){w=!1;let B=typeof l.success=="function"?await l.success(N):l.success,q=typeof l.description=="function"?await l.description(N):l.description;this.create({id:h,type:"success",message:B,description:q})}}).catch(async N=>{if(S=["reject",N],l.error!==void 0){w=!1;let B=typeof l.error=="function"?await l.error(N):l.error,q=typeof l.description=="function"?await l.description(N):l.description;this.create({id:h,type:"error",message:B,description:q})}}).finally(()=>{var N;w&&(this.dismiss(h),h=void 0),(N=l.finally)==null||N.call(l)}),o=()=>new Promise((N,B)=>R.then(()=>S[0]==="reject"?B(S[1]):N(S[1])).catch(B));return typeof h!="string"&&typeof h!="number"?{unwrap:o}:Object.assign(h,{unwrap:o})},this.custom=(i,l)=>{let h=(l==null?void 0:l.id)||cS++;return this.create({jsx:i(h),id:h,...l}),h},this.getActiveToasts=()=>this.toasts.filter(i=>!this.dismissedToasts.has(i.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},qs=new J8,e$=(i,l)=>{let h=(l==null?void 0:l.id)||cS++;return qs.addToast({title:i,...l,id:h}),h},t$=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",n$=e$,i$=()=>qs.toasts,r$=()=>qs.getActiveToasts(),cr=Object.assign(n$,{success:qs.success,info:qs.info,warning:qs.warning,error:qs.error,custom:qs.custom,message:qs.message,promise:qs.promise,dismiss:qs.dismiss,loading:qs.loading},{getHistory:i$,getToasts:r$});function o$(i,{insertAt:l}={}){if(typeof document>"u")return;let h=document.head||document.getElementsByTagName("head")[0],g=document.createElement("style");g.type="text/css",l==="top"&&h.firstChild?h.insertBefore(g,h.firstChild):h.appendChild(g),g.styleSheet?g.styleSheet.cssText=i:g.appendChild(document.createTextNode(i))}o$(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function bx(i){return i.label!==void 0}var s$=3,a$="32px",l$="16px",LR=4e3,c$=356,u$=14,d$=20,h$=200;function bl(...i){return i.filter(Boolean).join(" ")}function f$(i){let[l,h]=i.split("-"),g=[];return l&&g.push(l),h&&g.push(h),g}var p$=i=>{var l,h,g,w,S,R,o,N,B,q,Y;let{invert:J,toast:ie,unstyled:be,interacting:te,setHeights:le,visibleToasts:ce,heights:oe,index:ue,toasts:Me,expanded:Ne,removeToast:je,defaultRichColors:Te,closeButton:Ve,style:nt,cancelButtonStyle:At,actionButtonStyle:cn,className:qt="",descriptionClassName:Ht="",duration:st,position:Tt,gap:xt,loadingIcon:kt,expandByDefault:ze,classNames:He,icons:mt,closeButtonAriaLabel:$t="Close toast",pauseWhenPageIsHidden:Gt}=i,[Kt,mn]=pn.useState(null),[Yn,hi]=pn.useState(null),[nn,Zn]=pn.useState(!1),[_n,En]=pn.useState(!1),[An,Kn]=pn.useState(!1),[li,Ar]=pn.useState(!1),[Qr,xr]=pn.useState(!1),[Sr,Di]=pn.useState(0),[uo,Rs]=pn.useState(0),qo=pn.useRef(ie.duration||st||LR),ps=pn.useRef(null),ho=pn.useRef(null),oo=ue===0,Js=ue+1<=ce,fo=ie.type,vo=ie.dismissible!==!1,ea=ie.className||"",xo=ie.descriptionClassName||"",Ds=pn.useMemo(()=>oe.findIndex(fi=>fi.toastId===ie.id)||0,[oe,ie.id]),Ya=pn.useMemo(()=>{var fi;return(fi=ie.closeButton)!=null?fi:Ve},[ie.closeButton,Ve]),ba=pn.useMemo(()=>ie.duration||st||LR,[ie.duration,st]),Ta=pn.useRef(0),Er=pn.useRef(0),wo=pn.useRef(0),Ls=pn.useRef(null),[Sa,ks]=Tt.split("-"),zs=pn.useMemo(()=>oe.reduce((fi,Hi,Wi)=>Wi>=Ds?fi:fi+Hi.height,0),[oe,Ds]),rs=Q8(),yc=ie.invert||J,ta=fo==="loading";Er.current=pn.useMemo(()=>Ds*xt+zs,[Ds,zs]),pn.useEffect(()=>{qo.current=ba},[ba]),pn.useEffect(()=>{Zn(!0)},[]),pn.useEffect(()=>{let fi=ho.current;if(fi){let Hi=fi.getBoundingClientRect().height;return Rs(Hi),le(Wi=>[{toastId:ie.id,height:Hi,position:ie.position},...Wi]),()=>le(Wi=>Wi.filter(Fo=>Fo.toastId!==ie.id))}},[le,ie.id]),pn.useLayoutEffect(()=>{if(!nn)return;let fi=ho.current,Hi=fi.style.height;fi.style.height="auto";let Wi=fi.getBoundingClientRect().height;fi.style.height=Hi,Rs(Wi),le(Fo=>Fo.find(at=>at.toastId===ie.id)?Fo.map(at=>at.toastId===ie.id?{...at,height:Wi}:at):[{toastId:ie.id,height:Wi,position:ie.position},...Fo])},[nn,ie.title,ie.description,le,ie.id]);let Ai=pn.useCallback(()=>{En(!0),Di(Er.current),le(fi=>fi.filter(Hi=>Hi.toastId!==ie.id)),setTimeout(()=>{je(ie)},h$)},[ie,je,le,Er]);pn.useEffect(()=>{if(ie.promise&&fo==="loading"||ie.duration===1/0||ie.type==="loading")return;let fi;return Ne||te||Gt&&rs?(()=>{if(wo.current<Ta.current){let Hi=new Date().getTime()-Ta.current;qo.current=qo.current-Hi}wo.current=new Date().getTime()})():qo.current!==1/0&&(Ta.current=new Date().getTime(),fi=setTimeout(()=>{var Hi;(Hi=ie.onAutoClose)==null||Hi.call(ie,ie),Ai()},qo.current)),()=>clearTimeout(fi)},[Ne,te,ie,fo,Gt,rs,Ai]),pn.useEffect(()=>{ie.delete&&Ai()},[Ai,ie.delete]);function Wr(){var fi,Hi,Wi;return mt!=null&&mt.loading?pn.createElement("div",{className:bl(He==null?void 0:He.loader,(fi=ie==null?void 0:ie.classNames)==null?void 0:fi.loader,"sonner-loader"),"data-visible":fo==="loading"},mt.loading):kt?pn.createElement("div",{className:bl(He==null?void 0:He.loader,(Hi=ie==null?void 0:ie.classNames)==null?void 0:Hi.loader,"sonner-loader"),"data-visible":fo==="loading"},kt):pn.createElement(W8,{className:bl(He==null?void 0:He.loader,(Wi=ie==null?void 0:ie.classNames)==null?void 0:Wi.loader),visible:fo==="loading"})}return pn.createElement("li",{tabIndex:0,ref:ho,className:bl(qt,ea,He==null?void 0:He.toast,(l=ie==null?void 0:ie.classNames)==null?void 0:l.toast,He==null?void 0:He.default,He==null?void 0:He[fo],(h=ie==null?void 0:ie.classNames)==null?void 0:h[fo]),"data-sonner-toast":"","data-rich-colors":(g=ie.richColors)!=null?g:Te,"data-styled":!(ie.jsx||ie.unstyled||be),"data-mounted":nn,"data-promise":!!ie.promise,"data-swiped":Qr,"data-removed":_n,"data-visible":Js,"data-y-position":Sa,"data-x-position":ks,"data-index":ue,"data-front":oo,"data-swiping":An,"data-dismissible":vo,"data-type":fo,"data-invert":yc,"data-swipe-out":li,"data-swipe-direction":Yn,"data-expanded":!!(Ne||ze&&nn),style:{"--index":ue,"--toasts-before":ue,"--z-index":Me.length-ue,"--offset":`${_n?Sr:Er.current}px`,"--initial-height":ze?"auto":`${uo}px`,...nt,...ie.style},onDragEnd:()=>{Kn(!1),mn(null),Ls.current=null},onPointerDown:fi=>{ta||!vo||(ps.current=new Date,Di(Er.current),fi.target.setPointerCapture(fi.pointerId),fi.target.tagName!=="BUTTON"&&(Kn(!0),Ls.current={x:fi.clientX,y:fi.clientY}))},onPointerUp:()=>{var fi,Hi,Wi,Fo;if(li||!vo)return;Ls.current=null;let at=Number(((fi=ho.current)==null?void 0:fi.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),bo=Number(((Hi=ho.current)==null?void 0:Hi.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),na=new Date().getTime()-((Wi=ps.current)==null?void 0:Wi.getTime()),po=Kt==="x"?at:bo,Bn=Math.abs(po)/na;if(Math.abs(po)>=d$||Bn>.11){Di(Er.current),(Fo=ie.onDismiss)==null||Fo.call(ie,ie),hi(Kt==="x"?at>0?"right":"left":bo>0?"down":"up"),Ai(),Ar(!0),xr(!1);return}Kn(!1),mn(null)},onPointerMove:fi=>{var Hi,Wi,Fo,at;if(!Ls.current||!vo||((Hi=window.getSelection())==null?void 0:Hi.toString().length)>0)return;let bo=fi.clientY-Ls.current.y,na=fi.clientX-Ls.current.x,po=(Wi=i.swipeDirections)!=null?Wi:f$(Tt);!Kt&&(Math.abs(na)>1||Math.abs(bo)>1)&&mn(Math.abs(na)>Math.abs(bo)?"x":"y");let Bn={x:0,y:0};Kt==="y"?(po.includes("top")||po.includes("bottom"))&&(po.includes("top")&&bo<0||po.includes("bottom")&&bo>0)&&(Bn.y=bo):Kt==="x"&&(po.includes("left")||po.includes("right"))&&(po.includes("left")&&na<0||po.includes("right")&&na>0)&&(Bn.x=na),(Math.abs(Bn.x)>0||Math.abs(Bn.y)>0)&&xr(!0),(Fo=ho.current)==null||Fo.style.setProperty("--swipe-amount-x",`${Bn.x}px`),(at=ho.current)==null||at.style.setProperty("--swipe-amount-y",`${Bn.y}px`)}},Ya&&!ie.jsx?pn.createElement("button",{"aria-label":$t,"data-disabled":ta,"data-close-button":!0,onClick:ta||!vo?()=>{}:()=>{var fi;Ai(),(fi=ie.onDismiss)==null||fi.call(ie,ie)},className:bl(He==null?void 0:He.closeButton,(w=ie==null?void 0:ie.classNames)==null?void 0:w.closeButton)},(S=mt==null?void 0:mt.close)!=null?S:K8):null,ie.jsx||G.isValidElement(ie.title)?ie.jsx?ie.jsx:typeof ie.title=="function"?ie.title():ie.title:pn.createElement(pn.Fragment,null,fo||ie.icon||ie.promise?pn.createElement("div",{"data-icon":"",className:bl(He==null?void 0:He.icon,(R=ie==null?void 0:ie.classNames)==null?void 0:R.icon)},ie.promise||ie.type==="loading"&&!ie.icon?ie.icon||Wr():null,ie.type!=="loading"?ie.icon||(mt==null?void 0:mt[fo])||G8(fo):null):null,pn.createElement("div",{"data-content":"",className:bl(He==null?void 0:He.content,(o=ie==null?void 0:ie.classNames)==null?void 0:o.content)},pn.createElement("div",{"data-title":"",className:bl(He==null?void 0:He.title,(N=ie==null?void 0:ie.classNames)==null?void 0:N.title)},typeof ie.title=="function"?ie.title():ie.title),ie.description?pn.createElement("div",{"data-description":"",className:bl(Ht,xo,He==null?void 0:He.description,(B=ie==null?void 0:ie.classNames)==null?void 0:B.description)},typeof ie.description=="function"?ie.description():ie.description):null),G.isValidElement(ie.cancel)?ie.cancel:ie.cancel&&bx(ie.cancel)?pn.createElement("button",{"data-button":!0,"data-cancel":!0,style:ie.cancelButtonStyle||At,onClick:fi=>{var Hi,Wi;bx(ie.cancel)&&vo&&((Wi=(Hi=ie.cancel).onClick)==null||Wi.call(Hi,fi),Ai())},className:bl(He==null?void 0:He.cancelButton,(q=ie==null?void 0:ie.classNames)==null?void 0:q.cancelButton)},ie.cancel.label):null,G.isValidElement(ie.action)?ie.action:ie.action&&bx(ie.action)?pn.createElement("button",{"data-button":!0,"data-action":!0,style:ie.actionButtonStyle||cn,onClick:fi=>{var Hi,Wi;bx(ie.action)&&((Wi=(Hi=ie.action).onClick)==null||Wi.call(Hi,fi),!fi.defaultPrevented&&Ai())},className:bl(He==null?void 0:He.actionButton,(Y=ie==null?void 0:ie.classNames)==null?void 0:Y.actionButton)},ie.action.label):null))};function kR(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}function m$(i,l){let h={};return[i,l].forEach((g,w)=>{let S=w===1,R=S?"--mobile-offset":"--offset",o=S?l$:a$;function N(B){["top","right","bottom","left"].forEach(q=>{h[`${R}-${q}`]=typeof B=="number"?`${B}px`:B})}typeof g=="number"||typeof g=="string"?N(g):typeof g=="object"?["top","right","bottom","left"].forEach(B=>{g[B]===void 0?h[`${R}-${B}`]=o:h[`${R}-${B}`]=typeof g[B]=="number"?`${g[B]}px`:g[B]}):N(o)}),h}var g$=G.forwardRef(function(i,l){let{invert:h,position:g="bottom-right",hotkey:w=["altKey","KeyT"],expand:S,closeButton:R,className:o,offset:N,mobileOffset:B,theme:q="light",richColors:Y,duration:J,style:ie,visibleToasts:be=s$,toastOptions:te,dir:le=kR(),gap:ce=u$,loadingIcon:oe,icons:ue,containerAriaLabel:Me="Notifications",pauseWhenPageIsHidden:Ne}=i,[je,Te]=pn.useState([]),Ve=pn.useMemo(()=>Array.from(new Set([g].concat(je.filter(Gt=>Gt.position).map(Gt=>Gt.position)))),[je,g]),[nt,At]=pn.useState([]),[cn,qt]=pn.useState(!1),[Ht,st]=pn.useState(!1),[Tt,xt]=pn.useState(q!=="system"?q:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),kt=pn.useRef(null),ze=w.join("+").replace(/Key/g,"").replace(/Digit/g,""),He=pn.useRef(null),mt=pn.useRef(!1),$t=pn.useCallback(Gt=>{Te(Kt=>{var mn;return(mn=Kt.find(Yn=>Yn.id===Gt.id))!=null&&mn.delete||qs.dismiss(Gt.id),Kt.filter(({id:Yn})=>Yn!==Gt.id)})},[]);return pn.useEffect(()=>qs.subscribe(Gt=>{if(Gt.dismiss){Te(Kt=>Kt.map(mn=>mn.id===Gt.id?{...mn,delete:!0}:mn));return}setTimeout(()=>{ez.flushSync(()=>{Te(Kt=>{let mn=Kt.findIndex(Yn=>Yn.id===Gt.id);return mn!==-1?[...Kt.slice(0,mn),{...Kt[mn],...Gt},...Kt.slice(mn+1)]:[Gt,...Kt]})})})}),[]),pn.useEffect(()=>{if(q!=="system"){xt(q);return}if(q==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?xt("dark"):xt("light")),typeof window>"u")return;let Gt=window.matchMedia("(prefers-color-scheme: dark)");try{Gt.addEventListener("change",({matches:Kt})=>{xt(Kt?"dark":"light")})}catch{Gt.addListener(({matches:mn})=>{try{xt(mn?"dark":"light")}catch(Yn){console.error(Yn)}})}},[q]),pn.useEffect(()=>{je.length<=1&&qt(!1)},[je]),pn.useEffect(()=>{let Gt=Kt=>{var mn,Yn;w.every(hi=>Kt[hi]||Kt.code===hi)&&(qt(!0),(mn=kt.current)==null||mn.focus()),Kt.code==="Escape"&&(document.activeElement===kt.current||(Yn=kt.current)!=null&&Yn.contains(document.activeElement))&&qt(!1)};return document.addEventListener("keydown",Gt),()=>document.removeEventListener("keydown",Gt)},[w]),pn.useEffect(()=>{if(kt.current)return()=>{He.current&&(He.current.focus({preventScroll:!0}),He.current=null,mt.current=!1)}},[kt.current]),pn.createElement("section",{ref:l,"aria-label":`${Me} ${ze}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Ve.map((Gt,Kt)=>{var mn;let[Yn,hi]=Gt.split("-");return je.length?pn.createElement("ol",{key:Gt,dir:le==="auto"?kR():le,tabIndex:-1,ref:kt,className:o,"data-sonner-toaster":!0,"data-theme":Tt,"data-y-position":Yn,"data-lifted":cn&&je.length>1&&!S,"data-x-position":hi,style:{"--front-toast-height":`${((mn=nt[0])==null?void 0:mn.height)||0}px`,"--width":`${c$}px`,"--gap":`${ce}px`,...ie,...m$(N,B)},onBlur:nn=>{mt.current&&!nn.currentTarget.contains(nn.relatedTarget)&&(mt.current=!1,He.current&&(He.current.focus({preventScroll:!0}),He.current=null))},onFocus:nn=>{nn.target instanceof HTMLElement&&nn.target.dataset.dismissible==="false"||mt.current||(mt.current=!0,He.current=nn.relatedTarget)},onMouseEnter:()=>qt(!0),onMouseMove:()=>qt(!0),onMouseLeave:()=>{Ht||qt(!1)},onDragEnd:()=>qt(!1),onPointerDown:nn=>{nn.target instanceof HTMLElement&&nn.target.dataset.dismissible==="false"||st(!0)},onPointerUp:()=>st(!1)},je.filter(nn=>!nn.position&&Kt===0||nn.position===Gt).map((nn,Zn)=>{var _n,En;return pn.createElement(p$,{key:nn.id,icons:ue,index:Zn,toast:nn,defaultRichColors:Y,duration:(_n=te==null?void 0:te.duration)!=null?_n:J,className:te==null?void 0:te.className,descriptionClassName:te==null?void 0:te.descriptionClassName,invert:h,visibleToasts:be,closeButton:(En=te==null?void 0:te.closeButton)!=null?En:R,interacting:Ht,position:Gt,style:te==null?void 0:te.style,unstyled:te==null?void 0:te.unstyled,classNames:te==null?void 0:te.classNames,cancelButtonStyle:te==null?void 0:te.cancelButtonStyle,actionButtonStyle:te==null?void 0:te.actionButtonStyle,removeToast:$t,toasts:je.filter(An=>An.position==nn.position),heights:nt.filter(An=>An.position==nn.position),setHeights:At,expandByDefault:S,gap:ce,loadingIcon:oe,expanded:cn,pauseWhenPageIsHidden:Ne,swipeDirections:i.swipeDirections})})):null}))});const _$=({...i})=>{const{theme:l="system"}=$8();return L.jsx(g$,{theme:l,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})};var y$="DismissableLayer",uS="dismissableLayer.update",v$="dismissableLayer.pointerDownOutside",x$="dismissableLayer.focusOutside",zR,Yz=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Kz=G.forwardRef((i,l)=>{const{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:g,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:R,onDismiss:o,...N}=i,B=G.useContext(Yz),[q,Y]=G.useState(null),J=(q==null?void 0:q.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=G.useState({}),be=$i(l,Te=>Y(Te)),te=Array.from(B.layers),[le]=[...B.layersWithOutsidePointerEventsDisabled].slice(-1),ce=te.indexOf(le),oe=q?te.indexOf(q):-1,ue=B.layersWithOutsidePointerEventsDisabled.size>0,Me=oe>=ce,Ne=T$(Te=>{const Ve=Te.target,nt=[...B.branches].some(At=>At.contains(Ve));!Me||nt||(w==null||w(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J),je=S$(Te=>{const Ve=Te.target;[...B.branches].some(At=>At.contains(Ve))||(S==null||S(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J);return Ky(Te=>{oe===B.layers.size-1&&(g==null||g(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},J),G.useEffect(()=>{if(q)return h&&(B.layersWithOutsidePointerEventsDisabled.size===0&&(zR=J.body.style.pointerEvents,J.body.style.pointerEvents="none"),B.layersWithOutsidePointerEventsDisabled.add(q)),B.layers.add(q),OR(),()=>{h&&B.layersWithOutsidePointerEventsDisabled.size===1&&(J.body.style.pointerEvents=zR)}},[q,J,h,B]),G.useEffect(()=>()=>{q&&(B.layers.delete(q),B.layersWithOutsidePointerEventsDisabled.delete(q),OR())},[q,B]),G.useEffect(()=>{const Te=()=>ie({});return document.addEventListener(uS,Te),()=>document.removeEventListener(uS,Te)},[]),L.jsx(_i.div,{...N,ref:be,style:{pointerEvents:ue?Me?"auto":"none":void 0,...i.style},onFocusCapture:bn(i.onFocusCapture,je.onFocusCapture),onBlurCapture:bn(i.onBlurCapture,je.onBlurCapture),onPointerDownCapture:bn(i.onPointerDownCapture,Ne.onPointerDownCapture)})});Kz.displayName=y$;var w$="DismissableLayerBranch",b$=G.forwardRef((i,l)=>{const h=G.useContext(Yz),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return h.branches.add(S),()=>{h.branches.delete(S)}},[h.branches]),L.jsx(_i.div,{...i,ref:w})});b$.displayName=w$;function T$(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1),w=G.useRef(()=>{});return G.useEffect(()=>{const S=o=>{if(o.target&&!g.current){let N=function(){Qz(v$,h,B,{discrete:!0})};const B={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",w.current),w.current=N,l.addEventListener("click",w.current,{once:!0})):N()}else l.removeEventListener("click",w.current);g.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",S),l.removeEventListener("click",w.current)}},[l,h]),{onPointerDownCapture:()=>g.current=!0}}function S$(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1);return G.useEffect(()=>{const w=S=>{S.target&&!g.current&&Qz(x$,h,{originalEvent:S},{discrete:!1})};return l.addEventListener("focusin",w),()=>l.removeEventListener("focusin",w)},[l,h]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function OR(){const i=new CustomEvent(uS);document.dispatchEvent(i)}function Qz(i,l,h,{discrete:g}){const w=h.originalEvent.target,S=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}var E$=OS[" useId ".trim().toString()]||(()=>{}),I$=0;function tu(i){const[l,h]=G.useState(E$());return Oo(()=>{h(g=>g??String(I$++))},[i]),l?`radix-${l}`:""}const C$=["top","right","bottom","left"],vd=Math.min,ma=Math.max,x1=Math.round,Tx=Math.floor,mc=i=>({x:i,y:i}),A$={left:"right",right:"left",bottom:"top",top:"bottom"},P$={start:"end",end:"start"};function dS(i,l,h){return ma(i,vd(l,h))}function su(i,l){return typeof i=="function"?i(l):i}function au(i){return i.split("-")[0]}function $m(i){return i.split("-")[1]}function OE(i){return i==="x"?"y":"x"}function FE(i){return i==="y"?"height":"width"}const M$=new Set(["top","bottom"]);function hc(i){return M$.has(au(i))?"y":"x"}function NE(i){return OE(hc(i))}function R$(i,l,h){h===void 0&&(h=!1);const g=$m(i),w=NE(i),S=FE(w);let R=w==="x"?g===(h?"end":"start")?"right":"left":g==="start"?"bottom":"top";return l.reference[S]>l.floating[S]&&(R=w1(R)),[R,w1(R)]}function D$(i){const l=w1(i);return[hS(i),l,hS(l)]}function hS(i){return i.replace(/start|end/g,l=>P$[l])}const FR=["left","right"],NR=["right","left"],L$=["top","bottom"],k$=["bottom","top"];function z$(i,l,h){switch(i){case"top":case"bottom":return h?l?NR:FR:l?FR:NR;case"left":case"right":return l?L$:k$;default:return[]}}function O$(i,l,h,g){const w=$m(i);let S=z$(au(i),h==="start",g);return w&&(S=S.map(R=>R+"-"+w),l&&(S=S.concat(S.map(hS)))),S}function w1(i){return i.replace(/left|right|bottom|top/g,l=>A$[l])}function F$(i){return{top:0,right:0,bottom:0,left:0,...i}}function Jz(i){return typeof i!="number"?F$(i):{top:i,right:i,bottom:i,left:i}}function b1(i){const{x:l,y:h,width:g,height:w}=i;return{width:g,height:w,top:h,left:l,right:l+g,bottom:h+w,x:l,y:h}}function BR(i,l,h){let{reference:g,floating:w}=i;const S=hc(l),R=NE(l),o=FE(R),N=au(l),B=S==="y",q=g.x+g.width/2-w.width/2,Y=g.y+g.height/2-w.height/2,J=g[o]/2-w[o]/2;let ie;switch(N){case"top":ie={x:q,y:g.y-w.height};break;case"bottom":ie={x:q,y:g.y+g.height};break;case"right":ie={x:g.x+g.width,y:Y};break;case"left":ie={x:g.x-w.width,y:Y};break;default:ie={x:g.x,y:g.y}}switch($m(l)){case"start":ie[R]-=J*(h&&B?-1:1);break;case"end":ie[R]+=J*(h&&B?-1:1);break}return ie}const N$=async(i,l,h)=>{const{placement:g="bottom",strategy:w="absolute",middleware:S=[],platform:R}=h,o=S.filter(Boolean),N=await(R.isRTL==null?void 0:R.isRTL(l));let B=await R.getElementRects({reference:i,floating:l,strategy:w}),{x:q,y:Y}=BR(B,g,N),J=g,ie={},be=0;for(let te=0;te<o.length;te++){const{name:le,fn:ce}=o[te],{x:oe,y:ue,data:Me,reset:Ne}=await ce({x:q,y:Y,initialPlacement:g,placement:J,strategy:w,middlewareData:ie,rects:B,platform:R,elements:{reference:i,floating:l}});q=oe??q,Y=ue??Y,ie={...ie,[le]:{...ie[le],...Me}},Ne&&be<=50&&(be++,typeof Ne=="object"&&(Ne.placement&&(J=Ne.placement),Ne.rects&&(B=Ne.rects===!0?await R.getElementRects({reference:i,floating:l,strategy:w}):Ne.rects),{x:q,y:Y}=BR(B,J,N)),te=-1)}return{x:q,y:Y,placement:J,strategy:w,middlewareData:ie}};async function Oy(i,l){var h;l===void 0&&(l={});const{x:g,y:w,platform:S,rects:R,elements:o,strategy:N}=i,{boundary:B="clippingAncestors",rootBoundary:q="viewport",elementContext:Y="floating",altBoundary:J=!1,padding:ie=0}=su(l,i),be=Jz(ie),le=o[J?Y==="floating"?"reference":"floating":Y],ce=b1(await S.getClippingRect({element:(h=await(S.isElement==null?void 0:S.isElement(le)))==null||h?le:le.contextElement||await(S.getDocumentElement==null?void 0:S.getDocumentElement(o.floating)),boundary:B,rootBoundary:q,strategy:N})),oe=Y==="floating"?{x:g,y:w,width:R.floating.width,height:R.floating.height}:R.reference,ue=await(S.getOffsetParent==null?void 0:S.getOffsetParent(o.floating)),Me=await(S.isElement==null?void 0:S.isElement(ue))?await(S.getScale==null?void 0:S.getScale(ue))||{x:1,y:1}:{x:1,y:1},Ne=b1(S.convertOffsetParentRelativeRectToViewportRelativeRect?await S.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:oe,offsetParent:ue,strategy:N}):oe);return{top:(ce.top-Ne.top+be.top)/Me.y,bottom:(Ne.bottom-ce.bottom+be.bottom)/Me.y,left:(ce.left-Ne.left+be.left)/Me.x,right:(Ne.right-ce.right+be.right)/Me.x}}const B$=i=>({name:"arrow",options:i,async fn(l){const{x:h,y:g,placement:w,rects:S,platform:R,elements:o,middlewareData:N}=l,{element:B,padding:q=0}=su(i,l)||{};if(B==null)return{};const Y=Jz(q),J={x:h,y:g},ie=NE(w),be=FE(ie),te=await R.getDimensions(B),le=ie==="y",ce=le?"top":"left",oe=le?"bottom":"right",ue=le?"clientHeight":"clientWidth",Me=S.reference[be]+S.reference[ie]-J[ie]-S.floating[be],Ne=J[ie]-S.reference[ie],je=await(R.getOffsetParent==null?void 0:R.getOffsetParent(B));let Te=je?je[ue]:0;(!Te||!await(R.isElement==null?void 0:R.isElement(je)))&&(Te=o.floating[ue]||S.floating[be]);const Ve=Me/2-Ne/2,nt=Te/2-te[be]/2-1,At=vd(Y[ce],nt),cn=vd(Y[oe],nt),qt=At,Ht=Te-te[be]-cn,st=Te/2-te[be]/2+Ve,Tt=dS(qt,st,Ht),xt=!N.arrow&&$m(w)!=null&&st!==Tt&&S.reference[be]/2-(st<qt?At:cn)-te[be]/2<0,kt=xt?st<qt?st-qt:st-Ht:0;return{[ie]:J[ie]+kt,data:{[ie]:Tt,centerOffset:st-Tt-kt,...xt&&{alignmentOffset:kt}},reset:xt}}}),j$=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(l){var h,g;const{placement:w,middlewareData:S,rects:R,initialPlacement:o,platform:N,elements:B}=l,{mainAxis:q=!0,crossAxis:Y=!0,fallbackPlacements:J,fallbackStrategy:ie="bestFit",fallbackAxisSideDirection:be="none",flipAlignment:te=!0,...le}=su(i,l);if((h=S.arrow)!=null&&h.alignmentOffset)return{};const ce=au(w),oe=hc(o),ue=au(o)===o,Me=await(N.isRTL==null?void 0:N.isRTL(B.floating)),Ne=J||(ue||!te?[w1(o)]:D$(o)),je=be!=="none";!J&&je&&Ne.push(...O$(o,te,be,Me));const Te=[o,...Ne],Ve=await Oy(l,le),nt=[];let At=((g=S.flip)==null?void 0:g.overflows)||[];if(q&&nt.push(Ve[ce]),Y){const st=R$(w,R,Me);nt.push(Ve[st[0]],Ve[st[1]])}if(At=[...At,{placement:w,overflows:nt}],!nt.every(st=>st<=0)){var cn,qt;const st=(((cn=S.flip)==null?void 0:cn.index)||0)+1,Tt=Te[st];if(Tt&&(!(Y==="alignment"?oe!==hc(Tt):!1)||At.every(ze=>hc(ze.placement)===oe?ze.overflows[0]>0:!0)))return{data:{index:st,overflows:At},reset:{placement:Tt}};let xt=(qt=At.filter(kt=>kt.overflows[0]<=0).sort((kt,ze)=>kt.overflows[1]-ze.overflows[1])[0])==null?void 0:qt.placement;if(!xt)switch(ie){case"bestFit":{var Ht;const kt=(Ht=At.filter(ze=>{if(je){const He=hc(ze.placement);return He===oe||He==="y"}return!0}).map(ze=>[ze.placement,ze.overflows.filter(He=>He>0).reduce((He,mt)=>He+mt,0)]).sort((ze,He)=>ze[1]-He[1])[0])==null?void 0:Ht[0];kt&&(xt=kt);break}case"initialPlacement":xt=o;break}if(w!==xt)return{reset:{placement:xt}}}return{}}}};function jR(i,l){return{top:i.top-l.height,right:i.right-l.width,bottom:i.bottom-l.height,left:i.left-l.width}}function UR(i){return C$.some(l=>i[l]>=0)}const U$=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(l){const{rects:h}=l,{strategy:g="referenceHidden",...w}=su(i,l);switch(g){case"referenceHidden":{const S=await Oy(l,{...w,elementContext:"reference"}),R=jR(S,h.reference);return{data:{referenceHiddenOffsets:R,referenceHidden:UR(R)}}}case"escaped":{const S=await Oy(l,{...w,altBoundary:!0}),R=jR(S,h.floating);return{data:{escapedOffsets:R,escaped:UR(R)}}}default:return{}}}}},eO=new Set(["left","top"]);async function V$(i,l){const{placement:h,platform:g,elements:w}=i,S=await(g.isRTL==null?void 0:g.isRTL(w.floating)),R=au(h),o=$m(h),N=hc(h)==="y",B=eO.has(R)?-1:1,q=S&&N?-1:1,Y=su(l,i);let{mainAxis:J,crossAxis:ie,alignmentAxis:be}=typeof Y=="number"?{mainAxis:Y,crossAxis:0,alignmentAxis:null}:{mainAxis:Y.mainAxis||0,crossAxis:Y.crossAxis||0,alignmentAxis:Y.alignmentAxis};return o&&typeof be=="number"&&(ie=o==="end"?be*-1:be),N?{x:ie*q,y:J*B}:{x:J*B,y:ie*q}}const $$=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(l){var h,g;const{x:w,y:S,placement:R,middlewareData:o}=l,N=await V$(l,i);return R===((h=o.offset)==null?void 0:h.placement)&&(g=o.arrow)!=null&&g.alignmentOffset?{}:{x:w+N.x,y:S+N.y,data:{...N,placement:R}}}}},G$=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(l){const{x:h,y:g,placement:w}=l,{mainAxis:S=!0,crossAxis:R=!1,limiter:o={fn:le=>{let{x:ce,y:oe}=le;return{x:ce,y:oe}}},...N}=su(i,l),B={x:h,y:g},q=await Oy(l,N),Y=hc(au(w)),J=OE(Y);let ie=B[J],be=B[Y];if(S){const le=J==="y"?"top":"left",ce=J==="y"?"bottom":"right",oe=ie+q[le],ue=ie-q[ce];ie=dS(oe,ie,ue)}if(R){const le=Y==="y"?"top":"left",ce=Y==="y"?"bottom":"right",oe=be+q[le],ue=be-q[ce];be=dS(oe,be,ue)}const te=o.fn({...l,[J]:ie,[Y]:be});return{...te,data:{x:te.x-h,y:te.y-g,enabled:{[J]:S,[Y]:R}}}}}},H$=function(i){return i===void 0&&(i={}),{options:i,fn(l){const{x:h,y:g,placement:w,rects:S,middlewareData:R}=l,{offset:o=0,mainAxis:N=!0,crossAxis:B=!0}=su(i,l),q={x:h,y:g},Y=hc(w),J=OE(Y);let ie=q[J],be=q[Y];const te=su(o,l),le=typeof te=="number"?{mainAxis:te,crossAxis:0}:{mainAxis:0,crossAxis:0,...te};if(N){const ue=J==="y"?"height":"width",Me=S.reference[J]-S.floating[ue]+le.mainAxis,Ne=S.reference[J]+S.reference[ue]-le.mainAxis;ie<Me?ie=Me:ie>Ne&&(ie=Ne)}if(B){var ce,oe;const ue=J==="y"?"width":"height",Me=eO.has(au(w)),Ne=S.reference[Y]-S.floating[ue]+(Me&&((ce=R.offset)==null?void 0:ce[Y])||0)+(Me?0:le.crossAxis),je=S.reference[Y]+S.reference[ue]+(Me?0:((oe=R.offset)==null?void 0:oe[Y])||0)-(Me?le.crossAxis:0);be<Ne?be=Ne:be>je&&(be=je)}return{[J]:ie,[Y]:be}}}},W$=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(l){var h,g;const{placement:w,rects:S,platform:R,elements:o}=l,{apply:N=()=>{},...B}=su(i,l),q=await Oy(l,B),Y=au(w),J=$m(w),ie=hc(w)==="y",{width:be,height:te}=S.floating;let le,ce;Y==="top"||Y==="bottom"?(le=Y,ce=J===(await(R.isRTL==null?void 0:R.isRTL(o.floating))?"start":"end")?"left":"right"):(ce=Y,le=J==="end"?"top":"bottom");const oe=te-q.top-q.bottom,ue=be-q.left-q.right,Me=vd(te-q[le],oe),Ne=vd(be-q[ce],ue),je=!l.middlewareData.shift;let Te=Me,Ve=Ne;if((h=l.middlewareData.shift)!=null&&h.enabled.x&&(Ve=ue),(g=l.middlewareData.shift)!=null&&g.enabled.y&&(Te=oe),je&&!J){const At=ma(q.left,0),cn=ma(q.right,0),qt=ma(q.top,0),Ht=ma(q.bottom,0);ie?Ve=be-2*(At!==0||cn!==0?At+cn:ma(q.left,q.right)):Te=te-2*(qt!==0||Ht!==0?qt+Ht:ma(q.top,q.bottom))}await N({...l,availableWidth:Ve,availableHeight:Te});const nt=await R.getDimensions(o.floating);return be!==nt.width||te!==nt.height?{reset:{rects:!0}}:{}}}};function Q1(){return typeof window<"u"}function Gm(i){return tO(i)?(i.nodeName||"").toLowerCase():"#document"}function ya(i){var l;return(i==null||(l=i.ownerDocument)==null?void 0:l.defaultView)||window}function _c(i){var l;return(l=(tO(i)?i.ownerDocument:i.document)||window.document)==null?void 0:l.documentElement}function tO(i){return Q1()?i instanceof Node||i instanceof ya(i).Node:!1}function Ll(i){return Q1()?i instanceof Element||i instanceof ya(i).Element:!1}function gc(i){return Q1()?i instanceof HTMLElement||i instanceof ya(i).HTMLElement:!1}function VR(i){return!Q1()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof ya(i).ShadowRoot}const q$=new Set(["inline","contents"]);function ev(i){const{overflow:l,overflowX:h,overflowY:g,display:w}=kl(i);return/auto|scroll|overlay|hidden|clip/.test(l+g+h)&&!q$.has(w)}const Z$=new Set(["table","td","th"]);function X$(i){return Z$.has(Gm(i))}const Y$=[":popover-open",":modal"];function J1(i){return Y$.some(l=>{try{return i.matches(l)}catch{return!1}})}const K$=["transform","translate","scale","rotate","perspective"],Q$=["transform","translate","scale","rotate","perspective","filter"],J$=["paint","layout","strict","content"];function BE(i){const l=jE(),h=Ll(i)?kl(i):i;return K$.some(g=>h[g]?h[g]!=="none":!1)||(h.containerType?h.containerType!=="normal":!1)||!l&&(h.backdropFilter?h.backdropFilter!=="none":!1)||!l&&(h.filter?h.filter!=="none":!1)||Q$.some(g=>(h.willChange||"").includes(g))||J$.some(g=>(h.contain||"").includes(g))}function eG(i){let l=xd(i);for(;gc(l)&&!Fm(l);){if(BE(l))return l;if(J1(l))return null;l=xd(l)}return null}function jE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const tG=new Set(["html","body","#document"]);function Fm(i){return tG.has(Gm(i))}function kl(i){return ya(i).getComputedStyle(i)}function ew(i){return Ll(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function xd(i){if(Gm(i)==="html")return i;const l=i.assignedSlot||i.parentNode||VR(i)&&i.host||_c(i);return VR(l)?l.host:l}function nO(i){const l=xd(i);return Fm(l)?i.ownerDocument?i.ownerDocument.body:i.body:gc(l)&&ev(l)?l:nO(l)}function Fy(i,l,h){var g;l===void 0&&(l=[]),h===void 0&&(h=!0);const w=nO(i),S=w===((g=i.ownerDocument)==null?void 0:g.body),R=ya(w);if(S){const o=fS(R);return l.concat(R,R.visualViewport||[],ev(w)?w:[],o&&h?Fy(o):[])}return l.concat(w,Fy(w,[],h))}function fS(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function iO(i){const l=kl(i);let h=parseFloat(l.width)||0,g=parseFloat(l.height)||0;const w=gc(i),S=w?i.offsetWidth:h,R=w?i.offsetHeight:g,o=x1(h)!==S||x1(g)!==R;return o&&(h=S,g=R),{width:h,height:g,$:o}}function UE(i){return Ll(i)?i:i.contextElement}function mm(i){const l=UE(i);if(!gc(l))return mc(1);const h=l.getBoundingClientRect(),{width:g,height:w,$:S}=iO(l);let R=(S?x1(h.width):h.width)/g,o=(S?x1(h.height):h.height)/w;return(!R||!Number.isFinite(R))&&(R=1),(!o||!Number.isFinite(o))&&(o=1),{x:R,y:o}}const nG=mc(0);function rO(i){const l=ya(i);return!jE()||!l.visualViewport?nG:{x:l.visualViewport.offsetLeft,y:l.visualViewport.offsetTop}}function iG(i,l,h){return l===void 0&&(l=!1),!h||l&&h!==ya(i)?!1:l}function Wh(i,l,h,g){l===void 0&&(l=!1),h===void 0&&(h=!1);const w=i.getBoundingClientRect(),S=UE(i);let R=mc(1);l&&(g?Ll(g)&&(R=mm(g)):R=mm(i));const o=iG(S,h,g)?rO(S):mc(0);let N=(w.left+o.x)/R.x,B=(w.top+o.y)/R.y,q=w.width/R.x,Y=w.height/R.y;if(S){const J=ya(S),ie=g&&Ll(g)?ya(g):g;let be=J,te=fS(be);for(;te&&g&&ie!==be;){const le=mm(te),ce=te.getBoundingClientRect(),oe=kl(te),ue=ce.left+(te.clientLeft+parseFloat(oe.paddingLeft))*le.x,Me=ce.top+(te.clientTop+parseFloat(oe.paddingTop))*le.y;N*=le.x,B*=le.y,q*=le.x,Y*=le.y,N+=ue,B+=Me,be=ya(te),te=fS(be)}}return b1({width:q,height:Y,x:N,y:B})}function tw(i,l){const h=ew(i).scrollLeft;return l?l.left+h:Wh(_c(i)).left+h}function oO(i,l){const h=i.getBoundingClientRect(),g=h.left+l.scrollLeft-tw(i,h),w=h.top+l.scrollTop;return{x:g,y:w}}function rG(i){let{elements:l,rect:h,offsetParent:g,strategy:w}=i;const S=w==="fixed",R=_c(g),o=l?J1(l.floating):!1;if(g===R||o&&S)return h;let N={scrollLeft:0,scrollTop:0},B=mc(1);const q=mc(0),Y=gc(g);if((Y||!Y&&!S)&&((Gm(g)!=="body"||ev(R))&&(N=ew(g)),gc(g))){const ie=Wh(g);B=mm(g),q.x=ie.x+g.clientLeft,q.y=ie.y+g.clientTop}const J=R&&!Y&&!S?oO(R,N):mc(0);return{width:h.width*B.x,height:h.height*B.y,x:h.x*B.x-N.scrollLeft*B.x+q.x+J.x,y:h.y*B.y-N.scrollTop*B.y+q.y+J.y}}function oG(i){return Array.from(i.getClientRects())}function sG(i){const l=_c(i),h=ew(i),g=i.ownerDocument.body,w=ma(l.scrollWidth,l.clientWidth,g.scrollWidth,g.clientWidth),S=ma(l.scrollHeight,l.clientHeight,g.scrollHeight,g.clientHeight);let R=-h.scrollLeft+tw(i);const o=-h.scrollTop;return kl(g).direction==="rtl"&&(R+=ma(l.clientWidth,g.clientWidth)-w),{width:w,height:S,x:R,y:o}}const $R=25;function aG(i,l){const h=ya(i),g=_c(i),w=h.visualViewport;let S=g.clientWidth,R=g.clientHeight,o=0,N=0;if(w){S=w.width,R=w.height;const q=jE();(!q||q&&l==="fixed")&&(o=w.offsetLeft,N=w.offsetTop)}const B=tw(g);if(B<=0){const q=g.ownerDocument,Y=q.body,J=getComputedStyle(Y),ie=q.compatMode==="CSS1Compat"&&parseFloat(J.marginLeft)+parseFloat(J.marginRight)||0,be=Math.abs(g.clientWidth-Y.clientWidth-ie);be<=$R&&(S-=be)}else B<=$R&&(S+=B);return{width:S,height:R,x:o,y:N}}const lG=new Set(["absolute","fixed"]);function cG(i,l){const h=Wh(i,!0,l==="fixed"),g=h.top+i.clientTop,w=h.left+i.clientLeft,S=gc(i)?mm(i):mc(1),R=i.clientWidth*S.x,o=i.clientHeight*S.y,N=w*S.x,B=g*S.y;return{width:R,height:o,x:N,y:B}}function GR(i,l,h){let g;if(l==="viewport")g=aG(i,h);else if(l==="document")g=sG(_c(i));else if(Ll(l))g=cG(l,h);else{const w=rO(i);g={x:l.x-w.x,y:l.y-w.y,width:l.width,height:l.height}}return b1(g)}function sO(i,l){const h=xd(i);return h===l||!Ll(h)||Fm(h)?!1:kl(h).position==="fixed"||sO(h,l)}function uG(i,l){const h=l.get(i);if(h)return h;let g=Fy(i,[],!1).filter(o=>Ll(o)&&Gm(o)!=="body"),w=null;const S=kl(i).position==="fixed";let R=S?xd(i):i;for(;Ll(R)&&!Fm(R);){const o=kl(R),N=BE(R);!N&&o.position==="fixed"&&(w=null),(S?!N&&!w:!N&&o.position==="static"&&!!w&&lG.has(w.position)||ev(R)&&!N&&sO(i,R))?g=g.filter(q=>q!==R):w=o,R=xd(R)}return l.set(i,g),g}function dG(i){let{element:l,boundary:h,rootBoundary:g,strategy:w}=i;const R=[...h==="clippingAncestors"?J1(l)?[]:uG(l,this._c):[].concat(h),g],o=R[0],N=R.reduce((B,q)=>{const Y=GR(l,q,w);return B.top=ma(Y.top,B.top),B.right=vd(Y.right,B.right),B.bottom=vd(Y.bottom,B.bottom),B.left=ma(Y.left,B.left),B},GR(l,o,w));return{width:N.right-N.left,height:N.bottom-N.top,x:N.left,y:N.top}}function hG(i){const{width:l,height:h}=iO(i);return{width:l,height:h}}function fG(i,l,h){const g=gc(l),w=_c(l),S=h==="fixed",R=Wh(i,!0,S,l);let o={scrollLeft:0,scrollTop:0};const N=mc(0);function B(){N.x=tw(w)}if(g||!g&&!S)if((Gm(l)!=="body"||ev(w))&&(o=ew(l)),g){const ie=Wh(l,!0,S,l);N.x=ie.x+l.clientLeft,N.y=ie.y+l.clientTop}else w&&B();S&&!g&&w&&B();const q=w&&!g&&!S?oO(w,o):mc(0),Y=R.left+o.scrollLeft-N.x-q.x,J=R.top+o.scrollTop-N.y-q.y;return{x:Y,y:J,width:R.width,height:R.height}}function YT(i){return kl(i).position==="static"}function HR(i,l){if(!gc(i)||kl(i).position==="fixed")return null;if(l)return l(i);let h=i.offsetParent;return _c(i)===h&&(h=h.ownerDocument.body),h}function aO(i,l){const h=ya(i);if(J1(i))return h;if(!gc(i)){let w=xd(i);for(;w&&!Fm(w);){if(Ll(w)&&!YT(w))return w;w=xd(w)}return h}let g=HR(i,l);for(;g&&X$(g)&&YT(g);)g=HR(g,l);return g&&Fm(g)&&YT(g)&&!BE(g)?h:g||eG(i)||h}const pG=async function(i){const l=this.getOffsetParent||aO,h=this.getDimensions,g=await h(i.floating);return{reference:fG(i.reference,await l(i.floating),i.strategy),floating:{x:0,y:0,width:g.width,height:g.height}}};function mG(i){return kl(i).direction==="rtl"}const gG={convertOffsetParentRelativeRectToViewportRelativeRect:rG,getDocumentElement:_c,getClippingRect:dG,getOffsetParent:aO,getElementRects:pG,getClientRects:oG,getDimensions:hG,getScale:mm,isElement:Ll,isRTL:mG};function lO(i,l){return i.x===l.x&&i.y===l.y&&i.width===l.width&&i.height===l.height}function _G(i,l){let h=null,g;const w=_c(i);function S(){var o;clearTimeout(g),(o=h)==null||o.disconnect(),h=null}function R(o,N){o===void 0&&(o=!1),N===void 0&&(N=1),S();const B=i.getBoundingClientRect(),{left:q,top:Y,width:J,height:ie}=B;if(o||l(),!J||!ie)return;const be=Tx(Y),te=Tx(w.clientWidth-(q+J)),le=Tx(w.clientHeight-(Y+ie)),ce=Tx(q),ue={rootMargin:-be+"px "+-te+"px "+-le+"px "+-ce+"px",threshold:ma(0,vd(1,N))||1};let Me=!0;function Ne(je){const Te=je[0].intersectionRatio;if(Te!==N){if(!Me)return R();Te?R(!1,Te):g=setTimeout(()=>{R(!1,1e-7)},1e3)}Te===1&&!lO(B,i.getBoundingClientRect())&&R(),Me=!1}try{h=new IntersectionObserver(Ne,{...ue,root:w.ownerDocument})}catch{h=new IntersectionObserver(Ne,ue)}h.observe(i)}return R(!0),S}function yG(i,l,h,g){g===void 0&&(g={});const{ancestorScroll:w=!0,ancestorResize:S=!0,elementResize:R=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:N=!1}=g,B=UE(i),q=w||S?[...B?Fy(B):[],...Fy(l)]:[];q.forEach(ce=>{w&&ce.addEventListener("scroll",h,{passive:!0}),S&&ce.addEventListener("resize",h)});const Y=B&&o?_G(B,h):null;let J=-1,ie=null;R&&(ie=new ResizeObserver(ce=>{let[oe]=ce;oe&&oe.target===B&&ie&&(ie.unobserve(l),cancelAnimationFrame(J),J=requestAnimationFrame(()=>{var ue;(ue=ie)==null||ue.observe(l)})),h()}),B&&!N&&ie.observe(B),ie.observe(l));let be,te=N?Wh(i):null;N&&le();function le(){const ce=Wh(i);te&&!lO(te,ce)&&h(),te=ce,be=requestAnimationFrame(le)}return h(),()=>{var ce;q.forEach(oe=>{w&&oe.removeEventListener("scroll",h),S&&oe.removeEventListener("resize",h)}),Y==null||Y(),(ce=ie)==null||ce.disconnect(),ie=null,N&&cancelAnimationFrame(be)}}const vG=$$,xG=G$,wG=j$,bG=W$,TG=U$,WR=B$,SG=H$,EG=(i,l,h)=>{const g=new Map,w={platform:gG,...h},S={...w.platform,_c:g};return N$(i,l,{...w,platform:S})};var IG=typeof document<"u",CG=function(){},qx=IG?G.useLayoutEffect:CG;function T1(i,l){if(i===l)return!0;if(typeof i!=typeof l)return!1;if(typeof i=="function"&&i.toString()===l.toString())return!0;let h,g,w;if(i&&l&&typeof i=="object"){if(Array.isArray(i)){if(h=i.length,h!==l.length)return!1;for(g=h;g--!==0;)if(!T1(i[g],l[g]))return!1;return!0}if(w=Object.keys(i),h=w.length,h!==Object.keys(l).length)return!1;for(g=h;g--!==0;)if(!{}.hasOwnProperty.call(l,w[g]))return!1;for(g=h;g--!==0;){const S=w[g];if(!(S==="_owner"&&i.$$typeof)&&!T1(i[S],l[S]))return!1}return!0}return i!==i&&l!==l}function cO(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function qR(i,l){const h=cO(i);return Math.round(l*h)/h}function KT(i){const l=G.useRef(i);return qx(()=>{l.current=i}),l}function AG(i){i===void 0&&(i={});const{placement:l="bottom",strategy:h="absolute",middleware:g=[],platform:w,elements:{reference:S,floating:R}={},transform:o=!0,whileElementsMounted:N,open:B}=i,[q,Y]=G.useState({x:0,y:0,strategy:h,placement:l,middlewareData:{},isPositioned:!1}),[J,ie]=G.useState(g);T1(J,g)||ie(g);const[be,te]=G.useState(null),[le,ce]=G.useState(null),oe=G.useCallback(ze=>{ze!==je.current&&(je.current=ze,te(ze))},[]),ue=G.useCallback(ze=>{ze!==Te.current&&(Te.current=ze,ce(ze))},[]),Me=S||be,Ne=R||le,je=G.useRef(null),Te=G.useRef(null),Ve=G.useRef(q),nt=N!=null,At=KT(N),cn=KT(w),qt=KT(B),Ht=G.useCallback(()=>{if(!je.current||!Te.current)return;const ze={placement:l,strategy:h,middleware:J};cn.current&&(ze.platform=cn.current),EG(je.current,Te.current,ze).then(He=>{const mt={...He,isPositioned:qt.current!==!1};st.current&&!T1(Ve.current,mt)&&(Ve.current=mt,ef.flushSync(()=>{Y(mt)}))})},[J,l,h,cn,qt]);qx(()=>{B===!1&&Ve.current.isPositioned&&(Ve.current.isPositioned=!1,Y(ze=>({...ze,isPositioned:!1})))},[B]);const st=G.useRef(!1);qx(()=>(st.current=!0,()=>{st.current=!1}),[]),qx(()=>{if(Me&&(je.current=Me),Ne&&(Te.current=Ne),Me&&Ne){if(At.current)return At.current(Me,Ne,Ht);Ht()}},[Me,Ne,Ht,At,nt]);const Tt=G.useMemo(()=>({reference:je,floating:Te,setReference:oe,setFloating:ue}),[oe,ue]),xt=G.useMemo(()=>({reference:Me,floating:Ne}),[Me,Ne]),kt=G.useMemo(()=>{const ze={position:h,left:0,top:0};if(!xt.floating)return ze;const He=qR(xt.floating,q.x),mt=qR(xt.floating,q.y);return o?{...ze,transform:"translate("+He+"px, "+mt+"px)",...cO(xt.floating)>=1.5&&{willChange:"transform"}}:{position:h,left:He,top:mt}},[h,o,xt.floating,q.x,q.y]);return G.useMemo(()=>({...q,update:Ht,refs:Tt,elements:xt,floatingStyles:kt}),[q,Ht,Tt,xt,kt])}const PG=i=>{function l(h){return{}.hasOwnProperty.call(h,"current")}return{name:"arrow",options:i,fn(h){const{element:g,padding:w}=typeof i=="function"?i(h):i;return g&&l(g)?g.current!=null?WR({element:g.current,padding:w}).fn(h):{}:g?WR({element:g,padding:w}).fn(h):{}}}},MG=(i,l)=>({...vG(i),options:[i,l]}),RG=(i,l)=>({...xG(i),options:[i,l]}),DG=(i,l)=>({...SG(i),options:[i,l]}),LG=(i,l)=>({...wG(i),options:[i,l]}),kG=(i,l)=>({...bG(i),options:[i,l]}),zG=(i,l)=>({...TG(i),options:[i,l]}),OG=(i,l)=>({...PG(i),options:[i,l]});var FG="Arrow",uO=G.forwardRef((i,l)=>{const{children:h,width:g=10,height:w=5,...S}=i;return L.jsx(_i.svg,{...S,ref:l,width:g,height:w,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?h:L.jsx("polygon",{points:"0,0 30,0 15,10"})})});uO.displayName=FG;var NG=uO;function BG(i){const[l,h]=G.useState(void 0);return Oo(()=>{if(i){h({width:i.offsetWidth,height:i.offsetHeight});const g=new ResizeObserver(w=>{if(!Array.isArray(w)||!w.length)return;const S=w[0];let R,o;if("borderBoxSize"in S){const N=S.borderBoxSize,B=Array.isArray(N)?N[0]:N;R=B.inlineSize,o=B.blockSize}else R=i.offsetWidth,o=i.offsetHeight;h({width:R,height:o})});return g.observe(i,{box:"border-box"}),()=>g.unobserve(i)}else h(void 0)},[i]),l}var VE="Popper",[dO,Hm]=cu(VE),[jG,hO]=dO(VE),fO=i=>{const{__scopePopper:l,children:h}=i,[g,w]=G.useState(null);return L.jsx(jG,{scope:l,anchor:g,onAnchorChange:w,children:h})};fO.displayName=VE;var pO="PopperAnchor",mO=G.forwardRef((i,l)=>{const{__scopePopper:h,virtualRef:g,...w}=i,S=hO(pO,h),R=G.useRef(null),o=$i(l,R);return G.useEffect(()=>{S.onAnchorChange((g==null?void 0:g.current)||R.current)}),g?null:L.jsx(_i.div,{...w,ref:o})});mO.displayName=pO;var $E="PopperContent",[UG,VG]=dO($E),gO=G.forwardRef((i,l)=>{var nn,Zn,_n,En,An,Kn;const{__scopePopper:h,side:g="bottom",sideOffset:w=0,align:S="center",alignOffset:R=0,arrowPadding:o=0,avoidCollisions:N=!0,collisionBoundary:B=[],collisionPadding:q=0,sticky:Y="partial",hideWhenDetached:J=!1,updatePositionStrategy:ie="optimized",onPlaced:be,...te}=i,le=hO($E,h),[ce,oe]=G.useState(null),ue=$i(l,li=>oe(li)),[Me,Ne]=G.useState(null),je=BG(Me),Te=(je==null?void 0:je.width)??0,Ve=(je==null?void 0:je.height)??0,nt=g+(S!=="center"?"-"+S:""),At=typeof q=="number"?q:{top:0,right:0,bottom:0,left:0,...q},cn=Array.isArray(B)?B:[B],qt=cn.length>0,Ht={padding:At,boundary:cn.filter(GG),altBoundary:qt},{refs:st,floatingStyles:Tt,placement:xt,isPositioned:kt,middlewareData:ze}=AG({strategy:"fixed",placement:nt,whileElementsMounted:(...li)=>yG(...li,{animationFrame:ie==="always"}),elements:{reference:le.anchor},middleware:[MG({mainAxis:w+Ve,alignmentAxis:R}),N&&RG({mainAxis:!0,crossAxis:!1,limiter:Y==="partial"?DG():void 0,...Ht}),N&&LG({...Ht}),kG({...Ht,apply:({elements:li,rects:Ar,availableWidth:Qr,availableHeight:xr})=>{const{width:Sr,height:Di}=Ar.reference,uo=li.floating.style;uo.setProperty("--radix-popper-available-width",`${Qr}px`),uo.setProperty("--radix-popper-available-height",`${xr}px`),uo.setProperty("--radix-popper-anchor-width",`${Sr}px`),uo.setProperty("--radix-popper-anchor-height",`${Di}px`)}}),Me&&OG({element:Me,padding:o}),HG({arrowWidth:Te,arrowHeight:Ve}),J&&zG({strategy:"referenceHidden",...Ht})]}),[He,mt]=vO(xt),$t=co(be);Oo(()=>{kt&&($t==null||$t())},[kt,$t]);const Gt=(nn=ze.arrow)==null?void 0:nn.x,Kt=(Zn=ze.arrow)==null?void 0:Zn.y,mn=((_n=ze.arrow)==null?void 0:_n.centerOffset)!==0,[Yn,hi]=G.useState();return Oo(()=>{ce&&hi(window.getComputedStyle(ce).zIndex)},[ce]),L.jsx("div",{ref:st.setFloating,"data-radix-popper-content-wrapper":"",style:{...Tt,transform:kt?Tt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Yn,"--radix-popper-transform-origin":[(En=ze.transformOrigin)==null?void 0:En.x,(An=ze.transformOrigin)==null?void 0:An.y].join(" "),...((Kn=ze.hide)==null?void 0:Kn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:L.jsx(UG,{scope:h,placedSide:He,onArrowChange:Ne,arrowX:Gt,arrowY:Kt,shouldHideArrow:mn,children:L.jsx(_i.div,{"data-side":He,"data-align":mt,...te,ref:ue,style:{...te.style,animation:kt?void 0:"none"}})})})});gO.displayName=$E;var _O="PopperArrow",$G={top:"bottom",right:"left",bottom:"top",left:"right"},yO=G.forwardRef(function(l,h){const{__scopePopper:g,...w}=l,S=VG(_O,g),R=$G[S.placedSide];return L.jsx("span",{ref:S.onArrowChange,style:{position:"absolute",left:S.arrowX,top:S.arrowY,[R]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[S.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[S.placedSide],visibility:S.shouldHideArrow?"hidden":void 0},children:L.jsx(NG,{...w,ref:h,style:{...w.style,display:"block"}})})});yO.displayName=_O;function GG(i){return i!==null}var HG=i=>({name:"transformOrigin",options:i,fn(l){var le,ce,oe;const{placement:h,rects:g,middlewareData:w}=l,R=((le=w.arrow)==null?void 0:le.centerOffset)!==0,o=R?0:i.arrowWidth,N=R?0:i.arrowHeight,[B,q]=vO(h),Y={start:"0%",center:"50%",end:"100%"}[q],J=(((ce=w.arrow)==null?void 0:ce.x)??0)+o/2,ie=(((oe=w.arrow)==null?void 0:oe.y)??0)+N/2;let be="",te="";return B==="bottom"?(be=R?Y:`${J}px`,te=`${-N}px`):B==="top"?(be=R?Y:`${J}px`,te=`${g.floating.height+N}px`):B==="right"?(be=`${-N}px`,te=R?Y:`${ie}px`):B==="left"&&(be=`${g.floating.width+N}px`,te=R?Y:`${ie}px`),{data:{x:be,y:te}}}});function vO(i){const[l,h="center"]=i.split("-");return[l,h]}var xO=fO,GE=mO,HE=gO,WE=yO,[nw,YZ]=cu("Tooltip",[Hm]),qE=Hm(),wO="TooltipProvider",WG=700,ZR="tooltip.open",[qG,bO]=nw(wO),TO=i=>{const{__scopeTooltip:l,delayDuration:h=WG,skipDelayDuration:g=300,disableHoverableContent:w=!1,children:S}=i,R=G.useRef(!0),o=G.useRef(!1),N=G.useRef(0);return G.useEffect(()=>{const B=N.current;return()=>window.clearTimeout(B)},[]),L.jsx(qG,{scope:l,isOpenDelayedRef:R,delayDuration:h,onOpen:G.useCallback(()=>{window.clearTimeout(N.current),R.current=!1},[]),onClose:G.useCallback(()=>{window.clearTimeout(N.current),N.current=window.setTimeout(()=>R.current=!0,g)},[g]),isPointerInTransitRef:o,onPointerInTransitChange:G.useCallback(B=>{o.current=B},[]),disableHoverableContent:w,children:S})};TO.displayName=wO;var SO="Tooltip",[KZ,iw]=nw(SO),pS="TooltipTrigger",ZG=G.forwardRef((i,l)=>{const{__scopeTooltip:h,...g}=i,w=iw(pS,h),S=bO(pS,h),R=qE(h),o=G.useRef(null),N=$i(l,o,w.onTriggerChange),B=G.useRef(!1),q=G.useRef(!1),Y=G.useCallback(()=>B.current=!1,[]);return G.useEffect(()=>()=>document.removeEventListener("pointerup",Y),[Y]),L.jsx(GE,{asChild:!0,...R,children:L.jsx(_i.button,{"aria-describedby":w.open?w.contentId:void 0,"data-state":w.stateAttribute,...g,ref:N,onPointerMove:bn(i.onPointerMove,J=>{J.pointerType!=="touch"&&!q.current&&!S.isPointerInTransitRef.current&&(w.onTriggerEnter(),q.current=!0)}),onPointerLeave:bn(i.onPointerLeave,()=>{w.onTriggerLeave(),q.current=!1}),onPointerDown:bn(i.onPointerDown,()=>{w.open&&w.onClose(),B.current=!0,document.addEventListener("pointerup",Y,{once:!0})}),onFocus:bn(i.onFocus,()=>{B.current||w.onOpen()}),onBlur:bn(i.onBlur,w.onClose),onClick:bn(i.onClick,w.onClose)})})});ZG.displayName=pS;var XG="TooltipPortal",[QZ,YG]=nw(XG,{forceMount:void 0}),Nm="TooltipContent",EO=G.forwardRef((i,l)=>{const h=YG(Nm,i.__scopeTooltip),{forceMount:g=h.forceMount,side:w="top",...S}=i,R=iw(Nm,i.__scopeTooltip);return L.jsx(nf,{present:g||R.open,children:R.disableHoverableContent?L.jsx(IO,{side:w,...S,ref:l}):L.jsx(KG,{side:w,...S,ref:l})})}),KG=G.forwardRef((i,l)=>{const h=iw(Nm,i.__scopeTooltip),g=bO(Nm,i.__scopeTooltip),w=G.useRef(null),S=$i(l,w),[R,o]=G.useState(null),{trigger:N,onClose:B}=h,q=w.current,{onPointerInTransitChange:Y}=g,J=G.useCallback(()=>{o(null),Y(!1)},[Y]),ie=G.useCallback((be,te)=>{const le=be.currentTarget,ce={x:be.clientX,y:be.clientY},oe=nH(ce,le.getBoundingClientRect()),ue=iH(ce,oe),Me=rH(te.getBoundingClientRect()),Ne=sH([...ue,...Me]);o(Ne),Y(!0)},[Y]);return G.useEffect(()=>()=>J(),[J]),G.useEffect(()=>{if(N&&q){const be=le=>ie(le,q),te=le=>ie(le,N);return N.addEventListener("pointerleave",be),q.addEventListener("pointerleave",te),()=>{N.removeEventListener("pointerleave",be),q.removeEventListener("pointerleave",te)}}},[N,q,ie,J]),G.useEffect(()=>{if(R){const be=te=>{const le=te.target,ce={x:te.clientX,y:te.clientY},oe=(N==null?void 0:N.contains(le))||(q==null?void 0:q.contains(le)),ue=!oH(ce,R);oe?J():ue&&(J(),B())};return document.addEventListener("pointermove",be),()=>document.removeEventListener("pointermove",be)}},[N,q,R,B,J]),L.jsx(IO,{...i,ref:S})}),[QG,JG]=nw(SO,{isInside:!1}),eH=e6("TooltipContent"),IO=G.forwardRef((i,l)=>{const{__scopeTooltip:h,children:g,"aria-label":w,onEscapeKeyDown:S,onPointerDownOutside:R,...o}=i,N=iw(Nm,h),B=qE(h),{onClose:q}=N;return G.useEffect(()=>(document.addEventListener(ZR,q),()=>document.removeEventListener(ZR,q)),[q]),G.useEffect(()=>{if(N.trigger){const Y=J=>{const ie=J.target;ie!=null&&ie.contains(N.trigger)&&q()};return window.addEventListener("scroll",Y,{capture:!0}),()=>window.removeEventListener("scroll",Y,{capture:!0})}},[N.trigger,q]),L.jsx(Kz,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:S,onPointerDownOutside:R,onFocusOutside:Y=>Y.preventDefault(),onDismiss:q,children:L.jsxs(HE,{"data-state":N.stateAttribute,...B,...o,ref:l,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[L.jsx(eH,{children:g}),L.jsx(QG,{scope:h,isInside:!0,children:L.jsx(w6,{id:N.contentId,role:"tooltip",children:w||g})})]})})});EO.displayName=Nm;var CO="TooltipArrow",tH=G.forwardRef((i,l)=>{const{__scopeTooltip:h,...g}=i,w=qE(h);return JG(CO,h).isInside?null:L.jsx(WE,{...w,...g,ref:l})});tH.displayName=CO;function nH(i,l){const h=Math.abs(l.top-i.y),g=Math.abs(l.bottom-i.y),w=Math.abs(l.right-i.x),S=Math.abs(l.left-i.x);switch(Math.min(h,g,w,S)){case S:return"left";case w:return"right";case h:return"top";case g:return"bottom";default:throw new Error("unreachable")}}function iH(i,l,h=5){const g=[];switch(l){case"top":g.push({x:i.x-h,y:i.y+h},{x:i.x+h,y:i.y+h});break;case"bottom":g.push({x:i.x-h,y:i.y-h},{x:i.x+h,y:i.y-h});break;case"left":g.push({x:i.x+h,y:i.y-h},{x:i.x+h,y:i.y+h});break;case"right":g.push({x:i.x-h,y:i.y-h},{x:i.x-h,y:i.y+h});break}return g}function rH(i){const{top:l,right:h,bottom:g,left:w}=i;return[{x:w,y:l},{x:h,y:l},{x:h,y:g},{x:w,y:g}]}function oH(i,l){const{x:h,y:g}=i;let w=!1;for(let S=0,R=l.length-1;S<l.length;R=S++){const o=l[S],N=l[R],B=o.x,q=o.y,Y=N.x,J=N.y;q>g!=J>g&&h<(Y-B)*(g-q)/(J-q)+B&&(w=!w)}return w}function sH(i){const l=i.slice();return l.sort((h,g)=>h.x<g.x?-1:h.x>g.x?1:h.y<g.y?-1:h.y>g.y?1:0),aH(l)}function aH(i){if(i.length<=1)return i.slice();const l=[];for(let g=0;g<i.length;g++){const w=i[g];for(;l.length>=2;){const S=l[l.length-1],R=l[l.length-2];if((S.x-R.x)*(w.y-R.y)>=(S.y-R.y)*(w.x-R.x))l.pop();else break}l.push(w)}l.pop();const h=[];for(let g=i.length-1;g>=0;g--){const w=i[g];for(;h.length>=2;){const S=h[h.length-1],R=h[h.length-2];if((S.x-R.x)*(w.y-R.y)>=(S.y-R.y)*(w.x-R.x))h.pop();else break}h.push(w)}return h.pop(),l.length===1&&h.length===1&&l[0].x===h[0].x&&l[0].y===h[0].y?l:l.concat(h)}var lH=TO,AO=EO;const cH=lH,uH=G.forwardRef(({className:i,sideOffset:l=4,...h},g)=>L.jsx(AO,{ref:g,sideOffset:l,className:vr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...h}));uH.displayName=AO.displayName;var rw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ow=typeof window>"u"||"Deno"in globalThis;function El(){}function dH(i,l){return typeof i=="function"?i(l):i}function hH(i){return typeof i=="number"&&i>=0&&i!==1/0}function fH(i,l){return Math.max(i+(l||0)-Date.now(),0)}function mS(i,l){return typeof i=="function"?i(l):i}function pH(i,l){return typeof i=="function"?i(l):i}function XR(i,l){const{type:h="all",exact:g,fetchStatus:w,predicate:S,queryKey:R,stale:o}=i;if(R){if(g){if(l.queryHash!==ZE(R,l.options))return!1}else if(!By(l.queryKey,R))return!1}if(h!=="all"){const N=l.isActive();if(h==="active"&&!N||h==="inactive"&&N)return!1}return!(typeof o=="boolean"&&l.isStale()!==o||w&&w!==l.state.fetchStatus||S&&!S(l))}function YR(i,l){const{exact:h,status:g,predicate:w,mutationKey:S}=i;if(S){if(!l.options.mutationKey)return!1;if(h){if(Ny(l.options.mutationKey)!==Ny(S))return!1}else if(!By(l.options.mutationKey,S))return!1}return!(g&&l.state.status!==g||w&&!w(l))}function ZE(i,l){return((l==null?void 0:l.queryKeyHashFn)||Ny)(i)}function Ny(i){return JSON.stringify(i,(l,h)=>gS(h)?Object.keys(h).sort().reduce((g,w)=>(g[w]=h[w],g),{}):h)}function By(i,l){return i===l?!0:typeof i!=typeof l?!1:i&&l&&typeof i=="object"&&typeof l=="object"?Object.keys(l).every(h=>By(i[h],l[h])):!1}function PO(i,l){if(i===l)return i;const h=KR(i)&&KR(l);if(h||gS(i)&&gS(l)){const g=h?i:Object.keys(i),w=g.length,S=h?l:Object.keys(l),R=S.length,o=h?[]:{},N=new Set(g);let B=0;for(let q=0;q<R;q++){const Y=h?q:S[q];(!h&&N.has(Y)||h)&&i[Y]===void 0&&l[Y]===void 0?(o[Y]=void 0,B++):(o[Y]=PO(i[Y],l[Y]),o[Y]===i[Y]&&i[Y]!==void 0&&B++)}return w===R&&B===w?i:o}return l}function KR(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function gS(i){if(!QR(i))return!1;const l=i.constructor;if(l===void 0)return!0;const h=l.prototype;return!(!QR(h)||!h.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function QR(i){return Object.prototype.toString.call(i)==="[object Object]"}function mH(i){return new Promise(l=>{setTimeout(l,i)})}function gH(i,l,h){return typeof h.structuralSharing=="function"?h.structuralSharing(i,l):h.structuralSharing!==!1?PO(i,l):l}function _H(i,l,h=0){const g=[...i,l];return h&&g.length>h?g.slice(1):g}function yH(i,l,h=0){const g=[l,...i];return h&&g.length>h?g.slice(0,-1):g}var XE=Symbol();function MO(i,l){return!i.queryFn&&(l!=null&&l.initialPromise)?()=>l.initialPromise:!i.queryFn||i.queryFn===XE?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}var Mh,Ju,vm,kD,vH=(kD=class extends rw{constructor(){super();yr(this,Mh);yr(this,Ju);yr(this,vm);zi(this,vm,l=>{if(!ow&&window.addEventListener){const h=()=>l();return window.addEventListener("visibilitychange",h,!1),()=>{window.removeEventListener("visibilitychange",h)}}})}onSubscribe(){Vt(this,Ju)||this.setEventListener(Vt(this,vm))}onUnsubscribe(){var l;this.hasListeners()||((l=Vt(this,Ju))==null||l.call(this),zi(this,Ju,void 0))}setEventListener(l){var h;zi(this,vm,l),(h=Vt(this,Ju))==null||h.call(this),zi(this,Ju,l(g=>{typeof g=="boolean"?this.setFocused(g):this.onFocus()}))}setFocused(l){Vt(this,Mh)!==l&&(zi(this,Mh,l),this.onFocus())}onFocus(){const l=this.isFocused();this.listeners.forEach(h=>{h(l)})}isFocused(){var l;return typeof Vt(this,Mh)=="boolean"?Vt(this,Mh):((l=globalThis.document)==null?void 0:l.visibilityState)!=="hidden"}},Mh=new WeakMap,Ju=new WeakMap,vm=new WeakMap,kD),RO=new vH,xm,ed,wm,zD,xH=(zD=class extends rw{constructor(){super();yr(this,xm,!0);yr(this,ed);yr(this,wm);zi(this,wm,l=>{if(!ow&&window.addEventListener){const h=()=>l(!0),g=()=>l(!1);return window.addEventListener("online",h,!1),window.addEventListener("offline",g,!1),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",g)}}})}onSubscribe(){Vt(this,ed)||this.setEventListener(Vt(this,wm))}onUnsubscribe(){var l;this.hasListeners()||((l=Vt(this,ed))==null||l.call(this),zi(this,ed,void 0))}setEventListener(l){var h;zi(this,wm,l),(h=Vt(this,ed))==null||h.call(this),zi(this,ed,l(this.setOnline.bind(this)))}setOnline(l){Vt(this,xm)!==l&&(zi(this,xm,l),this.listeners.forEach(g=>{g(l)}))}isOnline(){return Vt(this,xm)}},xm=new WeakMap,ed=new WeakMap,wm=new WeakMap,zD),S1=new xH;function wH(){let i,l;const h=new Promise((w,S)=>{i=w,l=S});h.status="pending",h.catch(()=>{});function g(w){Object.assign(h,w),delete h.resolve,delete h.reject}return h.resolve=w=>{g({status:"fulfilled",value:w}),i(w)},h.reject=w=>{g({status:"rejected",reason:w}),l(w)},h}function bH(i){return Math.min(1e3*2**i,3e4)}function DO(i){return(i??"online")==="online"?S1.isOnline():!0}var LO=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function QT(i){return i instanceof LO}function kO(i){let l=!1,h=0,g=!1,w;const S=wH(),R=te=>{var le;g||(J(new LO(te)),(le=i.abort)==null||le.call(i))},o=()=>{l=!0},N=()=>{l=!1},B=()=>RO.isFocused()&&(i.networkMode==="always"||S1.isOnline())&&i.canRun(),q=()=>DO(i.networkMode)&&i.canRun(),Y=te=>{var le;g||(g=!0,(le=i.onSuccess)==null||le.call(i,te),w==null||w(),S.resolve(te))},J=te=>{var le;g||(g=!0,(le=i.onError)==null||le.call(i,te),w==null||w(),S.reject(te))},ie=()=>new Promise(te=>{var le;w=ce=>{(g||B())&&te(ce)},(le=i.onPause)==null||le.call(i)}).then(()=>{var te;w=void 0,g||(te=i.onContinue)==null||te.call(i)}),be=()=>{if(g)return;let te;const le=h===0?i.initialPromise:void 0;try{te=le??i.fn()}catch(ce){te=Promise.reject(ce)}Promise.resolve(te).then(Y).catch(ce=>{var je;if(g)return;const oe=i.retry??(ow?0:3),ue=i.retryDelay??bH,Me=typeof ue=="function"?ue(h,ce):ue,Ne=oe===!0||typeof oe=="number"&&h<oe||typeof oe=="function"&&oe(h,ce);if(l||!Ne){J(ce);return}h++,(je=i.onFail)==null||je.call(i,h,ce),mH(Me).then(()=>B()?void 0:ie()).then(()=>{l?J(ce):be()})})};return{promise:S,cancel:R,continue:()=>(w==null||w(),S),cancelRetry:o,continueRetry:N,canStart:q,start:()=>(q()?be():ie().then(be),S)}}var TH=i=>setTimeout(i,0);function SH(){let i=[],l=0,h=o=>{o()},g=o=>{o()},w=TH;const S=o=>{l?i.push(o):w(()=>{h(o)})},R=()=>{const o=i;i=[],o.length&&w(()=>{g(()=>{o.forEach(N=>{h(N)})})})};return{batch:o=>{let N;l++;try{N=o()}finally{l--,l||R()}return N},batchCalls:o=>(...N)=>{S(()=>{o(...N)})},schedule:S,setNotifyFunction:o=>{h=o},setBatchNotifyFunction:o=>{g=o},setScheduler:o=>{w=o}}}var Is=SH(),Rh,OD,zO=(OD=class{constructor(){yr(this,Rh)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),hH(this.gcTime)&&zi(this,Rh,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(ow?1/0:5*60*1e3))}clearGcTimeout(){Vt(this,Rh)&&(clearTimeout(Vt(this,Rh)),zi(this,Rh,void 0))}},Rh=new WeakMap,OD),bm,Dh,Ua,Lh,ds,Gy,kh,Il,Wc,FD,EH=(FD=class extends zO{constructor(l){super();yr(this,Il);yr(this,bm);yr(this,Dh);yr(this,Ua);yr(this,Lh);yr(this,ds);yr(this,Gy);yr(this,kh);zi(this,kh,!1),zi(this,Gy,l.defaultOptions),this.setOptions(l.options),this.observers=[],zi(this,Lh,l.client),zi(this,Ua,Vt(this,Lh).getQueryCache()),this.queryKey=l.queryKey,this.queryHash=l.queryHash,zi(this,bm,CH(this.options)),this.state=l.state??Vt(this,bm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var l;return(l=Vt(this,ds))==null?void 0:l.promise}setOptions(l){this.options={...Vt(this,Gy),...l},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Vt(this,Ua).remove(this)}setData(l,h){const g=gH(this.state.data,l,this.options);return ls(this,Il,Wc).call(this,{data:g,type:"success",dataUpdatedAt:h==null?void 0:h.updatedAt,manual:h==null?void 0:h.manual}),g}setState(l,h){ls(this,Il,Wc).call(this,{type:"setState",state:l,setStateOptions:h})}cancel(l){var g,w;const h=(g=Vt(this,ds))==null?void 0:g.promise;return(w=Vt(this,ds))==null||w.cancel(l),h?h.then(El).catch(El):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Vt(this,bm))}isActive(){return this.observers.some(l=>pH(l.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===XE||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(l=>mS(l.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(l=>l.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(l=0){return this.state.data===void 0?!0:l==="static"?!1:this.state.isInvalidated?!0:!fH(this.state.dataUpdatedAt,l)}onFocus(){var h;const l=this.observers.find(g=>g.shouldFetchOnWindowFocus());l==null||l.refetch({cancelRefetch:!1}),(h=Vt(this,ds))==null||h.continue()}onOnline(){var h;const l=this.observers.find(g=>g.shouldFetchOnReconnect());l==null||l.refetch({cancelRefetch:!1}),(h=Vt(this,ds))==null||h.continue()}addObserver(l){this.observers.includes(l)||(this.observers.push(l),this.clearGcTimeout(),Vt(this,Ua).notify({type:"observerAdded",query:this,observer:l}))}removeObserver(l){this.observers.includes(l)&&(this.observers=this.observers.filter(h=>h!==l),this.observers.length||(Vt(this,ds)&&(Vt(this,kh)?Vt(this,ds).cancel({revert:!0}):Vt(this,ds).cancelRetry()),this.scheduleGc()),Vt(this,Ua).notify({type:"observerRemoved",query:this,observer:l}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||ls(this,Il,Wc).call(this,{type:"invalidate"})}fetch(l,h){var B,q,Y;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(h!=null&&h.cancelRefetch))this.cancel({silent:!0});else if(Vt(this,ds))return Vt(this,ds).continueRetry(),Vt(this,ds).promise}if(l&&this.setOptions(l),!this.options.queryFn){const J=this.observers.find(ie=>ie.options.queryFn);J&&this.setOptions(J.options)}const g=new AbortController,w=J=>{Object.defineProperty(J,"signal",{enumerable:!0,get:()=>(zi(this,kh,!0),g.signal)})},S=()=>{const J=MO(this.options,h),be=(()=>{const te={client:Vt(this,Lh),queryKey:this.queryKey,meta:this.meta};return w(te),te})();return zi(this,kh,!1),this.options.persister?this.options.persister(J,be,this):J(be)},o=(()=>{const J={fetchOptions:h,options:this.options,queryKey:this.queryKey,client:Vt(this,Lh),state:this.state,fetchFn:S};return w(J),J})();(B=this.options.behavior)==null||B.onFetch(o,this),zi(this,Dh,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((q=o.fetchOptions)==null?void 0:q.meta))&&ls(this,Il,Wc).call(this,{type:"fetch",meta:(Y=o.fetchOptions)==null?void 0:Y.meta});const N=J=>{var ie,be,te,le;QT(J)&&J.silent||ls(this,Il,Wc).call(this,{type:"error",error:J}),QT(J)||((be=(ie=Vt(this,Ua).config).onError)==null||be.call(ie,J,this),(le=(te=Vt(this,Ua).config).onSettled)==null||le.call(te,this.state.data,J,this)),this.scheduleGc()};return zi(this,ds,kO({initialPromise:h==null?void 0:h.initialPromise,fn:o.fetchFn,abort:g.abort.bind(g),onSuccess:J=>{var ie,be,te,le;if(J===void 0){N(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(J)}catch(ce){N(ce);return}(be=(ie=Vt(this,Ua).config).onSuccess)==null||be.call(ie,J,this),(le=(te=Vt(this,Ua).config).onSettled)==null||le.call(te,J,this.state.error,this),this.scheduleGc()},onError:N,onFail:(J,ie)=>{ls(this,Il,Wc).call(this,{type:"failed",failureCount:J,error:ie})},onPause:()=>{ls(this,Il,Wc).call(this,{type:"pause"})},onContinue:()=>{ls(this,Il,Wc).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),Vt(this,ds).start()}},bm=new WeakMap,Dh=new WeakMap,Ua=new WeakMap,Lh=new WeakMap,ds=new WeakMap,Gy=new WeakMap,kh=new WeakMap,Il=new WeakSet,Wc=function(l){const h=g=>{switch(l.type){case"failed":return{...g,fetchFailureCount:l.failureCount,fetchFailureReason:l.error};case"pause":return{...g,fetchStatus:"paused"};case"continue":return{...g,fetchStatus:"fetching"};case"fetch":return{...g,...IH(g.data,this.options),fetchMeta:l.meta??null};case"success":return zi(this,Dh,void 0),{...g,data:l.data,dataUpdateCount:g.dataUpdateCount+1,dataUpdatedAt:l.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!l.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const w=l.error;return QT(w)&&w.revert&&Vt(this,Dh)?{...Vt(this,Dh),fetchStatus:"idle"}:{...g,error:w,errorUpdateCount:g.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:g.fetchFailureCount+1,fetchFailureReason:w,fetchStatus:"idle",status:"error"};case"invalidate":return{...g,isInvalidated:!0};case"setState":return{...g,...l.state}}};this.state=h(this.state),Is.batch(()=>{this.observers.forEach(g=>{g.onQueryUpdate()}),Vt(this,Ua).notify({query:this,type:"updated",action:l})})},FD);function IH(i,l){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:DO(l.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function CH(i){const l=typeof i.initialData=="function"?i.initialData():i.initialData,h=l!==void 0,g=h?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:l,dataUpdateCount:0,dataUpdatedAt:h?g??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:h?"success":"pending",fetchStatus:"idle"}}var ac,ND,AH=(ND=class extends rw{constructor(l={}){super();yr(this,ac);this.config=l,zi(this,ac,new Map)}build(l,h,g){const w=h.queryKey,S=h.queryHash??ZE(w,h);let R=this.get(S);return R||(R=new EH({client:l,queryKey:w,queryHash:S,options:l.defaultQueryOptions(h),state:g,defaultOptions:l.getQueryDefaults(w)}),this.add(R)),R}add(l){Vt(this,ac).has(l.queryHash)||(Vt(this,ac).set(l.queryHash,l),this.notify({type:"added",query:l}))}remove(l){const h=Vt(this,ac).get(l.queryHash);h&&(l.destroy(),h===l&&Vt(this,ac).delete(l.queryHash),this.notify({type:"removed",query:l}))}clear(){Is.batch(()=>{this.getAll().forEach(l=>{this.remove(l)})})}get(l){return Vt(this,ac).get(l)}getAll(){return[...Vt(this,ac).values()]}find(l){const h={exact:!0,...l};return this.getAll().find(g=>XR(h,g))}findAll(l={}){const h=this.getAll();return Object.keys(l).length>0?h.filter(g=>XR(l,g)):h}notify(l){Is.batch(()=>{this.listeners.forEach(h=>{h(l)})})}onFocus(){Is.batch(()=>{this.getAll().forEach(l=>{l.onFocus()})})}onOnline(){Is.batch(()=>{this.getAll().forEach(l=>{l.onOnline()})})}},ac=new WeakMap,ND),lc,Ss,zh,cc,qu,BD,PH=(BD=class extends zO{constructor(l){super();yr(this,cc);yr(this,lc);yr(this,Ss);yr(this,zh);this.mutationId=l.mutationId,zi(this,Ss,l.mutationCache),zi(this,lc,[]),this.state=l.state||MH(),this.setOptions(l.options),this.scheduleGc()}setOptions(l){this.options=l,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(l){Vt(this,lc).includes(l)||(Vt(this,lc).push(l),this.clearGcTimeout(),Vt(this,Ss).notify({type:"observerAdded",mutation:this,observer:l}))}removeObserver(l){zi(this,lc,Vt(this,lc).filter(h=>h!==l)),this.scheduleGc(),Vt(this,Ss).notify({type:"observerRemoved",mutation:this,observer:l})}optionalRemove(){Vt(this,lc).length||(this.state.status==="pending"?this.scheduleGc():Vt(this,Ss).remove(this))}continue(){var l;return((l=Vt(this,zh))==null?void 0:l.continue())??this.execute(this.state.variables)}async execute(l){var S,R,o,N,B,q,Y,J,ie,be,te,le,ce,oe,ue,Me,Ne,je,Te,Ve;const h=()=>{ls(this,cc,qu).call(this,{type:"continue"})};zi(this,zh,kO({fn:()=>this.options.mutationFn?this.options.mutationFn(l):Promise.reject(new Error("No mutationFn found")),onFail:(nt,At)=>{ls(this,cc,qu).call(this,{type:"failed",failureCount:nt,error:At})},onPause:()=>{ls(this,cc,qu).call(this,{type:"pause"})},onContinue:h,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Vt(this,Ss).canRun(this)}));const g=this.state.status==="pending",w=!Vt(this,zh).canStart();try{if(g)h();else{ls(this,cc,qu).call(this,{type:"pending",variables:l,isPaused:w}),await((R=(S=Vt(this,Ss).config).onMutate)==null?void 0:R.call(S,l,this));const At=await((N=(o=this.options).onMutate)==null?void 0:N.call(o,l));At!==this.state.context&&ls(this,cc,qu).call(this,{type:"pending",context:At,variables:l,isPaused:w})}const nt=await Vt(this,zh).start();return await((q=(B=Vt(this,Ss).config).onSuccess)==null?void 0:q.call(B,nt,l,this.state.context,this)),await((J=(Y=this.options).onSuccess)==null?void 0:J.call(Y,nt,l,this.state.context)),await((be=(ie=Vt(this,Ss).config).onSettled)==null?void 0:be.call(ie,nt,null,this.state.variables,this.state.context,this)),await((le=(te=this.options).onSettled)==null?void 0:le.call(te,nt,null,l,this.state.context)),ls(this,cc,qu).call(this,{type:"success",data:nt}),nt}catch(nt){try{throw await((oe=(ce=Vt(this,Ss).config).onError)==null?void 0:oe.call(ce,nt,l,this.state.context,this)),await((Me=(ue=this.options).onError)==null?void 0:Me.call(ue,nt,l,this.state.context)),await((je=(Ne=Vt(this,Ss).config).onSettled)==null?void 0:je.call(Ne,void 0,nt,this.state.variables,this.state.context,this)),await((Ve=(Te=this.options).onSettled)==null?void 0:Ve.call(Te,void 0,nt,l,this.state.context)),nt}finally{ls(this,cc,qu).call(this,{type:"error",error:nt})}}finally{Vt(this,Ss).runNext(this)}}},lc=new WeakMap,Ss=new WeakMap,zh=new WeakMap,cc=new WeakSet,qu=function(l){const h=g=>{switch(l.type){case"failed":return{...g,failureCount:l.failureCount,failureReason:l.error};case"pause":return{...g,isPaused:!0};case"continue":return{...g,isPaused:!1};case"pending":return{...g,context:l.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:l.isPaused,status:"pending",variables:l.variables,submittedAt:Date.now()};case"success":return{...g,data:l.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...g,data:void 0,error:l.error,failureCount:g.failureCount+1,failureReason:l.error,isPaused:!1,status:"error"}}};this.state=h(this.state),Is.batch(()=>{Vt(this,lc).forEach(g=>{g.onMutationUpdate(l)}),Vt(this,Ss).notify({mutation:this,type:"updated",action:l})})},BD);function MH(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Yc,Cl,Hy,jD,RH=(jD=class extends rw{constructor(l={}){super();yr(this,Yc);yr(this,Cl);yr(this,Hy);this.config=l,zi(this,Yc,new Set),zi(this,Cl,new Map),zi(this,Hy,0)}build(l,h,g){const w=new PH({mutationCache:this,mutationId:++nx(this,Hy)._,options:l.defaultMutationOptions(h),state:g});return this.add(w),w}add(l){Vt(this,Yc).add(l);const h=Sx(l);if(typeof h=="string"){const g=Vt(this,Cl).get(h);g?g.push(l):Vt(this,Cl).set(h,[l])}this.notify({type:"added",mutation:l})}remove(l){if(Vt(this,Yc).delete(l)){const h=Sx(l);if(typeof h=="string"){const g=Vt(this,Cl).get(h);if(g)if(g.length>1){const w=g.indexOf(l);w!==-1&&g.splice(w,1)}else g[0]===l&&Vt(this,Cl).delete(h)}}this.notify({type:"removed",mutation:l})}canRun(l){const h=Sx(l);if(typeof h=="string"){const g=Vt(this,Cl).get(h),w=g==null?void 0:g.find(S=>S.state.status==="pending");return!w||w===l}else return!0}runNext(l){var g;const h=Sx(l);if(typeof h=="string"){const w=(g=Vt(this,Cl).get(h))==null?void 0:g.find(S=>S!==l&&S.state.isPaused);return(w==null?void 0:w.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Is.batch(()=>{Vt(this,Yc).forEach(l=>{this.notify({type:"removed",mutation:l})}),Vt(this,Yc).clear(),Vt(this,Cl).clear()})}getAll(){return Array.from(Vt(this,Yc))}find(l){const h={exact:!0,...l};return this.getAll().find(g=>YR(h,g))}findAll(l={}){return this.getAll().filter(h=>YR(l,h))}notify(l){Is.batch(()=>{this.listeners.forEach(h=>{h(l)})})}resumePausedMutations(){const l=this.getAll().filter(h=>h.state.isPaused);return Is.batch(()=>Promise.all(l.map(h=>h.continue().catch(El))))}},Yc=new WeakMap,Cl=new WeakMap,Hy=new WeakMap,jD);function Sx(i){var l;return(l=i.options.scope)==null?void 0:l.id}function JR(i){return{onFetch:(l,h)=>{var q,Y,J,ie,be;const g=l.options,w=(J=(Y=(q=l.fetchOptions)==null?void 0:q.meta)==null?void 0:Y.fetchMore)==null?void 0:J.direction,S=((ie=l.state.data)==null?void 0:ie.pages)||[],R=((be=l.state.data)==null?void 0:be.pageParams)||[];let o={pages:[],pageParams:[]},N=0;const B=async()=>{let te=!1;const le=ue=>{Object.defineProperty(ue,"signal",{enumerable:!0,get:()=>(l.signal.aborted?te=!0:l.signal.addEventListener("abort",()=>{te=!0}),l.signal)})},ce=MO(l.options,l.fetchOptions),oe=async(ue,Me,Ne)=>{if(te)return Promise.reject();if(Me==null&&ue.pages.length)return Promise.resolve(ue);const Te=(()=>{const cn={client:l.client,queryKey:l.queryKey,pageParam:Me,direction:Ne?"backward":"forward",meta:l.options.meta};return le(cn),cn})(),Ve=await ce(Te),{maxPages:nt}=l.options,At=Ne?yH:_H;return{pages:At(ue.pages,Ve,nt),pageParams:At(ue.pageParams,Me,nt)}};if(w&&S.length){const ue=w==="backward",Me=ue?DH:eD,Ne={pages:S,pageParams:R},je=Me(g,Ne);o=await oe(Ne,je,ue)}else{const ue=i??S.length;do{const Me=N===0?R[0]??g.initialPageParam:eD(g,o);if(N>0&&Me==null)break;o=await oe(o,Me),N++}while(N<ue)}return o};l.options.persister?l.fetchFn=()=>{var te,le;return(le=(te=l.options).persister)==null?void 0:le.call(te,B,{client:l.client,queryKey:l.queryKey,meta:l.options.meta,signal:l.signal},h)}:l.fetchFn=B}}}function eD(i,{pages:l,pageParams:h}){const g=l.length-1;return l.length>0?i.getNextPageParam(l[g],l,h[g],h):void 0}function DH(i,{pages:l,pageParams:h}){var g;return l.length>0?(g=i.getPreviousPageParam)==null?void 0:g.call(i,l[0],l,h[0],h):void 0}var ao,td,nd,Tm,Sm,id,Em,Im,UD,LH=(UD=class{constructor(i={}){yr(this,ao);yr(this,td);yr(this,nd);yr(this,Tm);yr(this,Sm);yr(this,id);yr(this,Em);yr(this,Im);zi(this,ao,i.queryCache||new AH),zi(this,td,i.mutationCache||new RH),zi(this,nd,i.defaultOptions||{}),zi(this,Tm,new Map),zi(this,Sm,new Map),zi(this,id,0)}mount(){nx(this,id)._++,Vt(this,id)===1&&(zi(this,Em,RO.subscribe(async i=>{i&&(await this.resumePausedMutations(),Vt(this,ao).onFocus())})),zi(this,Im,S1.subscribe(async i=>{i&&(await this.resumePausedMutations(),Vt(this,ao).onOnline())})))}unmount(){var i,l;nx(this,id)._--,Vt(this,id)===0&&((i=Vt(this,Em))==null||i.call(this),zi(this,Em,void 0),(l=Vt(this,Im))==null||l.call(this),zi(this,Im,void 0))}isFetching(i){return Vt(this,ao).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return Vt(this,td).findAll({...i,status:"pending"}).length}getQueryData(i){var h;const l=this.defaultQueryOptions({queryKey:i});return(h=Vt(this,ao).get(l.queryHash))==null?void 0:h.state.data}ensureQueryData(i){const l=this.defaultQueryOptions(i),h=Vt(this,ao).build(this,l),g=h.state.data;return g===void 0?this.fetchQuery(i):(i.revalidateIfStale&&h.isStaleByTime(mS(l.staleTime,h))&&this.prefetchQuery(l),Promise.resolve(g))}getQueriesData(i){return Vt(this,ao).findAll(i).map(({queryKey:l,state:h})=>{const g=h.data;return[l,g]})}setQueryData(i,l,h){const g=this.defaultQueryOptions({queryKey:i}),w=Vt(this,ao).get(g.queryHash),S=w==null?void 0:w.state.data,R=dH(l,S);if(R!==void 0)return Vt(this,ao).build(this,g).setData(R,{...h,manual:!0})}setQueriesData(i,l,h){return Is.batch(()=>Vt(this,ao).findAll(i).map(({queryKey:g})=>[g,this.setQueryData(g,l,h)]))}getQueryState(i){var h;const l=this.defaultQueryOptions({queryKey:i});return(h=Vt(this,ao).get(l.queryHash))==null?void 0:h.state}removeQueries(i){const l=Vt(this,ao);Is.batch(()=>{l.findAll(i).forEach(h=>{l.remove(h)})})}resetQueries(i,l){const h=Vt(this,ao);return Is.batch(()=>(h.findAll(i).forEach(g=>{g.reset()}),this.refetchQueries({type:"active",...i},l)))}cancelQueries(i,l={}){const h={revert:!0,...l},g=Is.batch(()=>Vt(this,ao).findAll(i).map(w=>w.cancel(h)));return Promise.all(g).then(El).catch(El)}invalidateQueries(i,l={}){return Is.batch(()=>(Vt(this,ao).findAll(i).forEach(h=>{h.invalidate()}),(i==null?void 0:i.refetchType)==="none"?Promise.resolve():this.refetchQueries({...i,type:(i==null?void 0:i.refetchType)??(i==null?void 0:i.type)??"active"},l)))}refetchQueries(i,l={}){const h={...l,cancelRefetch:l.cancelRefetch??!0},g=Is.batch(()=>Vt(this,ao).findAll(i).filter(w=>!w.isDisabled()&&!w.isStatic()).map(w=>{let S=w.fetch(void 0,h);return h.throwOnError||(S=S.catch(El)),w.state.fetchStatus==="paused"?Promise.resolve():S}));return Promise.all(g).then(El)}fetchQuery(i){const l=this.defaultQueryOptions(i);l.retry===void 0&&(l.retry=!1);const h=Vt(this,ao).build(this,l);return h.isStaleByTime(mS(l.staleTime,h))?h.fetch(l):Promise.resolve(h.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(El).catch(El)}fetchInfiniteQuery(i){return i.behavior=JR(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(El).catch(El)}ensureInfiniteQueryData(i){return i.behavior=JR(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return S1.isOnline()?Vt(this,td).resumePausedMutations():Promise.resolve()}getQueryCache(){return Vt(this,ao)}getMutationCache(){return Vt(this,td)}getDefaultOptions(){return Vt(this,nd)}setDefaultOptions(i){zi(this,nd,i)}setQueryDefaults(i,l){Vt(this,Tm).set(Ny(i),{queryKey:i,defaultOptions:l})}getQueryDefaults(i){const l=[...Vt(this,Tm).values()],h={};return l.forEach(g=>{By(i,g.queryKey)&&Object.assign(h,g.defaultOptions)}),h}setMutationDefaults(i,l){Vt(this,Sm).set(Ny(i),{mutationKey:i,defaultOptions:l})}getMutationDefaults(i){const l=[...Vt(this,Sm).values()],h={};return l.forEach(g=>{By(i,g.mutationKey)&&Object.assign(h,g.defaultOptions)}),h}defaultQueryOptions(i){if(i._defaulted)return i;const l={...Vt(this,nd).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return l.queryHash||(l.queryHash=ZE(l.queryKey,l)),l.refetchOnReconnect===void 0&&(l.refetchOnReconnect=l.networkMode!=="always"),l.throwOnError===void 0&&(l.throwOnError=!!l.suspense),!l.networkMode&&l.persister&&(l.networkMode="offlineFirst"),l.queryFn===XE&&(l.enabled=!1),l}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...Vt(this,nd).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){Vt(this,ao).clear(),Vt(this,td).clear()}},ao=new WeakMap,td=new WeakMap,nd=new WeakMap,Tm=new WeakMap,Sm=new WeakMap,id=new WeakMap,Em=new WeakMap,Im=new WeakMap,UD),kH=G.createContext(void 0),zH=({client:i,children:l})=>(G.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),L.jsx(kH.Provider,{value:i,children:l}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jy(){return jy=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&(i[g]=h[g])}return i},jy.apply(this,arguments)}var sd;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(sd||(sd={}));const tD="popstate";function OH(i){i===void 0&&(i={});function l(g,w){let{pathname:S,search:R,hash:o}=g.location;return _S("",{pathname:S,search:R,hash:o},w.state&&w.state.usr||null,w.state&&w.state.key||"default")}function h(g,w){return typeof w=="string"?w:E1(w)}return NH(l,h,null,i)}function Mo(i,l){if(i===!1||i===null||typeof i>"u")throw new Error(l)}function OO(i,l){if(!i){typeof console<"u"&&console.warn(l);try{throw new Error(l)}catch{}}}function FH(){return Math.random().toString(36).substr(2,8)}function nD(i,l){return{usr:i.state,key:i.key,idx:l}}function _S(i,l,h,g){return h===void 0&&(h=null),jy({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof l=="string"?Wm(l):l,{state:h,key:l&&l.key||g||FH()})}function E1(i){let{pathname:l="/",search:h="",hash:g=""}=i;return h&&h!=="?"&&(l+=h.charAt(0)==="?"?h:"?"+h),g&&g!=="#"&&(l+=g.charAt(0)==="#"?g:"#"+g),l}function Wm(i){let l={};if(i){let h=i.indexOf("#");h>=0&&(l.hash=i.substr(h),i=i.substr(0,h));let g=i.indexOf("?");g>=0&&(l.search=i.substr(g),i=i.substr(0,g)),i&&(l.pathname=i)}return l}function NH(i,l,h,g){g===void 0&&(g={});let{window:w=document.defaultView,v5Compat:S=!1}=g,R=w.history,o=sd.Pop,N=null,B=q();B==null&&(B=0,R.replaceState(jy({},R.state,{idx:B}),""));function q(){return(R.state||{idx:null}).idx}function Y(){o=sd.Pop;let le=q(),ce=le==null?null:le-B;B=le,N&&N({action:o,location:te.location,delta:ce})}function J(le,ce){o=sd.Push;let oe=_S(te.location,le,ce);B=q()+1;let ue=nD(oe,B),Me=te.createHref(oe);try{R.pushState(ue,"",Me)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;w.location.assign(Me)}S&&N&&N({action:o,location:te.location,delta:1})}function ie(le,ce){o=sd.Replace;let oe=_S(te.location,le,ce);B=q();let ue=nD(oe,B),Me=te.createHref(oe);R.replaceState(ue,"",Me),S&&N&&N({action:o,location:te.location,delta:0})}function be(le){let ce=w.location.origin!=="null"?w.location.origin:w.location.href,oe=typeof le=="string"?le:E1(le);return oe=oe.replace(/ $/,"%20"),Mo(ce,"No window.location.(origin|href) available to create URL for href: "+oe),new URL(oe,ce)}let te={get action(){return o},get location(){return i(w,R)},listen(le){if(N)throw new Error("A history only accepts one active listener");return w.addEventListener(tD,Y),N=le,()=>{w.removeEventListener(tD,Y),N=null}},createHref(le){return l(w,le)},createURL:be,encodeLocation(le){let ce=be(le);return{pathname:ce.pathname,search:ce.search,hash:ce.hash}},push:J,replace:ie,go(le){return R.go(le)}};return te}var iD;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(iD||(iD={}));function BH(i,l,h){return h===void 0&&(h="/"),jH(i,l,h,!1)}function jH(i,l,h,g){let w=typeof l=="string"?Wm(l):l,S=YE(w.pathname||"/",h);if(S==null)return null;let R=FO(i);UH(R);let o=null;for(let N=0;o==null&&N<R.length;++N){let B=QH(S);o=YH(R[N],B,g)}return o}function FO(i,l,h,g){l===void 0&&(l=[]),h===void 0&&(h=[]),g===void 0&&(g="");let w=(S,R,o)=>{let N={relativePath:o===void 0?S.path||"":o,caseSensitive:S.caseSensitive===!0,childrenIndex:R,route:S};N.relativePath.startsWith("/")&&(Mo(N.relativePath.startsWith(g),'Absolute route path "'+N.relativePath+'" nested under path '+('"'+g+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),N.relativePath=N.relativePath.slice(g.length));let B=md([g,N.relativePath]),q=h.concat(N);S.children&&S.children.length>0&&(Mo(S.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+B+'".')),FO(S.children,l,q,B)),!(S.path==null&&!S.index)&&l.push({path:B,score:ZH(B,S.index),routesMeta:q})};return i.forEach((S,R)=>{var o;if(S.path===""||!((o=S.path)!=null&&o.includes("?")))w(S,R);else for(let N of NO(S.path))w(S,R,N)}),l}function NO(i){let l=i.split("/");if(l.length===0)return[];let[h,...g]=l,w=h.endsWith("?"),S=h.replace(/\?$/,"");if(g.length===0)return w?[S,""]:[S];let R=NO(g.join("/")),o=[];return o.push(...R.map(N=>N===""?S:[S,N].join("/"))),w&&o.push(...R),o.map(N=>i.startsWith("/")&&N===""?"/":N)}function UH(i){i.sort((l,h)=>l.score!==h.score?h.score-l.score:XH(l.routesMeta.map(g=>g.childrenIndex),h.routesMeta.map(g=>g.childrenIndex)))}const VH=/^:[\w-]+$/,$H=3,GH=2,HH=1,WH=10,qH=-2,rD=i=>i==="*";function ZH(i,l){let h=i.split("/"),g=h.length;return h.some(rD)&&(g+=qH),l&&(g+=GH),h.filter(w=>!rD(w)).reduce((w,S)=>w+(VH.test(S)?$H:S===""?HH:WH),g)}function XH(i,l){return i.length===l.length&&i.slice(0,-1).every((g,w)=>g===l[w])?i[i.length-1]-l[l.length-1]:0}function YH(i,l,h){let{routesMeta:g}=i,w={},S="/",R=[];for(let o=0;o<g.length;++o){let N=g[o],B=o===g.length-1,q=S==="/"?l:l.slice(S.length)||"/",Y=oD({path:N.relativePath,caseSensitive:N.caseSensitive,end:B},q),J=N.route;if(!Y&&B&&h&&!g[g.length-1].route.index&&(Y=oD({path:N.relativePath,caseSensitive:N.caseSensitive,end:!1},q)),!Y)return null;Object.assign(w,Y.params),R.push({params:w,pathname:md([S,Y.pathname]),pathnameBase:nW(md([S,Y.pathnameBase])),route:J}),Y.pathnameBase!=="/"&&(S=md([S,Y.pathnameBase]))}return R}function oD(i,l){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[h,g]=KH(i.path,i.caseSensitive,i.end),w=l.match(h);if(!w)return null;let S=w[0],R=S.replace(/(.)\/+$/,"$1"),o=w.slice(1);return{params:g.reduce((B,q,Y)=>{let{paramName:J,isOptional:ie}=q;if(J==="*"){let te=o[Y]||"";R=S.slice(0,S.length-te.length).replace(/(.)\/+$/,"$1")}const be=o[Y];return ie&&!be?B[J]=void 0:B[J]=(be||"").replace(/%2F/g,"/"),B},{}),pathname:S,pathnameBase:R,pattern:i}}function KH(i,l,h){l===void 0&&(l=!1),h===void 0&&(h=!0),OO(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let g=[],w="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(R,o,N)=>(g.push({paramName:o,isOptional:N!=null}),N?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(g.push({paramName:"*"}),w+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):h?w+="\\/*$":i!==""&&i!=="/"&&(w+="(?:(?=\\/|$))"),[new RegExp(w,l?void 0:"i"),g]}function QH(i){try{return i.split("/").map(l=>decodeURIComponent(l).replace(/\//g,"%2F")).join("/")}catch(l){return OO(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+l+").")),i}}function YE(i,l){if(l==="/")return i;if(!i.toLowerCase().startsWith(l.toLowerCase()))return null;let h=l.endsWith("/")?l.length-1:l.length,g=i.charAt(h);return g&&g!=="/"?null:i.slice(h)||"/"}function JH(i,l){l===void 0&&(l="/");let{pathname:h,search:g="",hash:w=""}=typeof i=="string"?Wm(i):i;return{pathname:h?h.startsWith("/")?h:eW(h,l):l,search:iW(g),hash:rW(w)}}function eW(i,l){let h=l.replace(/\/+$/,"").split("/");return i.split("/").forEach(w=>{w===".."?h.length>1&&h.pop():w!=="."&&h.push(w)}),h.length>1?h.join("/"):"/"}function JT(i,l,h,g){return"Cannot include a '"+i+"' character in a manually specified "+("`to."+l+"` field ["+JSON.stringify(g)+"].  Please separate it out to the ")+("`to."+h+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function tW(i){return i.filter((l,h)=>h===0||l.route.path&&l.route.path.length>0)}function BO(i,l){let h=tW(i);return l?h.map((g,w)=>w===h.length-1?g.pathname:g.pathnameBase):h.map(g=>g.pathnameBase)}function jO(i,l,h,g){g===void 0&&(g=!1);let w;typeof i=="string"?w=Wm(i):(w=jy({},i),Mo(!w.pathname||!w.pathname.includes("?"),JT("?","pathname","search",w)),Mo(!w.pathname||!w.pathname.includes("#"),JT("#","pathname","hash",w)),Mo(!w.search||!w.search.includes("#"),JT("#","search","hash",w)));let S=i===""||w.pathname==="",R=S?"/":w.pathname,o;if(R==null)o=h;else{let Y=l.length-1;if(!g&&R.startsWith("..")){let J=R.split("/");for(;J[0]==="..";)J.shift(),Y-=1;w.pathname=J.join("/")}o=Y>=0?l[Y]:"/"}let N=JH(w,o),B=R&&R!=="/"&&R.endsWith("/"),q=(S||R===".")&&h.endsWith("/");return!N.pathname.endsWith("/")&&(B||q)&&(N.pathname+="/"),N}const md=i=>i.join("/").replace(/\/\/+/g,"/"),nW=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),iW=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,rW=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function oW(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const UO=["post","put","patch","delete"];new Set(UO);const sW=["get",...UO];new Set(sW);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Uy(){return Uy=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&(i[g]=h[g])}return i},Uy.apply(this,arguments)}const KE=G.createContext(null),aW=G.createContext(null),rf=G.createContext(null),sw=G.createContext(null),Sd=G.createContext({outlet:null,matches:[],isDataRoute:!1}),VO=G.createContext(null);function lW(i,l){let{relative:h}=l===void 0?{}:l;tv()||Mo(!1);let{basename:g,navigator:w}=G.useContext(rf),{hash:S,pathname:R,search:o}=HO(i,{relative:h}),N=R;return g!=="/"&&(N=R==="/"?g:md([g,R])),w.createHref({pathname:N,search:o,hash:S})}function tv(){return G.useContext(sw)!=null}function qm(){return tv()||Mo(!1),G.useContext(sw).location}function $O(i){G.useContext(rf).static||G.useLayoutEffect(i)}function Zm(){let{isDataRoute:i}=G.useContext(Sd);return i?wW():cW()}function cW(){tv()||Mo(!1);let i=G.useContext(KE),{basename:l,future:h,navigator:g}=G.useContext(rf),{matches:w}=G.useContext(Sd),{pathname:S}=qm(),R=JSON.stringify(BO(w,h.v7_relativeSplatPath)),o=G.useRef(!1);return $O(()=>{o.current=!0}),G.useCallback(function(B,q){if(q===void 0&&(q={}),!o.current)return;if(typeof B=="number"){g.go(B);return}let Y=jO(B,JSON.parse(R),S,q.relative==="path");i==null&&l!=="/"&&(Y.pathname=Y.pathname==="/"?l:md([l,Y.pathname])),(q.replace?g.replace:g.push)(Y,q.state,q)},[l,g,R,S,i])}function GO(){let{matches:i}=G.useContext(Sd),l=i[i.length-1];return l?l.params:{}}function HO(i,l){let{relative:h}=l===void 0?{}:l,{future:g}=G.useContext(rf),{matches:w}=G.useContext(Sd),{pathname:S}=qm(),R=JSON.stringify(BO(w,g.v7_relativeSplatPath));return G.useMemo(()=>jO(i,JSON.parse(R),S,h==="path"),[i,R,S,h])}function uW(i,l){return dW(i,l)}function dW(i,l,h,g){tv()||Mo(!1);let{navigator:w}=G.useContext(rf),{matches:S}=G.useContext(Sd),R=S[S.length-1],o=R?R.params:{};R&&R.pathname;let N=R?R.pathnameBase:"/";R&&R.route;let B=qm(),q;if(l){var Y;let le=typeof l=="string"?Wm(l):l;N==="/"||(Y=le.pathname)!=null&&Y.startsWith(N)||Mo(!1),q=le}else q=B;let J=q.pathname||"/",ie=J;if(N!=="/"){let le=N.replace(/^\//,"").split("/");ie="/"+J.replace(/^\//,"").split("/").slice(le.length).join("/")}let be=BH(i,{pathname:ie}),te=gW(be&&be.map(le=>Object.assign({},le,{params:Object.assign({},o,le.params),pathname:md([N,w.encodeLocation?w.encodeLocation(le.pathname).pathname:le.pathname]),pathnameBase:le.pathnameBase==="/"?N:md([N,w.encodeLocation?w.encodeLocation(le.pathnameBase).pathname:le.pathnameBase])})),S,h,g);return l&&te?G.createElement(sw.Provider,{value:{location:Uy({pathname:"/",search:"",hash:"",state:null,key:"default"},q),navigationType:sd.Pop}},te):te}function hW(){let i=xW(),l=oW(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),h=i instanceof Error?i.stack:null,w={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return G.createElement(G.Fragment,null,G.createElement("h2",null,"Unexpected Application Error!"),G.createElement("h3",{style:{fontStyle:"italic"}},l),h?G.createElement("pre",{style:w},h):null,null)}const fW=G.createElement(hW,null);class pW extends G.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,h){return h.location!==l.location||h.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:h.error,location:h.location,revalidation:l.revalidation||h.revalidation}}componentDidCatch(l,h){console.error("React Router caught the following error during render",l,h)}render(){return this.state.error!==void 0?G.createElement(Sd.Provider,{value:this.props.routeContext},G.createElement(VO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function mW(i){let{routeContext:l,match:h,children:g}=i,w=G.useContext(KE);return w&&w.static&&w.staticContext&&(h.route.errorElement||h.route.ErrorBoundary)&&(w.staticContext._deepestRenderedBoundaryId=h.route.id),G.createElement(Sd.Provider,{value:l},g)}function gW(i,l,h,g){var w;if(l===void 0&&(l=[]),h===void 0&&(h=null),g===void 0&&(g=null),i==null){var S;if(!h)return null;if(h.errors)i=h.matches;else if((S=g)!=null&&S.v7_partialHydration&&l.length===0&&!h.initialized&&h.matches.length>0)i=h.matches;else return null}let R=i,o=(w=h)==null?void 0:w.errors;if(o!=null){let q=R.findIndex(Y=>Y.route.id&&(o==null?void 0:o[Y.route.id])!==void 0);q>=0||Mo(!1),R=R.slice(0,Math.min(R.length,q+1))}let N=!1,B=-1;if(h&&g&&g.v7_partialHydration)for(let q=0;q<R.length;q++){let Y=R[q];if((Y.route.HydrateFallback||Y.route.hydrateFallbackElement)&&(B=q),Y.route.id){let{loaderData:J,errors:ie}=h,be=Y.route.loader&&J[Y.route.id]===void 0&&(!ie||ie[Y.route.id]===void 0);if(Y.route.lazy||be){N=!0,B>=0?R=R.slice(0,B+1):R=[R[0]];break}}}return R.reduceRight((q,Y,J)=>{let ie,be=!1,te=null,le=null;h&&(ie=o&&Y.route.id?o[Y.route.id]:void 0,te=Y.route.errorElement||fW,N&&(B<0&&J===0?(be=!0,le=null):B===J&&(be=!0,le=Y.route.hydrateFallbackElement||null)));let ce=l.concat(R.slice(0,J+1)),oe=()=>{let ue;return ie?ue=te:be?ue=le:Y.route.Component?ue=G.createElement(Y.route.Component,null):Y.route.element?ue=Y.route.element:ue=q,G.createElement(mW,{match:Y,routeContext:{outlet:q,matches:ce,isDataRoute:h!=null},children:ue})};return h&&(Y.route.ErrorBoundary||Y.route.errorElement||J===0)?G.createElement(pW,{location:h.location,revalidation:h.revalidation,component:te,error:ie,children:oe(),routeContext:{outlet:null,matches:ce,isDataRoute:!0}}):oe()},null)}var WO=function(i){return i.UseBlocker="useBlocker",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i}(WO||{}),I1=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(I1||{});function _W(i){let l=G.useContext(KE);return l||Mo(!1),l}function yW(i){let l=G.useContext(aW);return l||Mo(!1),l}function vW(i){let l=G.useContext(Sd);return l||Mo(!1),l}function qO(i){let l=vW(),h=l.matches[l.matches.length-1];return h.route.id||Mo(!1),h.route.id}function xW(){var i;let l=G.useContext(VO),h=yW(I1.UseRouteError),g=qO(I1.UseRouteError);return l!==void 0?l:(i=h.errors)==null?void 0:i[g]}function wW(){let{router:i}=_W(WO.UseNavigateStable),l=qO(I1.UseNavigateStable),h=G.useRef(!1);return $O(()=>{h.current=!0}),G.useCallback(function(w,S){S===void 0&&(S={}),h.current&&(typeof w=="number"?i.navigate(w):i.navigate(w,Uy({fromRouteId:l},S)))},[i,l])}function bW(i,l){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function qc(i){Mo(!1)}function TW(i){let{basename:l="/",children:h=null,location:g,navigationType:w=sd.Pop,navigator:S,static:R=!1,future:o}=i;tv()&&Mo(!1);let N=l.replace(/^\/*/,"/"),B=G.useMemo(()=>({basename:N,navigator:S,static:R,future:Uy({v7_relativeSplatPath:!1},o)}),[N,o,S,R]);typeof g=="string"&&(g=Wm(g));let{pathname:q="/",search:Y="",hash:J="",state:ie=null,key:be="default"}=g,te=G.useMemo(()=>{let le=YE(q,N);return le==null?null:{location:{pathname:le,search:Y,hash:J,state:ie,key:be},navigationType:w}},[N,q,Y,J,ie,be,w]);return te==null?null:G.createElement(rf.Provider,{value:B},G.createElement(sw.Provider,{children:h,value:te}))}function SW(i){let{children:l,location:h}=i;return uW(yS(l),h)}new Promise(()=>{});function yS(i,l){l===void 0&&(l=[]);let h=[];return G.Children.forEach(i,(g,w)=>{if(!G.isValidElement(g))return;let S=[...l,w];if(g.type===G.Fragment){h.push.apply(h,yS(g.props.children,S));return}g.type!==qc&&Mo(!1),!g.props.index||!g.props.children||Mo(!1);let R={id:g.props.id||S.join("-"),caseSensitive:g.props.caseSensitive,element:g.props.element,Component:g.props.Component,index:g.props.index,path:g.props.path,loader:g.props.loader,action:g.props.action,errorElement:g.props.errorElement,ErrorBoundary:g.props.ErrorBoundary,hasErrorBoundary:g.props.ErrorBoundary!=null||g.props.errorElement!=null,shouldRevalidate:g.props.shouldRevalidate,handle:g.props.handle,lazy:g.props.lazy};g.props.children&&(R.children=yS(g.props.children,S)),h.push(R)}),h}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vS(){return vS=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var h=arguments[l];for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&(i[g]=h[g])}return i},vS.apply(this,arguments)}function EW(i,l){if(i==null)return{};var h={},g=Object.keys(i),w,S;for(S=0;S<g.length;S++)w=g[S],!(l.indexOf(w)>=0)&&(h[w]=i[w]);return h}function IW(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function CW(i,l){return i.button===0&&(!l||l==="_self")&&!IW(i)}const AW=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],PW="6";try{window.__reactRouterVersion=PW}catch{}const MW="startTransition",sD=OS[MW];function RW(i){let{basename:l,children:h,future:g,window:w}=i,S=G.useRef();S.current==null&&(S.current=OH({window:w,v5Compat:!0}));let R=S.current,[o,N]=G.useState({action:R.action,location:R.location}),{v7_startTransition:B}=g||{},q=G.useCallback(Y=>{B&&sD?sD(()=>N(Y)):N(Y)},[N,B]);return G.useLayoutEffect(()=>R.listen(q),[R,q]),G.useEffect(()=>bW(g),[g]),G.createElement(TW,{basename:l,children:h,location:o.location,navigationType:o.action,navigator:R,future:g})}const DW=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",LW=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ih=G.forwardRef(function(l,h){let{onClick:g,relative:w,reloadDocument:S,replace:R,state:o,target:N,to:B,preventScrollReset:q,viewTransition:Y}=l,J=EW(l,AW),{basename:ie}=G.useContext(rf),be,te=!1;if(typeof B=="string"&&LW.test(B)&&(be=B,DW))try{let ue=new URL(window.location.href),Me=B.startsWith("//")?new URL(ue.protocol+B):new URL(B),Ne=YE(Me.pathname,ie);Me.origin===ue.origin&&Ne!=null?B=Ne+Me.search+Me.hash:te=!0}catch{}let le=lW(B,{relative:w}),ce=kW(B,{replace:R,state:o,target:N,preventScrollReset:q,relative:w,viewTransition:Y});function oe(ue){g&&g(ue),ue.defaultPrevented||ce(ue)}return G.createElement("a",vS({},J,{href:be||le,onClick:te||S?g:oe,ref:h,target:N}))});var aD;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(aD||(aD={}));var lD;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(lD||(lD={}));function kW(i,l){let{target:h,replace:g,state:w,preventScrollReset:S,relative:R,viewTransition:o}=l===void 0?{}:l,N=Zm(),B=qm(),q=HO(i,{relative:R});return G.useCallback(Y=>{if(CW(Y,h)){Y.preventDefault();let J=g!==void 0?g:E1(B)===E1(q);N(i,{replace:J,state:w,preventScrollReset:S,relative:R,viewTransition:o})}},[B,N,q,g,w,h,i,S,R,o])}const zW="plotperfect-db",OW=1,C1="images",FW=i=>i,cD=new Map,NW=async i=>{const l=cD.get(i);if(l&&Date.now()<l.expiresAt)return l.url;try{const h=await fetch(FW(`/api/storage/signed-url?key=${encodeURIComponent(i)}`));if(!h.ok)throw console.warn("Failed to get signed URL, response not ok:",h.status,h.statusText),new Error("Could not resolve image");const g=await h.json();if(!(g!=null&&g.url))throw console.warn("No URL in signed URL response"),new Error("Could not resolve image");return cD.set(i,{url:g.url,expiresAt:Date.now()+4*60*1e3}),g.url}catch(h){throw console.error("Error getting signed URL for S3 reference:",i,h),h}},BW=()=>new Promise((i,l)=>{const h=indexedDB.open(zW,OW);h.onupgradeneeded=()=>{const g=h.result;g.objectStoreNames.contains(C1)||g.createObjectStore(C1)},h.onsuccess=()=>i(h.result),h.onerror=()=>l(h.error),setTimeout(()=>{h.result||l(new Error("IndexedDB initialization timeout"))},5e3)}),ZO=async(i,l)=>{const h=await BW();return new Promise((g,w)=>{const S=h.transaction(C1,i),R=S.objectStore(C1),o=l(R);o.onsuccess=()=>g(o.result),o.onerror=()=>w(o.error),S.oncomplete=()=>h.close(),S.onerror=()=>{w(S.error),h.close()}})},XO=(i,l)=>ZO("readwrite",h=>h.put(l,i)).then(()=>{}),jW=i=>ZO("readonly",l=>l.get(i)),UW=async(i,l)=>(await XO(l,i),`idb:${l}`),VW=async(i,l)=>{const h=await(await fetch(i)).blob();return await XO(l,h),`idb:${l}`},aw=async i=>{try{if(i.startsWith("s3:"))try{return console.log("Attempting to resolve S3 URL:",i),await NW(i)}catch(g){return console.warn("S3 URL resolution failed, using fallback:",g),""}if(!i.startsWith("idb:"))return i;const l=i.slice(4),h=await jW(l);if(!h)throw new Error("Image not found in IndexedDB");return URL.createObjectURL(h)}catch(l){return console.warn("Failed to resolve image reference:",i,l),""}},YO=G.createContext(void 0),oc=i=>i,$W=i=>{var h;const l={...i};if(typeof l.layoutImage=="string"){const g=l.layoutImage;(g.startsWith("data:image/")||g.length>5e4)&&(l.layoutImage="")}if((h=l.mapConfig)!=null&&h.imageUrl&&typeof l.mapConfig.imageUrl=="string"){const g=l.mapConfig.imageUrl;(g.startsWith("data:image/")||g.length>5e4)&&(l.mapConfig={...l.mapConfig,imageUrl:""})}return l},GW="admin@gmail.com";function HW({children:i}){const[l,h]=G.useState(()=>{const Ne=localStorage.getItem("realestate-projects"),je=Ne?JSON.parse(Ne):[];return(Array.isArray(je)?je:[]).filter(Ve=>(Ve==null?void 0:Ve.id)!=="aradhana-business-park")}),[g,w]=G.useState(null),[S,R]=G.useState(!1),[o,N]=G.useState(!1),[B,q]=G.useState(()=>{const Ne=localStorage.getItem("realestate-user");return Ne?JSON.parse(Ne):null});G.useEffect(()=>{let Ne=!1;return(async()=>{try{const je=await fetch(oc("/api/health"));if(!je.ok)throw new Error("health not ok");const Te=await je.json();if(!(Te!=null&&Te.dbReady)){if(Ne)return;R(!1),N(!0);return}if(Ne)return;R(!0);const Ve=await fetch(oc("/api/projects"));if(!Ve.ok)throw new Error("projects not ok");const nt=await Ve.json();if(Ne)return;Array.isArray(nt)&&h(nt)}catch{if(Ne)return;R(!1)}finally{Ne||N(!0)}})(),()=>{Ne=!0}},[]);const Y=G.useRef(!1);G.useEffect(()=>{if(Y.current)return;if(!l.some(je=>{var Te,Ve;return(Ve=(Te=je.mapConfig)==null?void 0:Te.imageUrl)==null?void 0:Ve.startsWith("data:image/")})){Y.current=!0;return}Y.current=!0,(async()=>{const je=await Promise.all(l.map(async Te=>{var nt;const Ve=(nt=Te.mapConfig)==null?void 0:nt.imageUrl;if(!Ve||!Ve.startsWith("data:image/"))return Te;try{const At=`map:${Te.id}:${Date.now()}`,cn=await VW(Ve,At);return{...Te,mapConfig:{...Te.mapConfig,imageUrl:cn}}}catch{return Te}}));h(je)})()},[l]),G.useEffect(()=>{try{const Ne=l.map($W);localStorage.setItem("realestate-projects",JSON.stringify(Ne))}catch{}},[l]),G.useEffect(()=>{B?localStorage.setItem("realestate-user",JSON.stringify(B)):localStorage.removeItem("realestate-user")},[B]);const J=async(Ne,je)=>{const Te=Ne.trim().toLowerCase();if(!Te||!je||Te===GW)return!1;try{return(await fetch(oc("/api/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:Te,password:je})})).ok}catch{return!1}},ie=async(Ne,je)=>{const Te=Ne.trim().toLowerCase();if(!Te||!je)return!1;try{const Ve=await fetch(oc("/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:Te,password:je})});if(!Ve.ok)return!1;const nt=await Ve.json();return!(nt!=null&&nt.email)||!(nt!=null&&nt.role)?!1:(q({id:nt.id||(nt.role==="admin"?"1":"2"),email:nt.email,role:nt.role}),!0)}catch{return!1}},be=()=>{q(null)},te=Ne=>{const je={...Ne,id:Date.now().toString(),createdAt:new Date().toISOString(),plots:[]};h(Te=>[...Te,je]),S&&fetch(oc("/api/projects"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)}).catch(()=>{})},le=(Ne,je)=>{h(Te=>Te.map(Ve=>Ve.id===Ne?{...Ve,...je}:Ve)),(g==null?void 0:g.id)===Ne&&w(Te=>Te?{...Te,...je}:null),S&&fetch(oc(`/api/projects/${Ne}`),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)}).catch(()=>{})},ce=Ne=>{h(je=>je.filter(Te=>Te.id!==Ne)),(g==null?void 0:g.id)===Ne&&w(null),S&&fetch(oc(`/api/projects/${Ne}`),{method:"DELETE"}).catch(()=>{})},oe=(Ne,je)=>{if(h(Te=>Te.map(Ve=>Ve.id===Ne?{...Ve,plots:[...Ve.plots,je]}:Ve)),(g==null?void 0:g.id)===Ne&&w(Te=>Te?{...Te,plots:[...Te.plots,je]}:null),S){const Te=l.find(Ve=>Ve.id===Ne);Te&&fetch(oc(`/api/projects/${Ne}`),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({plots:[...Te.plots,je]})}).catch(()=>{})}},ue=(Ne,je,Te)=>{if(h(Ve=>Ve.map(nt=>nt.id===Ne?{...nt,plots:nt.plots.map(At=>At.id===je?{...At,...Te}:At)}:nt)),(g==null?void 0:g.id)===Ne&&w(Ve=>Ve?{...Ve,plots:Ve.plots.map(nt=>nt.id===je?{...nt,...Te}:nt)}:null),S){const Ve=l.find(nt=>nt.id===Ne);if(Ve){const nt=Ve.plots.map(At=>At.id===je?{...At,...Te}:At);fetch(oc(`/api/projects/${Ne}`),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({plots:nt})}).catch(()=>{})}}},Me=(Ne,je)=>{if(h(Te=>Te.map(Ve=>Ve.id===Ne?{...Ve,plots:Ve.plots.filter(nt=>nt.id!==je)}:Ve)),(g==null?void 0:g.id)===Ne&&w(Te=>Te?{...Te,plots:Te.plots.filter(Ve=>Ve.id!==je)}:null),S){const Te=l.find(Ve=>Ve.id===Ne);if(Te){const Ve=Te.plots.filter(nt=>nt.id!==je);fetch(oc(`/api/projects/${Ne}`),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({plots:Ve})}).catch(()=>{})}}};return L.jsx(YO.Provider,{value:{projects:l,currentProject:g,user:B,isAdmin:(B==null?void 0:B.role)==="admin",isInitialized:o,setCurrentProject:w,register:J,login:ie,logout:be,addProject:te,updateProject:le,deleteProject:ce,addPlot:oe,updatePlot:ue,deletePlot:Me},children:i})}function Xa(){const i=G.useContext(YO);if(i===void 0)throw new Error("useApp must be used within an AppProvider");return i}const lw={available:{bg:"rgba(34, 197, 94, 0.4)",border:"rgba(34, 197, 94, 0.8)",label:"Available"},booked:{bg:"rgba(250, 204, 21, 0.4)",border:"rgba(250, 204, 21, 0.8)",label:"Booked"},sold:{bg:"rgba(239, 68, 68, 0.4)",border:"rgba(239, 68, 68, 0.8)",label:"Sold"},mortgaged:{bg:"rgba(148, 163, 184, 0.4)",border:"rgba(148, 163, 184, 0.8)",label:"Mortgaged"}},KO=i=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(i),QO=i=>new Date(i).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),WW=ME("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-border bg-transparent hover:bg-muted text-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-muted text-muted-foreground hover:text-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Oi=G.forwardRef(({className:i,variant:l,size:h,asChild:g=!1,...w},S)=>{const R=g?QV:"button";return L.jsx(R,{className:vr(WW({variant:l,size:h,className:i})),ref:S,...w})});Oi.displayName="Button";const Eh="/assets/sample-layout-BmTXfsKb.png";var qW=G.createContext(void 0);function QE(i){const l=G.useContext(qW);return i||l||"ltr"}var ZW="DismissableLayer",xS="dismissableLayer.update",XW="dismissableLayer.pointerDownOutside",YW="dismissableLayer.focusOutside",uD,JO=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),eF=G.forwardRef((i,l)=>{const{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:g,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:R,onDismiss:o,...N}=i,B=G.useContext(JO),[q,Y]=G.useState(null),J=(q==null?void 0:q.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=G.useState({}),be=$i(l,Te=>Y(Te)),te=Array.from(B.layers),[le]=[...B.layersWithOutsidePointerEventsDisabled].slice(-1),ce=te.indexOf(le),oe=q?te.indexOf(q):-1,ue=B.layersWithOutsidePointerEventsDisabled.size>0,Me=oe>=ce,Ne=JW(Te=>{const Ve=Te.target,nt=[...B.branches].some(At=>At.contains(Ve));!Me||nt||(w==null||w(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J),je=e7(Te=>{const Ve=Te.target;[...B.branches].some(At=>At.contains(Ve))||(S==null||S(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J);return Ky(Te=>{oe===B.layers.size-1&&(g==null||g(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},J),G.useEffect(()=>{if(q)return h&&(B.layersWithOutsidePointerEventsDisabled.size===0&&(uD=J.body.style.pointerEvents,J.body.style.pointerEvents="none"),B.layersWithOutsidePointerEventsDisabled.add(q)),B.layers.add(q),dD(),()=>{h&&B.layersWithOutsidePointerEventsDisabled.size===1&&(J.body.style.pointerEvents=uD)}},[q,J,h,B]),G.useEffect(()=>()=>{q&&(B.layers.delete(q),B.layersWithOutsidePointerEventsDisabled.delete(q),dD())},[q,B]),G.useEffect(()=>{const Te=()=>ie({});return document.addEventListener(xS,Te),()=>document.removeEventListener(xS,Te)},[]),L.jsx(_i.div,{...N,ref:be,style:{pointerEvents:ue?Me?"auto":"none":void 0,...i.style},onFocusCapture:bn(i.onFocusCapture,je.onFocusCapture),onBlurCapture:bn(i.onBlurCapture,je.onBlurCapture),onPointerDownCapture:bn(i.onPointerDownCapture,Ne.onPointerDownCapture)})});eF.displayName=ZW;var KW="DismissableLayerBranch",QW=G.forwardRef((i,l)=>{const h=G.useContext(JO),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return h.branches.add(S),()=>{h.branches.delete(S)}},[h.branches]),L.jsx(_i.div,{...i,ref:w})});QW.displayName=KW;function JW(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1),w=G.useRef(()=>{});return G.useEffect(()=>{const S=o=>{if(o.target&&!g.current){let N=function(){tF(XW,h,B,{discrete:!0})};const B={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",w.current),w.current=N,l.addEventListener("click",w.current,{once:!0})):N()}else l.removeEventListener("click",w.current);g.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",S),l.removeEventListener("click",w.current)}},[l,h]),{onPointerDownCapture:()=>g.current=!0}}function e7(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1);return G.useEffect(()=>{const w=S=>{S.target&&!g.current&&tF(YW,h,{originalEvent:S},{discrete:!1})};return l.addEventListener("focusin",w),()=>l.removeEventListener("focusin",w)},[l,h]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function dD(){const i=new CustomEvent(xS);document.dispatchEvent(i)}function tF(i,l,h,{discrete:g}){const w=h.originalEvent.target,S=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}var e2=0;function nF(){G.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??hD()),document.body.insertAdjacentElement("beforeend",i[1]??hD()),e2++,()=>{e2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(l=>l.remove()),e2--}},[])}function hD(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var t2="focusScope.autoFocusOnMount",n2="focusScope.autoFocusOnUnmount",fD={bubbles:!1,cancelable:!0},t7="FocusScope",cw=G.forwardRef((i,l)=>{const{loop:h=!1,trapped:g=!1,onMountAutoFocus:w,onUnmountAutoFocus:S,...R}=i,[o,N]=G.useState(null),B=co(w),q=co(S),Y=G.useRef(null),J=$i(l,te=>N(te)),ie=G.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;G.useEffect(()=>{if(g){let te=function(ue){if(ie.paused||!o)return;const Me=ue.target;o.contains(Me)?Y.current=Me:Zu(Y.current,{select:!0})},le=function(ue){if(ie.paused||!o)return;const Me=ue.relatedTarget;Me!==null&&(o.contains(Me)||Zu(Y.current,{select:!0}))},ce=function(ue){if(document.activeElement===document.body)for(const Ne of ue)Ne.removedNodes.length>0&&Zu(o)};document.addEventListener("focusin",te),document.addEventListener("focusout",le);const oe=new MutationObserver(ce);return o&&oe.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",te),document.removeEventListener("focusout",le),oe.disconnect()}}},[g,o,ie.paused]),G.useEffect(()=>{if(o){mD.add(ie);const te=document.activeElement;if(!o.contains(te)){const ce=new CustomEvent(t2,fD);o.addEventListener(t2,B),o.dispatchEvent(ce),ce.defaultPrevented||(n7(a7(iF(o)),{select:!0}),document.activeElement===te&&Zu(o))}return()=>{o.removeEventListener(t2,B),setTimeout(()=>{const ce=new CustomEvent(n2,fD);o.addEventListener(n2,q),o.dispatchEvent(ce),ce.defaultPrevented||Zu(te??document.body,{select:!0}),o.removeEventListener(n2,q),mD.remove(ie)},0)}}},[o,B,q,ie]);const be=G.useCallback(te=>{if(!h&&!g||ie.paused)return;const le=te.key==="Tab"&&!te.altKey&&!te.ctrlKey&&!te.metaKey,ce=document.activeElement;if(le&&ce){const oe=te.currentTarget,[ue,Me]=i7(oe);ue&&Me?!te.shiftKey&&ce===Me?(te.preventDefault(),h&&Zu(ue,{select:!0})):te.shiftKey&&ce===ue&&(te.preventDefault(),h&&Zu(Me,{select:!0})):ce===oe&&te.preventDefault()}},[h,g,ie.paused]);return L.jsx(_i.div,{tabIndex:-1,...R,ref:J,onKeyDown:be})});cw.displayName=t7;function n7(i,{select:l=!1}={}){const h=document.activeElement;for(const g of i)if(Zu(g,{select:l}),document.activeElement!==h)return}function i7(i){const l=iF(i),h=pD(l,i),g=pD(l.reverse(),i);return[h,g]}function iF(i){const l=[],h=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:g=>{const w=g.tagName==="INPUT"&&g.type==="hidden";return g.disabled||g.hidden||w?NodeFilter.FILTER_SKIP:g.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;h.nextNode();)l.push(h.currentNode);return l}function pD(i,l){for(const h of i)if(!r7(h,{upTo:l}))return h}function r7(i,{upTo:l}){if(getComputedStyle(i).visibility==="hidden")return!0;for(;i;){if(l!==void 0&&i===l)return!1;if(getComputedStyle(i).display==="none")return!0;i=i.parentElement}return!1}function o7(i){return i instanceof HTMLInputElement&&"select"in i}function Zu(i,{select:l=!1}={}){if(i&&i.focus){const h=document.activeElement;i.focus({preventScroll:!0}),i!==h&&o7(i)&&l&&i.select()}}var mD=s7();function s7(){let i=[];return{add(l){const h=i[0];l!==h&&(h==null||h.pause()),i=gD(i,l),i.unshift(l)},remove(l){var h;i=gD(i,l),(h=i[0])==null||h.resume()}}}function gD(i,l){const h=[...i],g=h.indexOf(l);return g!==-1&&h.splice(g,1),h}function a7(i){return i.filter(l=>l.tagName!=="A")}var i2="rovingFocusGroup.onEntryFocus",l7={bubbles:!1,cancelable:!0},nv="RovingFocusGroup",[wS,rF,c7]=X1(nv),[u7,oF]=cu(nv,[c7]),[d7,h7]=u7(nv),sF=G.forwardRef((i,l)=>L.jsx(wS.Provider,{scope:i.__scopeRovingFocusGroup,children:L.jsx(wS.Slot,{scope:i.__scopeRovingFocusGroup,children:L.jsx(f7,{...i,ref:l})})}));sF.displayName=nv;var f7=G.forwardRef((i,l)=>{const{__scopeRovingFocusGroup:h,orientation:g,loop:w=!1,dir:S,currentTabStopId:R,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:N,onEntryFocus:B,preventScrollOnEntryFocus:q=!1,...Y}=i,J=G.useRef(null),ie=$i(l,J),be=QE(S),[te,le]=km({prop:R,defaultProp:o??null,onChange:N,caller:nv}),[ce,oe]=G.useState(!1),ue=co(B),Me=rF(h),Ne=G.useRef(!1),[je,Te]=G.useState(0);return G.useEffect(()=>{const Ve=J.current;if(Ve)return Ve.addEventListener(i2,ue),()=>Ve.removeEventListener(i2,ue)},[ue]),L.jsx(d7,{scope:h,orientation:g,dir:be,loop:w,currentTabStopId:te,onItemFocus:G.useCallback(Ve=>le(Ve),[le]),onItemShiftTab:G.useCallback(()=>oe(!0),[]),onFocusableItemAdd:G.useCallback(()=>Te(Ve=>Ve+1),[]),onFocusableItemRemove:G.useCallback(()=>Te(Ve=>Ve-1),[]),children:L.jsx(_i.div,{tabIndex:ce||je===0?-1:0,"data-orientation":g,...Y,ref:ie,style:{outline:"none",...i.style},onMouseDown:bn(i.onMouseDown,()=>{Ne.current=!0}),onFocus:bn(i.onFocus,Ve=>{const nt=!Ne.current;if(Ve.target===Ve.currentTarget&&nt&&!ce){const At=new CustomEvent(i2,l7);if(Ve.currentTarget.dispatchEvent(At),!At.defaultPrevented){const cn=Me().filter(xt=>xt.focusable),qt=cn.find(xt=>xt.active),Ht=cn.find(xt=>xt.id===te),Tt=[qt,Ht,...cn].filter(Boolean).map(xt=>xt.ref.current);cF(Tt,q)}}Ne.current=!1}),onBlur:bn(i.onBlur,()=>oe(!1))})})}),aF="RovingFocusGroupItem",lF=G.forwardRef((i,l)=>{const{__scopeRovingFocusGroup:h,focusable:g=!0,active:w=!1,tabStopId:S,children:R,...o}=i,N=tu(),B=S||N,q=h7(aF,h),Y=q.currentTabStopId===B,J=rF(h),{onFocusableItemAdd:ie,onFocusableItemRemove:be,currentTabStopId:te}=q;return G.useEffect(()=>{if(g)return ie(),()=>be()},[g,ie,be]),L.jsx(wS.ItemSlot,{scope:h,id:B,focusable:g,active:w,children:L.jsx(_i.span,{tabIndex:Y?0:-1,"data-orientation":q.orientation,...o,ref:l,onMouseDown:bn(i.onMouseDown,le=>{g?q.onItemFocus(B):le.preventDefault()}),onFocus:bn(i.onFocus,()=>q.onItemFocus(B)),onKeyDown:bn(i.onKeyDown,le=>{if(le.key==="Tab"&&le.shiftKey){q.onItemShiftTab();return}if(le.target!==le.currentTarget)return;const ce=g7(le,q.orientation,q.dir);if(ce!==void 0){if(le.metaKey||le.ctrlKey||le.altKey||le.shiftKey)return;le.preventDefault();let ue=J().filter(Me=>Me.focusable).map(Me=>Me.ref.current);if(ce==="last")ue.reverse();else if(ce==="prev"||ce==="next"){ce==="prev"&&ue.reverse();const Me=ue.indexOf(le.currentTarget);ue=q.loop?_7(ue,Me+1):ue.slice(Me+1)}setTimeout(()=>cF(ue))}}),children:typeof R=="function"?R({isCurrentTabStop:Y,hasTabStop:te!=null}):R})})});lF.displayName=aF;var p7={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function m7(i,l){return l!=="rtl"?i:i==="ArrowLeft"?"ArrowRight":i==="ArrowRight"?"ArrowLeft":i}function g7(i,l,h){const g=m7(i.key,h);if(!(l==="vertical"&&["ArrowLeft","ArrowRight"].includes(g))&&!(l==="horizontal"&&["ArrowUp","ArrowDown"].includes(g)))return p7[g]}function cF(i,l=!1){const h=document.activeElement;for(const g of i)if(g===h||(g.focus({preventScroll:l}),document.activeElement!==h))return}function _7(i,l){return i.map((h,g)=>i[(l+g)%i.length])}var y7=sF,v7=lF,x7=function(i){if(typeof document>"u")return null;var l=Array.isArray(i)?i[0]:i;return l.ownerDocument.body},qp=new WeakMap,Ex=new WeakMap,Ix={},r2=0,uF=function(i){return i&&(i.host||uF(i.parentNode))},w7=function(i,l){return l.map(function(h){if(i.contains(h))return h;var g=uF(h);return g&&i.contains(g)?g:(console.error("aria-hidden",h,"in not contained inside",i,". Doing nothing"),null)}).filter(function(h){return!!h})},b7=function(i,l,h,g){var w=w7(l,Array.isArray(i)?i:[i]);Ix[h]||(Ix[h]=new WeakMap);var S=Ix[h],R=[],o=new Set,N=new Set(w),B=function(Y){!Y||o.has(Y)||(o.add(Y),B(Y.parentNode))};w.forEach(B);var q=function(Y){!Y||N.has(Y)||Array.prototype.forEach.call(Y.children,function(J){if(o.has(J))q(J);else try{var ie=J.getAttribute(g),be=ie!==null&&ie!=="false",te=(qp.get(J)||0)+1,le=(S.get(J)||0)+1;qp.set(J,te),S.set(J,le),R.push(J),te===1&&be&&Ex.set(J,!0),le===1&&J.setAttribute(h,"true"),be||J.setAttribute(g,"true")}catch(ce){console.error("aria-hidden: cannot operate on ",J,ce)}})};return q(l),o.clear(),r2++,function(){R.forEach(function(Y){var J=qp.get(Y)-1,ie=S.get(Y)-1;qp.set(Y,J),S.set(Y,ie),J||(Ex.has(Y)||Y.removeAttribute(g),Ex.delete(Y)),ie||Y.removeAttribute(h)}),r2--,r2||(qp=new WeakMap,qp=new WeakMap,Ex=new WeakMap,Ix={})}},JE=function(i,l,h){h===void 0&&(h="data-aria-hidden");var g=Array.from(Array.isArray(i)?i:[i]),w=x7(i);return w?(g.push.apply(g,Array.from(w.querySelectorAll("[aria-live]"))),b7(g,w,h,"aria-hidden")):function(){return null}},dc=function(){return dc=Object.assign||function(l){for(var h,g=1,w=arguments.length;g<w;g++){h=arguments[g];for(var S in h)Object.prototype.hasOwnProperty.call(h,S)&&(l[S]=h[S])}return l},dc.apply(this,arguments)};function dF(i,l){var h={};for(var g in i)Object.prototype.hasOwnProperty.call(i,g)&&l.indexOf(g)<0&&(h[g]=i[g]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var w=0,g=Object.getOwnPropertySymbols(i);w<g.length;w++)l.indexOf(g[w])<0&&Object.prototype.propertyIsEnumerable.call(i,g[w])&&(h[g[w]]=i[g[w]]);return h}function T7(i,l,h){if(h||arguments.length===2)for(var g=0,w=l.length,S;g<w;g++)(S||!(g in l))&&(S||(S=Array.prototype.slice.call(l,0,g)),S[g]=l[g]);return i.concat(S||Array.prototype.slice.call(l))}var Zx="right-scroll-bar-position",Xx="width-before-scroll-bar",S7="with-scroll-bars-hidden",E7="--removed-body-scroll-bar-size";function o2(i,l){return typeof i=="function"?i(l):i&&(i.current=l),i}function I7(i,l){var h=G.useState(function(){return{value:i,callback:l,facade:{get current(){return h.value},set current(g){var w=h.value;w!==g&&(h.value=g,h.callback(g,w))}}}})[0];return h.callback=l,h.facade}var C7=typeof window<"u"?G.useLayoutEffect:G.useEffect,_D=new WeakMap;function A7(i,l){var h=I7(null,function(g){return i.forEach(function(w){return o2(w,g)})});return C7(function(){var g=_D.get(h);if(g){var w=new Set(g),S=new Set(i),R=h.current;w.forEach(function(o){S.has(o)||o2(o,null)}),S.forEach(function(o){w.has(o)||o2(o,R)})}_D.set(h,i)},[i]),h}function P7(i){return i}function M7(i,l){l===void 0&&(l=P7);var h=[],g=!1,w={read:function(){if(g)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return h.length?h[h.length-1]:i},useMedium:function(S){var R=l(S,g);return h.push(R),function(){h=h.filter(function(o){return o!==R})}},assignSyncMedium:function(S){for(g=!0;h.length;){var R=h;h=[],R.forEach(S)}h={push:function(o){return S(o)},filter:function(){return h}}},assignMedium:function(S){g=!0;var R=[];if(h.length){var o=h;h=[],o.forEach(S),R=h}var N=function(){var q=R;R=[],q.forEach(S)},B=function(){return Promise.resolve().then(N)};B(),h={push:function(q){R.push(q),B()},filter:function(q){return R=R.filter(q),h}}}};return w}function R7(i){i===void 0&&(i={});var l=M7(null);return l.options=dc({async:!0,ssr:!1},i),l}var hF=function(i){var l=i.sideCar,h=dF(i,["sideCar"]);if(!l)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var g=l.read();if(!g)throw new Error("Sidecar medium not found");return G.createElement(g,dc({},h))};hF.isSideCarExport=!0;function D7(i,l){return i.useMedium(l),hF}var fF=R7(),s2=function(){},uw=G.forwardRef(function(i,l){var h=G.useRef(null),g=G.useState({onScrollCapture:s2,onWheelCapture:s2,onTouchMoveCapture:s2}),w=g[0],S=g[1],R=i.forwardProps,o=i.children,N=i.className,B=i.removeScrollBar,q=i.enabled,Y=i.shards,J=i.sideCar,ie=i.noRelative,be=i.noIsolation,te=i.inert,le=i.allowPinchZoom,ce=i.as,oe=ce===void 0?"div":ce,ue=i.gapMode,Me=dF(i,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Ne=J,je=A7([h,l]),Te=dc(dc({},Me),w);return G.createElement(G.Fragment,null,q&&G.createElement(Ne,{sideCar:fF,removeScrollBar:B,shards:Y,noRelative:ie,noIsolation:be,inert:te,setCallbacks:S,allowPinchZoom:!!le,lockRef:h,gapMode:ue}),R?G.cloneElement(G.Children.only(o),dc(dc({},Te),{ref:je})):G.createElement(oe,dc({},Te,{className:N,ref:je}),o))});uw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};uw.classNames={fullWidth:Xx,zeroRight:Zx};var L7=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function k7(){if(!document)return null;var i=document.createElement("style");i.type="text/css";var l=L7();return l&&i.setAttribute("nonce",l),i}function z7(i,l){i.styleSheet?i.styleSheet.cssText=l:i.appendChild(document.createTextNode(l))}function O7(i){var l=document.head||document.getElementsByTagName("head")[0];l.appendChild(i)}var F7=function(){var i=0,l=null;return{add:function(h){i==0&&(l=k7())&&(z7(l,h),O7(l)),i++},remove:function(){i--,!i&&l&&(l.parentNode&&l.parentNode.removeChild(l),l=null)}}},N7=function(){var i=F7();return function(l,h){G.useEffect(function(){return i.add(l),function(){i.remove()}},[l&&h])}},pF=function(){var i=N7(),l=function(h){var g=h.styles,w=h.dynamic;return i(g,w),null};return l},B7={left:0,top:0,right:0,gap:0},a2=function(i){return parseInt(i||"",10)||0},j7=function(i){var l=window.getComputedStyle(document.body),h=l[i==="padding"?"paddingLeft":"marginLeft"],g=l[i==="padding"?"paddingTop":"marginTop"],w=l[i==="padding"?"paddingRight":"marginRight"];return[a2(h),a2(g),a2(w)]},U7=function(i){if(i===void 0&&(i="margin"),typeof window>"u")return B7;var l=j7(i),h=document.documentElement.clientWidth,g=window.innerWidth;return{left:l[0],top:l[1],right:l[2],gap:Math.max(0,g-h+l[2]-l[0])}},V7=pF(),gm="data-scroll-locked",$7=function(i,l,h,g){var w=i.left,S=i.top,R=i.right,o=i.gap;return h===void 0&&(h="margin"),`
  .`.concat(S7,` {
   overflow: hidden `).concat(g,`;
   padding-right: `).concat(o,"px ").concat(g,`;
  }
  body[`).concat(gm,`] {
    overflow: hidden `).concat(g,`;
    overscroll-behavior: contain;
    `).concat([l&&"position: relative ".concat(g,";"),h==="margin"&&`
    padding-left: `.concat(w,`px;
    padding-top: `).concat(S,`px;
    padding-right: `).concat(R,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(g,`;
    `),h==="padding"&&"padding-right: ".concat(o,"px ").concat(g,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Zx,` {
    right: `).concat(o,"px ").concat(g,`;
  }
  
  .`).concat(Xx,` {
    margin-right: `).concat(o,"px ").concat(g,`;
  }
  
  .`).concat(Zx," .").concat(Zx,` {
    right: 0 `).concat(g,`;
  }
  
  .`).concat(Xx," .").concat(Xx,` {
    margin-right: 0 `).concat(g,`;
  }
  
  body[`).concat(gm,`] {
    `).concat(E7,": ").concat(o,`px;
  }
`)},yD=function(){var i=parseInt(document.body.getAttribute(gm)||"0",10);return isFinite(i)?i:0},G7=function(){G.useEffect(function(){return document.body.setAttribute(gm,(yD()+1).toString()),function(){var i=yD()-1;i<=0?document.body.removeAttribute(gm):document.body.setAttribute(gm,i.toString())}},[])},H7=function(i){var l=i.noRelative,h=i.noImportant,g=i.gapMode,w=g===void 0?"margin":g;G7();var S=G.useMemo(function(){return U7(w)},[w]);return G.createElement(V7,{styles:$7(S,!l,w,h?"":"!important")})},bS=!1;if(typeof window<"u")try{var Cx=Object.defineProperty({},"passive",{get:function(){return bS=!0,!0}});window.addEventListener("test",Cx,Cx),window.removeEventListener("test",Cx,Cx)}catch{bS=!1}var Zp=bS?{passive:!1}:!1,W7=function(i){return i.tagName==="TEXTAREA"},mF=function(i,l){if(!(i instanceof Element))return!1;var h=window.getComputedStyle(i);return h[l]!=="hidden"&&!(h.overflowY===h.overflowX&&!W7(i)&&h[l]==="visible")},q7=function(i){return mF(i,"overflowY")},Z7=function(i){return mF(i,"overflowX")},vD=function(i,l){var h=l.ownerDocument,g=l;do{typeof ShadowRoot<"u"&&g instanceof ShadowRoot&&(g=g.host);var w=gF(i,g);if(w){var S=_F(i,g),R=S[1],o=S[2];if(R>o)return!0}g=g.parentNode}while(g&&g!==h.body);return!1},X7=function(i){var l=i.scrollTop,h=i.scrollHeight,g=i.clientHeight;return[l,h,g]},Y7=function(i){var l=i.scrollLeft,h=i.scrollWidth,g=i.clientWidth;return[l,h,g]},gF=function(i,l){return i==="v"?q7(l):Z7(l)},_F=function(i,l){return i==="v"?X7(l):Y7(l)},K7=function(i,l){return i==="h"&&l==="rtl"?-1:1},Q7=function(i,l,h,g,w){var S=K7(i,window.getComputedStyle(l).direction),R=S*g,o=h.target,N=l.contains(o),B=!1,q=R>0,Y=0,J=0;do{if(!o)break;var ie=_F(i,o),be=ie[0],te=ie[1],le=ie[2],ce=te-le-S*be;(be||ce)&&gF(i,o)&&(Y+=ce,J+=be);var oe=o.parentNode;o=oe&&oe.nodeType===Node.DOCUMENT_FRAGMENT_NODE?oe.host:oe}while(!N&&o!==document.body||N&&(l.contains(o)||l===o));return(q&&(Math.abs(Y)<1||!w)||!q&&(Math.abs(J)<1||!w))&&(B=!0),B},Ax=function(i){return"changedTouches"in i?[i.changedTouches[0].clientX,i.changedTouches[0].clientY]:[0,0]},xD=function(i){return[i.deltaX,i.deltaY]},wD=function(i){return i&&"current"in i?i.current:i},J7=function(i,l){return i[0]===l[0]&&i[1]===l[1]},e9=function(i){return`
  .block-interactivity-`.concat(i,` {pointer-events: none;}
  .allow-interactivity-`).concat(i,` {pointer-events: all;}
`)},t9=0,Xp=[];function n9(i){var l=G.useRef([]),h=G.useRef([0,0]),g=G.useRef(),w=G.useState(t9++)[0],S=G.useState(pF)[0],R=G.useRef(i);G.useEffect(function(){R.current=i},[i]),G.useEffect(function(){if(i.inert){document.body.classList.add("block-interactivity-".concat(w));var te=T7([i.lockRef.current],(i.shards||[]).map(wD),!0).filter(Boolean);return te.forEach(function(le){return le.classList.add("allow-interactivity-".concat(w))}),function(){document.body.classList.remove("block-interactivity-".concat(w)),te.forEach(function(le){return le.classList.remove("allow-interactivity-".concat(w))})}}},[i.inert,i.lockRef.current,i.shards]);var o=G.useCallback(function(te,le){if("touches"in te&&te.touches.length===2||te.type==="wheel"&&te.ctrlKey)return!R.current.allowPinchZoom;var ce=Ax(te),oe=h.current,ue="deltaX"in te?te.deltaX:oe[0]-ce[0],Me="deltaY"in te?te.deltaY:oe[1]-ce[1],Ne,je=te.target,Te=Math.abs(ue)>Math.abs(Me)?"h":"v";if("touches"in te&&Te==="h"&&je.type==="range")return!1;var Ve=vD(Te,je);if(!Ve)return!0;if(Ve?Ne=Te:(Ne=Te==="v"?"h":"v",Ve=vD(Te,je)),!Ve)return!1;if(!g.current&&"changedTouches"in te&&(ue||Me)&&(g.current=Ne),!Ne)return!0;var nt=g.current||Ne;return Q7(nt,le,te,nt==="h"?ue:Me,!0)},[]),N=G.useCallback(function(te){var le=te;if(!(!Xp.length||Xp[Xp.length-1]!==S)){var ce="deltaY"in le?xD(le):Ax(le),oe=l.current.filter(function(Ne){return Ne.name===le.type&&(Ne.target===le.target||le.target===Ne.shadowParent)&&J7(Ne.delta,ce)})[0];if(oe&&oe.should){le.cancelable&&le.preventDefault();return}if(!oe){var ue=(R.current.shards||[]).map(wD).filter(Boolean).filter(function(Ne){return Ne.contains(le.target)}),Me=ue.length>0?o(le,ue[0]):!R.current.noIsolation;Me&&le.cancelable&&le.preventDefault()}}},[]),B=G.useCallback(function(te,le,ce,oe){var ue={name:te,delta:le,target:ce,should:oe,shadowParent:i9(ce)};l.current.push(ue),setTimeout(function(){l.current=l.current.filter(function(Me){return Me!==ue})},1)},[]),q=G.useCallback(function(te){h.current=Ax(te),g.current=void 0},[]),Y=G.useCallback(function(te){B(te.type,xD(te),te.target,o(te,i.lockRef.current))},[]),J=G.useCallback(function(te){B(te.type,Ax(te),te.target,o(te,i.lockRef.current))},[]);G.useEffect(function(){return Xp.push(S),i.setCallbacks({onScrollCapture:Y,onWheelCapture:Y,onTouchMoveCapture:J}),document.addEventListener("wheel",N,Zp),document.addEventListener("touchmove",N,Zp),document.addEventListener("touchstart",q,Zp),function(){Xp=Xp.filter(function(te){return te!==S}),document.removeEventListener("wheel",N,Zp),document.removeEventListener("touchmove",N,Zp),document.removeEventListener("touchstart",q,Zp)}},[]);var ie=i.removeScrollBar,be=i.inert;return G.createElement(G.Fragment,null,be?G.createElement(S,{styles:e9(w)}):null,ie?G.createElement(H7,{noRelative:i.noRelative,gapMode:i.gapMode}):null)}function i9(i){for(var l=null;i!==null;)i instanceof ShadowRoot&&(l=i.host,i=i.host),i=i.parentNode;return l}const r9=D7(fF,n9);var dw=G.forwardRef(function(i,l){return G.createElement(uw,dc({},i,{ref:l,sideCar:r9}))});dw.classNames=uw.classNames;var TS=["Enter"," "],o9=["ArrowDown","PageUp","Home"],yF=["ArrowUp","PageDown","End"],s9=[...o9,...yF],a9={ltr:[...TS,"ArrowRight"],rtl:[...TS,"ArrowLeft"]},l9={ltr:["ArrowLeft"],rtl:["ArrowRight"]},iv="Menu",[Vy,c9,u9]=X1(iv),[of,vF]=cu(iv,[u9,Hm,oF]),hw=Hm(),xF=oF(),[d9,sf]=of(iv),[h9,rv]=of(iv),wF=i=>{const{__scopeMenu:l,open:h=!1,children:g,dir:w,onOpenChange:S,modal:R=!0}=i,o=hw(l),[N,B]=G.useState(null),q=G.useRef(!1),Y=co(S),J=QE(w);return G.useEffect(()=>{const ie=()=>{q.current=!0,document.addEventListener("pointerdown",be,{capture:!0,once:!0}),document.addEventListener("pointermove",be,{capture:!0,once:!0})},be=()=>q.current=!1;return document.addEventListener("keydown",ie,{capture:!0}),()=>{document.removeEventListener("keydown",ie,{capture:!0}),document.removeEventListener("pointerdown",be,{capture:!0}),document.removeEventListener("pointermove",be,{capture:!0})}},[]),L.jsx(xO,{...o,children:L.jsx(d9,{scope:l,open:h,onOpenChange:Y,content:N,onContentChange:B,children:L.jsx(h9,{scope:l,onClose:G.useCallback(()=>Y(!1),[Y]),isUsingKeyboardRef:q,dir:J,modal:R,children:g})})})};wF.displayName=iv;var f9="MenuAnchor",eI=G.forwardRef((i,l)=>{const{__scopeMenu:h,...g}=i,w=hw(h);return L.jsx(GE,{...w,...g,ref:l})});eI.displayName=f9;var tI="MenuPortal",[p9,bF]=of(tI,{forceMount:void 0}),TF=i=>{const{__scopeMenu:l,forceMount:h,children:g,container:w}=i,S=sf(tI,l);return L.jsx(p9,{scope:l,forceMount:h,children:L.jsx(nf,{present:h||S.open,children:L.jsx(Qy,{asChild:!0,container:w,children:g})})})};TF.displayName=tI;var Wa="MenuContent",[m9,nI]=of(Wa),SF=G.forwardRef((i,l)=>{const h=bF(Wa,i.__scopeMenu),{forceMount:g=h.forceMount,...w}=i,S=sf(Wa,i.__scopeMenu),R=rv(Wa,i.__scopeMenu);return L.jsx(Vy.Provider,{scope:i.__scopeMenu,children:L.jsx(nf,{present:g||S.open,children:L.jsx(Vy.Slot,{scope:i.__scopeMenu,children:R.modal?L.jsx(g9,{...w,ref:l}):L.jsx(_9,{...w,ref:l})})})})}),g9=G.forwardRef((i,l)=>{const h=sf(Wa,i.__scopeMenu),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return JE(S)},[]),L.jsx(iI,{...i,ref:w,trapFocus:h.open,disableOutsidePointerEvents:h.open,disableOutsideScroll:!0,onFocusOutside:bn(i.onFocusOutside,S=>S.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>h.onOpenChange(!1)})}),_9=G.forwardRef((i,l)=>{const h=sf(Wa,i.__scopeMenu);return L.jsx(iI,{...i,ref:l,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>h.onOpenChange(!1)})}),y9=Hh("MenuContent.ScrollLock"),iI=G.forwardRef((i,l)=>{const{__scopeMenu:h,loop:g=!1,trapFocus:w,onOpenAutoFocus:S,onCloseAutoFocus:R,disableOutsidePointerEvents:o,onEntryFocus:N,onEscapeKeyDown:B,onPointerDownOutside:q,onFocusOutside:Y,onInteractOutside:J,onDismiss:ie,disableOutsideScroll:be,...te}=i,le=sf(Wa,h),ce=rv(Wa,h),oe=hw(h),ue=xF(h),Me=c9(h),[Ne,je]=G.useState(null),Te=G.useRef(null),Ve=$i(l,Te,le.onContentChange),nt=G.useRef(0),At=G.useRef(""),cn=G.useRef(0),qt=G.useRef(null),Ht=G.useRef("right"),st=G.useRef(0),Tt=be?dw:G.Fragment,xt=be?{as:y9,allowPinchZoom:!0}:void 0,kt=He=>{var nn,Zn;const mt=At.current+He,$t=Me().filter(_n=>!_n.disabled),Gt=document.activeElement,Kt=(nn=$t.find(_n=>_n.ref.current===Gt))==null?void 0:nn.textValue,mn=$t.map(_n=>_n.textValue),Yn=M9(mn,mt,Kt),hi=(Zn=$t.find(_n=>_n.textValue===Yn))==null?void 0:Zn.ref.current;(function _n(En){At.current=En,window.clearTimeout(nt.current),En!==""&&(nt.current=window.setTimeout(()=>_n(""),1e3))})(mt),hi&&setTimeout(()=>hi.focus())};G.useEffect(()=>()=>window.clearTimeout(nt.current),[]),nF();const ze=G.useCallback(He=>{var $t,Gt;return Ht.current===(($t=qt.current)==null?void 0:$t.side)&&D9(He,(Gt=qt.current)==null?void 0:Gt.area)},[]);return L.jsx(m9,{scope:h,searchRef:At,onItemEnter:G.useCallback(He=>{ze(He)&&He.preventDefault()},[ze]),onItemLeave:G.useCallback(He=>{var mt;ze(He)||((mt=Te.current)==null||mt.focus(),je(null))},[ze]),onTriggerLeave:G.useCallback(He=>{ze(He)&&He.preventDefault()},[ze]),pointerGraceTimerRef:cn,onPointerGraceIntentChange:G.useCallback(He=>{qt.current=He},[]),children:L.jsx(Tt,{...xt,children:L.jsx(cw,{asChild:!0,trapped:w,onMountAutoFocus:bn(S,He=>{var mt;He.preventDefault(),(mt=Te.current)==null||mt.focus({preventScroll:!0})}),onUnmountAutoFocus:R,children:L.jsx(eF,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:B,onPointerDownOutside:q,onFocusOutside:Y,onInteractOutside:J,onDismiss:ie,children:L.jsx(y7,{asChild:!0,...ue,dir:ce.dir,orientation:"vertical",loop:g,currentTabStopId:Ne,onCurrentTabStopIdChange:je,onEntryFocus:bn(N,He=>{ce.isUsingKeyboardRef.current||He.preventDefault()}),preventScrollOnEntryFocus:!0,children:L.jsx(HE,{role:"menu","aria-orientation":"vertical","data-state":jF(le.open),"data-radix-menu-content":"",dir:ce.dir,...oe,...te,ref:Ve,style:{outline:"none",...te.style},onKeyDown:bn(te.onKeyDown,He=>{const $t=He.target.closest("[data-radix-menu-content]")===He.currentTarget,Gt=He.ctrlKey||He.altKey||He.metaKey,Kt=He.key.length===1;$t&&(He.key==="Tab"&&He.preventDefault(),!Gt&&Kt&&kt(He.key));const mn=Te.current;if(He.target!==mn||!s9.includes(He.key))return;He.preventDefault();const hi=Me().filter(nn=>!nn.disabled).map(nn=>nn.ref.current);yF.includes(He.key)&&hi.reverse(),A9(hi)}),onBlur:bn(i.onBlur,He=>{He.currentTarget.contains(He.target)||(window.clearTimeout(nt.current),At.current="")}),onPointerMove:bn(i.onPointerMove,$y(He=>{const mt=He.target,$t=st.current!==He.clientX;if(He.currentTarget.contains(mt)&&$t){const Gt=He.clientX>st.current?"right":"left";Ht.current=Gt,st.current=He.clientX}}))})})})})})})});SF.displayName=Wa;var v9="MenuGroup",rI=G.forwardRef((i,l)=>{const{__scopeMenu:h,...g}=i;return L.jsx(_i.div,{role:"group",...g,ref:l})});rI.displayName=v9;var x9="MenuLabel",EF=G.forwardRef((i,l)=>{const{__scopeMenu:h,...g}=i;return L.jsx(_i.div,{...g,ref:l})});EF.displayName=x9;var A1="MenuItem",bD="menu.itemSelect",fw=G.forwardRef((i,l)=>{const{disabled:h=!1,onSelect:g,...w}=i,S=G.useRef(null),R=rv(A1,i.__scopeMenu),o=nI(A1,i.__scopeMenu),N=$i(l,S),B=G.useRef(!1),q=()=>{const Y=S.current;if(!h&&Y){const J=new CustomEvent(bD,{bubbles:!0,cancelable:!0});Y.addEventListener(bD,ie=>g==null?void 0:g(ie),{once:!0}),tf(Y,J),J.defaultPrevented?B.current=!1:R.onClose()}};return L.jsx(IF,{...w,ref:N,disabled:h,onClick:bn(i.onClick,q),onPointerDown:Y=>{var J;(J=i.onPointerDown)==null||J.call(i,Y),B.current=!0},onPointerUp:bn(i.onPointerUp,Y=>{var J;B.current||(J=Y.currentTarget)==null||J.click()}),onKeyDown:bn(i.onKeyDown,Y=>{const J=o.searchRef.current!=="";h||J&&Y.key===" "||TS.includes(Y.key)&&(Y.currentTarget.click(),Y.preventDefault())})})});fw.displayName=A1;var IF=G.forwardRef((i,l)=>{const{__scopeMenu:h,disabled:g=!1,textValue:w,...S}=i,R=nI(A1,h),o=xF(h),N=G.useRef(null),B=$i(l,N),[q,Y]=G.useState(!1),[J,ie]=G.useState("");return G.useEffect(()=>{const be=N.current;be&&ie((be.textContent??"").trim())},[S.children]),L.jsx(Vy.ItemSlot,{scope:h,disabled:g,textValue:w??J,children:L.jsx(v7,{asChild:!0,...o,focusable:!g,children:L.jsx(_i.div,{role:"menuitem","data-highlighted":q?"":void 0,"aria-disabled":g||void 0,"data-disabled":g?"":void 0,...S,ref:B,onPointerMove:bn(i.onPointerMove,$y(be=>{g?R.onItemLeave(be):(R.onItemEnter(be),be.defaultPrevented||be.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:bn(i.onPointerLeave,$y(be=>R.onItemLeave(be))),onFocus:bn(i.onFocus,()=>Y(!0)),onBlur:bn(i.onBlur,()=>Y(!1))})})})}),w9="MenuCheckboxItem",CF=G.forwardRef((i,l)=>{const{checked:h=!1,onCheckedChange:g,...w}=i;return L.jsx(DF,{scope:i.__scopeMenu,checked:h,children:L.jsx(fw,{role:"menuitemcheckbox","aria-checked":P1(h)?"mixed":h,...w,ref:l,"data-state":sI(h),onSelect:bn(w.onSelect,()=>g==null?void 0:g(P1(h)?!0:!h),{checkForDefaultPrevented:!1})})})});CF.displayName=w9;var AF="MenuRadioGroup",[b9,T9]=of(AF,{value:void 0,onValueChange:()=>{}}),PF=G.forwardRef((i,l)=>{const{value:h,onValueChange:g,...w}=i,S=co(g);return L.jsx(b9,{scope:i.__scopeMenu,value:h,onValueChange:S,children:L.jsx(rI,{...w,ref:l})})});PF.displayName=AF;var MF="MenuRadioItem",RF=G.forwardRef((i,l)=>{const{value:h,...g}=i,w=T9(MF,i.__scopeMenu),S=h===w.value;return L.jsx(DF,{scope:i.__scopeMenu,checked:S,children:L.jsx(fw,{role:"menuitemradio","aria-checked":S,...g,ref:l,"data-state":sI(S),onSelect:bn(g.onSelect,()=>{var R;return(R=w.onValueChange)==null?void 0:R.call(w,h)},{checkForDefaultPrevented:!1})})})});RF.displayName=MF;var oI="MenuItemIndicator",[DF,S9]=of(oI,{checked:!1}),LF=G.forwardRef((i,l)=>{const{__scopeMenu:h,forceMount:g,...w}=i,S=S9(oI,h);return L.jsx(nf,{present:g||P1(S.checked)||S.checked===!0,children:L.jsx(_i.span,{...w,ref:l,"data-state":sI(S.checked)})})});LF.displayName=oI;var E9="MenuSeparator",kF=G.forwardRef((i,l)=>{const{__scopeMenu:h,...g}=i;return L.jsx(_i.div,{role:"separator","aria-orientation":"horizontal",...g,ref:l})});kF.displayName=E9;var I9="MenuArrow",zF=G.forwardRef((i,l)=>{const{__scopeMenu:h,...g}=i,w=hw(h);return L.jsx(WE,{...w,...g,ref:l})});zF.displayName=I9;var C9="MenuSub",[JZ,OF]=of(C9),oy="MenuSubTrigger",FF=G.forwardRef((i,l)=>{const h=sf(oy,i.__scopeMenu),g=rv(oy,i.__scopeMenu),w=OF(oy,i.__scopeMenu),S=nI(oy,i.__scopeMenu),R=G.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:N}=S,B={__scopeMenu:i.__scopeMenu},q=G.useCallback(()=>{R.current&&window.clearTimeout(R.current),R.current=null},[]);return G.useEffect(()=>q,[q]),G.useEffect(()=>{const Y=o.current;return()=>{window.clearTimeout(Y),N(null)}},[o,N]),L.jsx(eI,{asChild:!0,...B,children:L.jsx(IF,{id:w.triggerId,"aria-haspopup":"menu","aria-expanded":h.open,"aria-controls":w.contentId,"data-state":jF(h.open),...i,ref:Z1(l,w.onTriggerChange),onClick:Y=>{var J;(J=i.onClick)==null||J.call(i,Y),!(i.disabled||Y.defaultPrevented)&&(Y.currentTarget.focus(),h.open||h.onOpenChange(!0))},onPointerMove:bn(i.onPointerMove,$y(Y=>{S.onItemEnter(Y),!Y.defaultPrevented&&!i.disabled&&!h.open&&!R.current&&(S.onPointerGraceIntentChange(null),R.current=window.setTimeout(()=>{h.onOpenChange(!0),q()},100))})),onPointerLeave:bn(i.onPointerLeave,$y(Y=>{var ie,be;q();const J=(ie=h.content)==null?void 0:ie.getBoundingClientRect();if(J){const te=(be=h.content)==null?void 0:be.dataset.side,le=te==="right",ce=le?-5:5,oe=J[le?"left":"right"],ue=J[le?"right":"left"];S.onPointerGraceIntentChange({area:[{x:Y.clientX+ce,y:Y.clientY},{x:oe,y:J.top},{x:ue,y:J.top},{x:ue,y:J.bottom},{x:oe,y:J.bottom}],side:te}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>S.onPointerGraceIntentChange(null),300)}else{if(S.onTriggerLeave(Y),Y.defaultPrevented)return;S.onPointerGraceIntentChange(null)}})),onKeyDown:bn(i.onKeyDown,Y=>{var ie;const J=S.searchRef.current!=="";i.disabled||J&&Y.key===" "||a9[g.dir].includes(Y.key)&&(h.onOpenChange(!0),(ie=h.content)==null||ie.focus(),Y.preventDefault())})})})});FF.displayName=oy;var NF="MenuSubContent",BF=G.forwardRef((i,l)=>{const h=bF(Wa,i.__scopeMenu),{forceMount:g=h.forceMount,...w}=i,S=sf(Wa,i.__scopeMenu),R=rv(Wa,i.__scopeMenu),o=OF(NF,i.__scopeMenu),N=G.useRef(null),B=$i(l,N);return L.jsx(Vy.Provider,{scope:i.__scopeMenu,children:L.jsx(nf,{present:g||S.open,children:L.jsx(Vy.Slot,{scope:i.__scopeMenu,children:L.jsx(iI,{id:o.contentId,"aria-labelledby":o.triggerId,...w,ref:B,align:"start",side:R.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:q=>{var Y;R.isUsingKeyboardRef.current&&((Y=N.current)==null||Y.focus()),q.preventDefault()},onCloseAutoFocus:q=>q.preventDefault(),onFocusOutside:bn(i.onFocusOutside,q=>{q.target!==o.trigger&&S.onOpenChange(!1)}),onEscapeKeyDown:bn(i.onEscapeKeyDown,q=>{R.onClose(),q.preventDefault()}),onKeyDown:bn(i.onKeyDown,q=>{var ie;const Y=q.currentTarget.contains(q.target),J=l9[R.dir].includes(q.key);Y&&J&&(S.onOpenChange(!1),(ie=o.trigger)==null||ie.focus(),q.preventDefault())})})})})})});BF.displayName=NF;function jF(i){return i?"open":"closed"}function P1(i){return i==="indeterminate"}function sI(i){return P1(i)?"indeterminate":i?"checked":"unchecked"}function A9(i){const l=document.activeElement;for(const h of i)if(h===l||(h.focus(),document.activeElement!==l))return}function P9(i,l){return i.map((h,g)=>i[(l+g)%i.length])}function M9(i,l,h){const w=l.length>1&&Array.from(l).every(B=>B===l[0])?l[0]:l,S=h?i.indexOf(h):-1;let R=P9(i,Math.max(S,0));w.length===1&&(R=R.filter(B=>B!==h));const N=R.find(B=>B.toLowerCase().startsWith(w.toLowerCase()));return N!==h?N:void 0}function R9(i,l){const{x:h,y:g}=i;let w=!1;for(let S=0,R=l.length-1;S<l.length;R=S++){const o=l[S],N=l[R],B=o.x,q=o.y,Y=N.x,J=N.y;q>g!=J>g&&h<(Y-B)*(g-q)/(J-q)+B&&(w=!w)}return w}function D9(i,l){if(!l)return!1;const h={x:i.clientX,y:i.clientY};return R9(h,l)}function $y(i){return l=>l.pointerType==="mouse"?i(l):void 0}var L9=wF,k9=eI,z9=TF,O9=SF,F9=rI,N9=EF,B9=fw,j9=CF,U9=PF,V9=RF,$9=LF,G9=kF,H9=zF,W9=FF,q9=BF,pw="DropdownMenu",[Z9,eX]=cu(pw,[vF]),Ms=vF(),[X9,UF]=Z9(pw),VF=i=>{const{__scopeDropdownMenu:l,children:h,dir:g,open:w,defaultOpen:S,onOpenChange:R,modal:o=!0}=i,N=Ms(l),B=G.useRef(null),[q,Y]=km({prop:w,defaultProp:S??!1,onChange:R,caller:pw});return L.jsx(X9,{scope:l,triggerId:tu(),triggerRef:B,contentId:tu(),open:q,onOpenChange:Y,onOpenToggle:G.useCallback(()=>Y(J=>!J),[Y]),modal:o,children:L.jsx(L9,{...N,open:q,onOpenChange:Y,dir:g,modal:o,children:h})})};VF.displayName=pw;var $F="DropdownMenuTrigger",GF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,disabled:g=!1,...w}=i,S=UF($F,h),R=Ms(h);return L.jsx(k9,{asChild:!0,...R,children:L.jsx(_i.button,{type:"button",id:S.triggerId,"aria-haspopup":"menu","aria-expanded":S.open,"aria-controls":S.open?S.contentId:void 0,"data-state":S.open?"open":"closed","data-disabled":g?"":void 0,disabled:g,...w,ref:Z1(l,S.triggerRef),onPointerDown:bn(i.onPointerDown,o=>{!g&&o.button===0&&o.ctrlKey===!1&&(S.onOpenToggle(),S.open||o.preventDefault())}),onKeyDown:bn(i.onKeyDown,o=>{g||(["Enter"," "].includes(o.key)&&S.onOpenToggle(),o.key==="ArrowDown"&&S.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});GF.displayName=$F;var Y9="DropdownMenuPortal",HF=i=>{const{__scopeDropdownMenu:l,...h}=i,g=Ms(l);return L.jsx(z9,{...g,...h})};HF.displayName=Y9;var WF="DropdownMenuContent",qF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=UF(WF,h),S=Ms(h),R=G.useRef(!1);return L.jsx(O9,{id:w.contentId,"aria-labelledby":w.triggerId,...S,...g,ref:l,onCloseAutoFocus:bn(i.onCloseAutoFocus,o=>{var N;R.current||(N=w.triggerRef.current)==null||N.focus(),R.current=!1,o.preventDefault()}),onInteractOutside:bn(i.onInteractOutside,o=>{const N=o.detail.originalEvent,B=N.button===0&&N.ctrlKey===!0,q=N.button===2||B;(!w.modal||q)&&(R.current=!0)}),style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});qF.displayName=WF;var K9="DropdownMenuGroup",Q9=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(F9,{...w,...g,ref:l})});Q9.displayName=K9;var J9="DropdownMenuLabel",ZF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(N9,{...w,...g,ref:l})});ZF.displayName=J9;var eq="DropdownMenuItem",XF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(B9,{...w,...g,ref:l})});XF.displayName=eq;var tq="DropdownMenuCheckboxItem",YF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(j9,{...w,...g,ref:l})});YF.displayName=tq;var nq="DropdownMenuRadioGroup",iq=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(U9,{...w,...g,ref:l})});iq.displayName=nq;var rq="DropdownMenuRadioItem",KF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(V9,{...w,...g,ref:l})});KF.displayName=rq;var oq="DropdownMenuItemIndicator",QF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx($9,{...w,...g,ref:l})});QF.displayName=oq;var sq="DropdownMenuSeparator",JF=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(G9,{...w,...g,ref:l})});JF.displayName=sq;var aq="DropdownMenuArrow",lq=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(H9,{...w,...g,ref:l})});lq.displayName=aq;var cq="DropdownMenuSubTrigger",e3=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(W9,{...w,...g,ref:l})});e3.displayName=cq;var uq="DropdownMenuSubContent",t3=G.forwardRef((i,l)=>{const{__scopeDropdownMenu:h,...g}=i,w=Ms(h);return L.jsx(q9,{...w,...g,ref:l,style:{...i.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});t3.displayName=uq;var dq=VF,hq=GF,fq=HF,n3=qF,i3=ZF,r3=XF,o3=YF,s3=KF,a3=QF,l3=JF,c3=e3,u3=t3;const d3=dq,h3=hq,pq=G.forwardRef(({className:i,inset:l,children:h,...g},w)=>L.jsxs(c3,{ref:w,className:vr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",l&&"pl-8",i),...g,children:[h,L.jsx($6,{className:"ml-auto h-4 w-4"})]}));pq.displayName=c3.displayName;const mq=G.forwardRef(({className:i,...l},h)=>L.jsx(u3,{ref:h,className:vr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...l}));mq.displayName=u3.displayName;const aI=G.forwardRef(({className:i,sideOffset:l=4,...h},g)=>L.jsx(fq,{children:L.jsx(n3,{ref:g,sideOffset:l,className:vr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...h})}));aI.displayName=n3.displayName;const _m=G.forwardRef(({className:i,inset:l,...h},g)=>L.jsx(r3,{ref:g,className:vr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",l&&"pl-8",i),...h}));_m.displayName=r3.displayName;const gq=G.forwardRef(({className:i,children:l,checked:h,...g},w)=>L.jsxs(o3,{ref:w,className:vr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",i),checked:h,...g,children:[L.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:L.jsx(a3,{children:L.jsx(Rz,{className:"h-4 w-4"})})}),l]}));gq.displayName=o3.displayName;const _q=G.forwardRef(({className:i,children:l,...h},g)=>L.jsxs(s3,{ref:g,className:vr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",i),...h,children:[L.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:L.jsx(a3,{children:L.jsx(H6,{className:"h-2 w-2 fill-current"})})}),l]}));_q.displayName=s3.displayName;const yq=G.forwardRef(({className:i,inset:l,...h},g)=>L.jsx(i3,{ref:g,className:vr("px-2 py-1.5 text-sm font-semibold",l&&"pl-8",i),...h}));yq.displayName=i3.displayName;const lI=G.forwardRef(({className:i,...l},h)=>L.jsx(l3,{ref:h,className:vr("-mx-1 my-1 h-px bg-muted",i),...l}));lI.displayName=l3.displayName;function _y(i,l,{checkForDefaultPrevented:h=!0}={}){return function(w){if(i==null||i(w),h===!1||!w.defaultPrevented)return l==null?void 0:l(w)}}function l2(i,l,{checkForDefaultPrevented:h=!0}={}){return function(w){if(i==null||i(w),h===!1||!w.defaultPrevented)return l==null?void 0:l(w)}}var vq="DismissableLayer",SS="dismissableLayer.update",xq="dismissableLayer.pointerDownOutside",wq="dismissableLayer.focusOutside",TD,f3=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),p3=G.forwardRef((i,l)=>{const{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:g,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:R,onDismiss:o,...N}=i,B=G.useContext(f3),[q,Y]=G.useState(null),J=(q==null?void 0:q.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=G.useState({}),be=$i(l,Te=>Y(Te)),te=Array.from(B.layers),[le]=[...B.layersWithOutsidePointerEventsDisabled].slice(-1),ce=te.indexOf(le),oe=q?te.indexOf(q):-1,ue=B.layersWithOutsidePointerEventsDisabled.size>0,Me=oe>=ce,Ne=Sq(Te=>{const Ve=Te.target,nt=[...B.branches].some(At=>At.contains(Ve));!Me||nt||(w==null||w(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J),je=Eq(Te=>{const Ve=Te.target;[...B.branches].some(At=>At.contains(Ve))||(S==null||S(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J);return Ky(Te=>{oe===B.layers.size-1&&(g==null||g(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},J),G.useEffect(()=>{if(q)return h&&(B.layersWithOutsidePointerEventsDisabled.size===0&&(TD=J.body.style.pointerEvents,J.body.style.pointerEvents="none"),B.layersWithOutsidePointerEventsDisabled.add(q)),B.layers.add(q),SD(),()=>{h&&B.layersWithOutsidePointerEventsDisabled.size===1&&(J.body.style.pointerEvents=TD)}},[q,J,h,B]),G.useEffect(()=>()=>{q&&(B.layers.delete(q),B.layersWithOutsidePointerEventsDisabled.delete(q),SD())},[q,B]),G.useEffect(()=>{const Te=()=>ie({});return document.addEventListener(SS,Te),()=>document.removeEventListener(SS,Te)},[]),L.jsx(_i.div,{...N,ref:be,style:{pointerEvents:ue?Me?"auto":"none":void 0,...i.style},onFocusCapture:l2(i.onFocusCapture,je.onFocusCapture),onBlurCapture:l2(i.onBlurCapture,je.onBlurCapture),onPointerDownCapture:l2(i.onPointerDownCapture,Ne.onPointerDownCapture)})});p3.displayName=vq;var bq="DismissableLayerBranch",Tq=G.forwardRef((i,l)=>{const h=G.useContext(f3),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return h.branches.add(S),()=>{h.branches.delete(S)}},[h.branches]),L.jsx(_i.div,{...i,ref:w})});Tq.displayName=bq;function Sq(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1),w=G.useRef(()=>{});return G.useEffect(()=>{const S=o=>{if(o.target&&!g.current){let N=function(){m3(xq,h,B,{discrete:!0})};const B={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",w.current),w.current=N,l.addEventListener("click",w.current,{once:!0})):N()}else l.removeEventListener("click",w.current);g.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",S),l.removeEventListener("click",w.current)}},[l,h]),{onPointerDownCapture:()=>g.current=!0}}function Eq(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1);return G.useEffect(()=>{const w=S=>{S.target&&!g.current&&m3(wq,h,{originalEvent:S},{discrete:!1})};return l.addEventListener("focusin",w),()=>l.removeEventListener("focusin",w)},[l,h]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function SD(){const i=new CustomEvent(SS);document.dispatchEvent(i)}function m3(i,l,h,{discrete:g}){const w=h.originalEvent.target,S=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}function Iq(i,l){return G.useReducer((h,g)=>l[h][g]??h,i)}var mw=i=>{const{present:l,children:h}=i,g=Cq(l),w=typeof h=="function"?h({present:g.isPresent}):G.Children.only(h),S=$i(g.ref,Aq(w));return typeof h=="function"||g.isPresent?G.cloneElement(w,{ref:S}):null};mw.displayName="Presence";function Cq(i){const[l,h]=G.useState(),g=G.useRef(null),w=G.useRef(i),S=G.useRef("none"),R=i?"mounted":"unmounted",[o,N]=Iq(R,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const B=Px(g.current);S.current=o==="mounted"?B:"none"},[o]),Oo(()=>{const B=g.current,q=w.current;if(q!==i){const J=S.current,ie=Px(B);i?N("MOUNT"):ie==="none"||(B==null?void 0:B.display)==="none"?N("UNMOUNT"):N(q&&J!==ie?"ANIMATION_OUT":"UNMOUNT"),w.current=i}},[i,N]),Oo(()=>{if(l){let B;const q=l.ownerDocument.defaultView??window,Y=ie=>{const te=Px(g.current).includes(CSS.escape(ie.animationName));if(ie.target===l&&te&&(N("ANIMATION_END"),!w.current)){const le=l.style.animationFillMode;l.style.animationFillMode="forwards",B=q.setTimeout(()=>{l.style.animationFillMode==="forwards"&&(l.style.animationFillMode=le)})}},J=ie=>{ie.target===l&&(S.current=Px(g.current))};return l.addEventListener("animationstart",J),l.addEventListener("animationcancel",Y),l.addEventListener("animationend",Y),()=>{q.clearTimeout(B),l.removeEventListener("animationstart",J),l.removeEventListener("animationcancel",Y),l.removeEventListener("animationend",Y)}}else N("ANIMATION_END")},[l,N]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:G.useCallback(B=>{g.current=B?getComputedStyle(B):null,h(B)},[])}}function Px(i){return(i==null?void 0:i.animationName)||"none"}function Aq(i){var g,w;let l=(g=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:g.get,h=l&&"isReactWarning"in l&&l.isReactWarning;return h?i.ref:(l=(w=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:w.get,h=l&&"isReactWarning"in l&&l.isReactWarning,h?i.props.ref:i.props.ref||i.ref)}var c2=0;function Pq(){G.useEffect(()=>{const i=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",i[0]??ED()),document.body.insertAdjacentElement("beforeend",i[1]??ED()),c2++,()=>{c2===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(l=>l.remove()),c2--}},[])}function ED(){const i=document.createElement("span");return i.setAttribute("data-radix-focus-guard",""),i.tabIndex=0,i.style.outline="none",i.style.opacity="0",i.style.position="fixed",i.style.pointerEvents="none",i}var gw="Dialog",[g3,tX]=cu(gw),[Mq,zl]=g3(gw),_3=i=>{const{__scopeDialog:l,children:h,open:g,defaultOpen:w,onOpenChange:S,modal:R=!0}=i,o=G.useRef(null),N=G.useRef(null),[B,q]=km({prop:g,defaultProp:w??!1,onChange:S,caller:gw});return L.jsx(Mq,{scope:l,triggerRef:o,contentRef:N,contentId:tu(),titleId:tu(),descriptionId:tu(),open:B,onOpenChange:q,onOpenToggle:G.useCallback(()=>q(Y=>!Y),[q]),modal:R,children:h})};_3.displayName=gw;var y3="DialogTrigger",v3=G.forwardRef((i,l)=>{const{__scopeDialog:h,...g}=i,w=zl(y3,h),S=$i(l,w.triggerRef);return L.jsx(_i.button,{type:"button","aria-haspopup":"dialog","aria-expanded":w.open,"aria-controls":w.contentId,"data-state":dI(w.open),...g,ref:S,onClick:_y(i.onClick,w.onOpenToggle)})});v3.displayName=y3;var cI="DialogPortal",[Rq,x3]=g3(cI,{forceMount:void 0}),w3=i=>{const{__scopeDialog:l,forceMount:h,children:g,container:w}=i,S=zl(cI,l);return L.jsx(Rq,{scope:l,forceMount:h,children:G.Children.map(g,R=>L.jsx(mw,{present:h||S.open,children:L.jsx(Qy,{asChild:!0,container:w,children:R})}))})};w3.displayName=cI;var M1="DialogOverlay",b3=G.forwardRef((i,l)=>{const h=x3(M1,i.__scopeDialog),{forceMount:g=h.forceMount,...w}=i,S=zl(M1,i.__scopeDialog);return S.modal?L.jsx(mw,{present:g||S.open,children:L.jsx(Lq,{...w,ref:l})}):null});b3.displayName=M1;var Dq=Hh("DialogOverlay.RemoveScroll"),Lq=G.forwardRef((i,l)=>{const{__scopeDialog:h,...g}=i,w=zl(M1,h);return L.jsx(dw,{as:Dq,allowPinchZoom:!0,shards:[w.contentRef],children:L.jsx(_i.div,{"data-state":dI(w.open),...g,ref:l,style:{pointerEvents:"auto",...g.style}})})}),qh="DialogContent",T3=G.forwardRef((i,l)=>{const h=x3(qh,i.__scopeDialog),{forceMount:g=h.forceMount,...w}=i,S=zl(qh,i.__scopeDialog);return L.jsx(mw,{present:g||S.open,children:S.modal?L.jsx(kq,{...w,ref:l}):L.jsx(zq,{...w,ref:l})})});T3.displayName=qh;var kq=G.forwardRef((i,l)=>{const h=zl(qh,i.__scopeDialog),g=G.useRef(null),w=$i(l,h.contentRef,g);return G.useEffect(()=>{const S=g.current;if(S)return JE(S)},[]),L.jsx(S3,{...i,ref:w,trapFocus:h.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_y(i.onCloseAutoFocus,S=>{var R;S.preventDefault(),(R=h.triggerRef.current)==null||R.focus()}),onPointerDownOutside:_y(i.onPointerDownOutside,S=>{const R=S.detail.originalEvent,o=R.button===0&&R.ctrlKey===!0;(R.button===2||o)&&S.preventDefault()}),onFocusOutside:_y(i.onFocusOutside,S=>S.preventDefault())})}),zq=G.forwardRef((i,l)=>{const h=zl(qh,i.__scopeDialog),g=G.useRef(!1),w=G.useRef(!1);return L.jsx(S3,{...i,ref:l,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:S=>{var R,o;(R=i.onCloseAutoFocus)==null||R.call(i,S),S.defaultPrevented||(g.current||(o=h.triggerRef.current)==null||o.focus(),S.preventDefault()),g.current=!1,w.current=!1},onInteractOutside:S=>{var N,B;(N=i.onInteractOutside)==null||N.call(i,S),S.defaultPrevented||(g.current=!0,S.detail.originalEvent.type==="pointerdown"&&(w.current=!0));const R=S.target;((B=h.triggerRef.current)==null?void 0:B.contains(R))&&S.preventDefault(),S.detail.originalEvent.type==="focusin"&&w.current&&S.preventDefault()}})}),S3=G.forwardRef((i,l)=>{const{__scopeDialog:h,trapFocus:g,onOpenAutoFocus:w,onCloseAutoFocus:S,...R}=i,o=zl(qh,h),N=G.useRef(null),B=$i(l,N);return Pq(),L.jsxs(L.Fragment,{children:[L.jsx(cw,{asChild:!0,loop:!0,trapped:g,onMountAutoFocus:w,onUnmountAutoFocus:S,children:L.jsx(p3,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":dI(o.open),...R,ref:B,onDismiss:()=>o.onOpenChange(!1)})}),L.jsxs(L.Fragment,{children:[L.jsx(Oq,{titleId:o.titleId}),L.jsx(Nq,{contentRef:N,descriptionId:o.descriptionId})]})]})}),uI="DialogTitle",E3=G.forwardRef((i,l)=>{const{__scopeDialog:h,...g}=i,w=zl(uI,h);return L.jsx(_i.h2,{id:w.titleId,...g,ref:l})});E3.displayName=uI;var I3="DialogDescription",C3=G.forwardRef((i,l)=>{const{__scopeDialog:h,...g}=i,w=zl(I3,h);return L.jsx(_i.p,{id:w.descriptionId,...g,ref:l})});C3.displayName=I3;var A3="DialogClose",P3=G.forwardRef((i,l)=>{const{__scopeDialog:h,...g}=i,w=zl(A3,h);return L.jsx(_i.button,{type:"button",...g,ref:l,onClick:_y(i.onClick,()=>w.onOpenChange(!1))})});P3.displayName=A3;function dI(i){return i?"open":"closed"}var M3="DialogTitleWarning",[nX,R3]=YV(M3,{contentName:qh,titleName:uI,docsSlug:"dialog"}),Oq=({titleId:i})=>{const l=R3(M3),h=`\`${l.contentName}\` requires a \`${l.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${l.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${l.docsSlug}`;return G.useEffect(()=>{i&&(document.getElementById(i)||console.error(h))},[h,i]),null},Fq="DialogDescriptionWarning",Nq=({contentRef:i,descriptionId:l})=>{const g=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${R3(Fq).contentName}}.`;return G.useEffect(()=>{var S;const w=(S=i.current)==null?void 0:S.getAttribute("aria-describedby");l&&w&&(document.getElementById(l)||console.warn(g))},[g,i,l]),null},Bq=_3,jq=v3,Uq=w3,D3=b3,L3=T3,k3=E3,z3=C3,Vq=P3;const Bh=Bq,O3=jq,$q=Uq,F3=G.forwardRef(({className:i,...l},h)=>L.jsx(D3,{ref:h,className:vr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",i),...l}));F3.displayName=D3.displayName;const gd=G.forwardRef(({className:i,children:l,...h},g)=>L.jsxs($q,{children:[L.jsx(F3,{}),L.jsxs(L3,{ref:g,className:vr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-card p-6 shadow-2xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-2xl",i),...h,children:[l,L.jsxs(Vq,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[L.jsx(kE,{className:"h-4 w-4"}),L.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));gd.displayName=L3.displayName;const Zh=({className:i,...l})=>L.jsx("div",{className:vr("flex flex-col space-y-1.5 text-center sm:text-left",i),...l});Zh.displayName="DialogHeader";const Xh=G.forwardRef(({className:i,...l},h)=>L.jsx(k3,{ref:h,className:vr("text-lg font-semibold leading-none tracking-tight",i),...l}));Xh.displayName=k3.displayName;const Gq=G.forwardRef(({className:i,...l},h)=>L.jsx(z3,{ref:h,className:vr("text-sm text-muted-foreground",i),...l}));Gq.displayName=z3.displayName;const rr=G.forwardRef(({className:i,type:l,...h},g)=>L.jsx("input",{type:l,className:vr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:g,...h}));rr.displayName="Input";var Hq="Label",N3=G.forwardRef((i,l)=>L.jsx(_i.label,{...i,ref:l,onMouseDown:h=>{var w;h.target.closest("button, input, select, textarea")||((w=i.onMouseDown)==null||w.call(i,h),!h.defaultPrevented&&h.detail>1&&h.preventDefault())}}));N3.displayName=Hq;var B3=N3;const Wq=ME("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Gi=G.forwardRef(({className:i,...l},h)=>L.jsx(B3,{ref:h,className:vr(Wq(),i),...l}));Gi.displayName=B3.displayName;function qq({project:i,onClick:l}){const{isAdmin:h,updateProject:g,deleteProject:w}=Xa(),[S,R]=G.useState(!1),[o,N]=G.useState(!1),[B,q]=G.useState(Eh),[Y,J]=G.useState(!0),[ie,be]=G.useState(!1),te=G.useRef(null),[le,ce]=G.useState({name:i.name,location:i.location,description:i.description||"",contactDetails:i.contactDetails||""});G.useEffect(()=>{let je=!1;return(async()=>{J(!0),be(!1);try{const Ve=i.layoutImage;if(!Ve){if(je)return;q(Eh),J(!1);return}const nt=await aw(Ve);if(je)return;if(!nt&&Ve.startsWith("s3:")){if(console.warn("S3 image failed to load for project card, using fallback"),je)return;q(Eh),J(!1);return}if(nt&&nt.startsWith("blob:")?(te.current&&te.current!==nt&&URL.revokeObjectURL(te.current),te.current=nt):te.current&&(URL.revokeObjectURL(te.current),te.current=null),je)return;q(nt||Eh),J(!1)}catch(Ve){if(console.warn("Failed to load project image:",Ve),je)return;q(Eh),be(!0),J(!1)}})(),()=>{je=!0}},[i.layoutImage]),G.useEffect(()=>()=>{te.current&&URL.revokeObjectURL(te.current)},[]);const oe={total:i.plots.length,available:i.plots.filter(je=>je.status==="available").length,booked:i.plots.filter(je=>je.status==="booked").length,sold:i.plots.filter(je=>je.status==="sold").length},ue=()=>{g(i.id,{name:le.name.trim(),location:le.location.trim(),description:le.description.trim()||void 0,contactDetails:le.contactDetails.trim()||void 0}),cr.success("Project updated successfully"),R(!1)},Me=()=>{w(i.id),cr.success("Project deleted successfully"),N(!1)},Ne=je=>{je.stopPropagation()};return L.jsxs(L.Fragment,{children:[L.jsxs("div",{onClick:l,className:"group glass glass-hover rounded-2xl overflow-hidden cursor-pointer transform transition-all duration-300 hover:scale-[1.02] hover:shadow-lg relative",children:[h&&L.jsx("div",{className:"absolute top-3 right-3 z-10",onClick:Ne,children:L.jsxs(d3,{children:[L.jsx(h3,{asChild:!0,children:L.jsx(Oi,{variant:"secondary",size:"icon",className:"h-8 w-8 bg-background/80 backdrop-blur-sm shadow-md",children:L.jsx(q6,{className:"w-4 h-4"})})}),L.jsxs(aI,{align:"end",className:"w-40",children:[L.jsxs(_m,{onClick:()=>R(!0),children:[L.jsx(zy,{className:"w-4 h-4 mr-2"}),"Edit"]}),L.jsx(lI,{}),L.jsxs(_m,{onClick:()=>N(!0),className:"text-destructive focus:text-destructive",children:[L.jsx(Om,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})}),L.jsxs("div",{className:"relative h-48 overflow-hidden bg-muted/20",children:[Y&&L.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/30",children:L.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}),L.jsx("img",{src:B,alt:i.name,className:`w-full h-full object-cover transform transition-all duration-500 group-hover:scale-110 ${Y?"opacity-0":"opacity-100"}`,onLoad:()=>J(!1),onError:()=>{be(!0),J(!1),q(Eh)}}),L.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-card via-card/20 to-transparent"}),L.jsxs("div",{className:"absolute bottom-4 left-4 right-4 flex gap-2",children:[L.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-status-available/20 border border-status-available/40",children:[L.jsx("span",{className:"w-2 h-2 rounded-full bg-status-available"}),L.jsx("span",{className:"text-xs font-medium text-foreground",children:oe.available})]}),L.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-status-booked/20 border border-status-booked/40",children:[L.jsx("span",{className:"w-2 h-2 rounded-full bg-status-booked"}),L.jsx("span",{className:"text-xs font-medium text-foreground",children:oe.booked})]}),L.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg bg-status-sold/20 border border-status-sold/40",children:[L.jsx("span",{className:"w-2 h-2 rounded-full bg-status-sold"}),L.jsx("span",{className:"text-xs font-medium text-foreground",children:oe.sold})]})]})]}),L.jsxs("div",{className:"p-5",children:[L.jsx("h3",{className:"text-xl font-bold text-foreground mb-2 group-hover:text-primary transition-colors",children:i.name}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[L.jsx(Nh,{className:"w-4 h-4"}),L.jsx("span",{children:i.location})]}),L.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[L.jsx(kz,{className:"w-4 h-4"}),L.jsxs("span",{children:[oe.total," Plots"]})]}),i.contactDetails&&L.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[L.jsx(Fz,{className:"w-4 h-4"}),L.jsx("span",{children:i.contactDetails})]}),L.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[L.jsx(Mz,{className:"w-4 h-4"}),L.jsxs("span",{children:["Created ",QO(i.createdAt)]})]})]})]})]}),L.jsx(Bh,{open:S,onOpenChange:R,children:L.jsxs(gd,{className:"sm:max-w-md",onClick:je=>je.stopPropagation(),children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Edit Project"})}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editCardName",children:"Project Name"}),L.jsx(rr,{id:"editCardName",value:le.name,onChange:je=>ce({...le,name:je.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editCardLocation",children:"Location"}),L.jsx(rr,{id:"editCardLocation",value:le.location,onChange:je=>ce({...le,location:je.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editCardDescription",children:"Description"}),L.jsx(rr,{id:"editCardDescription",value:le.description,onChange:je=>ce({...le,description:je.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editCardContact",children:"Contact Details"}),L.jsx(rr,{id:"editCardContact",value:le.contactDetails,onChange:je=>ce({...le,contactDetails:je.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{className:"flex gap-3 pt-2",children:[L.jsx(Oi,{onClick:ue,className:"flex-1",children:"Save Changes"}),L.jsx(Oi,{variant:"outline",onClick:()=>R(!1),children:"Cancel"})]})]})]})}),L.jsx(Bh,{open:o,onOpenChange:N,children:L.jsxs(gd,{className:"sm:max-w-sm",onClick:je=>je.stopPropagation(),children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Delete Project"})}),L.jsxs("div",{className:"text-center py-4",children:[L.jsx("div",{className:"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:L.jsx(Om,{className:"w-6 h-6 text-destructive"})}),L.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"Delete Project?"}),L.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:['This will permanently delete "',i.name,'" and all its plots.']}),L.jsxs("div",{className:"flex gap-3 justify-center pt-6",children:[L.jsx(Oi,{variant:"destructive",onClick:Me,children:"Delete"}),L.jsx(Oi,{variant:"outline",onClick:()=>N(!1),children:"Cancel"})]})]})]})})]})}function ID({onProjectCreated:i}){const{addProject:l}=Xa(),[h,g]=G.useState(!1),[w,S]=G.useState(""),[R,o]=G.useState(""),[N,B]=G.useState(""),[q,Y]=G.useState(""),[J,ie]=G.useState(""),[be,te]=G.useState(null),[le,ce]=G.useState(""),oe=G.useRef(null),ue=Te=>Te,Me=async(Te,Ve)=>{const At=(Te.name.split(".").pop()||"").toLowerCase().replace(/[^a-z0-9]/g,""),cn=await fetch(ue("/api/storage/presign-upload"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentType:Te.type,prefix:Ve,ext:At})});if(!cn.ok)throw new Error("Could not prepare upload");const qt=await cn.json();if(!(qt!=null&&qt.key)||!(qt!=null&&qt.url))throw new Error("Could not prepare upload");if(!(await fetch(qt.url,{method:"PUT",headers:{"Content-Type":Te.type},body:Te})).ok)throw new Error("Upload failed");return`s3:${qt.key}`},Ne=Te=>{var nt;const Ve=(nt=Te.target.files)==null?void 0:nt[0];if(Ve){if(!Ve.type.startsWith("image/")){cr.error("Please upload an image file");return}ce(Ve.name),te(Ve);const At=new FileReader;At.onload=cn=>{var qt;ie((qt=cn.target)==null?void 0:qt.result)},At.readAsDataURL(Ve)}},je=async Te=>{if(Te.preventDefault(),!w.trim()){cr.error("Please enter a project name");return}if(!R.trim()){cr.error("Please enter a location");return}let Ve=Eh;if(be)try{Ve=await Me(be,"project-layouts")}catch{cr.error("Image upload failed");return}else J&&(Ve=J);l({name:w.trim(),location:R.trim(),description:N.trim()||void 0,contactDetails:q.trim()||void 0,layoutImage:Ve}),cr.success("Project created successfully!"),g(!1),S(""),o(""),B(""),Y(""),ie(""),te(null),ce(""),i==null||i()};return L.jsxs(Bh,{open:h,onOpenChange:g,children:[L.jsx(O3,{asChild:!0,children:L.jsxs(Oi,{className:"gap-2",children:[L.jsx(sS,{className:"w-4 h-4"}),"New Project"]})}),L.jsxs(gd,{className:"sm:max-w-md max-h-[85vh] overflow-y-auto",children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Create New Project"})}),L.jsxs("form",{onSubmit:je,className:"space-y-5",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"projectName",children:"Project Name"}),L.jsx(rr,{id:"projectName",value:w,onChange:Te=>S(Te.target.value),placeholder:"e.g., Green Valley Residency",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"location",children:"Location"}),L.jsx(rr,{id:"location",value:R,onChange:Te=>o(Te.target.value),placeholder:"e.g., Sector 45, Gurgaon",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"description",children:"Description (Optional)"}),L.jsx(rr,{id:"description",value:N,onChange:Te=>B(Te.target.value),placeholder:"e.g., Premium residential plots",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"contactDetails",children:"Contact Details (Optional)"}),L.jsx(rr,{id:"contactDetails",value:q,onChange:Te=>Y(Te.target.value),placeholder:"e.g., +91 98765 43210",className:"mt-1.5"})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(Gi,{children:"Layout Image (Optional)"}),L.jsxs("div",{className:"relative",children:[L.jsx(rr,{type:"file",accept:"image/*",onChange:Ne,ref:oe,className:"hidden"}),L.jsx("div",{onClick:()=>{var Te;return(Te=oe.current)==null?void 0:Te.click()},className:"mt-1.5 border-2 border-dashed border-border rounded-xl p-6 cursor-pointer hover:border-primary/50 hover:bg-muted/30 transition-all text-center",children:J?L.jsxs("div",{className:"space-y-3",children:[L.jsx("img",{src:J,alt:"Preview",className:"w-full h-32 object-contain rounded-lg"}),L.jsx("p",{className:"text-sm text-muted-foreground",children:le})]}):L.jsxs("div",{className:"space-y-2",children:[L.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center mx-auto",children:L.jsx(zz,{className:"w-6 h-6 text-muted-foreground"})}),L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium text-foreground",children:"Click to upload layout image"}),L.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG or WEBP (max 10MB)"})]})]})})]})]}),L.jsxs("div",{children:[L.jsx(Gi,{children:"Map (Optional)"}),L.jsxs(Oi,{type:"button",variant:"outline",className:"w-full mt-1.5 gap-2",onClick:()=>window.open("/aradhana-map","_blank","noopener,noreferrer"),children:[L.jsx(Nh,{className:"w-4 h-4"}),"Open Map Tool"]})]}),L.jsxs(Oi,{type:"submit",className:"w-full",children:[L.jsx(aS,{className:"w-4 h-4 mr-2"}),"Create Project"]})]})]})]})}function j3(){const{user:i,isAdmin:l,logout:h,currentProject:g,setCurrentProject:w}=Xa();return qm(),L.jsx("header",{className:"sticky top-0 z-40 w-full glass border-b border-border",children:L.jsxs("div",{className:"container flex h-16 items-center justify-between px-4",children:[L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsxs(Ih,{to:i?"/dashboard":"/",onClick:()=>w(null),className:"flex items-center gap-2 text-foreground hover:text-primary transition-colors",children:[L.jsx("div",{className:"w-9 h-9 rounded-lg bg-primary flex items-center justify-center",children:L.jsx(zm,{className:"w-5 h-5 text-primary-foreground"})}),L.jsx("span",{className:"font-bold text-lg hidden sm:inline",children:"PlotManager"})]}),g&&L.jsxs(L.Fragment,{children:[L.jsx("span",{className:"text-muted-foreground",children:"/"}),L.jsx("span",{className:"text-foreground font-medium truncate max-w-[200px]",children:g.name})]})]}),L.jsx("div",{className:"flex items-center gap-3",children:i?L.jsxs(L.Fragment,{children:[L.jsx(Ih,{to:"/dashboard",children:L.jsxs(Oi,{variant:"outline",size:"sm",children:[L.jsx(X6,{className:"w-4 h-4 mr-2"}),L.jsx("span",{className:"hidden sm:inline",children:"Dashboard"}),L.jsx("span",{className:"sm:hidden",children:"Home"})]})}),L.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-muted/50",children:[L.jsx(Bz,{className:"w-4 h-4 text-muted-foreground"}),L.jsx("span",{className:"text-sm text-muted-foreground",children:i.email}),l&&L.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full bg-primary/20 text-primary",children:"Admin"})]}),l&&L.jsx(Ih,{to:"/aradhana-map",children:L.jsxs(Oi,{variant:"outline",size:"sm",children:[L.jsx(Nz,{className:"w-4 h-4 mr-2"}),L.jsx("span",{className:"hidden sm:inline",children:"Map Tool"}),L.jsx("span",{className:"sm:hidden",children:"Map"})]})}),L.jsxs(Oi,{variant:"ghost",size:"sm",onClick:h,className:"text-muted-foreground hover:text-destructive",children:[L.jsx(Q6,{className:"w-4 h-4 mr-2"}),L.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]}):L.jsxs(L.Fragment,{children:[L.jsx(Ih,{to:"/login",children:L.jsxs(Oi,{variant:"outline",size:"sm",children:[L.jsx(K6,{className:"w-4 h-4 mr-2"}),L.jsx("span",{children:"Login"})]})}),L.jsx(Ih,{to:"/register",children:L.jsxs(Oi,{size:"sm",children:[L.jsx(i8,{className:"w-4 h-4 mr-2"}),L.jsx("span",{children:"Register"})]})})]})})]})})}const CD=()=>{const{projects:i,setCurrentProject:l,isAdmin:h,isInitialized:g}=Xa(),w=Zm(),[S,R]=G.useState(""),o=i.filter(B=>B.name.toLowerCase().includes(S.toLowerCase())||B.location.toLowerCase().includes(S.toLowerCase())),N=B=>{l(B),w(`/project/${B.id}`)};return L.jsxs("div",{className:"min-h-screen bg-background",children:[L.jsx(j3,{}),L.jsxs("main",{className:"container px-4 py-8",children:[!g&&L.jsxs("div",{className:"space-y-8",children:[L.jsxs("div",{className:"text-center mb-12",children:[L.jsx("div",{className:"h-12 bg-muted rounded-lg w-64 mx-auto mb-4 animate-pulse"}),L.jsx("div",{className:"h-8 bg-muted rounded-lg w-96 mx-auto animate-pulse"})]}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(B=>L.jsx("div",{className:"h-80 bg-muted rounded-2xl animate-pulse"},B))})]}),L.jsxs("div",{className:g?"":"invisible",children:[L.jsxs("div",{className:"text-center mb-12",children:[L.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 border border-primary/20 mb-6",children:[L.jsx(zm,{className:"w-4 h-4 text-primary"}),L.jsx("span",{className:"text-sm font-medium text-primary",children:"Real Estate Management"})]}),L.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-foreground mb-4",children:["Plot Management ",L.jsx("span",{className:"text-gradient",children:"System"})]}),L.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Manage your real estate projects with interactive layouts, real-time status tracking, and comprehensive plot details."})]}),L.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-8",children:[L.jsxs("div",{className:"relative flex-1",children:[L.jsx(n8,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),L.jsx(rr,{placeholder:"Search projects by name or location...",value:S,onChange:B=>R(B.target.value),className:"pl-10"})]}),h&&L.jsx(ID,{})]}),o.length>0?L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(B=>L.jsx(qq,{project:B,onClick:()=>N(B)},B.id))}):L.jsxs("div",{className:"text-center py-16 bg-card border border-border rounded-2xl shadow-sm",children:[L.jsx("div",{className:"w-16 h-16 rounded-2xl bg-muted flex items-center justify-center mx-auto mb-4",children:L.jsx(zm,{className:"w-8 h-8 text-muted-foreground"})}),L.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:S?"No projects found":"No projects yet"}),L.jsx("p",{className:"text-muted-foreground mb-6",children:S?"Try adjusting your search query":h?"Create your first project to get started":"Login as admin to create projects"}),h&&!S&&L.jsx(ID,{})]}),i.length>0&&L.jsxs("div",{className:"mt-12 grid grid-cols-2 md:grid-cols-4 gap-4",children:[L.jsxs("div",{className:"bg-card border border-border rounded-xl p-5 text-center shadow-sm",children:[L.jsx("div",{className:"text-3xl font-bold text-foreground",children:i.length}),L.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Total Projects"})]}),L.jsxs("div",{className:"bg-card border border-border rounded-xl p-5 text-center shadow-sm",children:[L.jsx("div",{className:"text-3xl font-bold text-status-available",children:i.reduce((B,q)=>B+q.plots.filter(Y=>Y.status==="available").length,0)}),L.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Available Plots"})]}),L.jsxs("div",{className:"bg-card border border-border rounded-xl p-5 text-center shadow-sm",children:[L.jsx("div",{className:"text-3xl font-bold text-status-booked",children:i.reduce((B,q)=>B+q.plots.filter(Y=>Y.status==="booked").length,0)}),L.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Booked Plots"})]}),L.jsxs("div",{className:"bg-card border border-border rounded-xl p-5 text-center shadow-sm",children:[L.jsx("div",{className:"text-3xl font-bold text-status-sold",children:i.reduce((B,q)=>B+q.plots.filter(Y=>Y.status==="sold").length,0)}),L.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Sold Plots"})]})]})]})]}),L.jsx("footer",{className:"border-t border-border mt-12",children:L.jsxs("div",{className:"container px-4 py-6 text-center text-sm text-muted-foreground",children:[" ",new Date().getFullYear()," PlotManager. All rights reserved."]})})]})};function Zq({plot:i,position:l}){const h=lw[i.status],g={left:l.x+15,top:l.y+15};return L.jsx("div",{className:"absolute z-50 pointer-events-none animate-fade-in hidden sm:block",style:g,children:L.jsxs("div",{className:"bg-card border border-border rounded-xl shadow-lg p-4 min-w-[200px]",children:[L.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-border",children:[L.jsxs("span",{className:"text-lg font-bold text-foreground",children:["Unit ",i.plotNumber]}),L.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:h.bg,border:`1px solid ${h.border}`,color:h.border},children:h.label})]}),L.jsxs("div",{className:"space-y-2 text-sm",children:[L.jsxs("div",{className:"flex justify-between",children:[L.jsx("span",{className:"text-muted-foreground",children:"Area"}),L.jsxs("span",{className:"text-foreground font-medium",children:[i.area," sq.yd"]})]}),L.jsxs("div",{className:"flex justify-between",children:[L.jsx("span",{className:"text-muted-foreground",children:"Facing"}),L.jsx("span",{className:"text-foreground font-medium",children:i.facing})]}),L.jsxs("div",{className:"flex justify-between",children:[L.jsx("span",{className:"text-muted-foreground",children:"Price"}),L.jsx("span",{className:"text-primary font-bold",children:KO(i.price)})]})]}),L.jsx("div",{className:"mt-3 pt-2 border-t border-border text-center",children:L.jsx("span",{className:"text-xs text-muted-foreground",children:"Click for details"})})]})})}const U3=G.forwardRef(({className:i,...l},h)=>L.jsx("textarea",{className:vr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:h,...l}));U3.displayName="Textarea";function AD(i,[l,h]){return Math.min(h,Math.max(l,i))}var Xq="DismissableLayer",ES="dismissableLayer.update",Yq="dismissableLayer.pointerDownOutside",Kq="dismissableLayer.focusOutside",PD,V3=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$3=G.forwardRef((i,l)=>{const{disableOutsidePointerEvents:h=!1,onEscapeKeyDown:g,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:R,onDismiss:o,...N}=i,B=G.useContext(V3),[q,Y]=G.useState(null),J=(q==null?void 0:q.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ie]=G.useState({}),be=$i(l,Te=>Y(Te)),te=Array.from(B.layers),[le]=[...B.layersWithOutsidePointerEventsDisabled].slice(-1),ce=te.indexOf(le),oe=q?te.indexOf(q):-1,ue=B.layersWithOutsidePointerEventsDisabled.size>0,Me=oe>=ce,Ne=eZ(Te=>{const Ve=Te.target,nt=[...B.branches].some(At=>At.contains(Ve));!Me||nt||(w==null||w(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J),je=tZ(Te=>{const Ve=Te.target;[...B.branches].some(At=>At.contains(Ve))||(S==null||S(Te),R==null||R(Te),Te.defaultPrevented||o==null||o())},J);return Ky(Te=>{oe===B.layers.size-1&&(g==null||g(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},J),G.useEffect(()=>{if(q)return h&&(B.layersWithOutsidePointerEventsDisabled.size===0&&(PD=J.body.style.pointerEvents,J.body.style.pointerEvents="none"),B.layersWithOutsidePointerEventsDisabled.add(q)),B.layers.add(q),MD(),()=>{h&&B.layersWithOutsidePointerEventsDisabled.size===1&&(J.body.style.pointerEvents=PD)}},[q,J,h,B]),G.useEffect(()=>()=>{q&&(B.layers.delete(q),B.layersWithOutsidePointerEventsDisabled.delete(q),MD())},[q,B]),G.useEffect(()=>{const Te=()=>ie({});return document.addEventListener(ES,Te),()=>document.removeEventListener(ES,Te)},[]),L.jsx(_i.div,{...N,ref:be,style:{pointerEvents:ue?Me?"auto":"none":void 0,...i.style},onFocusCapture:bn(i.onFocusCapture,je.onFocusCapture),onBlurCapture:bn(i.onBlurCapture,je.onBlurCapture),onPointerDownCapture:bn(i.onPointerDownCapture,Ne.onPointerDownCapture)})});$3.displayName=Xq;var Qq="DismissableLayerBranch",Jq=G.forwardRef((i,l)=>{const h=G.useContext(V3),g=G.useRef(null),w=$i(l,g);return G.useEffect(()=>{const S=g.current;if(S)return h.branches.add(S),()=>{h.branches.delete(S)}},[h.branches]),L.jsx(_i.div,{...i,ref:w})});Jq.displayName=Qq;function eZ(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1),w=G.useRef(()=>{});return G.useEffect(()=>{const S=o=>{if(o.target&&!g.current){let N=function(){G3(Yq,h,B,{discrete:!0})};const B={originalEvent:o};o.pointerType==="touch"?(l.removeEventListener("click",w.current),w.current=N,l.addEventListener("click",w.current,{once:!0})):N()}else l.removeEventListener("click",w.current);g.current=!1},R=window.setTimeout(()=>{l.addEventListener("pointerdown",S)},0);return()=>{window.clearTimeout(R),l.removeEventListener("pointerdown",S),l.removeEventListener("click",w.current)}},[l,h]),{onPointerDownCapture:()=>g.current=!0}}function tZ(i,l=globalThis==null?void 0:globalThis.document){const h=co(i),g=G.useRef(!1);return G.useEffect(()=>{const w=S=>{S.target&&!g.current&&G3(Kq,h,{originalEvent:S},{discrete:!1})};return l.addEventListener("focusin",w),()=>l.removeEventListener("focusin",w)},[l,h]),{onFocusCapture:()=>g.current=!0,onBlurCapture:()=>g.current=!1}}function MD(){const i=new CustomEvent(ES);document.dispatchEvent(i)}function G3(i,l,h,{discrete:g}){const w=h.originalEvent.target,S=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:h});l&&w.addEventListener(i,l,{once:!0}),g?tf(w,S):w.dispatchEvent(S)}function nZ(i){const l=G.useRef({value:i,previous:i});return G.useMemo(()=>(l.current.value!==i&&(l.current.previous=l.current.value,l.current.value=i),l.current.previous),[i])}var iZ=[" ","Enter","ArrowUp","ArrowDown"],rZ=[" ","Enter"],Yh="Select",[_w,yw,oZ]=X1(Yh),[Xm,iX]=cu(Yh,[oZ,Hm]),vw=Hm(),[sZ,Ed]=Xm(Yh),[aZ,lZ]=Xm(Yh),H3=i=>{const{__scopeSelect:l,children:h,open:g,defaultOpen:w,onOpenChange:S,value:R,defaultValue:o,onValueChange:N,dir:B,name:q,autoComplete:Y,disabled:J,required:ie,form:be}=i,te=vw(l),[le,ce]=G.useState(null),[oe,ue]=G.useState(null),[Me,Ne]=G.useState(!1),je=QE(B),[Te,Ve]=km({prop:g,defaultProp:w??!1,onChange:S,caller:Yh}),[nt,At]=km({prop:R,defaultProp:o,onChange:N,caller:Yh}),cn=G.useRef(null),qt=le?be||!!le.closest("form"):!0,[Ht,st]=G.useState(new Set),Tt=Array.from(Ht).map(xt=>xt.props.value).join(";");return L.jsx(xO,{...te,children:L.jsxs(sZ,{required:ie,scope:l,trigger:le,onTriggerChange:ce,valueNode:oe,onValueNodeChange:ue,valueNodeHasChildren:Me,onValueNodeHasChildrenChange:Ne,contentId:tu(),value:nt,onValueChange:At,open:Te,onOpenChange:Ve,dir:je,triggerPointerDownPosRef:cn,disabled:J,children:[L.jsx(_w.Provider,{scope:l,children:L.jsx(aZ,{scope:i.__scopeSelect,onNativeOptionAdd:G.useCallback(xt=>{st(kt=>new Set(kt).add(xt))},[]),onNativeOptionRemove:G.useCallback(xt=>{st(kt=>{const ze=new Set(kt);return ze.delete(xt),ze})},[]),children:h})}),qt?L.jsxs(mN,{"aria-hidden":!0,required:ie,tabIndex:-1,name:q,autoComplete:Y,value:nt,onChange:xt=>At(xt.target.value),disabled:J,form:be,children:[nt===void 0?L.jsx("option",{value:""}):null,Array.from(Ht)]},Tt):null]})})};H3.displayName=Yh;var W3="SelectTrigger",q3=G.forwardRef((i,l)=>{const{__scopeSelect:h,disabled:g=!1,...w}=i,S=vw(h),R=Ed(W3,h),o=R.disabled||g,N=$i(l,R.onTriggerChange),B=yw(h),q=G.useRef("touch"),[Y,J,ie]=_N(te=>{const le=B().filter(ue=>!ue.disabled),ce=le.find(ue=>ue.value===R.value),oe=yN(le,te,ce);oe!==void 0&&R.onValueChange(oe.value)}),be=te=>{o||(R.onOpenChange(!0),ie()),te&&(R.triggerPointerDownPosRef.current={x:Math.round(te.pageX),y:Math.round(te.pageY)})};return L.jsx(GE,{asChild:!0,...S,children:L.jsx(_i.button,{type:"button",role:"combobox","aria-controls":R.contentId,"aria-expanded":R.open,"aria-required":R.required,"aria-autocomplete":"none",dir:R.dir,"data-state":R.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":gN(R.value)?"":void 0,...w,ref:N,onClick:bn(w.onClick,te=>{te.currentTarget.focus(),q.current!=="mouse"&&be(te)}),onPointerDown:bn(w.onPointerDown,te=>{q.current=te.pointerType;const le=te.target;le.hasPointerCapture(te.pointerId)&&le.releasePointerCapture(te.pointerId),te.button===0&&te.ctrlKey===!1&&te.pointerType==="mouse"&&(be(te),te.preventDefault())}),onKeyDown:bn(w.onKeyDown,te=>{const le=Y.current!=="";!(te.ctrlKey||te.altKey||te.metaKey)&&te.key.length===1&&J(te.key),!(le&&te.key===" ")&&iZ.includes(te.key)&&(be(),te.preventDefault())})})})});q3.displayName=W3;var Z3="SelectValue",X3=G.forwardRef((i,l)=>{const{__scopeSelect:h,className:g,style:w,children:S,placeholder:R="",...o}=i,N=Ed(Z3,h),{onValueNodeHasChildrenChange:B}=N,q=S!==void 0,Y=$i(l,N.onValueNodeChange);return Oo(()=>{B(q)},[B,q]),L.jsx(_i.span,{...o,ref:Y,style:{pointerEvents:"none"},children:gN(N.value)?L.jsx(L.Fragment,{children:R}):S})});X3.displayName=Z3;var cZ="SelectIcon",Y3=G.forwardRef((i,l)=>{const{__scopeSelect:h,children:g,...w}=i;return L.jsx(_i.span,{"aria-hidden":!0,...w,ref:l,children:g||""})});Y3.displayName=cZ;var uZ="SelectPortal",K3=i=>L.jsx(Qy,{asChild:!0,...i});K3.displayName=uZ;var Kh="SelectContent",Q3=G.forwardRef((i,l)=>{const h=Ed(Kh,i.__scopeSelect),[g,w]=G.useState();if(Oo(()=>{w(new DocumentFragment)},[]),!h.open){const S=g;return S?ef.createPortal(L.jsx(J3,{scope:i.__scopeSelect,children:L.jsx(_w.Slot,{scope:i.__scopeSelect,children:L.jsx("div",{children:i.children})})}),S):null}return L.jsx(eN,{...i,ref:l})});Q3.displayName=Kh;var Tl=10,[J3,Id]=Xm(Kh),dZ="SelectContentImpl",hZ=Hh("SelectContent.RemoveScroll"),eN=G.forwardRef((i,l)=>{const{__scopeSelect:h,position:g="item-aligned",onCloseAutoFocus:w,onEscapeKeyDown:S,onPointerDownOutside:R,side:o,sideOffset:N,align:B,alignOffset:q,arrowPadding:Y,collisionBoundary:J,collisionPadding:ie,sticky:be,hideWhenDetached:te,avoidCollisions:le,...ce}=i,oe=Ed(Kh,h),[ue,Me]=G.useState(null),[Ne,je]=G.useState(null),Te=$i(l,nn=>Me(nn)),[Ve,nt]=G.useState(null),[At,cn]=G.useState(null),qt=yw(h),[Ht,st]=G.useState(!1),Tt=G.useRef(!1);G.useEffect(()=>{if(ue)return JE(ue)},[ue]),nF();const xt=G.useCallback(nn=>{const[Zn,..._n]=qt().map(Kn=>Kn.ref.current),[En]=_n.slice(-1),An=document.activeElement;for(const Kn of nn)if(Kn===An||(Kn==null||Kn.scrollIntoView({block:"nearest"}),Kn===Zn&&Ne&&(Ne.scrollTop=0),Kn===En&&Ne&&(Ne.scrollTop=Ne.scrollHeight),Kn==null||Kn.focus(),document.activeElement!==An))return},[qt,Ne]),kt=G.useCallback(()=>xt([Ve,ue]),[xt,Ve,ue]);G.useEffect(()=>{Ht&&kt()},[Ht,kt]);const{onOpenChange:ze,triggerPointerDownPosRef:He}=oe;G.useEffect(()=>{if(ue){let nn={x:0,y:0};const Zn=En=>{var An,Kn;nn={x:Math.abs(Math.round(En.pageX)-(((An=He.current)==null?void 0:An.x)??0)),y:Math.abs(Math.round(En.pageY)-(((Kn=He.current)==null?void 0:Kn.y)??0))}},_n=En=>{nn.x<=10&&nn.y<=10?En.preventDefault():ue.contains(En.target)||ze(!1),document.removeEventListener("pointermove",Zn),He.current=null};return He.current!==null&&(document.addEventListener("pointermove",Zn),document.addEventListener("pointerup",_n,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Zn),document.removeEventListener("pointerup",_n,{capture:!0})}}},[ue,ze,He]),G.useEffect(()=>{const nn=()=>ze(!1);return window.addEventListener("blur",nn),window.addEventListener("resize",nn),()=>{window.removeEventListener("blur",nn),window.removeEventListener("resize",nn)}},[ze]);const[mt,$t]=_N(nn=>{const Zn=qt().filter(An=>!An.disabled),_n=Zn.find(An=>An.ref.current===document.activeElement),En=yN(Zn,nn,_n);En&&setTimeout(()=>En.ref.current.focus())}),Gt=G.useCallback((nn,Zn,_n)=>{const En=!Tt.current&&!_n;(oe.value!==void 0&&oe.value===Zn||En)&&(nt(nn),En&&(Tt.current=!0))},[oe.value]),Kt=G.useCallback(()=>ue==null?void 0:ue.focus(),[ue]),mn=G.useCallback((nn,Zn,_n)=>{const En=!Tt.current&&!_n;(oe.value!==void 0&&oe.value===Zn||En)&&cn(nn)},[oe.value]),Yn=g==="popper"?IS:tN,hi=Yn===IS?{side:o,sideOffset:N,align:B,alignOffset:q,arrowPadding:Y,collisionBoundary:J,collisionPadding:ie,sticky:be,hideWhenDetached:te,avoidCollisions:le}:{};return L.jsx(J3,{scope:h,content:ue,viewport:Ne,onViewportChange:je,itemRefCallback:Gt,selectedItem:Ve,onItemLeave:Kt,itemTextRefCallback:mn,focusSelectedItem:kt,selectedItemText:At,position:g,isPositioned:Ht,searchRef:mt,children:L.jsx(dw,{as:hZ,allowPinchZoom:!0,children:L.jsx(cw,{asChild:!0,trapped:oe.open,onMountAutoFocus:nn=>{nn.preventDefault()},onUnmountAutoFocus:bn(w,nn=>{var Zn;(Zn=oe.trigger)==null||Zn.focus({preventScroll:!0}),nn.preventDefault()}),children:L.jsx($3,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:S,onPointerDownOutside:R,onFocusOutside:nn=>nn.preventDefault(),onDismiss:()=>oe.onOpenChange(!1),children:L.jsx(Yn,{role:"listbox",id:oe.contentId,"data-state":oe.open?"open":"closed",dir:oe.dir,onContextMenu:nn=>nn.preventDefault(),...ce,...hi,onPlaced:()=>st(!0),ref:Te,style:{display:"flex",flexDirection:"column",outline:"none",...ce.style},onKeyDown:bn(ce.onKeyDown,nn=>{const Zn=nn.ctrlKey||nn.altKey||nn.metaKey;if(nn.key==="Tab"&&nn.preventDefault(),!Zn&&nn.key.length===1&&$t(nn.key),["ArrowUp","ArrowDown","Home","End"].includes(nn.key)){let En=qt().filter(An=>!An.disabled).map(An=>An.ref.current);if(["ArrowUp","End"].includes(nn.key)&&(En=En.slice().reverse()),["ArrowUp","ArrowDown"].includes(nn.key)){const An=nn.target,Kn=En.indexOf(An);En=En.slice(Kn+1)}setTimeout(()=>xt(En)),nn.preventDefault()}})})})})})})});eN.displayName=dZ;var fZ="SelectItemAlignedPosition",tN=G.forwardRef((i,l)=>{const{__scopeSelect:h,onPlaced:g,...w}=i,S=Ed(Kh,h),R=Id(Kh,h),[o,N]=G.useState(null),[B,q]=G.useState(null),Y=$i(l,Te=>q(Te)),J=yw(h),ie=G.useRef(!1),be=G.useRef(!0),{viewport:te,selectedItem:le,selectedItemText:ce,focusSelectedItem:oe}=R,ue=G.useCallback(()=>{if(S.trigger&&S.valueNode&&o&&B&&te&&le&&ce){const Te=S.trigger.getBoundingClientRect(),Ve=B.getBoundingClientRect(),nt=S.valueNode.getBoundingClientRect(),At=ce.getBoundingClientRect();if(S.dir!=="rtl"){const An=At.left-Ve.left,Kn=nt.left-An,li=Te.left-Kn,Ar=Te.width+li,Qr=Math.max(Ar,Ve.width),xr=window.innerWidth-Tl,Sr=AD(Kn,[Tl,Math.max(Tl,xr-Qr)]);o.style.minWidth=Ar+"px",o.style.left=Sr+"px"}else{const An=Ve.right-At.right,Kn=window.innerWidth-nt.right-An,li=window.innerWidth-Te.right-Kn,Ar=Te.width+li,Qr=Math.max(Ar,Ve.width),xr=window.innerWidth-Tl,Sr=AD(Kn,[Tl,Math.max(Tl,xr-Qr)]);o.style.minWidth=Ar+"px",o.style.right=Sr+"px"}const cn=J(),qt=window.innerHeight-Tl*2,Ht=te.scrollHeight,st=window.getComputedStyle(B),Tt=parseInt(st.borderTopWidth,10),xt=parseInt(st.paddingTop,10),kt=parseInt(st.borderBottomWidth,10),ze=parseInt(st.paddingBottom,10),He=Tt+xt+Ht+ze+kt,mt=Math.min(le.offsetHeight*5,He),$t=window.getComputedStyle(te),Gt=parseInt($t.paddingTop,10),Kt=parseInt($t.paddingBottom,10),mn=Te.top+Te.height/2-Tl,Yn=qt-mn,hi=le.offsetHeight/2,nn=le.offsetTop+hi,Zn=Tt+xt+nn,_n=He-Zn;if(Zn<=mn){const An=cn.length>0&&le===cn[cn.length-1].ref.current;o.style.bottom="0px";const Kn=B.clientHeight-te.offsetTop-te.offsetHeight,li=Math.max(Yn,hi+(An?Kt:0)+Kn+kt),Ar=Zn+li;o.style.height=Ar+"px"}else{const An=cn.length>0&&le===cn[0].ref.current;o.style.top="0px";const li=Math.max(mn,Tt+te.offsetTop+(An?Gt:0)+hi)+_n;o.style.height=li+"px",te.scrollTop=Zn-mn+te.offsetTop}o.style.margin=`${Tl}px 0`,o.style.minHeight=mt+"px",o.style.maxHeight=qt+"px",g==null||g(),requestAnimationFrame(()=>ie.current=!0)}},[J,S.trigger,S.valueNode,o,B,te,le,ce,S.dir,g]);Oo(()=>ue(),[ue]);const[Me,Ne]=G.useState();Oo(()=>{B&&Ne(window.getComputedStyle(B).zIndex)},[B]);const je=G.useCallback(Te=>{Te&&be.current===!0&&(ue(),oe==null||oe(),be.current=!1)},[ue,oe]);return L.jsx(mZ,{scope:h,contentWrapper:o,shouldExpandOnScrollRef:ie,onScrollButtonChange:je,children:L.jsx("div",{ref:N,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Me},children:L.jsx(_i.div,{...w,ref:Y,style:{boxSizing:"border-box",maxHeight:"100%",...w.style}})})})});tN.displayName=fZ;var pZ="SelectPopperPosition",IS=G.forwardRef((i,l)=>{const{__scopeSelect:h,align:g="start",collisionPadding:w=Tl,...S}=i,R=vw(h);return L.jsx(HE,{...R,...S,ref:l,align:g,collisionPadding:w,style:{boxSizing:"border-box",...S.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});IS.displayName=pZ;var[mZ,hI]=Xm(Kh,{}),CS="SelectViewport",nN=G.forwardRef((i,l)=>{const{__scopeSelect:h,nonce:g,...w}=i,S=Id(CS,h),R=hI(CS,h),o=$i(l,S.onViewportChange),N=G.useRef(0);return L.jsxs(L.Fragment,{children:[L.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:g}),L.jsx(_w.Slot,{scope:h,children:L.jsx(_i.div,{"data-radix-select-viewport":"",role:"presentation",...w,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...w.style},onScroll:bn(w.onScroll,B=>{const q=B.currentTarget,{contentWrapper:Y,shouldExpandOnScrollRef:J}=R;if(J!=null&&J.current&&Y){const ie=Math.abs(N.current-q.scrollTop);if(ie>0){const be=window.innerHeight-Tl*2,te=parseFloat(Y.style.minHeight),le=parseFloat(Y.style.height),ce=Math.max(te,le);if(ce<be){const oe=ce+ie,ue=Math.min(be,oe),Me=oe-ue;Y.style.height=ue+"px",Y.style.bottom==="0px"&&(q.scrollTop=Me>0?Me:0,Y.style.justifyContent="flex-end")}}}N.current=q.scrollTop})})})]})});nN.displayName=CS;var iN="SelectGroup",[gZ,_Z]=Xm(iN),yZ=G.forwardRef((i,l)=>{const{__scopeSelect:h,...g}=i,w=tu();return L.jsx(gZ,{scope:h,id:w,children:L.jsx(_i.div,{role:"group","aria-labelledby":w,...g,ref:l})})});yZ.displayName=iN;var rN="SelectLabel",oN=G.forwardRef((i,l)=>{const{__scopeSelect:h,...g}=i,w=_Z(rN,h);return L.jsx(_i.div,{id:w.id,...g,ref:l})});oN.displayName=rN;var R1="SelectItem",[vZ,sN]=Xm(R1),aN=G.forwardRef((i,l)=>{const{__scopeSelect:h,value:g,disabled:w=!1,textValue:S,...R}=i,o=Ed(R1,h),N=Id(R1,h),B=o.value===g,[q,Y]=G.useState(S??""),[J,ie]=G.useState(!1),be=$i(l,oe=>{var ue;return(ue=N.itemRefCallback)==null?void 0:ue.call(N,oe,g,w)}),te=tu(),le=G.useRef("touch"),ce=()=>{w||(o.onValueChange(g),o.onOpenChange(!1))};if(g==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return L.jsx(vZ,{scope:h,value:g,disabled:w,textId:te,isSelected:B,onItemTextChange:G.useCallback(oe=>{Y(ue=>ue||((oe==null?void 0:oe.textContent)??"").trim())},[]),children:L.jsx(_w.ItemSlot,{scope:h,value:g,disabled:w,textValue:q,children:L.jsx(_i.div,{role:"option","aria-labelledby":te,"data-highlighted":J?"":void 0,"aria-selected":B&&J,"data-state":B?"checked":"unchecked","aria-disabled":w||void 0,"data-disabled":w?"":void 0,tabIndex:w?void 0:-1,...R,ref:be,onFocus:bn(R.onFocus,()=>ie(!0)),onBlur:bn(R.onBlur,()=>ie(!1)),onClick:bn(R.onClick,()=>{le.current!=="mouse"&&ce()}),onPointerUp:bn(R.onPointerUp,()=>{le.current==="mouse"&&ce()}),onPointerDown:bn(R.onPointerDown,oe=>{le.current=oe.pointerType}),onPointerMove:bn(R.onPointerMove,oe=>{var ue;le.current=oe.pointerType,w?(ue=N.onItemLeave)==null||ue.call(N):le.current==="mouse"&&oe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:bn(R.onPointerLeave,oe=>{var ue;oe.currentTarget===document.activeElement&&((ue=N.onItemLeave)==null||ue.call(N))}),onKeyDown:bn(R.onKeyDown,oe=>{var Me;((Me=N.searchRef)==null?void 0:Me.current)!==""&&oe.key===" "||(rZ.includes(oe.key)&&ce(),oe.key===" "&&oe.preventDefault())})})})})});aN.displayName=R1;var sy="SelectItemText",lN=G.forwardRef((i,l)=>{const{__scopeSelect:h,className:g,style:w,...S}=i,R=Ed(sy,h),o=Id(sy,h),N=sN(sy,h),B=lZ(sy,h),[q,Y]=G.useState(null),J=$i(l,ce=>Y(ce),N.onItemTextChange,ce=>{var oe;return(oe=o.itemTextRefCallback)==null?void 0:oe.call(o,ce,N.value,N.disabled)}),ie=q==null?void 0:q.textContent,be=G.useMemo(()=>L.jsx("option",{value:N.value,disabled:N.disabled,children:ie},N.value),[N.disabled,N.value,ie]),{onNativeOptionAdd:te,onNativeOptionRemove:le}=B;return Oo(()=>(te(be),()=>le(be)),[te,le,be]),L.jsxs(L.Fragment,{children:[L.jsx(_i.span,{id:N.textId,...S,ref:J}),N.isSelected&&R.valueNode&&!R.valueNodeHasChildren?ef.createPortal(S.children,R.valueNode):null]})});lN.displayName=sy;var cN="SelectItemIndicator",uN=G.forwardRef((i,l)=>{const{__scopeSelect:h,...g}=i;return sN(cN,h).isSelected?L.jsx(_i.span,{"aria-hidden":!0,...g,ref:l}):null});uN.displayName=cN;var AS="SelectScrollUpButton",dN=G.forwardRef((i,l)=>{const h=Id(AS,i.__scopeSelect),g=hI(AS,i.__scopeSelect),[w,S]=G.useState(!1),R=$i(l,g.onScrollButtonChange);return Oo(()=>{if(h.viewport&&h.isPositioned){let o=function(){const B=N.scrollTop>0;S(B)};const N=h.viewport;return o(),N.addEventListener("scroll",o),()=>N.removeEventListener("scroll",o)}},[h.viewport,h.isPositioned]),w?L.jsx(fN,{...i,ref:R,onAutoScroll:()=>{const{viewport:o,selectedItem:N}=h;o&&N&&(o.scrollTop=o.scrollTop-N.offsetHeight)}}):null});dN.displayName=AS;var PS="SelectScrollDownButton",hN=G.forwardRef((i,l)=>{const h=Id(PS,i.__scopeSelect),g=hI(PS,i.__scopeSelect),[w,S]=G.useState(!1),R=$i(l,g.onScrollButtonChange);return Oo(()=>{if(h.viewport&&h.isPositioned){let o=function(){const B=N.scrollHeight-N.clientHeight,q=Math.ceil(N.scrollTop)<B;S(q)};const N=h.viewport;return o(),N.addEventListener("scroll",o),()=>N.removeEventListener("scroll",o)}},[h.viewport,h.isPositioned]),w?L.jsx(fN,{...i,ref:R,onAutoScroll:()=>{const{viewport:o,selectedItem:N}=h;o&&N&&(o.scrollTop=o.scrollTop+N.offsetHeight)}}):null});hN.displayName=PS;var fN=G.forwardRef((i,l)=>{const{__scopeSelect:h,onAutoScroll:g,...w}=i,S=Id("SelectScrollButton",h),R=G.useRef(null),o=yw(h),N=G.useCallback(()=>{R.current!==null&&(window.clearInterval(R.current),R.current=null)},[]);return G.useEffect(()=>()=>N(),[N]),Oo(()=>{var q;const B=o().find(Y=>Y.ref.current===document.activeElement);(q=B==null?void 0:B.ref.current)==null||q.scrollIntoView({block:"nearest"})},[o]),L.jsx(_i.div,{"aria-hidden":!0,...w,ref:l,style:{flexShrink:0,...w.style},onPointerDown:bn(w.onPointerDown,()=>{R.current===null&&(R.current=window.setInterval(g,50))}),onPointerMove:bn(w.onPointerMove,()=>{var B;(B=S.onItemLeave)==null||B.call(S),R.current===null&&(R.current=window.setInterval(g,50))}),onPointerLeave:bn(w.onPointerLeave,()=>{N()})})}),xZ="SelectSeparator",pN=G.forwardRef((i,l)=>{const{__scopeSelect:h,...g}=i;return L.jsx(_i.div,{"aria-hidden":!0,...g,ref:l})});pN.displayName=xZ;var MS="SelectArrow",wZ=G.forwardRef((i,l)=>{const{__scopeSelect:h,...g}=i,w=vw(h),S=Ed(MS,h),R=Id(MS,h);return S.open&&R.position==="popper"?L.jsx(WE,{...w,...g,ref:l}):null});wZ.displayName=MS;var bZ="SelectBubbleInput",mN=G.forwardRef(({__scopeSelect:i,value:l,...h},g)=>{const w=G.useRef(null),S=$i(g,w),R=nZ(l);return G.useEffect(()=>{const o=w.current;if(!o)return;const N=window.HTMLSelectElement.prototype,q=Object.getOwnPropertyDescriptor(N,"value").set;if(R!==l&&q){const Y=new Event("change",{bubbles:!0});q.call(o,l),o.dispatchEvent(Y)}},[R,l]),L.jsx(_i.select,{...h,style:{...az,...h.style},ref:S,defaultValue:l})});mN.displayName=bZ;function gN(i){return i===""||i===void 0}function _N(i){const l=co(i),h=G.useRef(""),g=G.useRef(0),w=G.useCallback(R=>{const o=h.current+R;l(o),function N(B){h.current=B,window.clearTimeout(g.current),B!==""&&(g.current=window.setTimeout(()=>N(""),1e3))}(o)},[l]),S=G.useCallback(()=>{h.current="",window.clearTimeout(g.current)},[]);return G.useEffect(()=>()=>window.clearTimeout(g.current),[]),[h,w,S]}function yN(i,l,h){const w=l.length>1&&Array.from(l).every(B=>B===l[0])?l[0]:l,S=h?i.indexOf(h):-1;let R=TZ(i,Math.max(S,0));w.length===1&&(R=R.filter(B=>B!==h));const N=R.find(B=>B.textValue.toLowerCase().startsWith(w.toLowerCase()));return N!==h?N:void 0}function TZ(i,l){return i.map((h,g)=>i[(l+g)%i.length])}var SZ=H3,vN=q3,EZ=X3,IZ=Y3,CZ=K3,xN=Q3,AZ=nN,wN=oN,bN=aN,PZ=lN,MZ=uN,TN=dN,SN=hN,EN=pN;const IN=SZ,CN=EZ,fI=G.forwardRef(({className:i,children:l,...h},g)=>L.jsxs(vN,{ref:g,className:vr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",i),...h,children:[l,L.jsx(IZ,{asChild:!0,children:L.jsx(Dz,{className:"h-4 w-4 opacity-50"})})]}));fI.displayName=vN.displayName;const AN=G.forwardRef(({className:i,...l},h)=>L.jsx(TN,{ref:h,className:vr("flex cursor-default items-center justify-center py-1",i),...l,children:L.jsx(G6,{className:"h-4 w-4"})}));AN.displayName=TN.displayName;const PN=G.forwardRef(({className:i,...l},h)=>L.jsx(SN,{ref:h,className:vr("flex cursor-default items-center justify-center py-1",i),...l,children:L.jsx(Dz,{className:"h-4 w-4"})}));PN.displayName=SN.displayName;const pI=G.forwardRef(({className:i,children:l,position:h="popper",...g},w)=>L.jsx(CZ,{children:L.jsxs(xN,{ref:w,className:vr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",h==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",i),position:h,...g,children:[L.jsx(AN,{}),L.jsx(AZ,{className:vr("p-1",h==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),L.jsx(PN,{})]})}));pI.displayName=xN.displayName;const RZ=G.forwardRef(({className:i,...l},h)=>L.jsx(wN,{ref:h,className:vr("py-1.5 pl-8 pr-2 text-sm font-semibold",i),...l}));RZ.displayName=wN.displayName;const Jc=G.forwardRef(({className:i,children:l,...h},g)=>L.jsxs(bN,{ref:g,className:vr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",i),...h,children:[L.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:L.jsx(MZ,{children:L.jsx(Rz,{className:"h-4 w-4"})})}),L.jsx(PZ,{children:l})]}));Jc.displayName=bN.displayName;const DZ=G.forwardRef(({className:i,...l},h)=>L.jsx(EN,{ref:h,className:vr("-mx-1 my-1 h-px bg-muted",i),...l}));DZ.displayName=EN.displayName;function LZ({plot:i,project:l,isAdmin:h,onClose:g,onUpdate:w,onDelete:S}){const[R,o]=G.useState(!1),[N,B]=G.useState(!1),[q,Y]=G.useState({plotNumber:i.plotNumber,area:i.area,dimensions:i.dimensions,facing:i.facing,price:i.price,status:i.status,ownerName:i.ownerName||"",saleDate:i.saleDate||"",notes:i.notes||""}),J=lw[i.status],ie=()=>{w(q),o(!1),cr.success("Plot updated successfully")},be=()=>{S(),cr.success("Plot deleted successfully")},te=({icon:le,label:ce,value:oe})=>L.jsxs("div",{className:"flex items-center gap-3 py-2",children:[L.jsx(le,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"}),L.jsx("span",{className:"text-muted-foreground text-sm w-24",children:ce}),L.jsx("span",{className:"text-foreground font-medium",children:oe})]});return L.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 bg-foreground/20 animate-fade-in",onClick:g,children:L.jsxs("div",{className:"bg-card border-t sm:border border-border rounded-t-2xl sm:rounded-2xl w-full sm:max-w-lg max-h-[85vh] sm:max-h-[90vh] overflow-hidden shadow-xl animate-scale-in",onClick:le=>le.stopPropagation(),children:[L.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsxs("h2",{className:"text-2xl font-bold text-foreground",children:["Unit ",i.plotNumber]}),L.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:J.bg,border:`1px solid ${J.border}`,color:J.border},children:J.label})]}),L.jsxs("div",{className:"flex items-center gap-2",children:[h&&!R&&L.jsx(Oi,{variant:"ghost",size:"icon",onClick:()=>o(!0),className:"text-muted-foreground hover:text-foreground",children:L.jsx(zy,{className:"w-4 h-4"})}),L.jsx(Oi,{variant:"ghost",size:"icon",onClick:g,className:"text-muted-foreground hover:text-foreground",children:L.jsx(kE,{className:"w-5 h-5"})})]})]}),L.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-80px)]",children:R?L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"plotNumber",children:"Plot Number"}),L.jsx(rr,{id:"plotNumber",value:q.plotNumber,onChange:le=>Y({...q,plotNumber:le.target.value})})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"area",children:"Area (sq.yd)"}),L.jsx(rr,{id:"area",type:"number",value:q.area,onChange:le=>Y({...q,area:parseFloat(le.target.value)})})]})]}),L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"dimensions",children:"Dimensions"}),L.jsx(rr,{id:"dimensions",value:q.dimensions,onChange:le=>Y({...q,dimensions:le.target.value})})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"facing",children:"Facing"}),L.jsx(rr,{id:"facing",value:q.facing,onChange:le=>Y({...q,facing:le.target.value})})]})]}),L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"price",children:"Price ()"}),L.jsx(rr,{id:"price",type:"number",value:q.price,onChange:le=>Y({...q,price:parseFloat(le.target.value)})})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"status",children:"Status"}),L.jsxs(IN,{value:q.status,onValueChange:le=>Y({...q,status:le}),children:[L.jsx(fI,{children:L.jsx(CN,{})}),L.jsxs(pI,{children:[L.jsx(Jc,{value:"available",children:"Available"}),L.jsx(Jc,{value:"booked",children:"Booked"}),L.jsx(Jc,{value:"sold",children:"Sold"}),L.jsx(Jc,{value:"mortgaged",children:"Mortgaged"})]})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"ownerName",children:"Owner Name"}),L.jsx(rr,{id:"ownerName",value:q.ownerName,onChange:le=>Y({...q,ownerName:le.target.value}),placeholder:"Enter owner name"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"saleDate",children:"Sale Date"}),L.jsx(rr,{id:"saleDate",type:"date",value:q.saleDate,onChange:le=>Y({...q,saleDate:le.target.value})})]})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"notes",children:"Notes"}),L.jsx(U3,{id:"notes",value:q.notes,onChange:le=>Y({...q,notes:le.target.value}),placeholder:"Additional notes...",rows:3})]}),L.jsxs("div",{className:"flex gap-3 pt-4",children:[L.jsxs(Oi,{onClick:ie,className:"flex-1",children:[L.jsx(t8,{className:"w-4 h-4 mr-2"}),"Save Changes"]}),L.jsx(Oi,{variant:"outline",onClick:()=>o(!1),children:"Cancel"})]})]}):N?L.jsxs("div",{className:"space-y-4 text-center py-4",children:[L.jsx("div",{className:"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto",children:L.jsx(Om,{className:"w-6 h-6 text-destructive"})}),L.jsxs("div",{children:[L.jsxs("h3",{className:"font-semibold text-foreground",children:["Delete Plot ",i.plotNumber,"?"]}),L.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This action cannot be undone."})]}),L.jsxs("div",{className:"flex gap-3 justify-center pt-2",children:[L.jsx(Oi,{variant:"destructive",onClick:be,children:"Delete Plot"}),L.jsx(Oi,{variant:"outline",onClick:()=>B(!1),children:"Cancel"})]})]}):L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"p-3 rounded-xl bg-secondary border border-border",children:[L.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Project Details"}),L.jsx(te,{icon:zm,label:"Project",value:l.name}),L.jsx(te,{icon:Nh,label:"Location",value:l.location}),l.description&&L.jsx(te,{icon:AR,label:"Description",value:l.description}),l.contactDetails&&L.jsx(te,{icon:Fz,label:"Contact",value:l.contactDetails})]}),L.jsxs("div",{className:"p-3 rounded-xl bg-muted/30 border border-border",children:[L.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Plot Information"}),L.jsx(te,{icon:Nh,label:"Plot No.",value:i.plotNumber}),L.jsx(te,{icon:PR,label:"Area",value:`${i.area} sq.yd`}),L.jsx(te,{icon:PR,label:"Dimensions",value:i.dimensions||"N/A"}),L.jsx(te,{icon:W6,label:"Facing",value:i.facing||"N/A"}),L.jsx(te,{icon:Z6,label:"Price",value:KO(i.price)})]}),(i.ownerName||i.saleDate)&&L.jsxs("div",{className:"p-3 rounded-xl bg-muted/30 border border-border",children:[L.jsx("h4",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Ownership Details"}),i.ownerName&&L.jsx(te,{icon:Bz,label:"Owner",value:i.ownerName}),i.saleDate&&L.jsx(te,{icon:Mz,label:"Sale Date",value:QO(i.saleDate)})]}),i.notes&&L.jsx("div",{className:"p-3 rounded-xl bg-muted/30 border border-border",children:L.jsxs("div",{className:"flex items-start gap-3",children:[L.jsx(AR,{className:"w-4 h-4 text-muted-foreground mt-0.5"}),L.jsxs("div",{children:[L.jsx("span",{className:"text-muted-foreground text-sm block mb-1",children:"Notes"}),L.jsx("p",{className:"text-foreground text-sm",children:i.notes})]})]})}),h&&L.jsxs("div",{className:"pt-4 border-t border-border space-y-2",children:[L.jsxs(Oi,{variant:"outline",className:"w-full",onClick:()=>o(!0),children:[L.jsx(zy,{className:"w-4 h-4 mr-2"}),"Edit Plot Details"]}),L.jsxs(Oi,{variant:"outline",className:"w-full text-destructive hover:text-destructive hover:bg-destructive/10 border-destructive/30",onClick:()=>B(!0),children:[L.jsx(Om,{className:"w-4 h-4 mr-2"}),"Delete Plot"]})]})]})})]})})}function kZ({layoutImage:i,plots:l,projectId:h,project:g,editMode:w}){const{isAdmin:S,updatePlot:R,deletePlot:o}=Xa(),[N,B]=G.useState(null),[q,Y]=G.useState(null),[J,ie]=G.useState(null),[be,te]=G.useState({x:0,y:0}),[le,ce]=G.useState("none"),[oe,ue]=G.useState({x:0,y:0}),[Me,Ne]=G.useState({x:0,y:0,width:0,height:0}),je=G.useRef(null),Te=(Tt,xt)=>{if(le==="none"){if(je.current){const kt=je.current.getBoundingClientRect();te({x:Tt.clientX-kt.left,y:Tt.clientY-kt.top})}B(xt)}},Ve=(Tt,xt)=>{le==="none"&&(w&&S&&!Tt.isLocked?ie(Tt):Y(Tt))},nt=Tt=>{q&&(R(h,q.id,Tt),Y({...q,...Tt}))},At=()=>{q&&(o(h,q.id),Y(null))},cn=(Tt,xt,kt)=>{!w||!S||Tt.isLocked||(kt.preventDefault(),kt.stopPropagation(),ie(Tt),ce(xt),ue({x:kt.clientX,y:kt.clientY}),Ne({...Tt.bounds}))},qt=Tt=>{if(!J||le==="none"||!je.current)return;const xt=je.current.getBoundingClientRect(),kt=(Tt.clientX-oe.x)/xt.width*100,ze=(Tt.clientY-oe.y)/xt.height*100;let He={...Me};le==="move"&&(He.x=Math.max(0,Math.min(100-He.width,Me.x+kt)),He.y=Math.max(0,Math.min(100-He.height,Me.y+ze))),le==="resize"&&(He.width=Math.max(2,Math.min(100-Me.x,Me.width+kt)),He.height=Math.max(2,Math.min(100-Me.y,Me.height+ze))),R(h,J.id,{bounds:He})},Ht=()=>{ce("none"),ie(null)};G.useEffect(()=>(le!=="none"&&(window.addEventListener("mousemove",qt),window.addEventListener("mouseup",Ht)),()=>{window.removeEventListener("mousemove",qt),window.removeEventListener("mouseup",Ht)}),[le,J,oe,Me]);const st=(Tt,xt)=>{xt.preventDefault(),xt.stopPropagation(),R(h,Tt.id,{isLocked:!Tt.isLocked}),cr.success(Tt.isLocked?"Plot unlocked":"Plot locked")};return L.jsxs("div",{className:"relative w-full h-full",children:[L.jsxs("div",{ref:je,className:"relative w-full max-w-full overflow-hidden",style:{aspectRatio:"16 / 9"},children:[L.jsx("img",{src:i,alt:"Layout Plan",draggable:!1,className:"w-full h-full block select-none object-contain px-[6px]"}),L.jsx("div",{className:"absolute inset-0",children:l.map(Tt=>{const xt=lw[Tt.status],kt=(N==null?void 0:N.id)===Tt.id,ze=(J==null?void 0:J.id)===Tt.id,He=w&&S&&!Tt.isLocked;return L.jsxs("div",{className:`absolute transition-all duration-200 ${He?"cursor-move":"cursor-pointer"} ${ze?"ring-2 ring-primary ring-offset-1":""}`,style:{left:`${Tt.bounds.x}%`,top:`${Tt.bounds.y}%`,width:`${Tt.bounds.width}%`,height:`${Tt.bounds.height}%`,backgroundColor:xt.bg,border:`2px solid ${xt.border}`,borderRadius:"4px",zIndex:kt||ze?10:1},onMouseMove:mt=>!w&&Te(mt,Tt),onMouseLeave:()=>B(null),onClick:mt=>Ve(Tt),onMouseDown:mt=>He&&cn(Tt,"move",mt),children:[L.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-[3px] sm:text-[10px] font-bold",children:Tt.plotNumber}),w&&S&&L.jsxs(L.Fragment,{children:[L.jsx("button",{className:"absolute -top-2 -right-2 w-5 h-5 bg-background border rounded-full",onClick:mt=>st(Tt,mt),children:Tt.isLocked?L.jsx(LE,{size:12}):L.jsx(Y6,{size:12})}),!Tt.isLocked&&L.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-primary cursor-se-resize",onMouseDown:mt=>cn(Tt,"resize",mt),children:L.jsx(J6,{size:10})}),!Tt.isLocked&&L.jsx(e8,{className:"absolute top-0.5 left-0.5 w-3 h-3 opacity-50"})]})]},Tt.id)})}),N&&!w&&L.jsx(Zq,{plot:N,position:be})]}),q&&L.jsx(LZ,{plot:q,project:g,isAdmin:S,onClose:()=>Y(null),onUpdate:nt,onDelete:At})]})}function zZ({plots:i}){const l={available:i.filter(g=>g.status==="available").length,booked:i.filter(g=>g.status==="booked").length,sold:i.filter(g=>g.status==="sold").length,mortgaged:i.filter(g=>g.status==="mortgaged").length},h=[{key:"available",label:"Available",count:l.available},{key:"booked",label:"Booked",count:l.booked},{key:"sold",label:"Sold",count:l.sold},{key:"mortgaged",label:"Mortgaged",count:l.mortgaged}];return L.jsx("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:h.map(({key:g,label:w,count:S})=>{const R=lw[g];return L.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1.5 sm:py-2 rounded-lg bg-secondary",children:[L.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:R.bg,border:`2px solid ${R.border}`}}),L.jsx("span",{className:"text-xs sm:text-sm text-foreground font-medium",children:w}),L.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground",children:["(",S,")"]})]},g)})})}function OZ({project:i}){const{updateProject:l,deleteProject:h,isAdmin:g}=Xa(),[w,S]=G.useState(!1),[R,o]=G.useState(!1),[N,B]=G.useState(!1),[q,Y]=G.useState({name:i.name,location:i.location,description:i.description||"",contactDetails:i.contactDetails||""}),[J,ie]=G.useState(""),[be,te]=G.useState(null),[le,ce]=G.useState(""),oe=G.useRef(null),ue=nt=>nt,Me=async(nt,At)=>{const qt=(nt.name.split(".").pop()||"").toLowerCase().replace(/[^a-z0-9]/g,""),Ht=await fetch(ue("/api/storage/presign-upload"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentType:nt.type,prefix:At,ext:qt})});if(!Ht.ok)throw new Error("Could not prepare upload");const st=await Ht.json();if(!(st!=null&&st.key)||!(st!=null&&st.url))throw new Error("Could not prepare upload");if(!(await fetch(st.url,{method:"PUT",headers:{"Content-Type":nt.type},body:nt})).ok)throw new Error("Upload failed");return`s3:${st.key}`};if(!g)return null;const Ne=()=>{l(i.id,{name:q.name.trim(),location:q.location.trim(),description:q.description.trim()||void 0,contactDetails:q.contactDetails.trim()||void 0}),cr.success("Project updated successfully"),S(!1)},je=()=>{h(i.id),cr.success("Project deleted successfully"),o(!1)},Te=nt=>{var cn;const At=(cn=nt.target.files)==null?void 0:cn[0];if(At){if(!At.type.startsWith("image/")){cr.error("Please upload an image file");return}ce(At.name),te(At);const qt=new FileReader;qt.onload=Ht=>{var st;ie((st=Ht.target)==null?void 0:st.result)},qt.readAsDataURL(At)}},Ve=async()=>{if(!J||!be){cr.error("Please select an image");return}try{const nt=await Me(be,"project-layouts");l(i.id,{layoutImage:nt})}catch{cr.error("Image upload failed");return}cr.success("Layout image updated successfully"),B(!1),ie(""),te(null),ce("")};return L.jsxs(L.Fragment,{children:[L.jsxs(d3,{children:[L.jsx(h3,{asChild:!0,children:L.jsxs(Oi,{variant:"outline",size:"sm",className:"gap-2",children:[L.jsx(Nz,{className:"w-4 h-4"}),"Manage Project"]})}),L.jsxs(aI,{align:"end",className:"w-48",children:[L.jsxs(_m,{onClick:()=>S(!0),children:[L.jsx(zy,{className:"w-4 h-4 mr-2"}),"Edit Project"]}),L.jsxs(_m,{onClick:()=>B(!0),children:[L.jsx(zz,{className:"w-4 h-4 mr-2"}),"Replace Layout Image"]}),L.jsx(lI,{}),L.jsxs(_m,{onClick:()=>o(!0),className:"text-destructive focus:text-destructive",children:[L.jsx(Om,{className:"w-4 h-4 mr-2"}),"Delete Project"]})]})]}),L.jsx(Bh,{open:w,onOpenChange:S,children:L.jsxs(gd,{className:"sm:max-w-md",children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Edit Project"})}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editName",children:"Project Name"}),L.jsx(rr,{id:"editName",value:q.name,onChange:nt=>Y({...q,name:nt.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editLocation",children:"Location"}),L.jsx(rr,{id:"editLocation",value:q.location,onChange:nt=>Y({...q,location:nt.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editDescription",children:"Description"}),L.jsx(rr,{id:"editDescription",value:q.description,onChange:nt=>Y({...q,description:nt.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"editContact",children:"Contact Details"}),L.jsx(rr,{id:"editContact",value:q.contactDetails,onChange:nt=>Y({...q,contactDetails:nt.target.value}),className:"mt-1.5"})]}),L.jsxs("div",{className:"flex gap-3 pt-2",children:[L.jsx(Oi,{onClick:Ne,className:"flex-1",children:"Save Changes"}),L.jsx(Oi,{variant:"outline",onClick:()=>S(!1),children:"Cancel"})]})]})]})}),L.jsx(Bh,{open:R,onOpenChange:o,children:L.jsx(gd,{className:"sm:max-w-sm",children:L.jsxs("div",{className:"text-center py-4",children:[L.jsx("div",{className:"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:L.jsx(Om,{className:"w-6 h-6 text-destructive"})}),L.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"Delete Project?"}),L.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:['This will permanently delete "',i.name,'" and all its plots. This action cannot be undone.']}),L.jsxs("div",{className:"flex gap-3 justify-center pt-6",children:[L.jsx(Oi,{variant:"destructive",onClick:je,children:"Delete Project"}),L.jsx(Oi,{variant:"outline",onClick:()=>o(!1),children:"Cancel"})]})]})})}),L.jsx(Bh,{open:N,onOpenChange:B,children:L.jsxs(gd,{className:"sm:max-w-md",children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Replace Layout Image"})}),L.jsxs("div",{className:"space-y-4",children:[L.jsx("input",{ref:oe,type:"file",accept:"image/*",onChange:Te,className:"hidden"}),L.jsx("div",{onClick:()=>{var nt;return(nt=oe.current)==null?void 0:nt.click()},className:"border-2 border-dashed border-border rounded-xl p-6 cursor-pointer hover:border-primary/50 hover:bg-muted/30 transition-all text-center",children:J?L.jsxs("div",{className:"space-y-3",children:[L.jsx("img",{src:J,alt:"Preview",className:"w-full h-40 object-contain rounded-lg"}),L.jsx("p",{className:"text-sm text-muted-foreground",children:le})]}):L.jsxs("div",{className:"space-y-2",children:[L.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted flex items-center justify-center mx-auto",children:L.jsx(aS,{className:"w-6 h-6 text-muted-foreground"})}),L.jsx("p",{className:"text-sm font-medium text-foreground",children:"Click to upload new layout image"})]})}),L.jsxs("div",{className:"flex gap-3",children:[L.jsxs(Oi,{onClick:Ve,className:"flex-1",disabled:!J,children:[L.jsx(aS,{className:"w-4 h-4 mr-2"}),"Update Image"]}),L.jsx(Oi,{variant:"outline",onClick:()=>{B(!1),ie(""),ce("")},children:"Cancel"})]})]})]})})]})}function FZ({projectId:i}){const{addPlot:l,isAdmin:h}=Xa(),[g,w]=G.useState(!1),[S,R]=G.useState({plotNumber:"",area:"",dimensions:"",facing:"",price:"",status:"available",x:"10",y:"10",width:"5",height:"5"});if(!h)return null;const o=N=>{if(N.preventDefault(),!S.plotNumber.trim()){cr.error("Please enter a plot number");return}const B={id:Date.now().toString(),plotNumber:S.plotNumber.trim(),area:parseFloat(S.area)||0,dimensions:S.dimensions.trim(),facing:S.facing.trim(),price:parseFloat(S.price)||0,status:S.status,bounds:{x:parseFloat(S.x)||10,y:parseFloat(S.y)||10,width:parseFloat(S.width)||5,height:parseFloat(S.height)||5},isLocked:!1};l(i,B),cr.success("Plot added successfully! Drag to position it on the layout."),w(!1),R({plotNumber:"",area:"",dimensions:"",facing:"",price:"",status:"available",x:"10",y:"10",width:"5",height:"5"})};return L.jsxs(Bh,{open:g,onOpenChange:w,children:[L.jsx(O3,{asChild:!0,children:L.jsxs(Oi,{size:"sm",className:"gap-2",children:[L.jsx(sS,{className:"w-4 h-4"}),"Add Plot"]})}),L.jsxs(gd,{className:"sm:max-w-md",children:[L.jsx(Zh,{children:L.jsx(Xh,{children:"Add New Plot"})}),L.jsxs("form",{onSubmit:o,className:"space-y-4",children:[L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"plotNumber",children:"Plot Number *"}),L.jsx(rr,{id:"plotNumber",value:S.plotNumber,onChange:N=>R({...S,plotNumber:N.target.value}),placeholder:"e.g., 25 or 1+2+3",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"status",children:"Status"}),L.jsxs(IN,{value:S.status,onValueChange:N=>R({...S,status:N}),children:[L.jsx(fI,{className:"mt-1.5",children:L.jsx(CN,{})}),L.jsxs(pI,{children:[L.jsx(Jc,{value:"available",children:"Available"}),L.jsx(Jc,{value:"booked",children:"Booked"}),L.jsx(Jc,{value:"sold",children:"Sold"}),L.jsx(Jc,{value:"mortgaged",children:"Mortgaged"})]})]})]})]}),L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"area",children:"Area (sq.yd)"}),L.jsx(rr,{id:"area",type:"number",value:S.area,onChange:N=>R({...S,area:N.target.value}),placeholder:"e.g., 150",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"dimensions",children:"Dimensions"}),L.jsx(rr,{id:"dimensions",value:S.dimensions,onChange:N=>R({...S,dimensions:N.target.value}),placeholder:"e.g., 15' x 10'",className:"mt-1.5"})]})]}),L.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"facing",children:"Facing"}),L.jsx(rr,{id:"facing",value:S.facing,onChange:N=>R({...S,facing:N.target.value}),placeholder:"e.g., North",className:"mt-1.5"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"price",children:"Price ()"}),L.jsx(rr,{id:"price",type:"number",value:S.price,onChange:N=>R({...S,price:N.target.value}),placeholder:"e.g., 500000",className:"mt-1.5"})]})]}),L.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border border-border",children:[L.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Initial overlay position (you can drag/resize after adding):"}),L.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"x",className:"text-xs",children:"X (%)"}),L.jsx(rr,{id:"x",type:"number",value:S.x,onChange:N=>R({...S,x:N.target.value}),className:"mt-1 h-8 text-sm"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"y",className:"text-xs",children:"Y (%)"}),L.jsx(rr,{id:"y",type:"number",value:S.y,onChange:N=>R({...S,y:N.target.value}),className:"mt-1 h-8 text-sm"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"width",className:"text-xs",children:"W (%)"}),L.jsx(rr,{id:"width",type:"number",value:S.width,onChange:N=>R({...S,width:N.target.value}),className:"mt-1 h-8 text-sm"})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"height",className:"text-xs",children:"H (%)"}),L.jsx(rr,{id:"height",type:"number",value:S.height,onChange:N=>R({...S,height:N.target.value}),className:"mt-1 h-8 text-sm"})]})]})]}),L.jsxs(Oi,{type:"submit",className:"w-full",children:[L.jsx(sS,{className:"w-4 h-4 mr-2"}),"Add Plot"]})]})]})]})}const NZ=i=>i;function BZ(){const{projectId:i}=GO(),{projects:l,currentProject:h,setCurrentProject:g,isAdmin:w}=Xa(),S=Zm(),[R,o]=G.useState(!1),[N,B]=G.useState(""),q=G.useRef(null);return G.useEffect(()=>{if(i){const Y=l.find(J=>J.id===i);Y?(g(Y),Y.layoutImage||fetch(NZ(`/api/projects/${i}`)).then(J=>J.ok?J.json():null).then(J=>{J&&J.id===i&&g(J)}).catch(()=>{})):S("/")}},[i,l,g,S]),G.useEffect(()=>{let Y=!1;return(async()=>{try{const J=(h==null?void 0:h.layoutImage)||"";if(!J){Y||B("");return}const ie=await aw(J);if(Y)return;ie&&ie.startsWith("blob:")?(q.current&&q.current!==ie&&URL.revokeObjectURL(q.current),q.current=ie):q.current&&(URL.revokeObjectURL(q.current),q.current=null),B(ie)}catch{if(Y)return;B("")}})(),()=>{Y=!0}},[h==null?void 0:h.layoutImage]),G.useEffect(()=>()=>{q.current&&URL.revokeObjectURL(q.current)},[]),h?L.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[L.jsx(j3,{}),L.jsxs("main",{className:"flex-1 container px-4 py-6",children:[L.jsxs("div",{className:"mb-6",children:[L.jsxs(Oi,{variant:"ghost",size:"sm",onClick:()=>{g(null),S("/")},className:"mb-4 text-muted-foreground hover:text-foreground",children:[L.jsx(RE,{className:"w-4 h-4 mr-2"}),"Back to Projects"]}),L.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-foreground",children:h.name}),L.jsxs("div",{className:"flex items-center gap-4 mt-2 text-muted-foreground",children:[L.jsxs("div",{className:"flex items-center gap-1",children:[L.jsx(Nh,{className:"w-4 h-4"}),L.jsx("span",{className:"text-sm",children:h.location})]}),L.jsxs("div",{className:"flex items-center gap-1",children:[L.jsx(kz,{className:"w-4 h-4"}),L.jsxs("span",{className:"text-sm",children:[h.plots.length," Plots"]})]})]})]}),L.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[w&&L.jsxs(L.Fragment,{children:[L.jsxs(Oi,{variant:"outline",size:"sm",onClick:()=>S(`/project/${h.id}/map`),className:"gap-2",children:[L.jsx(Nh,{className:"w-4 h-4"}),"Configure Map"]}),L.jsx(Oi,{variant:R?"default":"outline",size:"sm",onClick:()=>o(!R),className:"gap-2",children:R?L.jsxs(L.Fragment,{children:[L.jsx(DE,{className:"w-4 h-4"}),"View Mode"]}):L.jsxs(L.Fragment,{children:[L.jsx(zy,{className:"w-4 h-4"}),"Edit Overlays"]})}),L.jsx(FZ,{projectId:h.id}),L.jsx(OZ,{project:h})]}),!w&&L.jsxs(Oi,{variant:"outline",size:"sm",onClick:()=>S(`/project/${h.id}/map`),className:"gap-2",children:[L.jsx(Nh,{className:"w-4 h-4"}),"View Map"]}),L.jsx(zZ,{plots:h.plots})]})]})]}),L.jsx("div",{className:"bg-card border border-border rounded-2xl sm:p-4 overflow-hidden shadow-sm -mx-4 px-4 sm:mx-0 sm:px-0",children:L.jsx(kZ,{layoutImage:N||h.layoutImage,plots:h.plots,projectId:h.id,project:h,editMode:R})}),L.jsx("div",{className:"mt-6 p-4 rounded-xl bg-secondary border border-border",children:L.jsx("p",{className:"text-sm text-muted-foreground text-center",children:R&&w?L.jsxs(L.Fragment,{children:[L.jsx("span",{className:"font-medium text-foreground",children:"Edit Mode:"})," Drag plots to reposition, use corner handle to resize, click lock icon to secure position."]}):L.jsxs(L.Fragment,{children:[L.jsx("span",{className:"font-medium text-foreground",children:"Tip:"})," Hover over plots to see quick info, click to view full details."]})})})]})]}):L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"w-12 h-12 rounded-xl bg-muted animate-pulse mx-auto mb-4"}),L.jsx("p",{className:"text-muted-foreground",children:"Loading project..."})]})})}var MN={exports:{}};(function(i,l){(function(h,g){i.exports=g()})(yj,function(){var h,g,w;function S(o,N){if(!h)h=N;else if(!g)g=N;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+g+")(sharedChunk); self.onerror = null;",q={};h(q),w=N(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}S(["exports"],function(o){var N=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;function q(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=n*f-c*a;return p?(r[0]=f*(p=1/p),r[1]=-a*p,r[2]=-c*p,r[3]=n*p,r):null}function Y(){var r=new B(9);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function J(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=e[4],_=e[5],x=e[6],T=e[7],I=e[8];return r[0]=p*I-_*T,r[1]=c*T-a*I,r[2]=a*_-c*p,r[3]=_*x-f*I,r[4]=n*I-c*x,r[5]=c*f-n*_,r[6]=f*T-p*x,r[7]=a*x-n*T,r[8]=n*p-a*f,r}function ie(r,e,n){var a=e[0],c=e[1],f=e[2],p=e[3],_=e[4],x=e[5],T=e[6],I=e[7],C=e[8],P=n[0],D=n[1],k=n[2],j=n[3],H=n[4],$=n[5],K=n[6],ee=n[7],se=n[8];return r[0]=P*a+D*p+k*T,r[1]=P*c+D*_+k*I,r[2]=P*f+D*x+k*C,r[3]=j*a+H*p+$*T,r[4]=j*c+H*_+$*I,r[5]=j*f+H*x+$*C,r[6]=K*a+ee*p+se*T,r[7]=K*c+ee*_+se*I,r[8]=K*f+ee*x+se*C,r}function be(){var r=new B(16);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function te(r){var e=new B(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function le(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ce(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=e[4],_=e[5],x=e[6],T=e[7],I=e[8],C=e[9],P=e[10],D=e[11],k=e[12],j=e[13],H=e[14],$=e[15],K=n*_-a*p,ee=n*x-c*p,se=n*T-f*p,_e=a*x-c*_,fe=a*T-f*_,xe=c*T-f*x,Ie=I*j-C*k,Pe=I*H-P*k,Xe=I*$-D*k,ke=C*H-P*j,Je=C*$-D*j,rt=P*$-D*H,ot=K*rt-ee*Je+se*ke+_e*Xe-fe*Pe+xe*Ie;return ot?(r[0]=(_*rt-x*Je+T*ke)*(ot=1/ot),r[1]=(c*Je-a*rt-f*ke)*ot,r[2]=(j*xe-H*fe+$*_e)*ot,r[3]=(P*fe-C*xe-D*_e)*ot,r[4]=(x*Xe-p*rt-T*Pe)*ot,r[5]=(n*rt-c*Xe+f*Pe)*ot,r[6]=(H*se-k*xe-$*ee)*ot,r[7]=(I*xe-P*se+D*ee)*ot,r[8]=(p*Je-_*Xe+T*Ie)*ot,r[9]=(a*Xe-n*Je-f*Ie)*ot,r[10]=(k*fe-j*se+$*K)*ot,r[11]=(C*se-I*fe-D*K)*ot,r[12]=(_*Pe-p*ke-x*Ie)*ot,r[13]=(n*ke-a*Pe+c*Ie)*ot,r[14]=(j*ee-k*_e-H*K)*ot,r[15]=(I*_e-C*ee+P*K)*ot,r):null}function oe(r,e,n){var a=e[0],c=e[1],f=e[2],p=e[3],_=e[4],x=e[5],T=e[6],I=e[7],C=e[8],P=e[9],D=e[10],k=e[11],j=e[12],H=e[13],$=e[14],K=e[15],ee=n[0],se=n[1],_e=n[2],fe=n[3];return r[0]=ee*a+se*_+_e*C+fe*j,r[1]=ee*c+se*x+_e*P+fe*H,r[2]=ee*f+se*T+_e*D+fe*$,r[3]=ee*p+se*I+_e*k+fe*K,r[4]=(ee=n[4])*a+(se=n[5])*_+(_e=n[6])*C+(fe=n[7])*j,r[5]=ee*c+se*x+_e*P+fe*H,r[6]=ee*f+se*T+_e*D+fe*$,r[7]=ee*p+se*I+_e*k+fe*K,r[8]=(ee=n[8])*a+(se=n[9])*_+(_e=n[10])*C+(fe=n[11])*j,r[9]=ee*c+se*x+_e*P+fe*H,r[10]=ee*f+se*T+_e*D+fe*$,r[11]=ee*p+se*I+_e*k+fe*K,r[12]=(ee=n[12])*a+(se=n[13])*_+(_e=n[14])*C+(fe=n[15])*j,r[13]=ee*c+se*x+_e*P+fe*H,r[14]=ee*f+se*T+_e*D+fe*$,r[15]=ee*p+se*I+_e*k+fe*K,r}function ue(r,e,n){var a,c,f,p,_,x,T,I,C,P,D,k,j=n[0],H=n[1],$=n[2];return e===r?(r[12]=e[0]*j+e[4]*H+e[8]*$+e[12],r[13]=e[1]*j+e[5]*H+e[9]*$+e[13],r[14]=e[2]*j+e[6]*H+e[10]*$+e[14],r[15]=e[3]*j+e[7]*H+e[11]*$+e[15]):(c=e[1],f=e[2],p=e[3],_=e[4],x=e[5],T=e[6],I=e[7],C=e[8],P=e[9],D=e[10],k=e[11],r[0]=a=e[0],r[1]=c,r[2]=f,r[3]=p,r[4]=_,r[5]=x,r[6]=T,r[7]=I,r[8]=C,r[9]=P,r[10]=D,r[11]=k,r[12]=a*j+_*H+C*$+e[12],r[13]=c*j+x*H+P*$+e[13],r[14]=f*j+T*H+D*$+e[14],r[15]=p*j+I*H+k*$+e[15]),r}function Me(r,e,n){var a=n[0],c=n[1],f=n[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ne(r,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[4],p=e[5],_=e[6],x=e[7],T=e[8],I=e[9],C=e[10],P=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*c+T*a,r[5]=p*c+I*a,r[6]=_*c+C*a,r[7]=x*c+P*a,r[8]=T*c-f*a,r[9]=I*c-p*a,r[10]=C*c-_*a,r[11]=P*c-x*a,r}function je(r,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[0],p=e[1],_=e[2],x=e[3],T=e[8],I=e[9],C=e[10],P=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c-T*a,r[1]=p*c-I*a,r[2]=_*c-C*a,r[3]=x*c-P*a,r[8]=f*a+T*c,r[9]=p*a+I*c,r[10]=_*a+C*c,r[11]=x*a+P*c,r}function Te(r,e,n){var a=Math.sin(n),c=Math.cos(n),f=e[0],p=e[1],_=e[2],x=e[3],T=e[4],I=e[5],C=e[6],P=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c+T*a,r[1]=p*c+I*a,r[2]=_*c+C*a,r[3]=x*c+P*a,r[4]=T*c-f*a,r[5]=I*c-p*a,r[6]=C*c-_*a,r[7]=P*c-x*a,r}function Ve(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function nt(r,e,n){var a,c,f,p=n[0],_=n[1],x=n[2],T=Math.sqrt(p*p+_*_+x*x);return T<N?null:(p*=T=1/T,_*=T,x*=T,a=Math.sin(e),c=Math.cos(e),r[0]=p*p*(f=1-c)+c,r[1]=_*p*f+x*a,r[2]=x*p*f-_*a,r[3]=0,r[4]=p*_*f-x*a,r[5]=_*_*f+c,r[6]=x*_*f+p*a,r[7]=0,r[8]=p*x*f+_*a,r[9]=_*x*f-p*a,r[10]=x*x*f+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function At(r,e){var n=e[0],a=e[1],c=e[2],f=e[4],p=e[5],_=e[6],x=e[8],T=e[9],I=e[10];return r[0]=Math.sqrt(n*n+a*a+c*c),r[1]=Math.sqrt(f*f+p*p+_*_),r[2]=Math.sqrt(x*x+T*T+I*I),r}function cn(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=n+n,_=a+a,x=c+c,T=n*p,I=a*p,C=a*_,P=c*p,D=c*_,k=c*x,j=f*p,H=f*_,$=f*x;return r[0]=1-C-k,r[1]=I+$,r[2]=P-H,r[3]=0,r[4]=I-$,r[5]=1-T-k,r[6]=D+j,r[7]=0,r[8]=P+H,r[9]=D-j,r[10]=1-T-C,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var qt=oe;function Ht(){var r=new B(3);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function st(r){var e=new B(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Tt(r){var e=r[0],n=r[1],a=r[2];return Math.sqrt(e*e+n*n+a*a)}function xt(r,e,n){var a=new B(3);return a[0]=r,a[1]=e,a[2]=n,a}function kt(r,e,n,a){return r[0]=e,r[1]=n,r[2]=a,r}function ze(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r[2]=e[2]+n[2],r}function He(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],r}function mt(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r}function $t(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r}function Gt(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r}function Kt(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r}function mn(r,e,n,a){return r[0]=e[0]+n[0]*a,r[1]=e[1]+n[1]*a,r[2]=e[2]+n[2]*a,r}function Yn(r,e){var n=e[0]-r[0],a=e[1]-r[1],c=e[2]-r[2];return Math.sqrt(n*n+a*a+c*c)}function hi(r,e){var n=e[0]-r[0],a=e[1]-r[1],c=e[2]-r[2];return n*n+a*a+c*c}function nn(r){var e=r[0],n=r[1],a=r[2];return e*e+n*n+a*a}function Zn(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function _n(r,e){var n=e[0],a=e[1],c=e[2],f=n*n+a*a+c*c;return f>0&&(f=1/Math.sqrt(f)),r[0]=e[0]*f,r[1]=e[1]*f,r[2]=e[2]*f,r}function En(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function An(r,e,n){var a=e[0],c=e[1],f=e[2],p=n[0],_=n[1],x=n[2];return r[0]=c*x-f*_,r[1]=f*p-a*x,r[2]=a*_-c*p,r}function Kn(r,e,n,a){var c=e[0],f=e[1],p=e[2];return r[0]=c+a*(n[0]-c),r[1]=f+a*(n[1]-f),r[2]=p+a*(n[2]-p),r}function li(r,e,n){var a=e[0],c=e[1],f=e[2],p=n[3]*a+n[7]*c+n[11]*f+n[15];return r[0]=(n[0]*a+n[4]*c+n[8]*f+n[12])/(p=p||1),r[1]=(n[1]*a+n[5]*c+n[9]*f+n[13])/p,r[2]=(n[2]*a+n[6]*c+n[10]*f+n[14])/p,r}function Ar(r,e,n){var a=e[0],c=e[1],f=e[2];return r[0]=a*n[0]+c*n[3]+f*n[6],r[1]=a*n[1]+c*n[4]+f*n[7],r[2]=a*n[2]+c*n[5]+f*n[8],r}function Qr(r,e,n){var a=n[0],c=n[1],f=n[2],p=n[3],_=e[0],x=e[1],T=e[2],I=c*T-f*x,C=f*_-a*T,P=a*x-c*_;return r[0]=_+p*(I+=I)+c*(P+=P)-f*(C+=C),r[1]=x+p*C+f*I-a*P,r[2]=T+p*P+a*C-c*I,r}function xr(r){return r[0]=0,r[1]=0,r[2]=0,r}function Sr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Di=He,uo=mt,Rs=Tt;function qo(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function ps(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r}function ho(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=n*n+a*a+c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),r[0]=n*p,r[1]=a*p,r[2]=c*p,r[3]=f*p,r}function oo(r,e,n){var a=e[0],c=e[1],f=e[2],p=e[3];return r[0]=n[0]*a+n[4]*c+n[8]*f+n[12]*p,r[1]=n[1]*a+n[5]*c+n[9]*f+n[13]*p,r[2]=n[2]*a+n[6]*c+n[10]*f+n[14]*p,r[3]=n[3]*a+n[7]*c+n[11]*f+n[15]*p,r}function Js(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function fo(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function vo(r,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return r[0]=a*x+p*_,r[1]=c*x+f*_,r[2]=f*x-c*_,r[3]=p*x-a*_,r}function ea(r,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return r[0]=a*x-f*_,r[1]=c*x+p*_,r[2]=f*x+a*_,r[3]=p*x-c*_,r}Ht(),qo();var xo,Ds,Ya,ba=ho,Ta=(xo=Ht(),Ds=xt(1,0,0),Ya=xt(0,1,0),function(r,e,n){var a=En(e,n);return a<-.999999?(An(xo,Ds,e),Rs(xo)<1e-6&&An(xo,Ya,e),_n(xo,xo),function(c,f,p){p*=.5;var _=Math.sin(p);c[0]=_*f[0],c[1]=_*f[1],c[2]=_*f[2],c[3]=Math.cos(p)}(r,xo,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(An(xo,e,n),r[0]=xo[0],r[1]=xo[1],r[2]=xo[2],r[3]=1+a,ba(r,r))});function Er(){var r=new B(2);return B!=Float32Array&&(r[0]=0,r[1]=0),r}function wo(r,e){var n=new B(2);return n[0]=r,n[1]=e,n}function Ls(r,e,n){return r[0]=e,r[1]=n,r}function Sa(r,e,n){return r[0]=e[0]+n[0],r[1]=e[1]+n[1],r}function ks(r,e,n){return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r}function zs(r,e,n){return r[0]=e[0]*n,r[1]=e[1]*n,r}function rs(r){var e=r[0],n=r[1];return Math.sqrt(e*e+n*n)}function yc(r,e){var n=e[0],a=e[1],c=n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),r[0]=e[0]*c,r[1]=e[1]*c,r}function ta(r,e){return r[0]*e[0]+r[1]*e[1]}Js(),Js(),Y();var Ai,Wr,fi=ks;function Hi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Er();var Wi=function(){if(Wr)return Ai;function r(e,n,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=a,this.p2y=c}return Wr=1,Ai=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var f=this.sampleCurveX(a)-e;if(Math.abs(f)<n)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=f/p}var _=0,x=1;for(a=e,c=0;c<20&&(f=this.sampleCurveX(a),!(Math.abs(f-e)<n));c++)e>f?_=a:x=a,a=.5*(x-_)+_;return a},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Ai}(),Fo=Hi(Wi);function at(r,e){this.x=r,this.y=e}function bo(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!bo(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!bo(r[n],e[n]))return!1;return!0}return r===e}at.prototype={clone(){return new at(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),n=Math.sin(r),a=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=a,this},_rotateAround(r,e){const n=Math.cos(r),a=Math.sin(r),c=e.y+a*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:at},at.convert=function(r){if(r instanceof at)return r;if(Array.isArray(r))return new at(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new at(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const na=Math.PI/180,po=180/Math.PI;function Bn(r){return r*na}function Ro(r){return r*po}const Ym=[[0,0],[1,0],[1,1],[0,1]];function vc(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,n=e*r;return 4*(r<.5?n:3*(r-e)+n-.75)}function Cd(r,e,n,a){const c=new Fo(r,e,n,a);return function(f){return c.solve(f)}}const Be=Cd(.25,.1,.25,1);function W(r,e,n){return Math.min(n,Math.max(e,r))}function Q(r,e,n){return(n=W((n-r)/(e-r),0,1))*n*(3-2*n)}function de(r,e,n){const a=n-e,c=((r-e)%a+a)%a+e;return c===e?n:c}function Ce(r,e,n){if(!r.length)return n(null,[]);let a=r.length;const c=new Array(r.length);let f=null;r.forEach((p,_)=>{e(p,(x,T)=>{x&&(f=x),c[_]=T,--a==0&&n(f,c)})})}let Ee=1;function De(){return Ee++}function We(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Oe(r,e){r.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ge(r,e,n){const a={};for(const c in r)a[c]=e.call(this,r[c],c,r);return a}function gt(r,e,n){const a={};for(const c in r)e.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function it(r){return Array.isArray(r)?r.map(it):typeof r=="object"&&r?Ge(r,it):r}function Bt(r,e){for(let n=0;n<r.length;n++)if(e.indexOf(r[n])>=0)return!0;return!1}const on={};function Ot(r){on[r]||(typeof console<"u"&&console.warn(r),on[r]=!0)}function Rn(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function Pn(r){let e=0;for(let n,a,c=0,f=r.length,p=f-1;c<f;p=c++)n=r[c],a=r[p],e+=(a.x-n.x)*(n.y+a.y);return e}function In([r,e,n]){const a=Bn(e+90),c=Bn(n);return{x:r*Math.cos(a)*Math.sin(c),y:r*Math.sin(a)*Math.sin(c),z:r*Math.cos(c),azimuthal:e,polar:n}}function Qn(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function ur(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,f)=>{const p=c||f;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Pr=null;function pr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Lr(r,e,n,a){for(;e<n;){const c=e+n>>1;r[c]<a?e=c+1:n=c}return e}function or(r,e,n,a){for(;e<n;){const c=e+n>>1;r[c]<=a?e=c+1:n=c}return e}function ni(r){return r>0?1/(1.001-r):1+r}function sr(r){return r>0?1-1/(1.001-r):-r}function Li(r,e,n){return(r-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const $n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!$n.API_URL)return null;try{const r=new URL($n.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function mr(r){return $n.API_URL_REGEX.test(r)}function mo(r){return $n.API_SPRITE_REGEX.test(r)}let To,Zo,xc,Jr,ms,Do;function Ea(){return To==null&&(To=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),To}const qr={now:()=>Jr!==void 0?Jr:performance.now(),setNow(r){Jr=r},restoreNow(){Jr=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:n,height:a}=r;ms||(ms=document.createElement("canvas"));const c=ms.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(n>ms.width||a>ms.height)&&(ms.width=n,ms.height=a),c.clearRect(-e,-e,n+2*e,a+2*e),c.drawImage(r,0,0,n,a),c.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:r=>(Zo||(Zo=document.createElement("a")),Zo.href=r,Zo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(xc==null&&(xc=window.matchMedia("(prefers-reduced-motion: reduce)")),xc.matches)},hasCanvasFingerprintNoise(){if(Do!==void 0)return Do;if(!Ea())return Do=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let n=0;for(let c=0;c<r.width;++c)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,r.width,r.height);n=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&n++!==a.data[c])return Do=!0,!0;return Do=!1,!1}};function wc(r,e){const n=r.indexOf("?");if(n<0)return`${r}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(r.slice(n));for(const c in e)a.set(c,e[c]);return`${r.slice(0,n)}?${a.toString()}`}function uu(r,e={persistentParams:[]}){const n=r.indexOf("?");if(n<0)return r;const a=new URLSearchParams,c=new URLSearchParams(r.slice(n));for(const p of e.persistentParams){const _=c.get(p);_&&a.set(p,_)}const f=a.toString();return`${r.slice(0,n)}${f.length>0?`?${f}`:""}`}const af="mapbox-tiles";let lf=500,cf=50;const Ad=["language","worldview","jobid"];let Ia,Xo;function ia(){try{return caches}catch{}}function ra(){const r=ia();r&&Ia==null&&(Ia=r.open(af))}let Os=1/0;const Ca={supported:!1,testSupport:function(r){!uf&&bc&&(Tc?ov(r):Ol=r)}};let Ol,bc,uf=!1,Tc=!1;const df=typeof self<"u"?self:{};function ov(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,bc),r.isContextLost())return;Ca.supported=!0}catch{}r.deleteTexture(e),uf=!0}df.document&&(bc=df.document.createElement("img"),bc.onload=function(){Ol&&ov(Ol),Ol=null,Tc=!0},bc.onerror=function(){uf=!0,Ol=null},bc.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Pd={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Pd);class os extends Error{constructor(e,n,a){n===401&&mr(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const hf=Qn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sc=function(r,e){if(!(/^file:/.test(n=r.url)||/^file:/.test(hf())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const f=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:hf(),referrerPolicy:a.referrerPolicy,signal:f.signal});let _=!1,x=!1;const T=(I=p.url).indexOf("sku=")>0&&mr(I);var I;a.type==="json"&&p.headers.set("Accept","application/json");const C=(D,k,j)=>{if(x)return;if(D&&D.message!=="SecurityError"&&Ot(D.toString()),k&&j)return P(k);const H=Date.now();fetch(p).then($=>{if($.ok){const K=T?$.clone():null;return P($,K,H)}return c(new os($.statusText,$.status,a.url))}).catch($=>{$.name!=="AbortError"&&c(new Error(`${$.message} ${a.url}`))})},P=(D,k,j)=>{(a.type==="arrayBuffer"?D.arrayBuffer():a.type==="json"?D.json():D.text()).then(H=>{x||(k&&j&&function($,K,ee){if(ra(),Ia==null)return;const se=ur(K.headers.get("Cache-Control")||"");if(se["no-store"])return;const _e={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((Ie,Pe)=>_e.headers.set(Pe,Ie)),se["max-age"]&&_e.headers.set("Expires",new Date(ee+1e3*se["max-age"]).toUTCString());const fe=_e.headers.get("Expires");if(!fe||new Date(fe).getTime()-ee<42e4)return;let xe=uu($.url,{persistentParams:Ad});if(K.status===206){const Ie=$.headers.get("Range");if(!Ie)return;_e.status=200,xe=wc(xe,{range:Ie})}(function(Ie,Pe){if(Xo===void 0)try{new Response(new ReadableStream),Xo=!0}catch{Xo=!1}Xo?Pe(Ie.body):Ie.blob().then(Pe).catch(Xe=>Ot(Xe.message))})(K,Ie=>{const Pe=new Response((Xe=K.status)!==200&&Xe!==404&&[101,103,204,205,304].includes(Xe)?null:Ie,_e);var Xe;ra(),Ia!=null&&Ia.then(ke=>ke.put(xe,Pe)).catch(ke=>Ot(ke.message))})}(p,k,j),_=!0,c(null,H,D.headers))}).catch(H=>{x||c(new Error(H.message))})};return T?function(D,k){if(ra(),Ia==null)return k(null);Ia.then(j=>{let H=uu(D.url,{persistentParams:Ad});const $=D.headers.get("Range");$&&(H=wc(H,{range:$})),j.match(H).then(K=>{const ee=function(se){if(!se)return!1;const _e=new Date(se.headers.get("Expires")||0),fe=ur(se.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!fe["no-cache"]}(K);j.delete(H).catch(k),ee&&j.put(H,K.clone()).catch(k),k(null,K,ee)}).catch(k)}).catch(k)}(p,C):C(null,null),{cancel:()=>{x=!0,_||f.abort()}}}(r,e);if(Qn(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var n;return function(a,c){const f=new XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in a.headers)f.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(a.type==="json")try{p=JSON.parse(f.response)}catch(x){return c(x)}const _=new Headers;f.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(x=>{const T=x.split(": "),I=T.shift(),C=T.join(": ");_.append(I,C)}),c(null,p,_)}else c(new os(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(r,e)},Ka=function(r,e){return Sc(Object.assign(r,{type:"arrayBuffer"}),e)};function xw(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const sv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Md,ii;Md=[],ii=0;const ff=function(r,e){if(Ca.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),ii>=$n.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Md.push(f),f}ii++;let n=!1;const a=()=>{if(!n)for(n=!0,ii--;Md.length&&ii<$n.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Md.shift(),{requestParameters:p,callback:_,cancelled:x}=f;x||(f.cancel=ff(p,_).cancel)}},c=Ka(r,(f,p,_)=>{a(),f?e(f):p&&(self.createImageBitmap?function(x,T){const I=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(I).then(C=>{T(null,C)}).catch(C=>{T(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(x,T)=>e(x,T,_)):function(x,T){const I=new Image;I.onload=()=>{T(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=sv})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(x)],{type:"image/png"});I.src=x.byteLength?URL.createObjectURL(C):sv}(p,(x,T)=>e(x,T,_)))});return{cancel:()=>{c.cancel(),a()}}};var Km,av,lv,Fl={exports:{}},Rd={exports:{}},Dd={exports:{}},Qm=function(){if(lv)return Fl.exports;lv=1;var r=(Km||(Km=1,Rd.exports=function(n,a){var c,f,p,_,x,T,I,C;for(f=n.length-(c=3&n.length),p=a,x=3432918353,T=461845907,C=0;C<f;)I=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,p=27492+(65535&(_=5*(65535&(p=(p^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&n.charCodeAt(C+2))<<16;case 2:I^=(255&n.charCodeAt(C+1))<<8;case 1:p^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(C)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Rd.exports),e=(av||(av=1,Dd.exports=function(n,a){for(var c,f=n.length,p=a^f,_=0;f>=4;)c=1540483477*(65535&(c=255&n.charCodeAt(_)|(255&n.charCodeAt(++_))<<8|(255&n.charCodeAt(++_))<<16|(255&n.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++_;switch(f){case 3:p^=(255&n.charCodeAt(_+2))<<16;case 2:p^=(255&n.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Dd.exports);return Fl.exports=r,Fl.exports.murmur3=r,Fl.exports.murmur2=e,Fl.exports}(),pf=Hi(Qm);class Aa{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class Ld extends Aa{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function Jm(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function Nl(r,e,n){if(n&&n[r]){const a=n[r].indexOf(e);a!==-1&&n[r].splice(a,1)}}class Ec{on(e,n){return this._listeners=this._listeners||{},Jm(e,n,this._listeners),this}off(e,n){return Nl(e,n,this._listeners),Nl(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Jm(e,n,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,n){const a=typeof e=="string"?new Aa(e,n):e,c=a.type;if(this.listens(c)){a.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of f)x.call(this,a);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of p)Nl(c,x,this._oneTimeListeners),x.call(this,a);const _=this._eventedParent;if(_){const x=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,x),_.fire(a)}}else a instanceof Ld&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class Lo{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Lo(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,a]=e.split("");return new Lo({name:n,iconsetId:a})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return Lo.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var mf,kd={},Fs=function(){if(mf)return kd;mf=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function n(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function a(f){return(p=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:p>1?1:p;var p}function c(f,p,_){return _<0?_+=1:_>1&&(_-=1),6*_<1?f+(p-f)*_*6:2*_<1?p:3*_<2?f+(p-f)*(2/3-_)*6:f}try{kd.parseCSSColor=function(f){var p,_=f.replace(/ /g,"").toLowerCase();if(_ in r)return r[_].slice();if(_[0]==="#")return _.length===4?(p=parseInt(_.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:_.length===7&&(p=parseInt(_.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var x=_.indexOf("("),T=_.indexOf(")");if(x!==-1&&T+1===_.length){var I=_.substr(0,x),C=_.substr(x+1,T-(x+1)).split(","),P=1;switch(I){case"rgba":if(C.length!==4)return null;P=a(C.pop());case"rgb":return C.length!==3?null:[n(C[0]),n(C[1]),n(C[2]),P];case"hsla":if(C.length!==4)return null;P=a(C.pop());case"hsl":if(C.length!==3)return null;var D=(parseFloat(C[0])%360+360)%360/360,k=a(C[1]),j=a(C[2]),H=j<=.5?j*(k+1):j+k-j*k,$=2*j-H;return[e(255*c($,H,D+1/3)),e(255*c($,H,D)),e(255*c($,H,D-1/3)),P];default:return null}}return null}}catch{}return kd}();class vi{constructor(e,n,a,c=1){this.r=e,this.g=n,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof vi)return e;if(typeof e!="string")return;const n=Fs.parseCSSColor(e);return n?new vi(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,a,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*a)},${c})`}toNonPremultipliedRenderColor(e){const{r:n,g:a,b:c,a:f}=this;return new uv(e,n,a,c,f)}toPremultipliedRenderColor(e){const{r:n,g:a,b:c,a:f}=this;return new dv(e,n*f,a*f,c*f,f)}clone(){return new vi(this.r,this.g,this.b,this.a)}}class cv{constructor(e,n,a,c,f,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const _=e.image.height,x=_*_;this.premultiplied?(n=f===0?0:n/f*(_-1),a=f===0?0:a/f*(_-1),c=f===0?0:c/f*(_-1)):(n*=_-1,a*=_-1,c*=_-1);const T=Math.floor(n),I=Math.floor(a),C=Math.floor(c),P=Math.ceil(n),D=Math.ceil(a),k=Math.ceil(c),j=n-T,H=a-I,$=c-C,K=e.image.data,ee=4*(T+I*x+C*_),se=4*(T+I*x+k*_),_e=4*(T+D*x+C*_),fe=4*(T+D*x+k*_),xe=4*(P+I*x+C*_),Ie=4*(P+I*x+k*_),Pe=4*(P+D*x+C*_),Xe=4*(P+D*x+k*_);if(ee<0||Xe>=K.length)throw new Error("out of range");this.r=fn(fn(fn(K[ee],K[se],$),fn(K[_e],K[fe],$),H),fn(fn(K[xe],K[Ie],$),fn(K[Pe],K[Xe],$),H),j)/255*(this.premultiplied?f:1),this.g=fn(fn(fn(K[ee+1],K[se+1],$),fn(K[_e+1],K[fe+1],$),H),fn(fn(K[xe+1],K[Ie+1],$),fn(K[Pe+1],K[Xe+1],$),H),j)/255*(this.premultiplied?f:1),this.b=fn(fn(fn(K[ee+2],K[se+2],$),fn(K[_e+2],K[fe+2],$),H),fn(fn(K[xe+2],K[Ie+2],$),fn(K[Pe+2],K[Xe+2],$),H),j)/255*(this.premultiplied?f:1),this.a=f}else this.r=n,this.g=a,this.b=c,this.a=f}toArray(){const{r:e,g:n,b:a,a:c}=this;return[255*e,255*n,255*a,c]}toHslaArray(){let{r:e,g:n,b:a,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];const k=1/c;e*=k,n*=k,a*=k}const f=Math.min(Math.max(e,0),1),p=Math.min(Math.max(n,0),1),_=Math.min(Math.max(a,0),1),x=Math.min(f,p,_),T=Math.max(f,p,_),I=T-x,C=.5*(x+T);if(I===0)return[0,0,100*C,c];const P=C>.5?I/(2-T-x):I/(T+x);let D;switch(T){case f:D=60*((p-_)/I+(p<_?6:0));break;case p:D=60*((_-f)/I+2);break;default:D=60*((f-p)/I+4)}return[D,100*P,100*C,c]}toArray01(){const{r:e,g:n,b:a,a:c}=this;return[e,n,a,c]}toArray01Scaled(e){const{r:n,g:a,b:c}=this;return[n*e,a*e,c*e]}toArray01Linear(){const{r:e,g:n,b:a,a:c}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(a,2.2),c]}}class uv extends cv{constructor(e,n,a,c,f){super(e,n,a,c,f,!1)}}class dv extends cv{constructor(e,n,a,c,f){super(e,n,a,c,f,!0)}}function fn(r,e,n){return r*(1-n)+e*n}function eg(r,e,n){return r.map((a,c)=>fn(a,e[c],n))}vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1),vi.blue=new vi(0,0,1,1);var zd=Object.freeze({__proto__:null,array:eg,color:function(r,e,n){return new vi(fn(r.r,e.r,n),fn(r.g,e.g,n),fn(r.b,e.b,n),fn(r.a,e.a,n))},number:fn});class Ns extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class du{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,c]of n)this.bindings[a]=c}concat(e){return new du(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const oa={kind:"null"},tn={kind:"number"},Xn={kind:"string"},Ti={kind:"boolean"},Yo={kind:"color"},Pa={kind:"object"},yi={kind:"value"},gf={kind:"collator"},Od={kind:"formatted"},Fd={kind:"resolvedImage"};function So(r,e){return{kind:"array",itemType:r,N:e}}function Mr(r){if(r.kind==="array"){const e=Mr(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const ww=[oa,tn,Xn,Ti,Yo,Od,Pa,So(yi),Fd];function Bl(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bl(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of ww)if(!Bl(n,e))return null}}return`Expected ${Mr(r)} but found ${Mr(e)} instead.`}function tg(r,e){return e.some(n=>n.kind===r.kind)}function Nd(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function _f(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&_f(r.itemType,e.itemType):r.kind===e.kind}class ng{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yf{constructor(e,n,a,c,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=c,this.textColor=f}}class No{constructor(e){this.sections=e}static fromString(e){return new No([new yf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof No?e:No.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const c=n.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class Qa{constructor(e,n={}){this.id=Lo.from(e),this.params=n.params,this.sx=n.sx||1,this.sy=n.sy||1}toString(){return JSON.stringify(this)}static parse(e){let n,a,c,f;try{({id:n,params:a,sx:c,sy:f}=JSON.parse(e)||{})}catch{return null}return n?new Qa(n,{params:a,sx:c,sy:f}):null}scaleSelf(e,n=e){return this.sx*=e,this.sy*=n,this}}class Bo{constructor(e,n,a,c,f=!1){this.primaryId=Lo.from(e),this.primaryOptions=n,a&&(this.secondaryId=Lo.from(a)),this.secondaryOptions=c,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Qa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Qa(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Bo.build({name:e}):e}static build(e,n,a,c){return!e||typeof e=="object"&&!("name"in e)?null:new Bo(e,a,n,c)}}function Ic(r,e,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,n,a]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hu(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof vi||r instanceof ng||r instanceof No||r instanceof Bo)return!0;if(Array.isArray(r)){for(const e of r)if(!hu(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!hu(r[e]))return!1;return!0}return!1}function Zr(r){if(r===null)return oa;if(typeof r=="string")return Xn;if(typeof r=="boolean")return Ti;if(typeof r=="number")return tn;if(r instanceof vi)return Yo;if(r instanceof ng)return gf;if(r instanceof No)return Od;if(r instanceof Bo)return Fd;if(Array.isArray(r)){const e=r.length;let n;for(const a of r){const c=Zr(a);if(n){if(n===c)continue;n=yi;break}n=c}return So(n||yi,e)}return Pa}function Bs(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof No||r instanceof Bo||r instanceof vi?r.toString():JSON.stringify(r)}class Ja{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!hu(e[1]))return n.error("invalid value");const a=e[1];let c=Zr(a);const f=n.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new Ja(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof No?this.value.serialize():this.value}}class jr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ig={string:Xn,number:tn,boolean:Ti,object:Pa};class sa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,c=1;const f=e[0];if(f==="array"){let _,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in ig)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=ig[T],c++}else _=yi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}a=So(_,x)}else a=ig[f];const p=[];for(;c<e.length;c++){const _=n.parse(e[c],c,yi);if(!_)return null;p.push(_)}return new sa(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!Bl(this.type,Zr(a)))return a;if(n===this.args.length-1)throw new jr(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Mr(Zr(a))} but was expected to be of type ${Mr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(a=>a.serialize()))}}class Ma{constructor(e){this.type=Od,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const c=[];let f=!1;for(let p=1;p<=e.length-1;++p){const _=e[p];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let x=null;if(_["font-scale"]&&(x=n.parseObjectValue(_["font-scale"],p,"font-scale",tn),!x))return null;let T=null;if(_["text-font"]&&(T=n.parseObjectValue(_["text-font"],p,"text-font",So(Xn)),!T))return null;let I=null;if(_["text-color"]&&(I=n.parseObjectValue(_["text-color"],p,"text-color",Yo),!I))return null;const C=c[c.length-1];C.scale=x,C.font=T,C.textColor=I}else{const x=n.parse(e[p],p,yi);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Ma(c)}evaluate(e){return new No(this.sections.map(n=>{const a=n.content.evaluate(e);return _f(Zr(a),Fd)?new yf("",a,null,null,null):new yf(Bs(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Mn{constructor(e,n,a,c){this._imageWarnHistory={},this.type=Fd,this.namePrimary=e,this.nameSecondary=n,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=1;const c=[];function f(){if(a<e.length){const _=n.parse(e[a],a++,Xn);return _?(c.push({image:_,options:{}}),!0):(n.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(a<e.length){const x=e[a];if((_=x)===null||typeof _!="object"||Array.isArray(_))return!0;const T=x.params,I=x.iconset,C=n.concat(a);if(!T&&!I)return a++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const P={},D=C.concat(void 0,"params");for(const k in T){if(!k)return D.error("Image parameter name should be non-empty"),!1;const j=D.concat(void 0,k).parse(T[k],void 0,Yo,void 0,{typeAnnotation:"coerce"});if(!j)return!1;P[k]=j}c[c.length-1].options.params=P}if(I){if(typeof I!="object"||I.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!I.id)return C.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=I}return a++,!0}var _;return!0}for(let _=0;_<2;_++)if(!f()||!p())return;return new Mn(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,n){const a={};if(n){for(const c in n)if(n[c])try{a[c]=n[c].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Bo.build(n,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const f=c.getPrimary().id;if(c.available=e.availableImages.some(p=>Lo.isEqual(p,f)),c.available){const p=c.getSecondary()?c.getSecondary().id:null;p&&(c.available=e.availableImages.some(_=>Lo.isEqual(_,p)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const a={};if(n&&(a.iconset={id:n}),e){a.params={};for(const c in e)e[c]&&(a.params[c]=e[c].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Qt(r){return yn(r)?"string":fu(r)?"number":xf(r)?"boolean":Array.isArray(r)?"array":r===null?"null":vf(r)?"object":typeof r}function vf(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function yn(r){return typeof r=="string"||r instanceof String}function fu(r){return typeof r=="number"||r instanceof Number}function xf(r){return typeof r=="boolean"||r instanceof Boolean}const gn={"to-boolean":Ti,"to-color":Yo,"to-number":tn,"to-string":Xn};class Ra{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0],c=[];let f=oa;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);f=So(n.expectedType.itemType,p)}else{if(!(p>0&&hu(e[1][0])))return null;f=So(Zr(e[1][0]),p)}for(let _=0;_<p;_++){const x=e[1][_];let T;if(Array.isArray(x))T=n.parse(x,void 0,f.itemType);else{const I=Qt(x);if(I!==f.itemType.kind)return n.error(`Expected ${f.itemType.kind} but found ${I}.`);T=n.registry.literal.parse(["literal",x===void 0?null:x],n)}if(!T)return null;c.push(T)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");f=gn[a];for(let p=1;p<e.length;p++){const _=n.parse(e[p],p,yi);if(!_)return null;c.push(_)}}return new Ra(f,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(const c of this.args){if(n=c.evaluate(e),a=null,n instanceof vi)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ic(n[0],n[1],n[2],n[3]),!a))return new vi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new jr(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new jr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?No.fromString(Bs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Bo.build(Bs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Bs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ma([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Mn(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const rg=["Unknown","Point","LineString","Polygon"];class wf{constructor(e,n,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(c*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=vi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class jo{constructor(e,n,a,c,f){this.name=e,this.type=n,this._evaluate=a,this.args=c,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const n=jo.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const a=e[0],c=jo.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=[];let x=null,T=-1;for(const[I,C]of p){if(Array.isArray(I)&&I.length!==e.length-1)continue;_.push(I),T++,x=new Lf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const P=[];let D=!1;for(let k=1;k<e.length;k++){const j=e[k],H=Array.isArray(I)?I[k-1]:I.type,$=x.parse(j,1+P.length,H);if(!$){D=!0;break}P.push($)}if(!D)if(Array.isArray(I)&&I.length!==P.length)x.error(`Expected ${I.length} arguments, but found ${P.length} instead.`);else{for(let k=0;k<P.length;k++){const j=Array.isArray(I)?I[k]:I.type,H=P[k];x.concat(k+1).checkSubtype(j,H.type)}if(x.errors.length===0)return new jo(a,f,C,P,T)}}if(_.length===1)n.errors.push(...x.errors);else{const I=(_.length?_:p.map(([P])=>P)).map(bf).join(" | "),C=[];for(let P=1;P<e.length;P++){const D=n.parse(e[P],1+C.length);if(!D)return null;C.push(Mr(D.type))}n.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){jo.definitions=n;for(const a in n)e[a]=jo}}function bf(r){return Array.isArray(r)?`(${r.map(Mr).join(", ")})`:`(${Mr(r.type)}...)`}class eo{constructor(e,n,a){this.type=gf,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const c=a["case-sensitive"]===void 0?n.parse(!1,1,Ti):n.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Ti);if(!c)return null;const f=a["diacritic-sensitive"]===void 0?n.parse(!1,1,Ti):n.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Ti);if(!f)return null;let p=null;return a.locale&&(p=n.parseObjectValue(a.locale,1,"locale",Xn),!p)?null:new eo(c,f,p)}evaluate(e){return new ng(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Tf(r,e,n=0,a=r.length-1,c=og){for(;a>n;){if(a-n>600){const x=a-n+1,T=e-n+1,I=Math.log(x),C=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*C*(x-C)/x)*(T-x/2<0?-1:1);Tf(r,e,Math.max(n,Math.floor(e-T*C/x+P)),Math.min(a,Math.floor(e+(x-T)*C/x+P)),c)}const f=r[e];let p=n,_=a;for(aa(r,n,e),c(r[a],f)>0&&aa(r,n,a);p<_;){for(aa(r,p,_),p++,_--;c(r[p],f)<0;)p++;for(;c(r[_],f)>0;)_--}c(r[n],f)===0?aa(r,n,_):(_++,aa(r,_,a)),_<=e&&(n=_+1),e<=_&&(a=_-1)}}function aa(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}function og(r,e){return r<e?-1:r>e?1:0}function jl(r){let e=0;for(let n,a,c=0,f=r.length,p=f-1;c<f;p=c++)n=r[c],a=r[p],e+=(a.x-n.x)*(n.y+a.y);return e}function js(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Bd(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function bw(r,e,n){const a=r[0]-e[0],c=r[1]-e[1],f=r[0]-n[0],p=r[1]-n[1];return a*p-f*c==0&&a*f<=0&&c*p<=0}function pu(r,e,n=!1){let a=!1;for(let _=0,x=e.length;_<x;_++){const T=e[_];for(let I=0,C=T.length,P=C-1;I<C;P=I++){const D=T[P],k=T[I];if(bw(r,D,k))return n;(f=D)[1]>(c=r)[1]!=(p=k)[1]>c[1]&&c[0]<(p[0]-f[0])*(c[1]-f[1])/(p[1]-f[1])+f[0]&&(a=!a)}}var c,f,p;return a}function jd(r,e,n,a){const c=a[0]-n[0],f=a[1]-n[1],p=(r[0]-n[0])*f-c*(r[1]-n[1]),_=(e[0]-n[0])*f-c*(e[1]-n[1]);return p>0&&_<0||p<0&&_>0}function Ud(r,e,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*f[0]!=0&&!(!jd(r,e,n,a)||!jd(n,a,r,e));var c,f}function el(r){const e=new at(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new at(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of r[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),n.x<a.x&&(n.x=a.x),n.y<a.y&&(n.y=a.y);return{min:e,max:n}}const Ul=8192;function Tw(r,e){const n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Ul),Math.round(a*c*Ul)]}function sg(r,e){for(let n=0;n<e.length;n++)if(pu(r,e[n]))return!0;return!1}function Sw(r,e,n){for(const a of n)for(let c=0,f=a.length,p=f-1;c<f;p=c++)if(Ud(r,e,a[p],a[c]))return!0;return!1}function hv(r,e){for(let n=0;n<r.length;++n)if(!pu(r[n],e))return!1;for(let n=0;n<r.length-1;++n)if(Sw(r[n],r[n+1],e))return!1;return!0}function fv(r,e){for(let n=0;n<e.length;n++)if(hv(r,e[n]))return!0;return!1}function ag(r,e,n){const a=[];for(let c=0;c<r.length;c++){const f=[];for(let p=0;p<r[c].length;p++){const _=Tw(r[c][p],n);js(e,_),f.push(_)}a.push(f)}return a}function Vl(r,e,n){const a=[];for(let c=0;c<r.length;c++){const f=ag(r[c],e,n);a.push(f)}return a}function pv(r,e,n,a){if(r[0]<n[0]||r[0]>n[2]){const c=.5*a;let f=r[0]-n[0]>c?-a:n[0]-r[0]>c?a:0;f===0&&(f=r[0]-n[2]>c?-a:n[2]-r[0]>c?a:0),r[0]+=f}js(e,r)}function mv(r,e,n,a){const c=Math.pow(2,a.z)*Ul,f=[a.x*Ul,a.y*Ul],p=[];if(!r)return p;for(const _ of r)for(const x of _){const T=[x.x+f[0],x.y+f[1]];pv(T,e,n,c),p.push(T)}return p}function Sf(r,e,n,a){const c=Math.pow(2,a.z)*Ul,f=[a.x*Ul,a.y*Ul],p=[];if(!r)return p;for(const x of r){const T=[];for(const I of x){const C=[I.x+f[0],I.y+f[1]];js(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of p)for(const T of x)pv(T,e,n,c)}var _;return p}class $l{constructor(e,n){this.type=Ti,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(hu(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const f=a.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new $l(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new $l(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new $l(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const _=ag(a.coordinates,f,p),x=mv(n.geometry(),c,f,p);if(!Bd(c,f))return!1;for(const T of x)if(!pu(T,_))return!1}if(a.type==="MultiPolygon"){const _=Vl(a.coordinates,f,p),x=mv(n.geometry(),c,f,p);if(!Bd(c,f))return!1;for(const T of x)if(!sg(T,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const _=ag(a.coordinates,f,p),x=Sf(n.geometry(),c,f,p);if(!Bd(c,f))return!1;for(const T of x)if(!hv(T,_))return!1}if(a.type==="MultiPolygon"){const _=Vl(a.coordinates,f,p),x=Sf(n.geometry(),c,f,p);if(!Bd(c,f))return!1;for(const T of x)if(!fv(T,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Vd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Us=1/298.257223563,gv=Us*(2-Us),mu=Math.PI/180;class gu{static fromTile(e,n,a){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),f=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/mu;return new gu(f,a)}static get units(){return Vd}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Vd[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Vd).join(", ")}`);const a=6378.137*mu*(n?Vd[n]:1),c=Math.cos(e*mu),f=1/(1-gv*(1-c*c)),p=Math.sqrt(f);this.kx=a*p*c,this.ky=a*p*f*(1-gv)}distance(e,n){const a=gs(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,n){const a=gs(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/mu}destination(e,n,a){const c=a*mu;return this.offset(e,Math.sin(c)*n,Math.cos(c)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){const c=e[a];for(let f=0,p=c.length,_=p-1;f<p;_=f++)n+=gs(c[f][0]-c[_][0])*(c[f][1]+c[_][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let c=0;c<e.length-1;c++){const f=e[c],p=e[c+1],_=this.distance(f,p);if(a+=_,a>n)return Ef(f,p,(n-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[c,f]=n,p=gs(a[0]-c)*this.kx,_=(a[1]-f)*this.ky;if(p!==0||_!==0){const x=(gs(e[0]-c)*this.kx*p+(e[1]-f)*this.ky*_)/(p*p+_*_);x>1?(c=a[0],f=a[1]):x>0&&(c+=p/this.kx*x,f+=_/this.ky*x)}return p=gs(e[0]-c)*this.kx,_=(e[1]-f)*this.ky,Math.sqrt(p*p+_*_)}pointOnLine(e,n){let a=1/0,c=e[0][0],f=e[0][1],p=0,_=0;for(let x=0;x<e.length-1;x++){let T=e[x][0],I=e[x][1],C=gs(e[x+1][0]-T)*this.kx,P=(e[x+1][1]-I)*this.ky,D=0;C===0&&P===0||(D=(gs(n[0]-T)*this.kx*C+(n[1]-I)*this.ky*P)/(C*C+P*P),D>1?(T=e[x+1][0],I=e[x+1][1]):D>0&&(T+=C/this.kx*D,I+=P/this.ky*D)),C=gs(n[0]-T)*this.kx,P=(n[1]-I)*this.ky;const k=C*C+P*P;k<a&&(a=k,c=T,f=I,p=x,_=D)}return{point:[c,f],index:p,t:Math.max(0,Math.min(1,_))}}lineSlice(e,n,a){let c=this.pointOnLine(a,e),f=this.pointOnLine(a,n);if(c.index>f.index||c.index===f.index&&c.t>f.t){const T=c;c=f,f=T}const p=[c.point],_=c.index+1,x=f.index;!lg(a[_],p[0])&&_<=x&&p.push(a[_]);for(let T=_+1;T<=x;T++)p.push(a[T]);return lg(a[x],f.point)||p.push(f.point),p}lineSliceAlong(e,n,a){let c=0;const f=[];for(let p=0;p<a.length-1;p++){const _=a[p],x=a[p+1],T=this.distance(_,x);if(c+=T,c>e&&f.length===0&&f.push(Ef(_,x,(e-(c-T))/T)),c>=n)return f.push(Ef(_,x,(n-(c-T))/T)),f;c>e&&f.push(x)}return f}bufferPoint(e,n){const a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,n){const a=n/this.ky,c=n/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,n){return gs(e[0]-n[0])>=0&&gs(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function lg(r,e){return r[0]===e[0]&&r[1]===e[1]}function Ef(r,e,n){const a=gs(e[0]-r[0]);return[r[0]+a*n,r[1]+(e[1]-r[1])*n]}function gs(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class If{constructor(e=[],n=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:a}=this,c=n[e];for(;e>0;){const f=e-1>>1,p=n[f];if(a(c,p)>=0)break;n[e]=p,e=f}n[e]=c}_down(e){const{data:n,compare:a}=this,c=this.length>>1,f=n[e];for(;e<c;){let p=1+(e<<1);const _=p+1;if(_<this.length&&a(n[_],n[p])<0&&(p=_),a(n[p],f)>=0)break;n[e]=n[p],e=p}n[e]=f}}var Et=8192;function cg(r,e){return e.dist-r.dist}const Cf=100,Af=50;function ug(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==r[n])return!1;return!0}function $d(r){return r[1]-r[0]+1}function Da(r,e){const n=r[1]>=r[0]&&r[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function dg(r,e){if(r[0]>r[1])return[null,null];const n=$d(r);if(e){if(n===2)return[r,null];const a=Math.floor(n/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(n===1)return[r,null];const a=Math.floor(n/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function Cc(r,e){const n=[1/0,1/0,-1/0,-1/0];if(!Da(e,r.length))return n;for(let a=e[0];a<=e[1];++a)js(n,r[a]);return n}function Ac(r){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<r.length;++n)for(let a=0;a<r[n].length;++a)js(e,r[n][a]);return e}function Gl(r,e,n){if(ug(r)||ug(e))return NaN;let a=0,c=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),n.distance([0,0],[a,c])}function Pf(r){return 360*r-180}function _v(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Mf(r,e){const n=Math.pow(2,e.z),a=(r.y/Et+e.y)/n;return[Pf((r.x/Et+e.x)/n),_v(a)]}function Ew(r,e){const n=[];for(let a=0;a<r.length;++a)n.push(Mf(r[a],e));return n}function yv(r,e,n){const a=n.pointOnLine(e,r).point;return n.distance(r,a)}function hg(r,e,n,a,c){const f=n.slice(a[0],a[1]+1);let p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,yv(r[_],f,c)))===0)return 0;return p}function Hl(r,e,n,a,c){const f=Math.min(c.pointToSegmentDistance(r,n,a),c.pointToSegmentDistance(e,n,a)),p=Math.min(c.pointToSegmentDistance(n,r,e),c.pointToSegmentDistance(a,r,e));return Math.min(f,p)}function Jn(r,e,n,a,c){if(!Da(e,r.length)||!Da(a,n.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let _=a[0];_<a[1];++_){if(Ud(r[p],r[p+1],n[_],n[_+1]))return 0;f=Math.min(f,Hl(r[p],r[p+1],n[_],n[_+1],c))}return f}function Iw(r,e,n,a,c){if(!Da(e,r.length)||!Da(a,n.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let _=a[0];_<=a[1];++_)if((f=Math.min(f,c.distance(r[p],n[_])))===0)return f;return f}function Cw(r,e,n){if(pu(r,e,!0))return 0;let a=1/0;for(const c of e){const f=c.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[f-1]&&(a=Math.min(a,n.pointToSegmentDistance(r,c[f-1],c[0])))===0||(a=Math.min(a,yv(r,c,n)))===0)return a}return a}function Aw(r,e,n,a){if(!Da(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if(pu(r[f],n,!0))return 0;let c=1/0;for(let f=e[0];f<e[1];++f)for(const p of n)for(let _=0,x=p.length,T=x-1;_<x;T=_++){if(Ud(r[f],r[f+1],p[T],p[_]))return 0;c=Math.min(c,Hl(r[f],r[f+1],p[T],p[_],a))}return c}function fg(r,e){for(const n of r)for(let a=0;a<=n.length-1;++a)if(pu(n[a],e,!0))return!0;return!1}function Pw(r,e,n,a=1/0){const c=Ac(r),f=Ac(e);if(a!==1/0&&Gl(c,f,n)>=a)return a;if(Bd(c,f)){if(fg(r,e))return 0}else if(fg(e,r))return 0;let p=a;for(const _ of r)for(let x=0,T=_.length,I=T-1;x<T;I=x++)for(const C of e)for(let P=0,D=C.length,k=D-1;P<D;k=P++){if(Ud(_[I],_[x],C[k],C[P]))return 0;p=Math.min(p,Hl(_[I],_[x],C[k],C[P],n))}return p}function Yi(r,e,n,a,c,f,p){if(f===null||p===null)return;const _=Gl(Cc(a,f),Cc(c,p),n);_<e&&r.push({dist:_,range1:f,range2:p})}function Mw(r,e,n,a,c=1/0){let f=Math.min(a.distance(r[0],n[0][0]),c);if(f===0)return f;const p=new If([{dist:0,range1:[0,r.length-1],range2:[0,0]}],cg),_=e?Af:Cf,x=Ac(n);for(;p.length;){const T=p.pop();if(T.dist>=f)continue;const I=T.range1;if($d(I)<=_){if(!Da(I,r.length))return NaN;if(e){const C=Aw(r,I,n,a);if((f=Math.min(f,C))===0)return f}else for(let C=I[0];C<=I[1];++C){const P=Cw(r[C],n,a);if((f=Math.min(f,P))===0)return f}}else{const C=dg(I,e);if(C[0]!==null){const P=Gl(Cc(r,C[0]),x,a);P<f&&p.push({dist:P,range1:C[0],range2:[0,0]})}if(C[1]!==null){const P=Gl(Cc(r,C[1]),x,a);P<f&&p.push({dist:P,range1:C[1],range2:[0,0]})}}}return f}function vv(r,e,n,a,c,f=1/0){let p=Math.min(f,c.distance(r[0],n[0]));if(p===0)return p;const _=new If([{dist:0,range1:[0,r.length-1],range2:[0,n.length-1]}],cg),x=e?Af:Cf,T=a?Af:Cf;for(;_.length;){const I=_.pop();if(I.dist>=p)continue;const C=I.range1,P=I.range2;if($d(C)<=x&&$d(P)<=T){if(!Da(C,r.length)||!Da(P,n.length))return NaN;if(e&&a?p=Math.min(p,Jn(r,C,n,P,c)):e||a?e&&!a?p=Math.min(p,hg(n,P,r,C,c)):!e&&a&&(p=Math.min(p,hg(r,C,n,P,c))):p=Math.min(p,Iw(r,C,n,P,c)),p===0)return p}else{const D=dg(C,e),k=dg(P,a);Yi(_,p,c,r,n,D[0],k[0]),Yi(_,p,c,r,n,D[0],k[1]),Yi(_,p,c,r,n,D[1],k[0]),Yi(_,p,c,r,n,D[1],k[1])}}return p}function pg(r,e,n,a,c=1/0){let f=c;const p=Cc(r,[0,r.length-1]);for(const _ of n)if(!(f!==1/0&&Gl(p,Cc(_,[0,_.length-1]),a)>=f)&&(f=Math.min(f,vv(r,e,_,!0,a,f)),f===0))return f;return f}function Rf(r,e,n,a,c=1/0){let f=c;const p=Cc(r,[0,r.length-1]);for(const _ of n){if(f!==1/0&&Gl(p,Ac(_),a)>=f)continue;const x=Mw(r,e,_,a,f);if(isNaN(x))return x;if((f=Math.min(f,x))===0)return f}return f}function mg(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Pc{constructor(e,n){this.type=tn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(hu(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(mg(a.features[c].geometry.type))return new Pc(a,a.features[c].geometry)}else if(a.type==="Feature"){if(mg(a.geometry.type))return new Pc(a,a.geometry)}else if(mg(a.type))return new Pc(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(c,f,p){const _=[];for(const T of c)for(const I of T)_.push(Mf(I,f));const x=new gu(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?vv(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x):p.type==="MultiLineString"?pg(_,!1,p.coordinates,x):p.type==="Polygon"||p.type==="MultiPolygon"?Rf(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,x):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(c,f,p){const _=[];for(const T of c){const I=[];for(const C of T)I.push(Mf(C,f));_.push(I)}const x=new gu(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return pg(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,x);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=pg(p.coordinates[I],!0,_,x,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}if(p.type==="Polygon"||p.type==="MultiPolygon"){let T=1/0;for(let I=0;I<_.length;I++){const C=Rf(_[I],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,x,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,f,p){const _=[];for(const T of function(I,C){const P=I.length;if(P<=1)return[I];const D=[];let k,j;for(let H=0;H<P;H++){const $=jl(I[H]);$!==0&&(I[H].area=Math.abs($),j===void 0&&(j=$<0),j===$<0?(k&&D.push(k),k=[I[H]]):k.push(I[H]))}return k&&D.push(k),D}(c)){const I=[];for(let C=0;C<T.length;++C)I.push(Ew(T[C],f));_.push(I)}const x=new gu(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Rf(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,x);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=Rf(p.coordinates[I],!0,_,x,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return p.type==="Polygon"||p.type==="MultiPolygon"?function(T,I,C){let P=1/0;for(const D of T)for(const k of I){const j=Pw(D,k,C,P);if(isNaN(j))return j;if((P=Math.min(P,j))===0)return P}return P}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,x):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function _u(r){if(r instanceof jo&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof $l||r instanceof Pc)return!1;if(r instanceof vu)return r.featureConstant;let e=!0;return r.eachChild(n=>{e&&!_u(n)&&(e=!1)}),e}function Gd(r){if(r instanceof jo&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!Gd(n)&&(e=!1)}),e}function yu(r,e){if(r instanceof jo&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!yu(a,e)&&(n=!1)}),n}function xv(r,e,n){return[r,e,n].filter(Boolean).join("")}function gg(r,e){switch(r){case"string":return Bs(e);case"number":return+e;case"boolean":return!!e;case"color":return vi.parse(e);case"formatted":return No.fromString(Bs(e));case"resolvedImage":return Bo.build(Bs(e))}return e}function wv(r,e,n,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),n!==void 0&&r>n&&(r=n),r}class vu{constructor(e,n,a,c=!1){this.type=e,this.key=n,this.scope=a,this.featureConstant=c}static parse(e,n){let a=n.expectedType;if(a==null&&(a=yi),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const c=n.parse(e[1],1);if(!(c instanceof Ja))return n.error("Key name of 'config' expression must be a string literal.");let f,p=!0;const _=Bs(c.value);if(e.length>=3){const x=n.parse(e[2],2);if(!(x instanceof Ja))return n.error("Scope of 'config' expression must be a string literal.");f=Bs(x.value)}if(n.options){const x=xv(_,f,n._scope),T=n.options.get(x);T&&(p=_u(T.value||T.default))}return new vu(a,_,f,p)}evaluate(e){const n=xv(this.key,this.scope,e.scope),a=e.getConfig(n);if(!a)return null;const{type:c,value:f,values:p,minValue:_,maxValue:x,stepValue:T}=a,I=a.default.evaluate(e);let C=I;if(f){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),C=f.evaluate(e),e.scope=P}return c&&(C=gg(c,C)),C===void 0||_===void 0&&x===void 0&&T===void 0||(typeof C=="number"?C=wv(C,_,x,T):Array.isArray(C)&&(C=C.map(P=>typeof P=="number"?wv(P,_,x,T):P))),f!==void 0&&C!==void 0&&p&&!p.includes(C)&&(C=I,c&&(C=gg(c,C))),(c&&c!==this.type||C!==void 0&&!_f(Zr(C),this.type))&&(C=gg(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Df{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new Df(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lf{constructor(e,n=[],a,c=new du,f=[],p,_,x){this.registry=e,this.path=n,this.key=n.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=c,this.errors=f,this.expectedType=a,this._scope=p,this.options=_,this.iconImageUseTheme=x}parse(e,n,a,c,f={}){return n||a?this.concat(n,null,a,c)._parse(e,f):this._parse(e,f)}parseObjectValue(e,n,a,c,f,p={}){return this.concat(n,a,c,f)._parse(e,p)}_parse(e,n){function a(c,f,p){return p==="assert"?new sa(f,[c]):p==="coerce"?new Ra(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let f=c.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,_=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else f=a(f,p,n.typeAnnotation||"coerce");else f=a(f,p,n.typeAnnotation||"assert")}if(!(f instanceof Ja)&&f.type.kind!=="resolvedImage"&&_g(f)){const p=new wf(this._scope,this.options,this.iconImageUseTheme);try{f=new Ja(f.type,f.evaluate(p))}catch(_){return this.error(_.message),null}}return f}return Ra.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a,c){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof n=="string"?f.concat(n):f;const p=c?this.scope.concat(c):this.scope;return new Lf(this.registry,f,a||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ns(a,e))}checkSubtype(e,n){const a=Bl(e,n);return a&&this.error(a),a}}function _g(r){if(r instanceof Df)return _g(r.boundExpression);if(r instanceof jo&&r.name==="error"||r instanceof eo||r instanceof $l||r instanceof Pc||r instanceof vu)return!1;const e=r instanceof Ra||r instanceof sa;let n=!0;return r.eachChild(a=>{n=e?n&&_g(a):n&&a instanceof Ja}),!!n&&_u(r)&&yu(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function kf(r,e){const n=r.length-1;let a,c,f=0,p=n,_=0;for(;f<=p;)if(_=Math.floor((f+p)/2),a=r[_],c=r[_+1],a<=e){if(_===n||e<c)return _;f=_+1}else{if(!(a>e))throw new jr("Input is not a number.");p=_-1}return 0}class Hd{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,f]of a)this.labels.push(c),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,tn);if(!a)return null;const c=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let p=1;p<e.length;p+=2){const _=p===1?-1/0:e[p],x=e[p+1],T=p,I=p+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=n.parse(x,I,f);if(!C)return null;f=f||C.type,c.push([_,C])}return new Hd(f,a,c)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);const f=n.length;return c>=n[f-1]?a[f-1].evaluate(e):a[kf(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const bv=.95047,Tv=1.08883,Sv=4/29,xu=6/29,Ev=3*xu*xu,Rw=xu*xu*xu,Dw=Math.PI/180,Lw=180/Math.PI;function yg(r){return r>Rw?Math.pow(r,1/3):r/Ev+Sv}function vg(r){return r>xu?r*r*r:Ev*(r-Sv)}function xg(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function wg(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Iv(r){const e=wg(r.r),n=wg(r.g),a=wg(r.b),c=yg((.4124564*e+.3575761*n+.1804375*a)/bv),f=yg((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-yg((.0193339*e+.119192*n+.9503041*a)/Tv)),alpha:r.a}}function zf(r){let e=(r.l+16)/116,n=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*vg(e),n=bv*vg(n),a=Tv*vg(a),new vi(xg(3.2404542*n-1.5371385*e-.4985314*a),xg(-.969266*n+1.8760108*e+.041556*a),xg(.0556434*n-.2040259*e+1.0572252*a),r.alpha)}function Of(r,e,n){const a=e-r;return r+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const wu={forward:Iv,reverse:zf,interpolate:function(r,e,n){return{l:fn(r.l,e.l,n),a:fn(r.a,e.a,n),b:fn(r.b,e.b,n),alpha:fn(r.alpha,e.alpha,n)}}},Wd={forward:function(r){const{l:e,a:n,b:a}=Iv(r),c=Math.atan2(a,n)*Lw;return{h:c<0?c+360:c,c:Math.sqrt(n*n+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Dw,n=r.c;return zf({l:r.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:r.alpha})},interpolate:function(r,e,n){return{h:Of(r.h,e.h,n),c:fn(r.c,e.c,n),l:fn(r.l,e.l,n),alpha:fn(r.alpha,e.alpha,n)}}};var Cv=Object.freeze({__proto__:null,hcl:Wd,lab:wu});class _s{constructor(e,n,a,c,f){this.type=e,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[p,_]of f)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,n,a,c){let f=0;if(e.name==="exponential")f=Ff(n,e.base,a,c);else if(e.name==="linear")f=Ff(n,1,a,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new Fo(p[0],p[1],p[2],p[3]).solve(Ff(n,1,a,c))}return f}static parse(e,n){let[a,c,f,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,tn),!f)return null;const _=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=Yo:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let T=0;T<p.length;T+=2){const I=p[T],C=p[T+1],P=T+3,D=T+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(_.length&&_[_.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const k=n.parse(C,D,x);if(!k)return null;x=x||k.type,_.push([I,k])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new _s(x,a,c,f,_):n.error(`Type ${Mr(x)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return a[0].evaluate(e);const f=n.length;if(c>=n[f-1])return a[f-1].evaluate(e);const p=kf(n,c),_=_s.interpolationFactor(this.interpolation,c,n[p],n[p+1]),x=a[p].evaluate(e),T=a[p+1].evaluate(e);return this.operator==="interpolate"?zd[this.type.kind.toLowerCase()](x,T,_):this.operator==="interpolate-hcl"?Wd.reverse(Wd.interpolate(Wd.forward(x),Wd.forward(T),_)):wu.reverse(wu.interpolate(wu.forward(x),wu.forward(T),_))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function Ff(r,e,n,a){const c=a-n,f=r-n;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}class qd{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const c=n.expectedType;c&&c.kind!=="value"&&(a=c);const f=[];for(const _ of e.slice(1)){const x=n.parse(_,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,f.push(x)}const p=c&&f.some(_=>Bl(c,_.type));return new qd(p?yi:a,f)}evaluate(e){let n,a=null,c=0;for(const f of this.args){if(c++,a=f.evaluate(e),a&&a instanceof Bo&&!a.available&&(n||(n=a),a=null,c===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class tl{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=n.parse(e[f+1],f+1);if(!_)return null;a.push([p,_])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return c?new tl(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class Nf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,tn),c=n.parse(e[2],2,So(n.expectedType||yi));return a&&c?new Nf(c.type.itemType,a,c):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new jr("Array index out of bounds: negative index");if(n>=a.length)throw new jr("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new jr("Array index must be an integer. Use at-interpolated for fractional indices");return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Bf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,tn),c=n.parse(e[2],2,So(n.expectedType||yi));return a&&c?new Bf(c.type.itemType,a,c):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new jr(`Array index out of bounds: ${n} < 0.`);if(n>a.length-1)throw new jr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n===Math.floor(n))return a[n];const c=Math.floor(n),f=Math.ceil(n),p=a[c],_=a[f];if(typeof p!="number"||typeof _!="number")throw new jr(`Cannot interpolate between non-number values at index ${n}.`);const x=n-c;return p*(1-x)+_*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class bg{constructor(e,n){this.type=Ti,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,yi),c=n.parse(e[2],2,yi);return a&&c?tg(a.type,[Ti,Xn,tn,oa,yi])?new bg(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Nd(n,["boolean","string","number","null"]))throw new jr(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(Zr(n))} instead.`);if(!Nd(a,["string","array"]))throw new jr(`Expected second argument to be of type array or string, but found ${Mr(Zr(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bu{constructor(e,n,a){this.type=tn,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,yi),c=n.parse(e[2],2,yi);if(!a||!c)return null;if(!tg(a.type,[Ti,Xn,tn,oa,yi]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(a.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,tn);return f?new bu(a,c,f):null}return new bu(a,c)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Nd(n,["boolean","string","number","null"]))throw new jr(`Expected first argument to be of type boolean, string, number or null, but found ${Mr(Zr(n))} instead.`);if(!Nd(a,["string","array"]))throw new jr(`Expected second argument to be of type array or string, but found ${Mr(Zr(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(n,c)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Zd{constructor(e,n,a,c,f,p){this.inputType=e,this.type=n,this.input=a,this.cases=c,this.outputs=f,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const C=e[T+1];Array.isArray(I)||(I=[I]);const P=n.concat(T);if(I.length===0)return P.error("Expected at least one branch label.");for(const k of I){if(typeof k!="number"&&typeof k!="string")return P.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,Zr(k)))return null}else a=Zr(k);if(f[String(k)]!==void 0)return P.error("Branch labels must be unique.");f[String(k)]=p.length}const D=n.parse(C,T,c);if(!D)return null;c=c||D.type,p.push(D)}const _=n.parse(e[1],1,yi);if(!_)return null;const x=n.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&n.concat(1).checkSubtype(a,_.type)?null:new Zd(a,c,_,f,p,x):null}evaluate(e){const n=this.input.evaluate(e);return(_f(Zr(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],c={};for(const p of n){const _=c[this.cases[p]];_===void 0?(c[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[_][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,_]of a)e.push(_.length===1?f(_[0]):_.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Xd{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const _=n.parse(e[p],p,Ti);if(!_)return null;const x=n.parse(e[p+1],p+1,a);if(!x)return null;c.push([_,x]),a=a||x.type}const f=n.parse(e[e.length-1],e.length-1,a);return f?new Xd(a,c,f):null}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class jf{constructor(e,n,a,c){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,yi),c=n.parse(e[2],2,tn);if(!a||!c)return null;if(!tg(a.type,[So(yi),Xn,yi]))return n.error(`Expected first argument to be of type array or string, but found ${Mr(a.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,tn);return f?new jf(a.type,a,c,f):null}return new jf(a.type,a,c)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Nd(n,["string","array"]))throw new jr(`Expected first argument to be of type array or string, but found ${Mr(Zr(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(a,c)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Tg{constructor(e,n){this.type=So(Xn),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Xn),c=n.parse(e[2],2,Xn);return a&&c?new Tg(a,c):void 0}evaluate(e){const n=this.str.evaluate(e),a=this.delimiter.evaluate(e);return n.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Sg(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Eg(r,e,n,a){return a.compare(e,n)===0}function Tu(r,e,n){const a=r!=="=="&&r!=="!=";return class RN{constructor(f,p,_){this.type=Ti,this.lhs=f,this.rhs=p,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const _=f[0];let x=p.parse(f[1],1,yi);if(!x)return null;if(!Sg(_,x.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${Mr(x.type)}'.`);let T=p.parse(f[2],2,yi);if(!T)return null;if(!Sg(_,T.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${Mr(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Mr(x.type)}' and '${Mr(T.type)}'.`);a&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new sa(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new sa(x.type,[T])));let I=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(f[3],3,gf),!I)return null}return new RN(x,T,I)}evaluate(f){const p=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const x=Zr(p),T=Zr(_);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new jr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=Zr(p),T=Zr(_);if(x.kind!=="string"||T.kind!=="string")return e(f,p,_)}return this.collator?n(f,p,_,this.collator.evaluate(f)):e(f,p,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[r];return this.eachChild(p=>{f.push(p.serialize())}),f}}}const kw=Tu("==",function(r,e,n){return e===n},Eg),zw=Tu("!=",function(r,e,n){return e!==n},function(r,e,n,a){return!Eg(0,e,n,a)}),Av=Tu("<",function(r,e,n){return e<n},function(r,e,n,a){return a.compare(e,n)<0}),Pv=Tu(">",function(r,e,n){return e>n},function(r,e,n,a){return a.compare(e,n)>0}),Uf=Tu("<=",function(r,e,n){return e<=n},function(r,e,n,a){return a.compare(e,n)<=0}),Ow=Tu(">=",function(r,e,n){return e>=n},function(r,e,n,a){return a.compare(e,n)>=0});class Vf{constructor(e,n,a,c,f,p){this.type=Xn,this.number=e,this.locale=n,this.currency=a,this.unit=c,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,tn);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=n.parseObjectValue(c.locale,2,"locale",Xn),!f))return null;let p=null;if(c.currency&&(p=n.parseObjectValue(c.currency,2,"currency",Xn),!p))return null;let _=null;if(c.unit&&(_=n.parseObjectValue(c.unit,2,"unit",Xn),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",tn),!x))return null;let T=null;return c["max-fraction-digits"]&&(T=n.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",tn),!T)?null:new Vf(a,f,p,_,x,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ig{constructor(e){this.type=tn,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Mr(a.type)} instead.`):new Ig(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new jr(`Expected value to be of type string or array, but found ${Mr(Zr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Mv(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Su={"==":kw,"!=":zw,">":Pv,"<":Av,">=":Ow,"<=":Uf,array:sa,at:Nf,"at-interpolated":Bf,boolean:sa,case:Xd,coalesce:qd,collator:eo,format:Ma,image:Mn,in:bg,"index-of":bu,interpolate:_s,"interpolate-hcl":_s,"interpolate-lab":_s,length:Ig,let:tl,literal:Ja,match:Zd,number:sa,"number-format":Vf,object:sa,slice:jf,step:Hd,string:sa,"to-boolean":Ra,"to-color":Ra,"to-number":Ra,"to-string":Ra,var:Df,within:$l,distance:Pc,config:vu,split:Tg};function Cg(r,[e,n,a,c]){e=e.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const f=c?c.evaluate(r):1,p=Ic(e,n,a,f);if(p)throw new jr(p);return new vi(e/255,n/255,a/255,f)}function Ag(r,[e,n,a,c]){e=e.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const f=c?c.evaluate(r):1,p=function(T,I,C,P){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof C=="number"&&C>=0&&C<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[T,I,C,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[T,I,C,P]:[T,I,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[T,I,C,P]:[T,I,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,f);if(p)throw new jr(p);const _=`hsla(${e}, ${n}%, ${a}%, ${f})`,x=vi.parse(_);if(!x)throw new jr(`Failed to parse HSLA color: ${_}`);return x}function Rv(r,e){return r in e}function Pg(r,e){const n=e[r];return n===void 0?null:n}function Wl(r){return{type:r}}function Mc(r){if(r instanceof vu)return new Set([r.key]);let e=new Set;return r.eachChild(n=>{e=new Set([...e,...Mc(n)])}),e}function $f(r){if(r instanceof jo&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild(n=>{!e&&$f(n)&&(e=!0)}),e}function Dv(r){return{result:"success",value:r}}function ql(r){return{result:"error",value:r}}function Mg(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Yd(r){return r["property-type"]==="data-driven"}function Lv(r){return Mg(r.expression,"measure-light")}function kv(r){return Mg(r.expression,"zoom")}function Gf(r){return!!r.expression&&r.expression.interpolated}function Hf(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function zv(r){return r}function Ov(r,e){const n=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),f=r.type||(Gf(e)?"exponential":"interval");if(n&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(T=>[T[0],vi.parse(T[1])])),r.default=vi.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Cv[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let p,_,x;if(f==="exponential")p=Fv;else if(f==="interval")p=Nw;else if(f==="categorical"){p=Fw,_=Object.create(null);for(const T of r.stops)_[T[0]]=T[1];x=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=Nv}if(a){const T={},I=[];for(let D=0;D<r.stops.length;D++){const k=r.stops[D],j=k[0].zoom;T[j]===void 0&&(T[j]={zoom:j,type:r.type,property:r.property,default:r.default,stops:[]},I.push(j)),T[j].stops.push([k[0].value,k[1]])}const C=[];for(const D of I)C.push([T[D].zoom,Ov(T[D],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:_s.interpolationFactor.bind(void 0,P),zoomStops:C.map(D=>D[0]),evaluate:({zoom:D},k)=>Fv({stops:C,base:r.base},e,D).evaluate(D,k)}}if(c){const T=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:_s.interpolationFactor.bind(void 0,T),zoomStops:r.stops.map(I=>I[0]),evaluate:({zoom:I})=>p(r,e,I,_,x)}}return{kind:"source",evaluate(T,I){const C=I&&I.properties?I.properties[r.property]:void 0;return C===void 0?La(r.default,e.default):p(r,e,C,_,x)}}}function La(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function Fw(r,e,n,a,c){return La(typeof n===c?a[n]:void 0,r.default,e.default)}function Nw(r,e,n){if(!fu(n))return La(r.default,e.default);const a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];const c=kf(r.stops.map(f=>f[0]),n);return r.stops[c][1]}function Fv(r,e,n){const a=r.base!==void 0?r.base:1;if(!fu(n))return La(r.default,e.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const f=kf(r.stops.map(I=>I[0]),n),p=function(I,C,P,D){const k=D-P,j=I-P;return k===0?0:C===1?j/k:(Math.pow(C,j)-1)/(Math.pow(C,k)-1)}(n,a,r.stops[f][0],r.stops[f+1][0]),_=r.stops[f][1],x=r.stops[f+1][1];let T=zd[e.type]||zv;if(r.colorSpace&&r.colorSpace!=="rgb"){const I=Cv[r.colorSpace];T=(C,P)=>I.reverse(I.interpolate(I.forward(C),I.forward(P),p))}return typeof _.evaluate=="function"?{evaluate(...I){const C=_.evaluate.apply(void 0,I),P=x.evaluate.apply(void 0,I);if(C!==void 0&&P!==void 0)return T(C,P,p)}}:T(_,x,p)}function Nv(r,e,n){return e.type==="color"?n=vi.parse(n):e.type==="formatted"?n=No.fromString(n.toString()):e.type==="resolvedImage"?n=Bo.build(n.toString()):Qt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),La(n,r.default,e.default)}jo.register(Su,{error:[{kind:"error"},[Xn],(r,[e])=>{throw new jr(e.evaluate(r))}],typeof:[Xn,[yi],(r,[e])=>Mr(Zr(e.evaluate(r)))],"to-rgba":[So(tn,4),[Yo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[So(tn,4),[Yo],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Yo,[tn,tn,tn],Cg],rgba:[Yo,[tn,tn,tn,tn],Cg],hsl:[Yo,[tn,tn,tn],Ag],hsla:[Yo,[tn,tn,tn,tn],Ag],has:{type:Ti,overloads:[[[Xn],(r,[e])=>Rv(e.evaluate(r),r.properties())],[[Xn,Pa],(r,[e,n])=>Rv(e.evaluate(r),n.evaluate(r))]]},get:{type:yi,overloads:[[[Xn],(r,[e])=>Pg(e.evaluate(r),r.properties())],[[Xn,Pa],(r,[e,n])=>Pg(e.evaluate(r),n.evaluate(r))]]},"feature-state":[yi,[Xn],(r,[e])=>Pg(e.evaluate(r),r.featureState||{})],properties:[Pa,[],r=>r.properties()],"geometry-type":[Xn,[],r=>r.geometryType()],worldview:[Xn,[],r=>r.globals.worldview||""],"is-active-floor":[Ti,Wl(Xn),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const n=r.globals.activeFloors;return e.some(a=>{const c=a.evaluate(r);return n.has(c)})}],id:[yi,[],r=>r.id()],zoom:[tn,[],r=>r.globals.zoom],pitch:[tn,[],r=>r.globals.pitch||0],"distance-from-center":[tn,[],r=>r.distanceFromCenter()],"measure-light":[tn,[Xn],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[tn,[],r=>r.globals.heatmapDensity||0],"line-progress":[tn,[],r=>r.globals.lineProgress||0],"raster-value":[tn,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[tn,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[tn,[],r=>r.globals.skyRadialProgress||0],accumulated:[yi,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[tn,Wl(tn),(r,e)=>{let n=0;for(const a of e)n+=a.evaluate(r);return n}],"*":[tn,Wl(tn),(r,e)=>{let n=1;for(const a of e)n*=a.evaluate(r);return n}],"-":{type:tn,overloads:[[[tn,tn],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[tn],(r,[e])=>-e.evaluate(r)]]},"/":[tn,[tn,tn],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[tn,[tn,tn],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[tn,[],()=>Math.LN2],pi:[tn,[],()=>Math.PI],e:[tn,[],()=>Math.E],"^":[tn,[tn,tn],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[tn,[tn],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[tn,[tn],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[tn,[tn],(r,[e])=>Math.log(e.evaluate(r))],log2:[tn,[tn],(r,[e])=>Math.log2(e.evaluate(r))],sin:[tn,[tn],(r,[e])=>Math.sin(e.evaluate(r))],cos:[tn,[tn],(r,[e])=>Math.cos(e.evaluate(r))],tan:[tn,[tn],(r,[e])=>Math.tan(e.evaluate(r))],asin:[tn,[tn],(r,[e])=>Math.asin(e.evaluate(r))],acos:[tn,[tn],(r,[e])=>Math.acos(e.evaluate(r))],atan:[tn,[tn],(r,[e])=>Math.atan(e.evaluate(r))],min:[tn,Wl(tn),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[tn,Wl(tn),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[tn,[tn],(r,[e])=>Math.abs(e.evaluate(r))],round:[tn,[tn],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[tn,[tn],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[tn,[tn],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ti,[Xn,yi],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[Ti,[yi],(r,[e])=>r.id()===e.value],"filter-type-==":[Ti,[Xn],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ti,[Xn,yi],(r,[e,n])=>{const a=r.properties()[e.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Ti,[yi],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Ti,[Xn,yi],(r,[e,n])=>{const a=r.properties()[e.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[Ti,[yi],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Ti,[Xn,yi],(r,[e,n])=>{const a=r.properties()[e.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Ti,[yi],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Ti,[Xn,yi],(r,[e,n])=>{const a=r.properties()[e.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Ti,[yi],(r,[e])=>{const n=r.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Ti,[yi],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ti,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ti,[So(Xn)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ti,[So(yi)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ti,[Xn,So(yi)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ti,[Xn,So(yi)],(r,[e,n])=>function(a,c,f,p){for(;f<=p;){const _=f+p>>1;if(c[_]===a)return!0;c[_]>a?p=_-1:f=_+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Ti,overloads:[[[Ti,Ti],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[Wl(Ti),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Ti,overloads:[[[Ti,Ti],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[Wl(Ti),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[Ti,[Ti],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ti,[Xn],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Xn,[Xn],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Xn,[Xn],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Xn,Wl(yi),(r,e)=>e.map(n=>Bs(n.evaluate(r))).join("")],"resolved-locale":[Xn,[gf],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[tn,[tn,tn,yi],(r,e)=>{const[n,a,c]=e.map(p=>p.evaluate(r));if(n>a||n===a)return n;let f;if(typeof c=="string")f=function(p){let _=0;if(p.length===0)return _;for(let x=0;x<p.length;x++)_=(_<<5)-_+p.charCodeAt(x),_|=0;return _}(c);else{if(typeof c!="number")throw new jr(`Invalid seed input: ${c}`);f=c}return n+Mv(f)()*(a-n)}]});class Wf{constructor(e,n,a,c,f){this.expression=e,this._warningHistory={},this._scope=a,this._options=c,this._iconImageUseTheme=f,this._evaluator=new wf(a,c,f),this._defaultValue=n?function(p){return p.type==="color"&&(Hf(p.default)||Array.isArray(p.default))?new vi(0,0,0,0):p.type==="color"?vi.parse(p.default)||null:p.default===void 0?null:p.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=Mc(e),this.isIndoorDependent=$f(e)}evaluateWithoutErrorHandling(e,n,a,c,f,p,_,x){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,c,f,p,_,x,T){this._evaluator||(this._evaluator=new wf(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this._evaluator.iconImageUseTheme=T||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new jr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){const C=I;return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function Kd(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Su}function Zl(r,e,n,a,c){const f=new Lf(Su,[],e?function(_){const x={color:Yo,string:Xn,number:tn,enum:Xn,boolean:Ti,formatted:Od,resolvedImage:Fd};return _.type==="array"?So(x[_.value]||yi,_.length):x[_.type]}(e):void 0,void 0,void 0,n,a,c),p=f.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Dv(new Wf(p,e,n,a,c)):ql(f.errors)}class Eu{constructor(e,n,a,c){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!Gd(n.expression),this.configDependencies=Mc(n.expression),this.isIndoorDependent=$f(n.expression)}evaluateWithoutErrorHandling(e,n,a,c,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,f,p)}evaluate(e,n,a,c,f,p,_){return this._styleExpression.evaluate(e,n,a,c,f,p,void 0,void 0,_)}}class Rc{constructor(e,n,a,c,f,p){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Gd(n.expression),this.isIndoorDependent=$f(n.expression),this.isLightConstant=f,this.isLineProgressConstant=p,this.configDependencies=Mc(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,a,c,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,c,f,p)}evaluate(e,n,a,c,f,p){return this._styleExpression.evaluate(e,n,a,c,f,p)}interpolationFactor(e,n,a){return this.interpolationType?_s.interpolationFactor(this.interpolationType,e,n,a):0}}function Rg(r,e,n,a,c){if((r=Zl(r,e,n,a,c)).result==="error")return r;const f=r.value.expression,p=_u(f);if(!p&&!Yd(e))return ql([new Ns("","data expressions not supported")]);const _=yu(f,["zoom","pitch","distance-from-center"]);if(!_&&!kv(e))return ql([new Ns("","zoom expressions not supported")]);const x=yu(f,["measure-light"]);if(!x&&!Lv(e))return ql([new Ns("","measure-light expression not supported")]);const T=yu(f,["line-progress"]);if(!T&&!function(P){return Mg(P.expression,"line-progress")}(e))return ql([new Ns("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,C=la(f);return C||_||I?C instanceof Ns?ql([C]):C instanceof _s&&!Gf(e)?ql([new Ns("",'"interpolate" expressions cannot be used with this property')]):Dv(C?new Rc(p&&T?"camera":"composite",r.value,C.labels,C instanceof _s?C.interpolation:void 0,x,T):new Eu(p&&T?"constant":"source",r.value,x,T)):ql([new Ns("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qf{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,Ov(this._parameters,this._specification))}static deserialize(e){return new qf(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function la(r){let e=null;if(r instanceof tl)e=la(r.result);else if(r instanceof qd){for(const n of r.args)if(e=la(n),e)break}else(r instanceof Hd||r instanceof _s)&&r.input instanceof jo&&r.input.name==="zoom"&&(e=r);return e instanceof Ns||r.eachChild(n=>{const a=la(n);a instanceof Ns?e=a:e&&a&&e!==a&&(e=new Ns("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Dg,Bv,jv=function(){if(Bv)return Dg;Bv=1,Dg=e;var r=3;function e(n,a,c){var f=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var p=new Int32Array(this.arrayBuffer);n=p[0],this.d=(a=p[1])+2*(c=p[2]);for(var _=0;_<this.d*this.d;_++){var x=p[r+_],T=p[r+_+1];f.push(x===T?null:p.subarray(x,T))}var I=p[r+f.length+1];this.keys=p.subarray(p[r+f.length],I),this.bboxes=p.subarray(I),this.insert=this._insertReadonly}else{this.d=a+2*c;for(var C=0;C<this.d*this.d;C++)f.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=c,this.scale=a/n,this.uid=0;var P=c/a*n;this.min=-P,this.max=n+P}return e.prototype.insert=function(n,a,c,f,p){this._forEachCell(a,c,f,p,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,a,c,f,p,_){this.cells[p].push(_)},e.prototype.query=function(n,a,c,f,p){var _=this.min,x=this.max;if(n<=_&&a<=_&&x<=c&&x<=f&&!p)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(n,a,c,f,this._queryCell,T,{},p),T},e.prototype._queryCell=function(n,a,c,f,p,_,x,T){var I=this.cells[p];if(I!==null)for(var C=this.keys,P=this.bboxes,D=0;D<I.length;D++){var k=I[D];if(x[k]===void 0){var j=4*k;(T?T(P[j+0],P[j+1],P[j+2],P[j+3]):n<=P[j+2]&&a<=P[j+3]&&c>=P[j+0]&&f>=P[j+1])?(x[k]=!0,_.push(C[k])):x[k]=!1}}},e.prototype._forEachCell=function(n,a,c,f,p,_,x,T){for(var I=this._convertToCellCoord(n),C=this._convertToCellCoord(a),P=this._convertToCellCoord(c),D=this._convertToCellCoord(f),k=I;k<=P;k++)for(var j=C;j<=D;j++){var H=this.d*j+k;if((!T||T(this._convertFromCellCoord(k),this._convertFromCellCoord(j),this._convertFromCellCoord(k+1),this._convertFromCellCoord(j+1)))&&p.call(this,n,a,c,f,H,_,x,T))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,a=r+this.cells.length+1+1,c=0,f=0;f<this.cells.length;f++)c+=this.cells[f].length;var p=new Int32Array(a+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var _=a,x=0;x<n.length;x++){var T=n[x];p[r+x]=_,p.set(T,_),_+=T.length}return p[r+n.length]=_,p.set(this.keys,_),p[r+n.length+1]=_+=this.keys.length,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer},Dg}(),Iu=Hi(jv);const Dc={};function jt(r,e,n={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Dc[e]={klass:r,omit:n.omit||[]}}jt(Object,"Object"),Iu.serialize=function(r,e){const n=r.toArrayBuffer();return e&&e.add(n),{buffer:n}},Iu.deserialize=function(r){return new Iu(r.buffer)},Object.defineProperty(Iu,"name",{value:"Grid"}),jt(Iu,"Grid"),delete at.prototype.constructor,jt(vi,"Color"),jt(Error,"Error"),jt(No,"Formatted"),jt(yf,"FormattedSection"),jt(os,"AJAXError"),jt(Bo,"ResolvedImage"),jt(qf,"StylePropertyFunction"),jt(Wf,"StyleExpression",{omit:["_evaluator"]}),jt(Lo,"ImageId"),jt(Qa,"ImageVariant"),jt(Rc,"ZoomDependentExpression"),jt(Eu,"ZoomConstantExpression"),jt(jo,"CompoundExpression",{omit:["_evaluate"]});for(const r in Su)Dc[Su[r]._classRegistryKey]||jt(Su[r],`Expression${r}`);function Qd(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function nl(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Qd(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const a of r)n.push(nl(a,e));return n}if(r instanceof Map){const n={$name:"Map",entries:[]};for(const[a,c]of r.entries())n.entries.push(nl(a),nl(c,e));return n}if(r instanceof Set){const n={$name:"Set"};let a=0;for(const c of r.values())n[++a]=nl(c);return n}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const n=r.constructor,a=n._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const c=n.serialize?n.serialize(r,e):{};if(!n.serialize){for(const f in r)r.hasOwnProperty(f)&&(Dc[a].omit.indexOf(f)>=0||(c[f]=nl(r[f],e)));r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof r)}function Xl(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Qd(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Xl);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const c=r.entries||[],f=new Map;for(let p=0;p<c.length;p+=2)f.set(Xl(c[p]),Xl(c[p+1]));return f}if(e==="Set"){const c=new Set;for(const f of Object.keys(r))f!=="$name"&&c.add(Xl(r[f]));return c}if(e==="BigInt")return BigInt(r.value);const{klass:n}=Dc[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(r);const a=Object.create(n.prototype);for(const c of Object.keys(r))c!=="$name"&&(a[c]=Xl(r[c]));return a}throw new Error("can't deserialize object of type "+typeof r)}const ln={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Jd(r){for(const e of r)if(Zf(e.charCodeAt(0)))return!0;return!1}function Lg(r){for(const e of r)if(!Uv(e.charCodeAt(0)))return!1;return!0}function Uv(r){return!(ln.Arabic(r)||ln["Arabic Supplement"](r)||ln["Arabic Extended-A"](r)||ln["Arabic Presentation Forms-A"](r)||ln["Arabic Presentation Forms-B"](r))}function Zf(r){return!(r!==746&&r!==747&&(r<4352||!(ln["Bopomofo Extended"](r)||ln.Bopomofo(r)||ln["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ln["CJK Compatibility Ideographs"](r)||ln["CJK Compatibility"](r)||ln["CJK Radicals Supplement"](r)||ln["CJK Strokes"](r)||!(!ln["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ln["CJK Unified Ideographs Extension A"](r)||ln["CJK Unified Ideographs"](r)||ln["Enclosed CJK Letters and Months"](r)||ln["Hangul Compatibility Jamo"](r)||ln["Hangul Jamo Extended-A"](r)||ln["Hangul Jamo Extended-B"](r)||ln["Hangul Jamo"](r)||ln["Hangul Syllables"](r)||ln.Hiragana(r)||ln["Ideographic Description Characters"](r)||ln.Kanbun(r)||ln["Kangxi Radicals"](r)||ln["Katakana Phonetic Extensions"](r)||ln.Katakana(r)&&r!==12540||!(!ln["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ln["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ln["Unified Canadian Aboriginal Syllabics"](r)||ln["Unified Canadian Aboriginal Syllabics Extended"](r)||ln["Vertical Forms"](r)||ln["Yijing Hexagram Symbols"](r)||ln["Yi Syllables"](r)||ln["Yi Radicals"](r))))}function Xf(r){return!(Zf(r)||function(e){return!!(ln["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ln["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ln["Letterlike Symbols"](e)||ln["Number Forms"](e)||ln["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ln["Control Pictures"](e)&&e!==9251||ln["Optical Character Recognition"](e)||ln["Enclosed Alphanumerics"](e)||ln["Geometric Shapes"](e)||ln["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ln["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ln["CJK Symbols and Punctuation"](e)||ln.Katakana(e)||ln["Private Use Area"](e)||ln["CJK Compatibility Forms"](e)||ln["Small Form Variants"](e)||ln["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Yf(r){return ln.Arabic(r)||ln["Arabic Supplement"](r)||ln["Arabic Extended-A"](r)||ln["Arabic Presentation Forms-A"](r)||ln["Arabic Presentation Forms-B"](r)}function kg(r){return r>=1424&&r<=2303||ln["Arabic Presentation Forms-A"](r)||ln["Arabic Presentation Forms-B"](r)}function il(r,e){return!(!e&&kg(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ln.Khmer(r))}function Bw(r){for(const e of r)if(kg(e.charCodeAt(0)))return!0;return!1}const ss={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let zg=null,Uo=ss.unavailable,rl=null;const eh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Uo=ss.error),zg&&zg(r)};function Kf(){Qf.fire(new Aa("pluginStateChange",{pluginStatus:Uo,pluginURL:rl}))}const Qf=new Ec,th=function(){return Uo},Vv=function(){if(Uo!==ss.deferred||!rl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Uo=ss.loading,Kf(),rl&&Ka({url:rl},r=>{r?eh(r):(Uo=ss.loaded,Kf())})},ol={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Uo===ss.loaded||ol.applyArabicShaping!=null,isLoading:()=>Uo===ss.loading,setState(r){Uo=r.pluginStatus,rl=r.pluginURL},isParsing:()=>Uo===ss.parsing,isParsed:()=>Uo===ss.parsed,getPluginURL:()=>rl};class Bi{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(const c of n)if(!il(c.charCodeAt(0),a))return!1;return!0}(e,ol.isLoaded())}}class Jf{constructor(e,n,a,c,f){this.property=e,this.value=n,this.expression=function(p,_,x,T,I){if(Hf(p))return new qf(p,_);if(Kd(p)||Array.isArray(p)&&p.length>0){const C=Rg(p,_,x,T,I);if(C.result==="error")throw new Error(C.value.map(P=>`${P.key}: ${P.message}`).join(", "));return C.value}{let C=p;return typeof p=="string"&&_.type==="color"&&(C=vi.parse(p)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>C}}}(n===void 0?e.specification.default:n,e.specification,a,c,f)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a,c){return this.property.possiblyEvaluate(this,e,n,a,c)}}class Og{constructor(e,n,a,c){this.property=e,this.value=new Jf(e,void 0,n,a,c)}transitioned(e,n){return new Gv(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Gv(this.property,this.value,null,{},0)}}class $v{constructor(e,n,a,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return it(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Og(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Jf(this._values[e].property,n===null?void 0:it(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const a=this._properties.properties;if(e)for(const c in e){const f=e[c];if(c.endsWith("-transition")){const p=c.slice(0,-11);a[p]&&this.setTransition(p,f)}else a.hasOwnProperty(c)&&this.setValue(c,f)}}getTransition(e){return it(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Og(this._values[e].property)),this._values[e].transition=it(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const a=new Hv(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,n._values[c]);return a}untransitioned(){const e=new Hv(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Gv{constructor(e,n,a,c,f){const p=c.delay||0,_=c.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+p,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const c=e.now||0,f=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return p.possiblyEvaluate(e,n,a);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),f,vc(_))}}return f}}class Hv{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const c=new kc(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Wv{constructor(e,n,a,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return it(this._values[e].value)}setValue(e,n){this._values[e]=new Jf(this._values[e].property,n===null?void 0:it(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a,c){const f=new kc(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,n,a,c);return f}isIndoorDependent(){return this._isIndoorDependent}}class Lc{constructor(e,n,a,c){this.property=e,this.value=n,this.parameters=a,this.iconImageUseTheme=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,c){return this.property.evaluate(this.value,this.parameters,e,n,a,c,this.iconImageUseTheme)}}class kc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){const c=zd[this.specification.type];return c?c(e,n,a):e}}class Pt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,c,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Lc(this,{kind:"constant",value:e.expression.evaluate(n,null,{},a,c,void 0,f)},n):new Lc(this,e.expression,n,f)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Lc(this,{kind:"constant",value:void 0},e.parameters);const c=zd[this.specification.type];return c?new Lc(this,{kind:"constant",value:c(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,c,f,p,_){return e.kind==="constant"?e.value:e.evaluate(n,a,c,f,p,void 0,_)}}class zc{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,c){return!!e.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class dr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Bi(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new Jf(c,void 0),p=this.defaultTransitionablePropertyValues[a]=new Og(c);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate(n)}}}jt(Pt,"DataDrivenProperty"),jt(bt,"DataConstantProperty"),jt(zc,"ColorRampProperty");var Fe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function qv(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ep(r){if(Array.isArray(r))return r.map(ep);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=ep(r[n]);return e}return qv(r)}function ka(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ka(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function tp(r,e="",n=null,a="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ka(r)||(r=np(r));const c=r;let f=!0;try{f=function(I){if(!Cu(I))return I;let C=ep(I);return Zv(C),C=Oc(C),C}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let p=null,_=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){_=Fe[`filter_${a}`];const I=Zl(f,_,e,n);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));p=(C,P,D)=>I.value.evaluate(C,P,{},D)}let x=null,T=null;if(f!==c){const I=Zl(c,_,e,n);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));x=(C,P,D,k,j)=>I.value.evaluate(C,P,{},D,void 0,void 0,k,j),T=!_u(I.value.expression)}return{filter:p,dynamicFilter:x||void 0,needGeometry:Xv(f),needFeature:!!T}}function Oc(r){if(!Array.isArray(r))return r;const e=function(n){if(jw.has(n[0])){for(let a=1;a<n.length;a++)if(Cu(n[a]))return!0}return n}(r);return e===!0?e:e.map(n=>Oc(n))}function Zv(r){let e=!1;const n=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||Cu(r[a]),n.push(r[a+1]);n.push(r[r.length-1])}else if(r[0]==="match"){e=e||Cu(r[1]);for(let a=2;a<r.length-1;a+=2)n.push(r[a+1]);n.push(r[r.length-1])}else if(r[0]==="step"){e=e||Cu(r[1]);for(let a=1;a<r.length-1;a+=2)n.push(r[a+1])}e&&(r.length=0,r.push("any",...n));for(let a=1;a<r.length;a++)Zv(r[a])}function Cu(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<r.length;n++)if(Cu(r[n]))return!0;return!1}const jw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uw(r,e){return r<e?-1:r>e?1:0}function Xv(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Xv(r[e]))return!0;return!1}function np(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?ip(r[1],r[2],"=="):e==="!="?nh(ip(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ip(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(np))):e==="all"?["all"].concat(r.slice(1).map(np)):e==="none"?["all"].concat(r.slice(1).map(np).map(nh)):e==="in"?rp(r[1],r.slice(2)):e==="!in"?nh(rp(r[1],r.slice(2))):e==="has"?op(r[1]):e!=="!has"||nh(op(r[1]));var n}function ip(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function rp(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Uw)]]:["filter-in-small",r,["literal",e]]}}function op(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function nh(r){return["!",r]}const Fc="";function ca(r,e){return e?`${r}${Fc}${e}`:r}let Yv;const Kv=()=>Yv||(Yv=new dr({"icon-size":new Pt(Fe.layout_symbol["icon-size"]),"icon-image":new Pt(Fe.layout_symbol["icon-image"]),"icon-rotate":new Pt(Fe.layout_symbol["icon-rotate"]),"icon-offset":new Pt(Fe.layout_symbol["icon-offset"]),"text-size":new Pt(Fe.layout_symbol["text-size"]),"text-rotate":new Pt(Fe.layout_symbol["text-rotate"]),"text-offset":new Pt(Fe.layout_symbol["text-offset"])}));class Qv{constructor(e,n,a,c,f,p){const _=Zl(e,Fe.appearance.condition);if(_.result==="success"&&(this.condition=_.value),this.name=n,a){this.properties=new kc(Kv()),this.unevaluatedLayout=new Wv(Kv(),c,f,p);for(const x in a)this.unevaluatedLayout.setValue(x,a[x])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,n,a){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,a))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),n=this.hasProperty("icon-size"),a=this.hasProperty("icon-offset"),c=this.hasProperty("icon-rotate");return e||n||a||c}hasTextProperties(){const e=this.hasProperty("text-size"),n=this.hasProperty("text-offset"),a=this.hasProperty("text-rotate");return e||n||a}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Jv="-transition",za=new Set(["fill","line","background","hillshade","raster"]);class Vo extends Ec{constructor(e,n,a,c,f,p){if(super(),this.id=e.id,this.fqid=ca(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=f,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const _=Zl(this.filter,Fe[`filter_${e.type}`]);_.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new Wv(n.layout,this.scope,f,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new $v(n.paint,this.scope,f);for(const _ in e.paint)this.setPaintProperty(_,e.paint[_]);for(const _ in e.layout)this.setLayoutProperty(_,e.layout[_]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kc(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&za.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(n=>{this.appearances.push(new Qv(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Jv)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const a=this._transitionablePaint,c=a._properties.properties;if(e.endsWith(Jv)){const C=e.slice(0,-11);return c[C]&&a.setTransition(C,n||void 0),!1}if(!c[e])return!1;const f=a._values[e],p=f.value.isDataDriven(),_=f.value;a.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const x=a._values[e].value,T=x.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||p||I||this._handleOverridablePaintPropertyUpdate(e,_,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(n=>n.serialize())),gt(e,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Lc&&Yd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!Gd(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=tp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,a){return{}}queryRadius(e){}queryIntersectsFeature(e,n,a,c,f,p,_,x,T){}}const e0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ih{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Vw=new ArrayBuffer(0);class qi{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,n){return e._trim(),n&&e.arrayBuffer&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,e.arrayBuffer?n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement:(n.capacity=0,n.arrayBuffer=Vw),n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function jn(r,e=1){let n=0,a=0;return{members:r.map(c=>{const f=e0[c.type].BYTES_PER_ELEMENT,p=n=t0(n,Math.max(e,f)),_=c.components||1;return a=Math.max(a,f),n+=f*_,{name:c.name,type:c.type,components:_,offset:p}}),size:t0(n,Math.max(a,e)),alignment:e}}function t0(r,e){return Math.ceil(r/e)*e}class Yl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,e}}Yl.prototype.bytesPerElement=4,jt(Yl,"StructArrayLayout2i4");class Au extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=c,e}}Au.prototype.bytesPerElement=6,jt(Au,"StructArrayLayout3i6");class Pu extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=c,this.int16[p+3]=f,e}}Pu.prototype.bytesPerElement=8,jt(Pu,"StructArrayLayout4i8");class sl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}sl.prototype.bytesPerElement=4,jt(sl,"StructArrayLayout1f4");class Fg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){const f=4*e,p=2*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.float32[p+1]=c,e}}Fg.prototype.bytesPerElement=8,jt(Fg,"StructArrayLayout2i1f8");class Ng extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){const f=4*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=c,e}}Ng.prototype.bytesPerElement=8,jt(Ng,"StructArrayLayout3i8");class Bg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,f)}emplace(e,n,a,c,f,p){const _=5*e;return this.int16[_+0]=n,this.int16[_+1]=a,this.int16[_+2]=c,this.int16[_+3]=f,this.int16[_+4]=p,e}}Bg.prototype.bytesPerElement=10,jt(Bg,"StructArrayLayout5i10");class sp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,p,_)}emplace(e,n,a,c,f,p,_,x){const T=6*e,I=12*e,C=3*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.uint8[I+4]=c,this.uint8[I+5]=f,this.uint8[I+6]=p,this.uint8[I+7]=_,this.float32[C+2]=x,e}}sp.prototype.bytesPerElement=12,jt(sp,"StructArrayLayout2i4ub1f12");class ys extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=c,e}}ys.prototype.bytesPerElement=12,jt(ys,"StructArrayLayout3f12");class Ko extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,f)}emplace(e,n,a,c,f,p){const _=6*e,x=3*e;return this.uint16[_+0]=n,this.uint16[_+1]=a,this.uint16[_+2]=c,this.uint16[_+3]=f,this.float32[x+2]=p,e}}Ko.prototype.bytesPerElement=12,jt(Ko,"StructArrayLayout4ui1f12");class Nc extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=c,this.uint16[p+3]=f,e}}Nc.prototype.bytesPerElement=8,jt(Nc,"StructArrayLayout4ui8");class ap extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,f,p)}emplace(e,n,a,c,f,p,_){const x=6*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=_,e}}ap.prototype.bytesPerElement=12,jt(ap,"StructArrayLayout6i12");class jg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,a,c,f,p,_,x,T,I,C,P)}emplace(e,n,a,c,f,p,_,x,T,I,C,P,D){const k=12*e;return this.int16[k+0]=n,this.int16[k+1]=a,this.int16[k+2]=c,this.int16[k+3]=f,this.uint16[k+4]=p,this.uint16[k+5]=_,this.uint16[k+6]=x,this.uint16[k+7]=T,this.int16[k+8]=I,this.int16[k+9]=C,this.int16[k+10]=P,this.int16[k+11]=D,e}}jg.prototype.bytesPerElement=24,jt(jg,"StructArrayLayout4i4ui4i24");class Ug extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,f,p)}emplace(e,n,a,c,f,p,_){const x=10*e,T=5*e;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=_,e}}Ug.prototype.bytesPerElement=20,jt(Ug,"StructArrayLayout3i3f20");class Kl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=c,this.float32[p+3]=f,e}}Kl.prototype.bytesPerElement=16,jt(Kl,"StructArrayLayout4f16");class lp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}lp.prototype.bytesPerElement=4,jt(lp,"StructArrayLayout1ul4");class vs extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,e}}vs.prototype.bytesPerElement=4,jt(vs,"StructArrayLayout2ui4");class cp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C,P,D){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,a,c,f,p,_,x,T,I,C,P,D)}emplace(e,n,a,c,f,p,_,x,T,I,C,P,D,k){const j=20*e,H=10*e;return this.int16[j+0]=n,this.int16[j+1]=a,this.int16[j+2]=c,this.int16[j+3]=f,this.int16[j+4]=p,this.float32[H+3]=_,this.float32[H+4]=x,this.float32[H+5]=T,this.float32[H+6]=I,this.int16[j+14]=C,this.uint32[H+8]=P,this.uint16[j+18]=D,this.uint16[j+19]=k,e}}cp.prototype.bytesPerElement=40,jt(cp,"StructArrayLayout5i4f1i1ul2ui40");class up extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,p,_)}emplace(e,n,a,c,f,p,_,x){const T=8*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=c,this.int16[T+4]=f,this.int16[T+5]=p,this.int16[T+6]=_,this.int16[T+7]=x,e}}up.prototype.bytesPerElement=16,jt(up,"StructArrayLayout3i2i2i16");class dp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,f)}emplace(e,n,a,c,f,p){const _=4*e,x=8*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=c,this.int16[x+6]=f,this.int16[x+7]=p,e}}dp.prototype.bytesPerElement=16,jt(dp,"StructArrayLayout2f1f2i16");class Vg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,f,p)}emplace(e,n,a,c,f,p,_){const x=20*e,T=5*e;return this.uint8[x+0]=n,this.uint8[x+1]=a,this.float32[T+1]=c,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=_,e}}Vg.prototype.bytesPerElement=20,jt(Vg,"StructArrayLayout2ub4f20");class kr extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a)}emplace(e,n,a,c){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=c,e}}kr.prototype.bytesPerElement=6,jt(kr,"StructArrayLayout3ui6");class Mu extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e)}emplace(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e,fe){const xe=30*e,Ie=15*e,Pe=60*e;return this.int16[xe+0]=n,this.int16[xe+1]=a,this.int16[xe+2]=c,this.float32[Ie+2]=f,this.float32[Ie+3]=p,this.uint16[xe+8]=_,this.uint16[xe+9]=x,this.uint32[Ie+5]=T,this.uint32[Ie+6]=I,this.uint32[Ie+7]=C,this.uint16[xe+16]=P,this.uint16[xe+17]=D,this.uint16[xe+18]=k,this.float32[Ie+10]=j,this.float32[Ie+11]=H,this.uint8[Pe+48]=$,this.uint8[Pe+49]=K,this.uint8[Pe+50]=ee,this.uint32[Ie+13]=se,this.int16[xe+28]=_e,this.uint8[Pe+58]=fe,e}}Mu.prototype.bytesPerElement=60,jt(Mu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $g extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e,fe,xe,Ie,Pe,Xe,ke,Je,rt,ot,ht,pt,ct){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e,fe,xe,Ie,Pe,Xe,ke,Je,rt,ot,ht,pt,ct)}emplace(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e,fe,xe,Ie,Pe,Xe,ke,Je,rt,ot,ht,pt,ct,ut){const Qe=20*e,Ye=40*e,dt=80*e;return this.float32[Qe+0]=n,this.float32[Qe+1]=a,this.int16[Ye+4]=c,this.int16[Ye+5]=f,this.int16[Ye+6]=p,this.int16[Ye+7]=_,this.int16[Ye+8]=x,this.int16[Ye+9]=T,this.int16[Ye+10]=I,this.int16[Ye+11]=C,this.int16[Ye+12]=P,this.uint16[Ye+13]=D,this.uint16[Ye+14]=k,this.uint16[Ye+15]=j,this.uint16[Ye+16]=H,this.uint16[Ye+17]=$,this.uint16[Ye+18]=K,this.uint16[Ye+19]=ee,this.uint16[Ye+20]=se,this.uint16[Ye+21]=_e,this.uint16[Ye+22]=fe,this.uint16[Ye+23]=xe,this.uint16[Ye+24]=Ie,this.uint16[Ye+25]=Pe,this.uint16[Ye+26]=Xe,this.uint16[Ye+27]=ke,this.uint32[Qe+14]=Je,this.float32[Qe+15]=rt,this.float32[Qe+16]=ot,this.float32[Qe+17]=ht,this.float32[Qe+18]=pt,this.uint8[dt+76]=ct,this.uint16[Ye+39]=ut,e}}$g.prototype.bytesPerElement=80,jt($g,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Gg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,c,f,p)}emplace(e,n,a,c,f,p,_){const x=6*e;return this.float32[x+0]=n,this.float32[x+1]=a,this.float32[x+2]=c,this.float32[x+3]=f,this.float32[x+4]=p,this.float32[x+5]=_,e}}Gg.prototype.bytesPerElement=24,jt(Gg,"StructArrayLayout6f24");class Bc extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,c,f)}emplace(e,n,a,c,f,p){const _=5*e;return this.float32[_+0]=n,this.float32[_+1]=a,this.float32[_+2]=c,this.float32[_+3]=f,this.float32[_+4]=p,e}}Bc.prototype.bytesPerElement=20,jt(Bc,"StructArrayLayout5f20");class Hg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,p,_)}emplace(e,n,a,c,f,p,_,x){const T=7*e;return this.float32[T+0]=n,this.float32[T+1]=a,this.float32[T+2]=c,this.float32[T+3]=f,this.float32[T+4]=p,this.float32[T+5]=_,this.float32[T+6]=x,e}}Hg.prototype.bytesPerElement=28,jt(Hg,"StructArrayLayout7f28");class Wg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,a,c,f,p,_,x,T,I,C)}emplace(e,n,a,c,f,p,_,x,T,I,C,P){const D=11*e;return this.float32[D+0]=n,this.float32[D+1]=a,this.float32[D+2]=c,this.float32[D+3]=f,this.float32[D+4]=p,this.float32[D+5]=_,this.float32[D+6]=x,this.float32[D+7]=T,this.float32[D+8]=I,this.float32[D+9]=C,this.float32[D+10]=P,e}}Wg.prototype.bytesPerElement=44,jt(Wg,"StructArrayLayout11f44");class Ru extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,a,c,f,p,_,x,T)}emplace(e,n,a,c,f,p,_,x,T,I){const C=9*e;return this.float32[C+0]=n,this.float32[C+1]=a,this.float32[C+2]=c,this.float32[C+3]=f,this.float32[C+4]=p,this.float32[C+5]=_,this.float32[C+6]=x,this.float32[C+7]=T,this.float32[C+8]=I,e}}Ru.prototype.bytesPerElement=36,jt(Ru,"StructArrayLayout9f36");class Oa extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=a,e}}Oa.prototype.bytesPerElement=8,jt(Oa,"StructArrayLayout2f8");class Qo extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,c)}emplace(e,n,a,c,f){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=c,this.uint16[p+4]=f,e}}Qo.prototype.bytesPerElement=12,jt(Qo,"StructArrayLayout1ul3ui12");class Ql extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ql.prototype.bytesPerElement=2,jt(Ql,"StructArrayLayout1ui2");class qg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H){const $=this.length;return this.resize($+1),this.emplace($,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H)}emplace(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$){const K=16*e;return this.float32[K+0]=n,this.float32[K+1]=a,this.float32[K+2]=c,this.float32[K+3]=f,this.float32[K+4]=p,this.float32[K+5]=_,this.float32[K+6]=x,this.float32[K+7]=T,this.float32[K+8]=I,this.float32[K+9]=C,this.float32[K+10]=P,this.float32[K+11]=D,this.float32[K+12]=k,this.float32[K+13]=j,this.float32[K+14]=H,this.float32[K+15]=$,e}}qg.prototype.bytesPerElement=64,jt(qg,"StructArrayLayout16f64");class hp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,c,f,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,c,f,p,_)}emplace(e,n,a,c,f,p,_,x){const T=10*e,I=5*e;return this.uint16[T+0]=n,this.uint16[T+1]=a,this.uint16[T+2]=c,this.uint16[T+3]=f,this.float32[I+2]=p,this.float32[I+3]=_,this.float32[I+4]=x,e}}hp.prototype.bytesPerElement=20,jt(hp,"StructArrayLayout4ui3f20");class Zg extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Zg.prototype.bytesPerElement=2,jt(Zg,"StructArrayLayout1i2");class fp extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}fp.prototype.bytesPerElement=1,jt(fp,"StructArrayLayout1ub1");class pp extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pp.prototype.size=40;class n0 extends cp{get(e){return new pp(this,e)}}jt(n0,"CollisionBoxArray");class mp extends ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}mp.prototype.size=60;class i0 extends Mu{get(e){return new mp(this,e)}}jt(i0,"PlacedSymbolArray");class r0 extends ih{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}r0.prototype.size=80;class Xg extends $g{get(e){return new r0(this,e)}}jt(Xg,"SymbolInstanceArray");class gp extends sl{getoffsetX(e){return this.float32[1*e+0]}}jt(gp,"GlyphOffsetArray");class o0 extends Yl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}jt(o0,"SymbolLineVertexArray");class Yg extends ih{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yg.prototype.size=12;class Kg extends Qo{get(e){return new Yg(this,e)}}jt(Kg,"FeatureIndexArray");class s0 extends vs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}jt(s0,"FillExtrusionCentroidArray");class _p extends ih{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}_p.prototype.size=6;class rh extends Au{get(e){return new _p(this,e)}}jt(rh,"FillExtrusionWallArray");const a0=jn([{name:"a_pos",components:2,type:"Int16"}],4),$w=jn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),l0=jn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class er{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,c){let f=this.segments[this.segments.length-1];return e>er.MAX_VERTEX_ARRAY_LENGTH&&Ot(`Max vertices per segment is ${er.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>er.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}prepareSegment(e,n,a,c){return this._prepareSegment(e,n.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,c){return new er([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function yp(r,e){return 256*(r=W(Math.floor(r),0,255))+W(Math.floor(e),0,255)}er.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt(er,"SegmentVector");const Gw=jn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Hw=jn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Ww=jn([{name:"a_dash",components:4,type:"Uint16"}]);class oh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,c){this.ids.push(Qg(e)),this.positions.push(n,a,c)}eachPosition(e,n){const a=Qg(e);let c=0,f=this.ids.length-1;for(;c<f;){const p=c+f>>1;this.ids[p]>=a?f=p:c=p+1}for(;this.ids[c]===a;)n(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,n){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Jg(a,c,0,a.length-1),n&&(n.add(a.buffer),n.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const n=new oh;let a;n.ids=e.ids,n.positions=e.positions;for(const c of n.ids)c!==a&&n.uniqueIds.push(c),a=c;return n.indexed=!0,n}}function Qg(r){const e=+r;return Number.isSafeInteger(e)?e:pf(String(r))}function Jg(r,e,n,a){for(;n<a;){const c=r[n+a>>1];let f=n-1,p=a+1;for(;;){do f++;while(r[f]<c);do p--;while(r[p]>c);if(f>=p)break;vp(r,f,p),vp(e,3*f,3*p),vp(e,3*f+1,3*p+1),vp(e,3*f+2,3*p+2)}p-n<a-p?(Jg(r,e,n,p),n=p+1):(Jg(r,e,p+1,a),a=p)}}function vp(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}jt(oh,"FeaturePositionMap");class al{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xp extends al{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class zr extends al{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Fa extends al{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class sh extends al{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class wp extends al{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class ah extends al{constructor(e){super(e),this.current=vi.transparent.toPremultipliedRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const qw=new Float32Array(16);class lh extends al{constructor(e){super(e),this.current=qw}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const bp=new Float32Array(9),Zw=new Float32Array(4);class Tp extends al{constructor(e){super(e),this.current=Zw}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function e_(r){return[yp(255*r.r,255*r.g),yp(255*r.b,255*r.a)]}function ch(r,e,n,a,c,f,p,_){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Bi(0,{brightness:f,worldview:_}),e,n,c,a,p)==="none":r.value==="none")}class uh{constructor(e,n,a,c){this.value=e,this.uniformNames=n.map(f=>`u_${f}`),this.type=a,this.context=c}setUniform(e,n,a,c,f){const p=c.constantOr(this.value);n.set(e,f,p instanceof vi?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,n){return this.type==="color"?new ah(e):new zr(e)}}class Du{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,a,c,f){let p=null;f!=="u_pattern"&&f!=="u_dash"||(p=this.pattern),f==="u_pattern_b"&&(p=this.patternTransition),f==="u_pixel_ratio"&&(p=this.pixelRatio),p&&n.set(e,f,p)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new wp(e):new zr(e)}}class ll{constructor(e,n,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,a,c,f,p,_,x){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Bi(0,{brightness:p,worldview:x}),n,{},f,c,_):this.expression.kind==="constant"&&this.expression.value,C=ch(this.lutExpression,n,{},c,f,p,_,x);this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,C?null:this.context.lut)}updatePaintArray(e,n,a,c,f,p,_,x){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:_,worldview:x},a,c,void 0,f):this.expression.kind==="constant"&&this.expression.value,I=ch(this.lutExpression,a,c,f,void 0,_,void 0,x);this._setPaintValue(e,n,T,I?null:this.context.lut)}_setPaintValue(e,n,a,c){if(this.type==="color"){const f=e_(a.toPremultipliedRenderColor(c));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(e,n,a,c,f,p){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=c,this.context=f,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,c,f,p,_,x){const T=this.expression.evaluate(new Bi(this.context.zoom,{brightness:p,worldview:x}),n,{},f,c,_),I=this.expression.evaluate(new Bi(this.context.zoom+1,{brightness:p,worldview:x}),n,{},f,c,_),C=ch(this.lutExpression,n,{},c,f,p,_,x),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,T,I,C?null:this.context.lut)}updatePaintArray(e,n,a,c,f,p,_,x){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:_,worldview:x},a,c,void 0,f),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_,worldview:x},a,c,void 0,f),C=ch(this.lutExpression,a,c,f,void 0,_,void 0,x);this._setPaintValue(e,n,T,I,C?null:this.context.lut)}_setPaintValue(e,n,a,c,f){if(this.type==="color"){const p=e_(a.toPremultipliedRenderColor(f)),_=e_(a.toPremultipliedRenderColor(f));for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,p[0],p[1],_[0],_[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,c,f){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=W(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,f,_)}getBinding(e,n){return new zr(e)}}class ul{constructor(e,n,a,c,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(a==="array"?Ww:Gw).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new c,this.paintTransitionVertexArray=new Nc}populatePaintArray(e,n,a,c){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,c,f,p,_){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,c){if(!c||!a)return;const f=c[a[0]],p=c[a[1]];if(f){if(f){const{tl:_,br:x,pixelRatio:T}=f;for(let I=e;I<n;I++)this.paintVertexArray.emplace(I,_[0],_[1],x[0],x[1],T)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:_,br:x}=p;for(let T=e;T<n;T++)this.paintTransitionVertexArray.emplace(T,_[0],_[1],x[0],x[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Hw.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Jl{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;const c=[];for(const f in e.paint._values){const p=e.paint.get(f);if(f.endsWith("-use-theme")||!a(f)||!(p instanceof Lc&&Yd(p.property.specification)))continue;const _=Yw(f,e.type),x=p.value,T=p.property.specification.type,I=!!p.property.useIntegerZoom,C=f==="line-dasharray"||f.endsWith("pattern"),P=e.paint.get(`${f}-use-theme`),D=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(x.kind!=="constant"||D)if(x.kind==="source"||D||C){const k=t_(f,T,"source");this.binders[f]=C?new ul(x,_,T,k,e.id):new ll(x,_,T,k),c.push(`/a_${f}`)}else{const k=t_(f,T,"composite");this.binders[f]=new cl(x,_,T,I,n,k),c.push(`/z_${f}`)}else this.binders[f]=C?new Du(x.value,_):new uh(x.value,_,T,n),c.push(`/u_${f}`);P&&(this.binders[f].lutExpression=P.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof ll||n instanceof cl?n.maxValue:0}populatePaintArrays(e,n,a,c,f,p,_,x){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof ll||I instanceof cl||I instanceof ul)&&I.populatePaintArray(e,n,a,c,f,p,_,x)}}setConstantPatternPositions(e,n){for(const a in this.binders){const c=this.binders[a];c instanceof Du&&c.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof ul?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,a,c,f,p,_,x,T,I){let C=!1;const P=Object.keys(e),D=P.length!==0&&!x,k=D?P:n.uniqueIds;this.context.lut=f.lut;for(const j in this.binders){const H=this.binders[j];if(H.context=this.context,(H instanceof ll||H instanceof cl||H instanceof ul)&&H.expression&&H.expression.kind&&H.expression.kind!=="constant"&&(H.expression.isStateDependent===!0||H.expression.isLightConstant===!1)){const $=f.paint.get(j);H.expression=$.value;for(const K of k){const ee=e[K.toString()];n.eachPosition(K,(se,_e,fe)=>{const xe=c.feature(se);H.updatePaintArray(_e,fe,xe,ee,p,_,T,I)})}if(!D)for(const K of a.uniqueIds){const ee=e[K.toString()];a.eachPosition(K,(se,_e,fe)=>{const xe=c.feature(se);H.updatePaintArray(_e,fe,xe,ee,p,_,T,I)})}C=!0}}return C}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof uh||a instanceof Du)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof uh||c instanceof Du||c instanceof cl)for(const f of c.uniformNames)n.push({name:f,property:a,binding:c.getBinding(e,f)})}return n}setUniforms(e,n,a,c,f){for(const{name:p,property:_,binding:x}of a)this.binders[_].setUniform(e,x,f,c.get(_),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof ll||n instanceof cl||n instanceof ul)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof ul&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof ll||a instanceof cl||a instanceof ul)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof ll||n instanceof cl||n instanceof ul)&&n.destroy()}}}class ua{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Jl(c,n,a);this.needsUpload=!1,this._featureMap=new oh,this._featureMapWithoutIds=new oh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,c,f,p,_,x,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,n,c,f,p,_,x,T);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,c,f,p,_,x){for(const T of a)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,T,c,f,p,_||0,x)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Xw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Yw(r,e){return Xw[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Kw={"line-pattern":{source:Ko,composite:Ko},"fill-pattern":{source:Ko,composite:Ko},"fill-extrusion-pattern":{source:Ko,composite:Ko},"line-dasharray":{source:Nc,composite:Nc}},Qw={color:{source:Oa,composite:Kl},number:{source:sl,composite:Oa}};function t_(r,e,n){const a=Kw[r];return a&&a[n]||Qw[e][n]}jt(uh,"ConstantBinder"),jt(Du,"PatternConstantBinder"),jt(ll,"SourceExpressionBinder"),jt(ul,"PatternCompositeBinder"),jt(cl,"CompositeExpressionBinder"),jt(Jl,"ProgramConfiguration",{omit:["_buffers"]}),jt(ua,"ProgramConfigurationSet");const Eo=Et/Math.PI/2,Vs=5,Sp=6,Jw=16383,Lu=64,n_=[Lu,32,16],$s=-Eo,Gs=Eo;function jc(r,e,n,a=Eo){return n=Bn(n),[r*Math.sin(n)*a,-e*a,r*Math.cos(n)*a]}function ku(r,e,n){return jc(Math.cos(Bn(r)),Math.sin(Bn(r)),e,n)}const u=63710088e-1,t=2*Math.PI*u;class s{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new s(de(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,c=e.lat*n,f=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return u*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new d({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return ku(this.lat,this.lng,Eo+e*Eo/u)}static convert(e){if(e instanceof s)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new s(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new s(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class d{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof s?new s(e.lng,e.lat):s.convert(e),this}setSouthWest(e){return this._sw=e instanceof s?new s(e.lng,e.lat):s.convert(e),this}extend(e){const n=this._sw,a=this._ne;let c,f;if(e instanceof s)c=e,f=e;else{if(!(e instanceof d))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(d.convert(e)):this.extend(s.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(s.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new s(c.lng,c.lat),this._ne=new s(f.lng,f.lat)),this}getCenter(){return new s((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s(this.getWest(),this.getNorth())}getSouthEast(){return new s(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=s.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){if(e)return e instanceof d?e:new d(e)}}const m=0,y=25.5;function v(r){return t*Math.cos(r*Math.PI/180)}function b(r){return(180+r)/360}function E(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function A(r,e){return r/v(e)}function M(r){return 360*r-180}function O(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function z(r,e){return r*v(O(e))}const F=85.051129;function V(r){return Math.cos(Bn(W(r,-F,F)))}function U(r,e){const n=W(e,m,y),a=Math.pow(2,n);return V(r)*t/(512*a)}function X(r){return 1/Math.cos(r*Math.PI/180)}function Z(r,e=0){const n=Math.exp(Math.PI*(1-(r.y+e/Et)/(1<<r.z)*2));return 80150034*n/(n*n+1)/Et/(1<<r.z)}class ne{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=s.convert(e);return new ne(b(a.lng),E(a.lat),A(n,a.lat))}toLngLat(){return new s(M(this.x),O(this.y))}toAltitude(){return z(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*X(O(this.y))}}function ae(r,e,n,a,c,f,p,_,x){const T=(e+a)/2,I=(n+c)/2,C=new at(T,I);_(C),function(P,D,k,j,H,$){const K=k-H,ee=j-$;return Math.abs((j-D)*K-(k-P)*ee)/Math.hypot(K,ee)}(C.x,C.y,f.x,f.y,p.x,p.y)>=x?(ae(r,e,n,T,I,f,C,_,x),ae(r,T,I,a,c,C,p,_,x)):r.push(p)}function re(r,e,n){let a=r[0],c=a.x,f=a.y;e(a);const p=[a];for(let _=1;_<r.length;_++){const x=r[_],{x:T,y:I}=x;e(x),ae(p,c,f,T,I,a,x,e,n),c=T,f=I,a=x}return p}function we(r,e,n,a){if(a(e,n)){const c=e.add(n)._mult(.5);we(r,e,c,a),we(r,c,n,a)}else r.push(n)}function ge(r,e){let n=r[0];const a=[n];for(let c=1;c<r.length;c++){const f=r[c];we(a,n,f,e),n=f}return a}const ve=Math.pow(2,14)-1,me=-ve-1;function he(r,e){const n=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=W(n,me,ve),r.y=W(a,me,ve),(n<r.x||n>r.x+1||a<r.y||a>r.y+1)&&Ot("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Se(r,e,n){const a=r.loadGeometry(),c=r.extent,f=Et/c;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:_,x,y:T,projection:I}=n,C=P=>{const D=M((e.x+P.x/c)/p),k=O((e.y+P.y/c)/p),j=I.project(D,k);P.x=(j.x*_-x)*c,P.y=(j.y*_-T)*c};for(let P=0;P<a.length;P++)if(r.type!==1)a[P]=re(a[P],C,1);else{const D=[];for(const k of a[P])k.x<0||k.x>=c||k.y<0||k.y>=c||(C(k),D.push(k));a[P]=D}}for(const p of a)for(const _ of p)he(_,f);return a}function Le(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Se(r):[]}}class Re{constructor(e,n,a,c,f){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=f,e.readFields(qe,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,a=[];let c,f=1,p=0,_=0,x=0;for(;e.pos<n;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)_+=e.readSVarint(),x+=e.readSVarint(),f===1&&(c&&a.push(c),c=[]),c&&c.push(new at(_,x));else{if(f!==7)throw new Error(`unknown command ${f}`);c&&c.push(c[0].clone())}}return c&&a.push(c),a}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let a=1,c=0,f=0,p=0,_=1/0,x=-1/0,T=1/0,I=-1/0;for(;e.pos<n;){if(c<=0){const C=e.readVarint();a=7&C,c=C>>3}if(c--,a===1||a===2)f+=e.readSVarint(),p+=e.readSVarint(),f<_&&(_=f),f>x&&(x=f),p<T&&(T=p),p>I&&(I=p);else if(a!==7)throw new Error(`unknown command ${a}`)}return[_,T,x,I]}toGeoJSON(e,n,a){const c=this.extent*Math.pow(2,a),f=this.extent*e,p=this.extent*n,_=this.loadGeometry();function x(P){return[360*(P.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(P.y+p)/c)*Math.PI))-90]}function T(P){return P.map(x)}let I;if(this.type===1){const P=[];for(const k of _)P.push(k[0]);const D=T(P);I=P.length===1?{type:"Point",coordinates:D[0]}:{type:"MultiPoint",coordinates:D}}else if(this.type===2){const P=_.map(T);I=P.length===1?{type:"LineString",coordinates:P[0]}:{type:"MultiLineString",coordinates:P}}else{if(this.type!==3)throw new Error("unknown feature type");{const P=function(k){const j=k.length;if(j<=1)return[k];const H=[];let $,K;for(let ee=0;ee<j;ee++){const se=Ze(k[ee]);se!==0&&(K===void 0&&(K=se<0),K===se<0?($&&H.push($),$=[k[ee]]):$&&$.push(k[ee]))}return $&&H.push($),H}(_),D=[];for(const k of P)D.push(k.map(T));I=D.length===1?{type:"Polygon",coordinates:D[0]}:{type:"MultiPolygon",coordinates:D}}}const C={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function qe(r,e,n){r===1?e.id=n.readVarint():r===2?function(a,c){const f=a.readVarint()+a.pos;for(;a.pos<f;){const p=c._keys[a.readVarint()],_=c._values[a.readVarint()];c.properties[p]=_}}(n,e):r===3?e.type=n.readVarint():r===4&&(e._geometry=n.pos)}function Ze(r){let e=0;for(let n,a,c=0,f=r.length,p=f-1;c<f;p=c++)n=r[c],a=r[p],e+=(a.x-n.x)*(n.y+a.y);return e}Re.types=["Unknown","Point","LineString","Polygon"];class tt{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(_t,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Re(this._pbf,n,this.extent,this._keys,this._values)}}function _t(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(a){let c=null;const f=a.readVarint()+a.pos;for(;a.pos<f;){const p=a.readVarint()>>3;c=p===1?a.readString():p===2?a.readFloat():p===3?a.readDouble():p===4?a.readVarint64():p===5?a.readVarint():p===6?a.readSVarint():p===7?a.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c}(n))}class Ue{constructor(e,n){this.layers=e.readFields(Ae,{},n)}}function Ae(r,e,n){if(r===3){const a=new tt(n,n.readVarint()+n.pos);a.length&&(e[a.name]=a)}}const Ke="3d_elevation_id",$e="level";class lt{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,a){return this.get(e,!0,n,a)}optional(e,n,a){return this.get(e,!1,n,a)}success(){return this._valid}get(e,n,a,c){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?a(c?c(f):f):n&&(this._valid=!1),this}}class Ct{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,a){return this.featureFunc(e,n,a)}parseVertex(e,n,a){return this.vertexFunc(e,n,a)}}const zt=new Ct((r,e,n)=>r.reset(e).require(Ke,a=>{n.id=a}).optional("fixed_height_relative",a=>{n.constantHeight=a},yt.decodeRelativeHeight).geometry(a=>{n.bounds=a},el).success(),(r,e,n)=>r.reset(e).require(Ke,a=>{n.id=a}).require("elevation_idx",a=>{n.idx=a}).require("extent",a=>{n.extent=a}).require("height_relative",a=>{n.height=a},yt.decodeRelativeHeight).geometry(a=>{n.position=a},yt.getPoint).success()),St=new Ct((r,e,n)=>r.reset(e).require(Ke,a=>{n.id=a}).optional("fixed_height",a=>{n.constantHeight=a},yt.decodeMetricHeight).geometry(a=>{n.bounds=a},el).success(),(r,e,n)=>r.reset(e).require(Ke,a=>{n.id=a}).require("elevation_idx",a=>{n.idx=a}).require("extent",a=>{n.extent=a}).require("height",a=>{n.height=a},yt.decodeMetricHeight).geometry(a=>{n.position=a},yt.getPoint).success());class yt{static getPoint(e){return wo(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?St:void 0:zt}static parse(e){const n=[],a=[],c=e.length,f=new lt;for(let p=0;p<c;p++){const _=e.feature(p),x=_.properties.version,T=yt.getVersionSchema(x);if(T===void 0){Ot(`Unknown elevation feature version number ${x||"(unknown)"}`);continue}const I=_.properties.type;if(!I)continue;const C=Re.types[_.type];if(C==="Point"&&I==="curve_point"){const P={};T.parseVertex(f,_,P)&&n.push(P)}else if(C==="Polygon"&&I==="curve_meta"){const P={};T.parseFeature(f,_,P)&&a.push(P)}}return{vertices:n,features:a}}}class Xt{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const c=ta(n,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/c;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,!0}}class Ut{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const c=En(n,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/c;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,a){if(function(D,k){var j=D[0],H=D[1],$=D[2],K=k[0],ee=k[1],se=k[2];return Math.abs(j-K)<=N*Math.max(1,Math.abs(j),Math.abs(K))&&Math.abs(H-ee)<=N*Math.max(1,Math.abs(H),Math.abs(ee))&&Math.abs($-se)<=N*Math.max(1,Math.abs($),Math.abs(se))}(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;const[c,f,p]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],T=this.pos[2]-e[2],I=c*c+f*f+p*p,C=2*(_*c+x*f+T*p),P=C*C-4*I*(_*_+x*x+T*T-n*n);if(P<0){const D=Math.max(-C/2,0),k=_+c*D,j=x+f*D,H=T+p*D,$=Math.hypot(k,j,H);return a[0]=k*n/$,a[1]=j*n/$,a[2]=H*n/$,!1}{const D=(-C-Math.sqrt(P))/(2*I);if(D<0){const k=Math.hypot(_,x,T);return a[0]=_*n/k,a[1]=x*n/k,a[2]=T*n/k,!1}return a[0]=_+c*D,a[1]=x+f*D,a[2]=T+p*D,!0}}}class Dt{constructor(e,n,a,c,f){this.TL=e,this.TR=n,this.BR=a,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,n,a){const c=[-1,1,1],f=[1,1,1],p=[1,-1,1],_=[-1,-1,1],x=li(c,c,e),T=li(f,f,e),I=li(p,p,e),C=li(_,_,e);return new Dt(x,T,I,C,n/a)}}function Ft(r,e,n){let a=1/0,c=-1/0;const f=[];for(const p of r){Di(f,p,e);const _=En(f,n);a=Math.min(a,_),c=Math.max(c,_)}return[a,c]}function sn(r,e){let n=!0;for(let a=0;a<r.planes.length;a++){const c=r.planes[a];let f=0;for(let p=0;p<e.length;p++)f+=+(En(c,e[p])+c[3]>=0);if(f===0)return 0;f!==e.length&&(n=!1)}return n?2:1}function Tn(r,e){for(const n of r.projections){const a=Ft(e,r.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function Gn(r,e){let n=0;const a=[0,0,0,0];for(let p=0;p<r.length;p++)a[0]=r[p][0],a[1]=r[p][1],a[2]=r[p][2],a[3]=1,(c=a)[0]*(f=e)[0]+c[1]*f[1]+c[2]*f[2]+c[3]*f[3]>=0&&n++;var c,f;return n}class ci{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Yt.fromPoints(this.points),this.projections=[],this.frustumEdges=[Di([],this.points[2],this.points[3]),Di([],this.points[0],this.points[3]),Di([],this.points[4],this.points[0]),Di([],this.points[5],this.points[1]),Di([],this.points[6],this.points[2]),Di([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],f=[a[2],0,-a[0]];this.projections.push({axis:c,projection:Ft(this.points,this.points[0],c)}),this.projections.push({axis:f,projection:Ft(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,n,a,c){const f=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=oo([],T,e),C=1/I[3]/n*f;return(P=I)[0]=(D=I)[0]*(k=[C,C,c?1/I[3]:C,C])[0],P[1]=D[1]*k[1],P[2]=D[2]*k[2],P[3]=D[3]*k[3],P;var P,D,k}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=_n([],An([],Di([],p[T[0]],p[T[1]]),Di([],p[T[2]],p[T[1]]))),C=-En(I,p[T[1]]);return I.concat(C)}),x=[];for(let T=0;T<p.length;T++)x.push([p[T][0],p[T][1],p[T][2]]);return new ci(x,_)}intersectsPrecise(e,n,a){for(let c=0;c<n.length;c++)if(!Gn(e,n[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!Gn(e,this.planes[c]))return 0;for(const c of a)for(const f of this.frustumEdges){const p=An([],c,f),_=Tt(p);if(_===0)continue;Kt(p,p,1/_);const x=Ft(this.points,this.points[0],p),T=Ft(e,this.points[0],p);if(x[0]>T[1]||T[0]>x[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const a=n[3];if(En([n[0],n[1],n[2]],e)+a<0)return!1}return!0}}class Yt{static fromPoints(e){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)$t(n,n,c),Gt(a,a,c);return new Yt(n,a)}static fromTileIdAndHeight(e,n,a){const c=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new Yt([f/c,p/c,n],[(f+1)/c,(p+1)/c,a])}static applyTransform(e,n){const a=e.getCorners();for(let c=0;c<a.length;++c)li(a[c],a[c],n);return Yt.fromPoints(a)}static applyTransformFast(e,n){const a=[n[12],n[13],n[14]],c=[...a];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const _=n[4*p+f],x=_*e.min[p],T=_*e.max[p];a[f]+=Math.min(x,T),c[f]+=Math.max(x,T)}return new Yt(a,c)}static projectAabbCorners(e,n){const a=e.getCorners();for(let c=0;c<a.length;++c)li(a[c],a[c],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=Kt([],ze([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=st(this.min),c=st(this.max);for(let f=0;f<n.length;f++)a[f]=n[f]?this.min[f]:this.center[f],c[f]=n[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new Yt(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?sn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?sn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Tn(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Tn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}jt(Yt,"Aabb");class oi{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,a=n[1],c=-n[0],f=(e.extent+1)*this.metersToTile;return[new at(Math.trunc(e.position[0]+a*f),Math.trunc(e.position[1]+c*f)),new at(Math.trunc(e.position[0]-a*f),Math.trunc(e.position[1]-c*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class wn{constructor(e,n,a,c,f,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Er(),Er(),Er(),Er(),Er(),Er(),Er()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=n,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=f,this.edges=this.edges.filter(_=>{return _.a<this.vertices.length&&_.b<this.vertices.length&&!((x=this.vertices[_.a].position)[0]===(T=this.vertices[_.b].position)[0]&&x[1]===T[1]);var x,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const _ of this.vertices)this.vertexProps.push({dir:wo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,_.height),this.heightRange.max=Math.max(this.heightRange.max,_.height);for(const _ of this.edges){const x=this.vertices[_.a].position,T=this.vertices[_.b].position,I=ks(Er(),T,x),C=rs(I),P=zs(Er(),I,1/C);this.edgeProps.push({vec:I,dir:P,len:C});const D=this.vertexProps[_.a].dir,k=this.vertexProps[_.b].dir;Sa(D,D,P),Sa(k,k,P)}for(const _ of this.vertexProps)_.dir[0]===0&&_.dir[1]===0||yc(_.dir,_.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[a,c]=n;return fn(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,c)}computeSlopeNormal(e,n){const a=this.getClosestEdge(e);if(!a)return xt(0,0,1);const c=a[0],f=this.edges[c],p=this.edgeProps[c].vec,_=xt(p[0],p[1],(this.vertices[f.b].height-this.vertices[f.a].height)*n),x=xt(_[1],-_[0],0);An(x,x,_);const T=Tt(x);return T>0?Kt(x,x,1/T):kt(x,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,a=Number.POSITIVE_INFINITY,c=0;const[f,p,_,x,T,I,C]=this._tmpVec2;Ls(C,e.x,e.y);const P=new Xt(C,null);for(let D=0;D<this.edges.length;D++){const k=this.edges[D],j=this.edgeProps[D].dir;P.dir=j;const H=this.vertices[k.a].position,$=this.vertices[k.b].position,K=P.intersectsPlane(H,this.vertexProps[k.a].dir,f),ee=P.intersectsPlane($,this.vertexProps[k.b].dir,p);if(!K||!ee)continue;ks(_,p,f),ks(x,C,f);const se=ta(_,_),_e=se>0?ta(x,_)/se:0,fe=W(_e,0,1),xe=Math.abs((_e-fe)*this.edgeProps[D].len);ks(T,C,H),Ls(I,j[1],-j[0]);const Ie=xe+Math.abs(ta(T,I));Ie<a&&(n=D,a=Ie,c=fe)}return[n,c]}tessellate(e){const n=Ht(),a=Ht(),c=Ht(),f=Ht();for(let p=this.edges.length-1;p>=0;--p){const _=this.edges[p].a,x=this.edges[p].b,{position:T,height:I,extent:C}=this.vertices[_],{position:P,height:D,extent:k}=this.vertices[x],j=this.vertexProps[_].dir,H=this.vertexProps[x].dir;if(kt(n,T[0]/e,T[1]/e,I),kt(a,P[0]/e,P[1]/e,D),kt(c,j[1],-j[0],0),Kt(c,c,C),kt(f,H[1],-H[0],0),Kt(f,f,k),this.distSqLines(xt(n[0]+.5*c[0],n[1]+.5*c[1],n[2]+.5*c[2]),xt(a[0]-.5*f[0],a[1]-.5*f[1],a[2]-.5*f[2]),xt(n[0]-.5*c[0],n[1]-.5*c[1],n[2]-.5*c[2]),xt(a[0]+.5*f[0],a[1]+.5*f[1],a[2]+.5*f[2]))<=.0025000000000000005)continue;const $=this.vertices.length,K=Sa(Er(),T,P);this.vertices.push({position:zs(K,K,.5),height:.5*(I+D),extent:.5*(C+k)});const ee=Sa(Er(),j,H);this.vertexProps.push({dir:yc(ee,ee)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:_,b:$}),this.edges.push({a:$,b:x});const se=ks(Er(),this.vertices[$].position,T),_e=rs(se),fe={vec:se,dir:zs(Er(),se,1/_e),len:_e};this.edgeProps.push(fe),this.edgeProps.push(fe)}}distSqLines(e,n,a,c){const f=He(Ht(),n,e),p=He(Ht(),c,a),_=He(Ht(),e,a),x=En(f,f),T=En(f,p),I=En(f,_),C=En(p,p),P=En(p,_),D=x*C-T*T;if(D===0)return hi(Kn(f,a,c,En(_,p)/En(p,p)),e);const k=(x*P-T*I)/D;return hi(Kn(f,e,n,(T*P-I*C)/D),Kn(p,a,c,k))}}class pi{static parseFrom(e,n){const a=yt.parse(e);if(!a)return[];let{vertices:c,features:f}=a;const p=1/Z(n);f.sort((I,C)=>I.id-C.id),c.sort((I,C)=>I.id-C.id||I.idx-C.idx),c=c.filter((I,C,P)=>C===P.findIndex(D=>D.id===I.id&&D.idx===I.idx));const _=new Array;let x=0;const T=c.length;for(const I of f){if(I.constantHeight){_.push(new wn(I.id,I.bounds,I.constantHeight));continue}for(;x!==T&&c[x].id<I.id;)x++;if(x===T||c[x].id!==I.id)continue;const C=new Array,P=new Array,D=x;for(;x!==T&&c[x].id===I.id;){const k=c[x];if(C.push({position:k.position,height:k.height,extent:k.extent}),x!==D&&c[x-1].idx===k.idx-1){const j=x-D;P.push({a:j-1,b:j})}x++}_.push(new wn(I.id,I.bounds,void 0,C,P,p))}return _}static getElevationFeature(e,n){if(!n)return;const a=+e.properties[Ke];return Number.isNaN(a)?void 0:n.find(c=>c.id===a)}}class Si{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Et,this.yOffset=(e.y*this.zScale-n.y)*Et)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,a){const c=this.constantElevation(n,a);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),a))}computeBiasedHeight(e,n){return n<=0?e:e+n*Q(0,n,e>=0?e:Math.abs(.5*e))}}jt(wn,"ElevationFeature");class xi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Yl,this.indexArray=new kr,this.segments=new er,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new sl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,a,c){}populate(e,n,a,c){const f=this.layers[0],p=[];let _=null;f.type==="circle"&&(_=f.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:C,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,k=Le(T,D);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),k,a))continue;const j=_?_.evaluate(k,{},a):void 0,H={id:I,properties:T.properties,type:T.type,sourceLayerIndex:P,index:C,geometry:D?k.geometry:Se(T,a,c),patterns:{},sortKey:j};p.push(H)}_&&p.sort((T,I)=>T.sortKey-I.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new ap,x=c.projection);for(const T of p){const{geometry:I,index:C,sourceLayerIndex:P}=T,D=e[C].feature;this.addFeature(T,I,C,n.availableImages,a,x,n.brightness,n.elevationFeatures),n.featureIndex.insert(D,I,C,P,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,a,c,f,p,_){this.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,a0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,l0.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,$w.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,a,c,f,p,_,x){let T;this.elevationMode!=="none"&&(T=pi.getElevationFeature(e,x));for(const I of n)for(const C of I){const P=C.x,D=C.y;if(P<0||P>=Et||D<0||D>=Et)continue;if(p){const H=p.projectTilePoint(P,D,f),$=p.upVector(f,P,D);this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$),this.addGlobeExtVertex(H,$)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),j=k.vertexLength;if(this.addCircleVertex(P,D,-1,-1),this.addCircleVertex(P,D,1,-1),this.addCircleVertex(P,D,1,1),this.addCircleVertex(P,D,-1,1),this.elevationMode!=="none"){const H=T?T.pointElevation(new at(P,D)):0;this.hasElevation=this.hasElevation||H!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(H)}this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+2,j+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,f,_,void 0,this.worldview)}addCircleVertex(e,n,a,c){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*n+(c+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function ri(r,e){for(let n=0;n<r.length;n++)if(Pi(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Pi(r,e[n]))return!0;return!!Zi(r,e)}function Dn(r,e,n){return!!Pi(r,e)||!!Vi(e,r,n)}function di(r,e){if(r.length===1)return tr(e,r[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let c=0;c<a.length;c++)if(Pi(r,a[c]))return!0}for(let n=0;n<r.length;n++)if(tr(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Zi(r,e[n]))return!0;return!1}function ar(r,e,n){if(r.length>1){if(Zi(r,e))return!0;for(let a=0;a<e.length;a++)if(Vi(e[a],r,n))return!0}for(let a=0;a<r.length;a++)if(Vi(r[a],e,n))return!0;return!1}function Zi(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const a=r[n],c=r[n+1];for(let f=0;f<e.length-1;f++)if(mi(a,c,e[f],e[f+1]))return!0}return!1}function mi(r,e,n,a){return Rn(r,n,a)!==Rn(e,n,a)&&Rn(r,e,n)!==Rn(r,e,a)}function ei(r,e,n){return(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x)}function Ln(r,e,n,a){const c=ei(r,e,a),f=ei(r,e,n);if(Math.sign(c)===Math.sign(f))return;const p=ei(n,a,r),_=p+f-c;return Math.sign(p)!==Math.sign(_)?[p/(p-_),f/(f-c)]:void 0}function Vi(r,e,n){const a=n*n;if(e.length===1)return r.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(gr(r,e[c-1],e[c])<a)return!0;return!1}function gr(r,e,n){const a=e.distSqr(n);if(a===0)return r.distSqr(e);const c=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/a;return r.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function tr(r,e){let n,a,c,f=!1;for(let p=0;p<r.length;p++){n=r[p];for(let _=0,x=n.length-1;_<n.length;x=_++)a=n[_],c=n[x],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(f=!f)}return f}function Pi(r,e){let n=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const f=r[a],p=r[c];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(n=!n)}return n}function $o(r,e,n,a,c){for(const p of r)if(e<=p.x&&n<=p.y&&a>=p.x&&c>=p.y)return!0;const f=[new at(e,n),new at(e,c),new at(a,c),new at(a,n)];if(r.length>2){for(const p of f)if(Pi(r,p))return!0}for(let p=0;p<r.length-1;p++)if(go(r[p],r[p+1],f))return!0;return!1}function go(r,e,n){const a=n[0],c=n[2];if(r.x<a.x&&e.x<a.x||r.x>c.x&&e.x>c.x||r.y<a.y&&e.y<a.y||r.y>c.y&&e.y>c.y)return!1;const f=Rn(r,e,n[0]);return f!==Rn(r,e,n[1])||f!==Rn(r,e,n[2])||f!==Rn(r,e,n[3])}function Or(r,e,n,a,c,f){let p=e.y-r.y,_=r.x-e.x;if(f=f||0){const x=p*p+_*_;if(x===0)return!0;const T=Math.sqrt(x);p/=T,_/=T}return!((n.x-r.x)*p+(n.y-r.y)*_-f<0||(a.x-r.x)*p+(a.y-r.y)*_-f<0||(c.x-r.x)*p+(c.y-r.y)*_-f<0)}function Io(r,e,n,a,c,f,p){return!(Or(r,e,a,c,f,p)||Or(e,n,a,c,f,p)||Or(n,r,a,c,f,p)||Or(a,c,r,e,n,p)||Or(c,f,r,e,n,p)||Or(f,a,r,e,n,p))}function Co(r,e,n){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(r)}function so(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function xs(r,e,n,a,c){if(!e[0]&&!e[1])return r;const f=at.convert(e)._mult(c);n==="viewport"&&f._rotate(-a);const p=[];for(let _=0;_<r.length;_++)p.push(r[_].sub(f));return p}function Hs(r,e,n,a){const c=at.convert(r)._mult(a);return e==="viewport"&&c._rotate(-n),c}let Jo,hr;function wr(r,e,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}jt(xi,"CircleBucket",{omit:["layers"]});class Mi{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=nr(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const a=function(f,p,_){var x=wr(256*f,256*(p=Math.pow(2,_)-p-1),_),T=wr(256*(f+1),256*(p+1),_);return x[0]+","+x[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),c=function(f,p,_){let x,T="";for(let I=f;I>0;I--)x=1<<I-1,T+=(p&x?1:0)+(_&x?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ir{constructor(e,n){this.wrap=e,this.canonical=n,this.key=nr(e,n.z,n.z,n.x,n.y)}}class lr{constructor(e,n,a,c,f){this.overscaledZ=e,this.wrap=n,this.canonical=new Mi(a,+c,+f),this.key=n===0&&e===a?this.canonical.key:nr(n,e,a,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new lr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return nr(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return nr(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new lr(n,this.wrap,n,a,c),new lr(n,this.wrap,n,a+1,c),new lr(n,this.wrap,n,a,c+1),new lr(n,this.wrap,n,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ir(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function nr(r,e,n,a,c){const f=1<<Math.min(n,22);let p=f*(c%f)+a%f;return r&&n<22&&(p+=f*f*((r<0?-2*r-1:2*r)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const Ws=[r=>{let e=r.canonical.x-1,n=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,n--),new lr(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,n=r.wrap;return e===1<<r.canonical.z&&(e=0,n++),new lr(r.overscaledZ,n,r.canonical.z,e,r.canonical.y)},r=>new lr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new lr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];jt(Mi,"CanonicalTileID"),jt(lr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const dh=jn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:da}=dh,hh=jn([{name:"a_pos_3",components:3,type:"Int16"}]);var zu=jn([{name:"a_pos",type:"Int16",components:2}]);function Na(r){return r*Eo/u}const dl=[new Yt([$s,$s,$s],[Gs,Gs,Gs]),new Yt([$s,$s,$s],[0,0,Gs]),new Yt([0,$s,$s],[Gs,0,Gs]),new Yt([$s,0,$s],[0,Gs,Gs]),new Yt([0,0,$s],[Gs,Gs,Gs])];function Ou(r,e,n,a=!0){const c=Kt([],r._camera.position,r.worldSize),f=[e,n,1,1];oo(f,f,r.pixelMatrixInverse),ps(f,f,1/f[3]);const p=_n([],Di([],f,c)),_=r.globeMatrix,x=[_[12],_[13],_[14]],T=Di([],x,c),I=Tt(T),C=_n([],T),P=r.worldSize/(2*Math.PI),D=En(C,p),k=Math.asin(P/I);if(k<Math.acos(D)){if(!a)return null;const Xe=[],ke=[];Kt(Xe,p,I/D),_n(ke,Di(ke,Xe,T)),_n(p,ze(p,T,Kt(p,ke,Math.tan(k)*I)))}const j=[];new Ut(c,p).closestPointOnSphere(x,P,j);const H=_n([],pr(_,0)),$=_n([],pr(_,1)),K=_n([],pr(_,2)),ee=En(H,j),se=En($,j),_e=En(K,j),fe=Ro(Math.asin(-se/P));let xe=Ro(Math.atan2(ee,_e));xe=r.center.lng+function(Xe,ke){const Je=(ke-Xe+180)%360-180;return Je<-180?Je+360:Je}(r.center.lng,xe);const Ie=b(xe),Pe=W(E(fe),0,1);return new ne(Ie,Pe)}class ec{constructor(e,n,a){this.a=Di([],e,a),this.b=Di([],n,a),this.center=a;const c=_n([],this.a),f=_n([],this.b);this.angle=Math.acos(En(c,f))}}function hl(r,e){if(r.angle===0)return null;let n;return n=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),n<0||n>1?null:function(a,c,f,p){const _=Math.sin(f);return a*(Math.sin((1-p)*f)/_)+c*(Math.sin(p*f)/_)}(r.a[e],r.b[e],r.angle,W(n,0,1))+r.center[e]}function ha(r){if(r.z<=1)return dl[r.z+2*r.y+r.x];const e=eb(c0(r));return Yt.fromPoints(e)}function fl(r,e,n){return Kt(r,r,1-n),mn(r,r,e,n)}function mI(r,e,n){for(const a of r)li(a,a,e),Kt(a,a,n)}function gI(r,e,n,a){const c=e/r.worldSize,f=r.globeMatrix;if(n.z<=1){const Pe=ha(n).getCorners();return mI(Pe,f,c),Yt.fromPoints(Pe)}const p=c0(n,a),_=eb(p,Eo+Na(r._tileCoverLift));mI(_,f,c);const x=Number.MAX_VALUE,T=[-x,-x,-x],I=[x,x,x];if(p.contains(r.center)){for(const ke of _)$t(I,I,ke),Gt(T,T,ke);T[2]=0;const Pe=r.point,Xe=[Pe.x*c,Pe.y*c,0];return $t(I,I,Xe),Gt(T,T,Xe),new Yt(I,T)}if(r._tileCoverLift>0){for(const Pe of _)$t(I,I,Pe),Gt(T,T,Pe);return new Yt(I,T)}const C=[f[12]*c,f[13]*c,f[14]*c],P=p.getCenter(),D=W(r.center.lat,-F,F),k=W(P.lat,-F,F),j=b(r.center.lng),H=E(D);let $=j-b(P.lng);const K=H-E(k);$>.5?$-=1:$<-.5&&($+=1);let ee=0;Math.abs($)>Math.abs(K)?ee=$>=0?1:3:(ee=K>=0?0:2,mn(C,C,[f[4]*c,f[5]*c,f[6]*c],-Math.sin(Bn(K>=0?p.getSouth():p.getNorth()))*Eo));const se=_[ee],_e=_[(ee+1)%4],fe=new ec(se,_e,C),xe=[hl(fe,0)||se[0],hl(fe,1)||se[1],hl(fe,2)||se[2]],Ie=Fu(r.zoom);if(Ie>0){const Pe=function({x:ke,y:Je,z:rt},ot,ht,pt,ct){const ut=1/(1<<rt);let Qe=ke*ut,Ye=Qe+ut,dt=Je*ut,It=dt+ut,vt=0;const Jt=(Qe+Ye)/2-pt;return Jt>.5?vt=-1:Jt<-.5&&(vt=1),Qe=((Qe+vt)*ot-(pt*=ot))*ht+pt,Ye=((Ye+vt)*ot-pt)*ht+pt,dt=(dt*ot-(ct*=ot))*ht+ct,It=(It*ot-ct)*ht+ct,[[Qe,It,0],[Ye,It,0],[Ye,dt,0],[Qe,dt,0]]}(n,e,r._pixelsPerMercatorPixel,j,H);for(let ke=0;ke<_.length;ke++)fl(_[ke],Pe[ke],Ie);const Xe=ze([],Pe[ee],Pe[(ee+1)%4]);Kt(Xe,Xe,.5),fl(xe,Xe,Ie)}for(const Pe of _)$t(I,I,Pe),Gt(T,T,Pe);return I[2]=Math.min(se[2],_e[2]),$t(I,I,xe),Gt(T,T,xe),new Yt(I,T)}function c0({x:r,y:e,z:n},a=!1){const c=1/(1<<n),f=new s(M(r*c),e===(1<<n)-1&&a?-90:O((e+1)*c)),p=new s(M((r+1)*c),e===0&&a?90:O(e*c));return new d(f,p)}function eb(r,e=Eo){const n=Bn(r.getNorth()),a=Bn(r.getSouth()),c=Math.cos(n),f=Math.cos(a),p=Math.sin(n),_=Math.sin(a),x=r.getWest(),T=r.getEast();return[jc(f,_,x,e),jc(f,_,T,e),jc(c,p,T,e),jc(c,p,x,e)]}function i_(r,e,n,a){const c=1<<n.z,f=(r/Et+n.x)/c;return ku(O((e/Et+n.y)/c),M(f),a)}function u0({min:r,max:e}){return Jw/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const _I=new Float64Array(16);function d0(r){const e=u0(r),n=Ve(_I,[e,e,e]);return ue(n,n,Zn([],r.min))}function tb(r){const e=(a=r.min,(n=_I)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=a[0],n[13]=a[1],n[14]=a[2],n[15]=1,n);var n,a;const c=1/u0(r);return Me(e,e,[c,c,c])}function nb(r){const e=Et/(2*Math.PI);return r/(2*Math.PI)/e}function yI(r,e){return Et/(512*Math.pow(2,r))*u0(ha(e))}function vI(r,e,n,a,c){const f=nb(n),p=[r,e,-n/(2*Math.PI)],_=le(new Float64Array(16));return ue(_,_,p),Me(_,_,[f,f,f]),Ne(_,_,Bn(-c)),je(_,_,Bn(-a)),_}function Fu(r){return Q(Vs,Sp,r)}function xI(r,e){const n=ku(e.lat,e.lng),a=function(k){const j=ku(k._center.lat,k._center.lng);let H=An([],xt(0,1,0),j);const $=nt([],-k.angle,j);H=li(H,H,$),nt($,-k._pitch,H);const K=_n([],j);return Kt(K,K,Na(k.cameraToCenterDistance/k.pixelsPerMeter)),li(K,K,$),ze([],j,K)}(r);return p=(c=He([],a,n))[0],_=c[1],x=c[2],T=(f=n)[0],I=f[1],C=f[2],D=(P=Math.sqrt((p*p+_*_+x*x)*(T*T+I*I+C*C)))&&En(c,f)/P,Math.acos(Math.min(Math.max(D,-1),1));var c,f,p,_,x,T,I,C,P,D}function ib(r,e){return xI(r,e)>Math.PI/2*1.01}const wI=Bn(85),LN=Math.cos(wI),kN=Math.sin(wI),zN=be(),bI=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function TI(r,e,n,a,c,f,p,_,x){if(f&&r.queryGeometry.isAboveHorizon)return!1;f&&(x*=r.pixelToTileUnitsFactor);const T=r.tileID.canonical,I=n.projection.upVectorScale(T,n.center.lat,n.worldSize).metersToTile;for(const C of e)for(const P of C){const D=P.add(_),k=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(D.x,D.y,!0):0,j=n.projection.projectTilePoint(D.x,D.y,T);if(k>0){const ee=n.projection.upVector(T,D.x,D.y);j.x+=ee[0]*I*k,j.y+=ee[1]*I*k,j.z+=ee[2]*I*k}const H=f?D:ON(j.x,j.y,j.z,a),$=f?r.tilespaceRays.map(ee=>NN(ee,k)):r.queryGeometry.screenGeometry,K=oo([],[j.x,j.y,j.z,1],a);if(!p&&f?x*=K[3]/n.cameraToCenterDistance:p&&!f&&(x*=n.cameraToCenterDistance/K[3]),f){const ee=O((P.y/Et+T.y)/(1<<T.z));x/=n.projection.pixelsPerMeter(ee,1)/A(1,ee)}if(Dn($,H,x))return!0}return!1}function ON(r,e,n,a){const c=oo([],[r,e,n,1],a);return new at(c[0]/c[3],c[1]/c[3])}const SI=xt(0,0,0),FN=xt(0,0,1);function NN(r,e){const n=Ht();return SI[2]=e,r.intersectsPlane(SI,FN,n),new at(n[0],n[1])}class EI extends xi{}let II,CI,AI,PI;function MI(r,{width:e,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*a);return r.width=e,r.height=n,r.data=c,r}function RI(r,e,n){const{width:a,height:c}=e;a===r.width&&c===r.height||(rb(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,c)},n,null),r.width=a,r.height=c,r.data=e.data)}function rb(r,e,n,a,c,f,p,_){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const x=r.data,T=e.data,I=f===4&&_;for(let C=0;C<c.height;C++){const P=((n.y+C)*r.width+n.x)*f,D=((a.y+C)*e.width+a.x)*f;if(I)for(let k=0;k<c.width;k++){const j=P+k*f+3,H=D+k*f;T[H+0]=255,T[H+1]=255,T[H+2]=255,T[H+3]=x[j]}else if(p)for(let k=0;k<c.width;k++){const j=P+k*f,H=D+k*f,$=new vi(x[j+0]/255,x[j+1]/255,x[j+2]/255,x[j+3]).toNonPremultipliedRenderColor(p).toArray();T[H+0]=$[0],T[H+1]=$[1],T[H+2]=$[2],T[H+3]=$[3]}else for(let k=0;k<c.width*f;k++)T[D+k]=x[P+k]}return e}jt(EI,"HeatmapBucket",{omit:["layers"]});class Nu{constructor(e,n){MI(this,e,1,n)}resize(e){RI(this,new Nu(e),1)}clone(){return new Nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,f){rb(e,n,a,c,f,1,null)}}class Ao{constructor(e,n){MI(this,e,4,n)}resize(e){RI(this,new Ao(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,c,f,p,_){rb(e,n,a,c,f,4,p,_)}}class DI{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function r_(r){const e={},n=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Ao({width:n,height:a}),f=(p,_,x)=>{e[r.evaluationKey]=x;const T=r.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(c.data[p+_+0]=Math.floor(255*I.r),c.data[p+_+1]=Math.floor(255*I.g),c.data[p+_+2]=Math.floor(255*I.b),c.data[p+_+3]=Math.floor(255*I.a))};if(r.clips)for(let p=0,_=0;p<a;++p,_+=4*n)for(let x=0,T=0;x<n;x++,T+=4){const I=x/(n-1),{start:C,end:P}=r.clips[p];f(_,T,C*(1-I)+P*I)}else for(let p=0,_=0;p<n;p++,_+=4)f(0,_,p/(n-1));return c}jt(Nu,"AlphaImage"),jt(Ao,"RGBAImage");const BN=jn([{name:"a_pos",components:2,type:"Int16"}],4),jN=jn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),UN=jn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),VN=jn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ep(r,e,n=2){const a=e&&e.length,c=a?e[0]*n:r.length;let f=LI(r,0,c,n,!0);const p=[];if(!f||f.next===f.prev)return p;let _,x,T;if(a&&(f=function(I,C,P,D){const k=[];for(let j=0,H=C.length;j<H;j++){const $=LI(I,C[j]*D,j<H-1?C[j+1]*D:I.length,D,!1);$===$.next&&($.steiner=!0),k.push(YN($))}k.sort(qN);for(let j=0;j<k.length;j++)P=ZN(k[j],P);return P}(r,e,f,n)),r.length>80*n){_=r[0],x=r[1];let I=_,C=x;for(let P=n;P<c;P+=n){const D=r[P],k=r[P+1];D<_&&(_=D),k<x&&(x=k),D>I&&(I=D),k>C&&(C=k)}T=Math.max(I-_,C-x),T=T!==0?32767/T:0}return o_(f,p,n,_,x,T,0),p}function LI(r,e,n,a,c){let f;if(c===function(p,_,x,T){let I=0;for(let C=_,P=x-T;C<x;C+=T)I+=(p[P]-p[C])*(p[C+1]+p[P+1]),P=C;return I}(r,e,n,a)>0)for(let p=e;p<n;p+=a)f=FI(p/a|0,r[p],r[p+1],f);else for(let p=n-a;p>=e;p-=a)f=FI(p/a|0,r[p],r[p+1],f);return f&&Ip(f,f.next)&&(l_(f),f=f.next),f}function fh(r,e){if(!r)return r;e||(e=r);let n,a=r;do if(n=!1,a.steiner||!Ip(a,a.next)&&to(a.prev,a,a.next)!==0)a=a.next;else{if(l_(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function o_(r,e,n,a,c,f,p){if(!r)return;!p&&f&&function(x,T,I,C){let P=x;do P.z===0&&(P.z=ob(P.x,P.y,T,I,C)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==x);P.prevZ.nextZ=null,P.prevZ=null,function(D){let k,j=1;do{let H,$=D;D=null;let K=null;for(k=0;$;){k++;let ee=$,se=0;for(let fe=0;fe<j&&(se++,ee=ee.nextZ,ee);fe++);let _e=j;for(;se>0||_e>0&&ee;)se!==0&&(_e===0||!ee||$.z<=ee.z)?(H=$,$=$.nextZ,se--):(H=ee,ee=ee.nextZ,_e--),K?K.nextZ=H:D=H,H.prevZ=K,K=H;$=ee}K.nextZ=null,j*=2}while(k>1)}(P)}(r,a,c,f);let _=r;for(;r.prev!==r.next;){const x=r.prev,T=r.next;if(f?GN(r,a,c,f):$N(r))e.push(x.i,r.i,T.i),l_(r),r=T.next,_=T.next;else if((r=T)===_){p?p===1?o_(r=HN(fh(r),e),e,n,a,c,f,2):p===2&&WN(r,e,n,a,c,f):o_(fh(r),e,n,a,c,f,1);break}}}function $N(r){const e=r.prev,n=r,a=r.next;if(to(e,n,a)>=0)return!1;const c=e.x,f=n.x,p=a.x,_=e.y,x=n.y,T=a.y,I=Math.min(c,f,p),C=Math.min(_,x,T),P=Math.max(c,f,p),D=Math.max(_,x,T);let k=a.next;for(;k!==e;){if(k.x>=I&&k.x<=P&&k.y>=C&&k.y<=D&&s_(c,_,f,x,p,T,k.x,k.y)&&to(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function GN(r,e,n,a){const c=r.prev,f=r,p=r.next;if(to(c,f,p)>=0)return!1;const _=c.x,x=f.x,T=p.x,I=c.y,C=f.y,P=p.y,D=Math.min(_,x,T),k=Math.min(I,C,P),j=Math.max(_,x,T),H=Math.max(I,C,P),$=ob(D,k,e,n,a),K=ob(j,H,e,n,a);let ee=r.prevZ,se=r.nextZ;for(;ee&&ee.z>=$&&se&&se.z<=K;){if(ee.x>=D&&ee.x<=j&&ee.y>=k&&ee.y<=H&&ee!==c&&ee!==p&&s_(_,I,x,C,T,P,ee.x,ee.y)&&to(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,se.x>=D&&se.x<=j&&se.y>=k&&se.y<=H&&se!==c&&se!==p&&s_(_,I,x,C,T,P,se.x,se.y)&&to(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ee&&ee.z>=$;){if(ee.x>=D&&ee.x<=j&&ee.y>=k&&ee.y<=H&&ee!==c&&ee!==p&&s_(_,I,x,C,T,P,ee.x,ee.y)&&to(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;se&&se.z<=K;){if(se.x>=D&&se.x<=j&&se.y>=k&&se.y<=H&&se!==c&&se!==p&&s_(_,I,x,C,T,P,se.x,se.y)&&to(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function HN(r,e){let n=r;do{const a=n.prev,c=n.next.next;!Ip(a,c)&&zI(a,n,n.next,c)&&a_(a,c)&&a_(c,a)&&(e.push(a.i,n.i,c.i),l_(n),l_(n.next),n=r=c),n=n.next}while(n!==r);return fh(n)}function WN(r,e,n,a,c,f){let p=r;do{let _=p.next.next;for(;_!==p.prev;){if(p.i!==_.i&&KN(p,_)){let x=OI(p,_);return p=fh(p,p.next),x=fh(x,x.next),o_(p,e,n,a,c,f,0),void o_(x,e,n,a,c,f,0)}_=_.next}p=p.next}while(p!==r)}function qN(r,e){let n=r.x-e.x;return n===0&&(n=r.y-e.y,n===0)&&(n=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function ZN(r,e){const n=function(c,f){let p=f;const _=c.x,x=c.y;let T,I=-1/0;if(Ip(c,p))return p;do{if(Ip(c,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const j=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(j<=_&&j>I&&(I=j,T=p.x<p.next.x?p:p.next,j===_))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,P=T.x,D=T.y;let k=1/0;p=T;do{if(_>=p.x&&p.x>=P&&_!==p.x&&kI(x<D?_:I,x,P,D,x<D?I:_,x,p.x,p.y)){const j=Math.abs(x-p.y)/(_-p.x);a_(p,c)&&(j<k||j===k&&(p.x>T.x||p.x===T.x&&XN(T,p)))&&(T=p,k=j)}p=p.next}while(p!==C);return T}(r,e);if(!n)return e;const a=OI(n,r);return fh(a,a.next),fh(n,n.next)}function XN(r,e){return to(r.prev,r,e.prev)<0&&to(e.next,r,r.next)<0}function ob(r,e,n,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function YN(r){let e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function kI(r,e,n,a,c,f,p,_){return(c-p)*(e-_)>=(r-p)*(f-_)&&(r-p)*(a-_)>=(n-p)*(e-_)&&(n-p)*(f-_)>=(c-p)*(a-_)}function s_(r,e,n,a,c,f,p,_){return!(r===p&&e===_)&&kI(r,e,n,a,c,f,p,_)}function KN(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&zI(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(r,e)&&(a_(r,e)&&a_(e,r)&&function(n,a){let c=n,f=!1;const p=(n.x+a.x)/2,_=(n.y+a.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&p<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==n);return f}(r,e)&&(to(r.prev,r,e.prev)||to(r,e.prev,e))||Ip(r,e)&&to(r.prev,r,r.next)>0&&to(e.prev,e,e.next)>0)}function to(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Ip(r,e){return r.x===e.x&&r.y===e.y}function zI(r,e,n,a){const c=f0(to(r,e,n)),f=f0(to(r,e,a)),p=f0(to(n,a,r)),_=f0(to(n,a,e));return c!==f&&p!==_||!(c!==0||!h0(r,n,e))||!(f!==0||!h0(r,a,e))||!(p!==0||!h0(n,r,a))||!(_!==0||!h0(n,e,a))}function h0(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function f0(r){return r>0?1:r<0?-1:0}function a_(r,e){return to(r.prev,r,r.next)<0?to(r,e,r.next)>=0&&to(r,r.prev,e)>=0:to(r,e,r.prev)<0||to(r,r.next,e)<0}function OI(r,e){const n=sb(r.i,r.x,r.y),a=sb(e.i,e.x,e.y),c=r.next,f=e.prev;return r.next=e,e.prev=r,n.next=c,c.prev=n,a.next=n,n.prev=a,f.next=a,a.prev=f,a}function FI(r,e,n,a){const c=sb(r,e,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function l_(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function sb(r,e,n){return{i:r,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function c_(r,e){const n=r.length;if(n<=1)return[r];const a=[];let c,f;for(let p=0;p<n;p++){const _=Pn(r[p]);_!==0&&(r[p].area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(c&&a.push(c),c=[r[p]]):c.push(r[p]))}if(c&&a.push(c),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(Tf(a[p],e,1,a[p].length-1,QN),a[p]=a[p].slice(0,e));return a}function QN(r,e){return e.area-r.area}function NI(r,e,n=1){if(!r)return null;const a=typeof r=="string"?Bo.from(r).getPrimary():r.getPrimary(),c=typeof r=="string"?null:r.getSecondary();for(const f of[a,c]){if(!f)continue;const p=f.id.toString();e.has(p)||e.set(p,[]),f.scaleSelf(n),e.get(p).push(f)}return{primary:a.toString(),secondary:c?c.toString():null}}function ab(r,e,n,a){const c=a.patternDependencies;let f=!1;for(const p of e){const _=p.paint.get(`${r}-pattern`);_.isConstant()||(f=!0),NI(_.constantOr(null),c,n)&&(f=!0)}return f}function lb(r,e,n,a,c,f){const p=f.patternDependencies;for(const _ of e){const x=_.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:a},n,{},f.availableImages);T=T&&T.name?T.name:T;const I=NI(T,p,c);if(!I)continue;const{primary:C,secondary:P}=I;C&&(n.patterns[_.id]=[C,P].filter(Boolean))}}return n}class BI{constructor(){this.polygons=new Map}add(e,...n){const a=this.polygons.get(e);a?a.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,a]of e.polygons)this.add(n,...a)}}class Uc{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=Et&&n>=Et}static evaluate(e){if(e.length===0)return new Uc;let n=[];for(const x of e)n.push(...x.portals);if(n.length===0)return new Uc;for(const x of n){const T=x.va,I=x.vb;(Uc.isOnBorder(T.x,I.x)||Uc.isOnBorder(T.y,I.y))&&(x.type="border")}const a=n.filter(x=>x.type!=="unevaluated"),c=n.filter(x=>x.type==="unevaluated");if(c.length===0)return new Uc;c.sort((x,T)=>x.hash===T.hash?x.isTunnel===T.isTunnel?0:x.isTunnel?-1:1:x.hash<T.hash?1:-1),n=a.concat(c);let f=a.length,p=f,_=f;do if(p++,p===n.length||n[f].hash!==n[p].hash){if(p-f==2){_<f&&(n[_]=n[f],n[f]=null);const x=n[_],T=n[p-1];x.type=x.isTunnel!==T.isTunnel?"tunnel":"polygon",x.connection={a:x.connection.a,b:T.connection.a},_++}f=p}while(f!==n.length);return n.splice(_),n.sort((x,T)=>x.hash<T.hash?1:-1),{portals:n}}}jt(Uc,"ElevationPortalGraph"),jt(BI,"ElevationPolygons");class JN{constructor(e,n,a){this.outPositions=e,this.outNormals=n,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,n,a){let c=e[2];a!=null&&(c*=a);const f=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,p=this.vertexLookup.get(f);if(p!=null)return p;const _=this.outPositions.length;this.vertexLookup.set(f,_);const x=Math.trunc(16384*n[0]),T=Math.trunc(16384*n[1]),I=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(x,T,I),_}addTriangle(e,n,a){this.outIndices.emplaceBack(e,n,a)}addTriangles(e,n,a){if(e.length===0)return;const c=a.length===1,f=Ht(),p=Ht();for(let _=0;_<e.length;_+=3){const x=n[e[_+0]],T=n[e[_+1]],I=n[e[_+2]],C=c?a[0]:a[e[_+1]],P=c?a[0]:a[e[_+2]];kt(f,x.x,x.y,c?a[0]:a[e[_+0]]);const D=this.addVertex(f,p);kt(f,T.x,T.y,C);const k=this.addVertex(f,p);kt(f,I.x,I.y,P);const j=this.addVertex(f,p);this.outIndices.emplaceBack(D,k,j)}}addQuad(e,n,a,c,f,p){const _=this.addVertex(e,f,p),x=this.addVertex(n,f,p),T=this.addVertex(a,f,p),I=this.addVertex(c,f,p);this.addTriangle(_,x,T),this.addTriangle(T,I,_)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ws{constructor(e,n,a,c){this.unevaluatedPortals=new Uc,this.portalPolygons=new BI,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Fg,this.vertexNormals=new Ng,this.indexArray=new kr,this.tileToMeters=Z(e),this.bridgeProgramConfigurations=new ua(n,{zoom:a,lut:c},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new ua(n,{zoom:a,lut:c},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,n){const a=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(n[c]);return a}addTriangles(e,n,a){const c=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)c.push(f+n)}addRenderableRing(e,n,a,c,f,p){const _=[new at(f.min.x,f.min.y),new at(f.max.x,f.min.y),new at(f.max.x,f.max.y),new at(f.min.x,f.max.y)];for(let x=0;x<a-1;x++){const T=n+x,I=T+1,C=this.unevalVertices[T],P=this.unevalVertices[I];if(!(C.x>=f.min.x&&C.x<=f.max.x&&C.y>=f.min.y&&C.y<=f.max.y||P.x>=f.min.x&&P.x<=f.max.x&&P.y>=f.min.y&&P.y<=f.max.y||go(C,P,_))||this.isOnBorder(C.x,P.x)||this.isOnBorder(C.y,P.y))continue;const D=ws.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let k,j=this.vertexHashLookup.get(ws.computePosHash(C));j!=null?k=j.next:(j=this.vertexHashLookup.get(ws.computePosHash(P)),k=j!=null?j.prev:D),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:D,portalHash:k,isTunnel:c,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,n,a,c,f){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:f});const p=n[0];this.vertexHashLookup.clear();let _=ws.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let x=0;x<p.length-1;x++){const T=p[x+0],I=p[x+1],C=wo(I.x-T.x,I.y-T.y),P=rs(C);if(P===0)continue;let D="unevaluated";const k=c.pointElevation(T),j=c.pointElevation(I);Math.abs(k)<.01&&Math.abs(j)<.01?D="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(D="border");const H=ws.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:C,length:P,hash:H,isTunnel:a,type:D});const $=ws.computePosHash(T);this.vertexHashLookup.set($,{prev:_,next:H}),_=H}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},c=new JN(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=n(),p=n(),_=n(),x=(P,D)=>{P.sort((j,H)=>j.type===D&&H.type!==D?-1:j.type!==D&&H.type===D?1:0);const k=P.findIndex(j=>j.type!==D);return k>=0?k:P.length};let T=0;this.unevalEdges.length>0&&(T=x(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),a(_);const I=n(),C=n();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(T),D=x(P,"tunnel")+T;this.unevalEdges.push(...P),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:D})}a(I),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(C),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(p),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(f),this.maskSegments=er.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=er.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=er.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableTunnelSegments=er.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=er.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,n,a,c,f,p,_,x){this.bridgeProgramConfigurations.updatePaintArrays(e,n,f,a,c,p,_,x),this.tunnelProgramConfigurations.updatePaintArrays(e,n,f,a,c,p,_,x)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,UN.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,VN.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,a,c,f){const p=(_,x)=>{for(let T=0;T<x.length-1;T++){const I=x[T].featureIndex,C=x[T+1].vertexStart,P=e.feature(I);_.populatePaintArrays(C,P,I,{},a,n,c,void 0,f)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,a,c,f){const p=new Map;for(let _=c;_<f;_++){const x=a[_],T=x.a,I=x.b,C=ws.computePosHash(e[T]),P=ws.computePosHash(e[I]);let D=p.get(C);D||(D={},p.set(C,D));let k=p.get(P);k||(k={},p.set(P,k)),n[T]<=0&&n[I]<=0||(D.to=I,k.from=T)}return p}isTerminalVertex(e,n){const a=ws.computePosHash(this.unevalVertices[e]),c=n.get(a);return!c||!c.from||!c.to}constructBridgeStructures(e,n,a,c,f,p){e.clearVertexLookup();const _=this.computeVertexConnections(n,a,c,f.min,f.max),x=1/p,T=.5*x,I=(ht,pt)=>kt(ht,n[pt].x,n[pt].y,a[pt]*x),C=Ht(),P=Ht(),D=Ht(),k=Ht(),j=Ht(),H=(ht,pt)=>{const ct=_.get(ws.computePosHash(n[pt])),ut=ct.from,Qe=ct.to;if(!ut||!Qe)return;I(C,ut),I(P,pt),I(D,Qe),xr(k),Sr(C,P)||(Di(j,P,C),_n(k,j)),Sr(D,P)||(Di(j,D,P),ze(k,k,_n(j,j)));const Ye=Rs(k);return Ye>0?Kt(ht,k,1/Ye):void 0};let $=Number.POSITIVE_INFINITY;this.sortSubarray(c,f.min,f.max,(ht,pt)=>ht.featureInfo.featureIndex-pt.featureInfo.featureIndex);const K=Ht(),ee=Ht(),se=Ht(),_e=Ht(),fe=Ht(),xe=Ht(),Ie=Ht(),Pe=Ht(),Xe=Ht(),ke=[Ht(),Ht(),Ht(),Ht()],Je=[Ht(),Ht(),Ht(),Ht()],rt=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],ot=(ht,pt)=>ht>pt;for(let ht=f.min;ht<f.max;ht++){const pt=c[ht];if(!pt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(rt,n,a,pt,ot))continue;const[ct,ut]=rt;if(kt(K,ct.coord.x,ct.coord.y,x*ct.height),kt(ee,ut.coord.x,ut.coord.y,x*ut.height),Sr(K,ee))continue;Di(se,ee,K),_n(se,se);const Qe=H(Pe,pt.a)||se,Ye=H(Xe,pt.b)||se;kt(_e,Qe[1],-Qe[0],0),_n(_e,_e),kt(fe,Ye[1],-Ye[0],0),_n(fe,fe),An(Pe,_e,Qe),_n(xe,Pe),An(Pe,fe,Ye),_n(Ie,Pe),ze(ke[0],K,Kt(Pe,Di(Pe,_e,xe),T)),ze(ke[1],K,Kt(Pe,ze(Pe,_e,xe),T)),ze(ke[2],K,Kt(Pe,xe,T)),ke[3]=K,ze(Je[0],ee,Kt(Pe,Di(Pe,fe,Ie),T)),ze(Je[1],ee,Kt(Pe,ze(Pe,fe,Ie),T)),ze(Je[2],ee,Kt(Pe,Ie,T)),Je[3]=ee,$=this.addFeatureSection(pt.featureInfo.featureIndex,$,this.bridgeFeatureSections,e);const dt=e.addVertex(ke[0],_e,p),It=e.addVertex(ke[1],_e,p),vt=e.addVertex(Je[0],fe,p),Jt=e.addVertex(Je[1],fe,p);e.addTriangle(dt,It,vt),e.addTriangle(It,Jt,vt);const Lt=e.addVertex(ke[1],xe,p),Nt=e.addVertex(ke[2],xe,p),Wt=e.addVertex(Je[1],Ie,p),Fn=e.addVertex(Je[2],Ie,p);e.addTriangle(Lt,Nt,Wt),e.addTriangle(Nt,Fn,Wt),Zn(_e,_e),Zn(fe,fe);const wt=e.addVertex(ke[2],_e,p),Zt=e.addVertex(ke[3],_e,p),xn=e.addVertex(Je[2],fe,p),Hn=e.addVertex(Je[3],fe,p);e.addTriangle(wt,Zt,xn),e.addTriangle(Zt,Hn,xn);const qn=this.isTerminalVertex(pt.a,_),Cn=this.isTerminalVertex(pt.b,_);ct.height<.01&&qn&&e.addQuad(ke[3],ke[2],ke[1],ke[0],Zn(Qe,Qe),p),ut.height<.01&&Cn&&e.addQuad(Je[0],Je[1],Je[2],Je[3],Ye,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,a,c,f,p){e.clearVertexLookup();let _=Number.POSITIVE_INFINITY;const x=($,K)=>$.featureInfo.featureIndex-K.featureInfo.featureIndex;this.sortSubarray(c,f.min,f.max,x),this.sortSubarray(c,p.min,p.max,x);const T=$=>_n($,$),I=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],C=($,K)=>$<K,P=Ht(),D=Ht(),k=Ht(),j=Ht(),H=Ht();for(let $=f.min;$<f.max;$++){if(!this.prepareEdgePoints(I,n,a,c[$],C))continue;const[K,ee]=I,se=T(kt(H,-(ee.coord.y-K.coord.y),ee.coord.x-K.coord.x,0));_=this.addFeatureSection(c[$].featureInfo.featureIndex,_,this.tunnelFeatureSections,e),e.addQuad(kt(P,K.coord.x,K.coord.y,K.height),kt(D,ee.coord.x,ee.coord.y,ee.height),kt(k,ee.coord.x,ee.coord.y,c[$].isTunnel?-.1:0),kt(j,K.coord.x,K.coord.y,c[$].isTunnel?-.1:0),se)}for(let $=p.min;$<p.max;$++){const K=c[$];K.isTunnel&&([K.a,K.b]=[K.b,K.a]);const ee=n[K.a],se=n[K.b],_e=T(kt(H,-(se.y-ee.y),se.x-ee.x,0));_=this.addFeatureSection(K.featureInfo.featureIndex,_,this.tunnelFeatureSections,e),e.addQuad(kt(P,se.x,se.y,0),kt(D,ee.x,ee.y,0),kt(k,ee.x,ee.y,a[K.a]+4),kt(j,se.x,se.y,a[K.b]+4),_e),e.addQuad(kt(P,ee.x,ee.y,0),kt(D,se.x,se.y,0),kt(k,se.x,se.y,a[K.b]+4),kt(j,ee.x,ee.y,a[K.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,a,c){e.coord.x=n,e.coord.y=a,e.height=c}prepareEdgePoints(e,n,a,c,f){let p=n[c.a].x,_=n[c.a].y,x=n[c.b].x,T=n[c.b].y,I=a[c.a],C=a[c.b];const P=f(I,0),D=f(C,0);if(P&&D)return this.setElevatedPoint(e[0],p,_,I),this.setElevatedPoint(e[1],x,T,C),!0;if(!P&&!D)return!1;if(P){if(!D){const k=C/(C-I);x=fn(x,p,k),T=fn(T,_,k),C=fn(C,I,k)}}else{const k=I/(I-C);p=fn(p,x,k),_=fn(_,T,k),I=fn(I,C,k)}return this.setElevatedPoint(e[0],p,_,I),this.setElevatedPoint(e[1],x,T,C),!0}prepareEdges(e,n){if(n.length===0)return;n.sort((_,x)=>_.hash===x.hash?x.polygonIdx-_.polygonIdx:x.hash>_.hash?1:-1);let a=0,c=0,f=0,p=n[a].polygonIdx;do c++,(c===n.length||n[a].hash!==n[c].hash)&&((c-a==1||n[c-1].polygonIdx!==p)&&(f<a&&(n[f]=n[a],n[a]=null),n[f].type="none",f++),a=c,a!==n.length&&(p=n[a].polygonIdx));while(a!==n.length);if(n.splice(f),n.length!==0&&e.length!==0){n.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let _=0,x=0;for(;_!==n.length&&x!==e.length;){const T=n[_],I=e[x];T.portalHash>I.hash?_++:I.hash>T.portalHash?x++:(T.type=I.type,_++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Et&&n>=Et}addFeatureSection(e,n,a,c){return e!==n&&(n=e,a.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),n}sortSubarray(e,n,a,c){const f=e.slice(n,a);f.sort(c),e.splice(n,f.length,...f)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(ws.computePosHash(e))<<32n|BigInt(ws.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var jI,UI={exports:{}},VI=(jI||(jI=1,function(r){function e(pe,ye){return pe>ye?1:pe<ye?-1:0}var n=function(pe,ye){pe===void 0&&(pe=e),ye===void 0&&(ye=!1),this._compare=pe,this._root=null,this._size=0,this._noDuplicates=!!ye},a={size:{configurable:!0}};function c(pe,ye,et,ft,Mt){var Rt=Mt-ft;if(Rt>0){var en=ft+Math.floor(Rt/2),rn={key:ye[en],data:et[en],parent:pe};return rn.left=c(rn,ye,et,ft,en),rn.right=c(rn,ye,et,en+1,Mt),rn}return null}function f(pe,ye,et,ft,Mt){if(!(et>=ft)){for(var Rt=pe[et+ft>>1],en=et-1,rn=ft+1;;){do en++;while(Mt(pe[en],Rt)<0);do rn--;while(Mt(pe[rn],Rt)>0);if(en>=rn)break;var Sn=pe[en];pe[en]=pe[rn],pe[rn]=Sn,Sn=ye[en],ye[en]=ye[rn],ye[rn]=Sn}f(pe,ye,et,rn,Mt),f(pe,ye,rn+1,ft,Mt)}}n.prototype.rotateLeft=function(pe){var ye=pe.right;ye&&(pe.right=ye.left,ye.left&&(ye.left.parent=pe),ye.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ye:pe.parent.right=ye:this._root=ye,ye&&(ye.left=pe),pe.parent=ye},n.prototype.rotateRight=function(pe){var ye=pe.left;ye&&(pe.left=ye.right,ye.right&&(ye.right.parent=pe),ye.parent=pe.parent),pe.parent?pe===pe.parent.left?pe.parent.left=ye:pe.parent.right=ye:this._root=ye,ye&&(ye.right=pe),pe.parent=ye},n.prototype._splay=function(pe){for(;pe.parent;){var ye=pe.parent;ye.parent?ye.left===pe&&ye.parent.left===ye?(this.rotateRight(ye.parent),this.rotateRight(ye)):ye.right===pe&&ye.parent.right===ye?(this.rotateLeft(ye.parent),this.rotateLeft(ye)):ye.left===pe&&ye.parent.right===ye?(this.rotateRight(ye),this.rotateLeft(ye)):(this.rotateLeft(ye),this.rotateRight(ye)):ye.left===pe?this.rotateRight(ye):this.rotateLeft(ye)}},n.prototype.splay=function(pe){for(var ye,et,ft,Mt,Rt;pe.parent;)(et=(ye=pe.parent).parent)&&et.parent?((ft=et.parent).left===et?ft.left=pe:ft.right=pe,pe.parent=ft):(pe.parent=null,this._root=pe),Mt=pe.left,Rt=pe.right,pe===ye.left?(et&&(et.left===ye?(ye.right?(et.left=ye.right,et.left.parent=et):et.left=null,ye.right=et,et.parent=ye):(Mt?(et.right=Mt,Mt.parent=et):et.right=null,pe.left=et,et.parent=pe)),Rt?(ye.left=Rt,Rt.parent=ye):ye.left=null,pe.right=ye,ye.parent=pe):(et&&(et.right===ye?(ye.left?(et.right=ye.left,et.right.parent=et):et.right=null,ye.left=et,et.parent=ye):(Rt?(et.left=Rt,Rt.parent=et):et.left=null,pe.right=et,et.parent=pe)),Mt?(ye.right=Mt,Mt.parent=ye):ye.right=null,pe.left=ye,ye.parent=pe)},n.prototype.replace=function(pe,ye){pe.parent?pe===pe.parent.left?pe.parent.left=ye:pe.parent.right=ye:this._root=ye,ye&&(ye.parent=pe.parent)},n.prototype.minNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.left;)pe=pe.left;return pe},n.prototype.maxNode=function(pe){if(pe===void 0&&(pe=this._root),pe)for(;pe.right;)pe=pe.right;return pe},n.prototype.insert=function(pe,ye){var et=this._root,ft=null,Mt=this._compare;if(this._noDuplicates)for(;et;){if(ft=et,Mt(et.key,pe)===0)return;et=Mt(et.key,pe)<0?et.right:et.left}else for(;et;)ft=et,et=Mt(et.key,pe)<0?et.right:et.left;return et={key:pe,data:ye,left:null,right:null,parent:ft},ft?Mt(ft.key,et.key)<0?ft.right=et:ft.left=et:this._root=et,this.splay(et),this._size++,et},n.prototype.find=function(pe){for(var ye=this._root,et=this._compare;ye;){var ft=et(ye.key,pe);if(ft<0)ye=ye.right;else{if(!(ft>0))return ye;ye=ye.left}}return null},n.prototype.contains=function(pe){for(var ye=this._root,et=this._compare;ye;){var ft=et(pe,ye.key);if(ft===0)return!0;ye=ft<0?ye.left:ye.right}return!1},n.prototype.remove=function(pe){var ye=this.find(pe);if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var et=this.minNode(ye.right);et.parent!==ye&&(this.replace(et,et.right),et.right=ye.right,et.right.parent=et),this.replace(ye,et),et.left=ye.left,et.left.parent=et}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},n.prototype.removeNode=function(pe){if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var ye=this.minNode(pe.right);ye.parent!==pe&&(this.replace(ye,ye.right),ye.right=pe.right,ye.right.parent=ye),this.replace(pe,ye),ye.left=pe.left,ye.left.parent=ye}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},n.prototype.erase=function(pe){var ye=this.find(pe);if(ye){this.splay(ye);var et=ye.left,ft=ye.right,Mt=null;et&&(et.parent=null,Mt=this.maxNode(et),this.splay(Mt),this._root=Mt),ft&&(et?Mt.right=ft:this._root=ft,ft.parent=Mt),this._size--}},n.prototype.pop=function(){var pe=this._root,ye=null;if(pe){for(;pe.left;)pe=pe.left;ye={key:pe.key,data:pe.data},this.remove(pe.key)}return ye},n.prototype.next=function(pe){var ye=pe;if(ye)if(ye.right)for(ye=ye.right;ye&&ye.left;)ye=ye.left;else for(ye=pe.parent;ye&&ye.right===pe;)pe=ye,ye=ye.parent;return ye},n.prototype.prev=function(pe){var ye=pe;if(ye)if(ye.left)for(ye=ye.left;ye&&ye.right;)ye=ye.right;else for(ye=pe.parent;ye&&ye.left===pe;)pe=ye,ye=ye.parent;return ye},n.prototype.forEach=function(pe){for(var ye=this._root,et=[],ft=!1,Mt=0;!ft;)ye?(et.push(ye),ye=ye.left):et.length>0?(pe(ye=et.pop(),Mt++),ye=ye.right):ft=!0;return this},n.prototype.range=function(pe,ye,et,ft){for(var Mt=[],Rt=this._compare,en=this._root;Mt.length!==0||en;)if(en)Mt.push(en),en=en.left;else{if(Rt((en=Mt.pop()).key,ye)>0)break;if(Rt(en.key,pe)>=0&&et.call(ft,en))return this;en=en.right}return this},n.prototype.keys=function(){for(var pe=this._root,ye=[],et=[],ft=!1;!ft;)pe?(ye.push(pe),pe=pe.left):ye.length>0?(pe=ye.pop(),et.push(pe.key),pe=pe.right):ft=!0;return et},n.prototype.values=function(){for(var pe=this._root,ye=[],et=[],ft=!1;!ft;)pe?(ye.push(pe),pe=pe.left):ye.length>0?(pe=ye.pop(),et.push(pe.data),pe=pe.right):ft=!0;return et},n.prototype.at=function(pe){for(var ye=this._root,et=[],ft=!1,Mt=0;!ft;)if(ye)et.push(ye),ye=ye.left;else if(et.length>0){if(ye=et.pop(),Mt===pe)return ye;Mt++,ye=ye.right}else ft=!0;return null},n.prototype.load=function(pe,ye,et){if(pe===void 0&&(pe=[]),ye===void 0&&(ye=[]),et===void 0&&(et=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ft=pe.length;return et&&f(pe,ye,0,ft-1,this._compare),this._root=c(null,pe,ye,0,ft),this._size=ft,this},n.prototype.min=function(){var pe=this.minNode(this._root);return pe?pe.key:null},n.prototype.max=function(){var pe=this.maxNode(this._root);return pe?pe.key:null},n.prototype.isEmpty=function(){return this._root===null},a.size.get=function(){return this._size},n.createTree=function(pe,ye,et,ft,Mt){return new n(et,Mt).load(pe,ye,ft)},Object.defineProperties(n.prototype,a);var p=0,_=1,x=2,T=3,I=0,C=1,P=2,D=3;function k(pe,ye,et){ye===null?(pe.inOut=!1,pe.otherInOut=!0):(pe.isSubject===ye.isSubject?(pe.inOut=!ye.inOut,pe.otherInOut=ye.otherInOut):(pe.inOut=!ye.otherInOut,pe.otherInOut=ye.isVertical()?!ye.inOut:ye.inOut),ye&&(pe.prevInResult=!j(ye,et)||ye.isVertical()?ye.prevInResult:ye));var ft=j(pe,et);pe.resultTransition=ft?function(Mt,Rt){var en,rn=!Mt.inOut,Sn=!Mt.otherInOut;switch(Rt){case I:en=rn&&Sn;break;case C:en=rn||Sn;break;case D:en=rn^Sn;break;case P:en=Mt.isSubject?rn&&!Sn:Sn&&!rn}return en?1:-1}(pe,et):0}function j(pe,ye){switch(pe.type){case p:switch(ye){case I:return!pe.otherInOut;case C:return pe.otherInOut;case P:return pe.isSubject&&pe.otherInOut||!pe.isSubject&&!pe.otherInOut;case D:return!0}break;case x:return ye===I||ye===C;case T:return ye===P;case _:return!1}return!1}var H=function(pe,ye,et,ft,Mt){this.left=ye,this.point=pe,this.otherEvent=et,this.isSubject=ft,this.type=Mt||p,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},$={inResult:{configurable:!0}};function K(pe,ye){return pe[0]===ye[0]&&pe[1]===ye[1]}H.prototype.isBelow=function(pe){var ye=this.point,et=this.otherEvent.point;return this.left?(ye[0]-pe[0])*(et[1]-pe[1])-(et[0]-pe[0])*(ye[1]-pe[1])>0:(et[0]-pe[0])*(ye[1]-pe[1])-(ye[0]-pe[0])*(et[1]-pe[1])>0},H.prototype.isAbove=function(pe){return!this.isBelow(pe)},H.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},$.inResult.get=function(){return this.resultTransition!==0},H.prototype.clone=function(){var pe=new H(this.point,this.left,this.otherEvent,this.isSubject,this.type);return pe.contourId=this.contourId,pe.resultTransition=this.resultTransition,pe.prevInResult=this.prevInResult,pe.isExteriorRing=this.isExteriorRing,pe.inOut=this.inOut,pe.otherInOut=this.otherInOut,pe},Object.defineProperties(H.prototype,$);var ee=11102230246251565e-32,se=134217729,_e=(3+8*ee)*ee;function fe(pe,ye,et,ft,Mt){var Rt,en,rn,Sn,kn=ye[0],On=ft[0],Un=0,hn=0;On>kn==On>-kn?(Rt=kn,kn=ye[++Un]):(Rt=On,On=ft[++hn]);var vn=0;if(Un<pe&&hn<et)for(On>kn==On>-kn?(rn=Rt-((en=kn+Rt)-kn),kn=ye[++Un]):(rn=Rt-((en=On+Rt)-On),On=ft[++hn]),Rt=en,rn!==0&&(Mt[vn++]=rn);Un<pe&&hn<et;)On>kn==On>-kn?(rn=Rt-((en=Rt+kn)-(Sn=en-Rt))+(kn-Sn),kn=ye[++Un]):(rn=Rt-((en=Rt+On)-(Sn=en-Rt))+(On-Sn),On=ft[++hn]),Rt=en,rn!==0&&(Mt[vn++]=rn);for(;Un<pe;)rn=Rt-((en=Rt+kn)-(Sn=en-Rt))+(kn-Sn),kn=ye[++Un],Rt=en,rn!==0&&(Mt[vn++]=rn);for(;hn<et;)rn=Rt-((en=Rt+On)-(Sn=en-Rt))+(On-Sn),On=ft[++hn],Rt=en,rn!==0&&(Mt[vn++]=rn);return Rt===0&&vn!==0||(Mt[vn++]=Rt),vn}function xe(pe){return new Float64Array(pe)}var Ie=33306690738754716e-32,Pe=22204460492503146e-32,Xe=11093356479670487e-47,ke=xe(4),Je=xe(8),rt=xe(12),ot=xe(16),ht=xe(4);function pt(pe,ye,et){var ft=function(Mt,Rt,en,rn,Sn,kn){var On=(Rt-kn)*(en-Sn),Un=(Mt-Sn)*(rn-kn),hn=On-Un;if(On===0||Un===0||On>0!=Un>0)return hn;var vn=Math.abs(On+Un);return Math.abs(hn)>=Ie*vn?hn:-function(ti,si,ai,wi,Ri,Ii,ui){var gi,zn,Wn,Ki,un,Vn,Ci,ki,ji,br,Fi,dn,ir,bi,Xi,Fr,Yr,Rr,Dr=ti-Ri,Vr=ai-Ri,es=si-Ii,Ni=wi-Ii;ke[0]=(Xi=(ki=Dr-(Ci=(Vn=se*Dr)-(Vn-Dr)))*(br=Ni-(ji=(Vn=se*Ni)-(Vn-Ni)))-((bi=Dr*Ni)-Ci*ji-ki*ji-Ci*br))-((Fi=Xi-(Yr=(ki=es-(Ci=(Vn=se*es)-(Vn-es)))*(br=Vr-(ji=(Vn=se*Vr)-(Vn-Vr)))-((Fr=es*Vr)-Ci*ji-ki*ji-Ci*br)))+(un=Xi-Fi))+(un-Yr),ke[1]=(ir=bi-((dn=bi+Fi)-(un=dn-bi))+(Fi-un))-((Fi=ir-Fr)+(un=ir-Fi))+(un-Fr),ke[2]=dn-((Rr=dn+Fi)-(un=Rr-dn))+(Fi-un),ke[3]=Rr;var _r=function(ic,_o){for(var Go=_o[0],Ts=1;Ts<4;Ts++)Go+=_o[Ts];return Go}(0,ke),Tr=Pe*ui;if(_r>=Tr||-_r>=Tr||(gi=ti-(Dr+(un=ti-Dr))+(un-Ri),Wn=ai-(Vr+(un=ai-Vr))+(un-Ri),zn=si-(es+(un=si-es))+(un-Ii),Ki=wi-(Ni+(un=wi-Ni))+(un-Ii),gi===0&&zn===0&&Wn===0&&Ki===0)||(Tr=Xe*ui+_e*Math.abs(_r),(_r+=Dr*Ki+Ni*gi-(es*Wn+Vr*zn))>=Tr||-_r>=Tr))return _r;ht[0]=(Xi=(ki=gi-(Ci=(Vn=se*gi)-(Vn-gi)))*(br=Ni-(ji=(Vn=se*Ni)-(Vn-Ni)))-((bi=gi*Ni)-Ci*ji-ki*ji-Ci*br))-((Fi=Xi-(Yr=(ki=zn-(Ci=(Vn=se*zn)-(Vn-zn)))*(br=Vr-(ji=(Vn=se*Vr)-(Vn-Vr)))-((Fr=zn*Vr)-Ci*ji-ki*ji-Ci*br)))+(un=Xi-Fi))+(un-Yr),ht[1]=(ir=bi-((dn=bi+Fi)-(un=dn-bi))+(Fi-un))-((Fi=ir-Fr)+(un=ir-Fi))+(un-Fr),ht[2]=dn-((Rr=dn+Fi)-(un=Rr-dn))+(Fi-un),ht[3]=Rr;var as=fe(4,ke,4,ht,Je);ht[0]=(Xi=(ki=Dr-(Ci=(Vn=se*Dr)-(Vn-Dr)))*(br=Ki-(ji=(Vn=se*Ki)-(Vn-Ki)))-((bi=Dr*Ki)-Ci*ji-ki*ji-Ci*br))-((Fi=Xi-(Yr=(ki=es-(Ci=(Vn=se*es)-(Vn-es)))*(br=Wn-(ji=(Vn=se*Wn)-(Vn-Wn)))-((Fr=es*Wn)-Ci*ji-ki*ji-Ci*br)))+(un=Xi-Fi))+(un-Yr),ht[1]=(ir=bi-((dn=bi+Fi)-(un=dn-bi))+(Fi-un))-((Fi=ir-Fr)+(un=ir-Fi))+(un-Fr),ht[2]=dn-((Rr=dn+Fi)-(un=Rr-dn))+(Fi-un),ht[3]=Rr;var Nr=fe(as,Je,4,ht,rt);ht[0]=(Xi=(ki=gi-(Ci=(Vn=se*gi)-(Vn-gi)))*(br=Ki-(ji=(Vn=se*Ki)-(Vn-Ki)))-((bi=gi*Ki)-Ci*ji-ki*ji-Ci*br))-((Fi=Xi-(Yr=(ki=zn-(Ci=(Vn=se*zn)-(Vn-zn)))*(br=Wn-(ji=(Vn=se*Wn)-(Vn-Wn)))-((Fr=zn*Wn)-Ci*ji-ki*ji-Ci*br)))+(un=Xi-Fi))+(un-Yr),ht[1]=(ir=bi-((dn=bi+Fi)-(un=dn-bi))+(Fi-un))-((Fi=ir-Fr)+(un=ir-Fi))+(un-Fr),ht[2]=dn-((Rr=dn+Fi)-(un=Rr-dn))+(Fi-un),ht[3]=Rr;var ja=fe(Nr,rt,4,ht,ot);return ot[ja-1]}(Mt,Rt,en,rn,Sn,kn,vn)}(pe[0],pe[1],ye[0],ye[1],et[0],et[1]);return ft>0?-1:ft<0?1:0}function ct(pe,ye){var et=pe.point,ft=ye.point;return et[0]>ft[0]?1:et[0]<ft[0]?-1:et[1]!==ft[1]?et[1]>ft[1]?1:-1:function(Mt,Rt,en,rn){return Mt.left!==Rt.left?Mt.left?1:-1:pt(en,Mt.otherEvent.point,Rt.otherEvent.point)!==0?Mt.isBelow(Rt.otherEvent.point)?-1:1:!Mt.isSubject&&Rt.isSubject?1:-1}(pe,ye,et)}function ut(pe,ye,et){var ft=new H(ye,!1,pe,pe.isSubject),Mt=new H(ye,!0,pe.otherEvent,pe.isSubject);return K(pe.point,pe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",pe),ft.contourId=Mt.contourId=pe.contourId,ct(Mt,pe.otherEvent)>0&&(pe.otherEvent.left=!0,Mt.left=!1),pe.otherEvent.otherEvent=Mt,pe.otherEvent=ft,et.push(Mt),et.push(ft),et}function Qe(pe,ye){return pe[0]*ye[1]-pe[1]*ye[0]}function Ye(pe,ye){return pe[0]*ye[0]+pe[1]*ye[1]}function dt(pe,ye,et){var ft=function(Sn,kn,On,Un,hn){var vn=[kn[0]-Sn[0],kn[1]-Sn[1]],ti=[Un[0]-On[0],Un[1]-On[1]];function si(Vn,Ci,ki){return[Vn[0]+Ci*ki[0],Vn[1]+Ci*ki[1]]}var ai=[On[0]-Sn[0],On[1]-Sn[1]],wi=Qe(vn,ti),Ri=wi*wi,Ii=Ye(vn,vn);if(Ri>0){var ui=Qe(ai,ti)/wi;if(ui<0||ui>1)return null;var gi=Qe(ai,vn)/wi;return gi<0||gi>1?null:ui===0||ui===1?[si(Sn,ui,vn)]:gi===0||gi===1?[si(On,gi,ti)]:[si(Sn,ui,vn)]}if((Ri=(wi=Qe(ai,vn))*wi)>0)return null;var zn=Ye(vn,ai)/Ii,Wn=zn+Ye(vn,ti)/Ii,Ki=Math.min(zn,Wn),un=Math.max(zn,Wn);return Ki<=1&&un>=0?Ki===1?[si(Sn,Ki>0?Ki:0,vn)]:un===0?[si(Sn,un<1?un:1,vn)]:[si(Sn,Ki>0?Ki:0,vn),si(Sn,un<1?un:1,vn)]:null}(pe.point,pe.otherEvent.point,ye.point,ye.otherEvent.point),Mt=ft?ft.length:0;if(Mt===0||Mt===1&&(K(pe.point,ye.point)||K(pe.otherEvent.point,ye.otherEvent.point))||Mt===2&&pe.isSubject===ye.isSubject)return 0;if(Mt===1)return K(pe.point,ft[0])||K(pe.otherEvent.point,ft[0])||ut(pe,ft[0],et),K(ye.point,ft[0])||K(ye.otherEvent.point,ft[0])||ut(ye,ft[0],et),1;var Rt=[],en=!1,rn=!1;return K(pe.point,ye.point)?en=!0:ct(pe,ye)===1?Rt.push(ye,pe):Rt.push(pe,ye),K(pe.otherEvent.point,ye.otherEvent.point)?rn=!0:ct(pe.otherEvent,ye.otherEvent)===1?Rt.push(ye.otherEvent,pe.otherEvent):Rt.push(pe.otherEvent,ye.otherEvent),en&&rn||en?(ye.type=_,pe.type=ye.inOut===pe.inOut?x:T,en&&!rn&&ut(Rt[1].otherEvent,Rt[0].point,et),2):rn?(ut(Rt[0],Rt[1].point,et),3):Rt[0]!==Rt[3].otherEvent?(ut(Rt[0],Rt[1].point,et),ut(Rt[1],Rt[2].point,et),3):(ut(Rt[0],Rt[1].point,et),ut(Rt[3].otherEvent,Rt[2].point,et),3)}function It(pe,ye){if(pe===ye)return 0;if(pt(pe.point,pe.otherEvent.point,ye.point)!==0||pt(pe.point,pe.otherEvent.point,ye.otherEvent.point)!==0)return K(pe.point,ye.point)?pe.isBelow(ye.otherEvent.point)?-1:1:pe.point[0]===ye.point[0]?pe.point[1]<ye.point[1]?-1:1:ct(pe,ye)===1?ye.isAbove(pe.point)?-1:1:pe.isBelow(ye.point)?-1:1;if(pe.isSubject!==ye.isSubject)return pe.isSubject?-1:1;var et=pe.point,ft=ye.point;return et[0]===ft[0]&&et[1]===ft[1]?(et=pe.otherEvent.point)[0]===(ft=ye.otherEvent.point)[0]&&et[1]===ft[1]?0:pe.contourId>ye.contourId?1:-1:ct(pe,ye)===1?1:-1}var vt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Jt(pe,ye,et,ft){var Mt,Rt=pe+1,en=ye[pe].point,rn=ye.length;for(Rt<rn&&(Mt=ye[Rt].point);Rt<rn&&Mt[0]===en[0]&&Mt[1]===en[1];){if(!et[Rt])return Rt;++Rt<rn&&(Mt=ye[Rt].point)}for(Rt=pe-1;et[Rt]&&Rt>ft;)Rt--;return Rt}vt.prototype.isExterior=function(){return this.holeOf==null};var Lt=Wt,Nt=Wt;function Wt(pe,ye){if(!(this instanceof Wt))return new Wt(pe,ye);if(this.data=pe||[],this.length=this.data.length,this.compare=ye||Fn,this.length>0)for(var et=(this.length>>1)-1;et>=0;et--)this._down(et)}function Fn(pe,ye){return pe<ye?-1:pe>ye?1:0}Wt.prototype={push:function(pe){this.data.push(pe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var pe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),pe}},peek:function(){return this.data[0]},_up:function(pe){for(var ye=this.data,et=this.compare,ft=ye[pe];pe>0;){var Mt=pe-1>>1,Rt=ye[Mt];if(et(ft,Rt)>=0)break;ye[pe]=Rt,pe=Mt}ye[pe]=ft},_down:function(pe){for(var ye=this.data,et=this.compare,ft=this.length>>1,Mt=ye[pe];pe<ft;){var Rt=1+(pe<<1),en=Rt+1,rn=ye[Rt];if(en<this.length&&et(ye[en],rn)<0&&(Rt=en,rn=ye[en]),et(rn,Mt)>=0)break;ye[pe]=rn,pe=Rt}ye[pe]=Mt}},Lt.default=Nt;var wt=Math.max,Zt=Math.min,xn=0;function Hn(pe,ye,et,ft,Mt,Rt){var en,rn,Sn,kn,On,Un;for(en=0,rn=pe.length-1;en<rn;en++)if(kn=pe[en+1],On=new H(Sn=pe[en],!1,void 0,ye),Un=new H(kn,!1,On,ye),On.otherEvent=Un,Sn[0]!==kn[0]||Sn[1]!==kn[1]){On.contourId=Un.contourId=et,Rt||(On.isExteriorRing=!1,Un.isExteriorRing=!1),ct(On,Un)>0?Un.left=!0:On.left=!0;var hn=Sn[0],vn=Sn[1];Mt[0]=Zt(Mt[0],hn),Mt[1]=Zt(Mt[1],vn),Mt[2]=wt(Mt[2],hn),Mt[3]=wt(Mt[3],vn),ft.push(On),ft.push(Un)}}var qn=[];function Cn(pe,ye,et){typeof pe[0][0][0]=="number"&&(pe=[pe]),typeof ye[0][0][0]=="number"&&(ye=[ye]);var ft=function(vn,ti,si){var ai=null;return vn.length*ti.length==0&&(si===I?ai=qn:si===P?ai=vn:si!==C&&si!==D||(ai=vn.length===0?ti:vn)),ai}(pe,ye,et);if(ft)return ft===qn?null:ft;var Mt=[1/0,1/0,-1/0,-1/0],Rt=[1/0,1/0,-1/0,-1/0],en=function(vn,ti,si,ai,wi){var Ri,Ii,ui,gi,zn,Wn,Ki=new Lt(null,ct);for(ui=0,gi=vn.length;ui<gi;ui++)for(zn=0,Wn=(Ri=vn[ui]).length;zn<Wn;zn++)(Ii=zn===0)&&xn++,Hn(Ri[zn],!0,xn,Ki,si,Ii);for(ui=0,gi=ti.length;ui<gi;ui++)for(zn=0,Wn=(Ri=ti[ui]).length;zn<Wn;zn++)Ii=zn===0,wi===P&&(Ii=!1),Ii&&xn++,Hn(Ri[zn],!1,xn,Ki,ai,Ii);return Ki}(pe,ye,Mt,Rt,et);if(ft=function(vn,ti,si,ai,wi){var Ri=null;return(si[0]>ai[2]||ai[0]>si[2]||si[1]>ai[3]||ai[1]>si[3])&&(wi===I?Ri=qn:wi===P?Ri=vn:wi!==C&&wi!==D||(Ri=vn.concat(ti))),Ri}(pe,ye,Mt,Rt,et))return ft===qn?null:ft;for(var rn=function(vn){var ti,si,ai=function(ui){var gi,zn,Wn,Ki,un=[];for(zn=0,Wn=ui.length;zn<Wn;zn++)((gi=ui[zn]).left&&gi.inResult||!gi.left&&gi.otherEvent.inResult)&&un.push(gi);for(var Vn=!1;!Vn;)for(Vn=!0,zn=0,Wn=un.length;zn<Wn;zn++)zn+1<Wn&&ct(un[zn],un[zn+1])===1&&(Ki=un[zn],un[zn]=un[zn+1],un[zn+1]=Ki,Vn=!1);for(zn=0,Wn=un.length;zn<Wn;zn++)(gi=un[zn]).otherPos=zn;for(zn=0,Wn=un.length;zn<Wn;zn++)(gi=un[zn]).left||(Ki=gi.otherPos,gi.otherPos=gi.otherEvent.otherPos,gi.otherEvent.otherPos=Ki);return un}(vn),wi={},Ri=[],Ii=function(){if(!wi[ti]){var ui=Ri.length,gi=function(un,Vn,Ci){var ki=new vt;if(un.prevInResult!=null){var ji=un.prevInResult,br=ji.outputContourId;if(ji.resultTransition>0){var Fi=Vn[br];if(Fi.holeOf!=null){var dn=Fi.holeOf;Vn[dn].holeIds.push(Ci),ki.holeOf=dn,ki.depth=Vn[br].depth}else Vn[br].holeIds.push(Ci),ki.holeOf=br,ki.depth=Vn[br].depth+1}else ki.holeOf=null,ki.depth=Vn[br].depth}else ki.holeOf=null,ki.depth=0;return ki}(ai[ti],Ri,ui),zn=function(un){wi[un]=!0,un<ai.length&&ai[un]&&(ai[un].outputContourId=ui)},Wn=ti,Ki=ti;for(gi.points.push(ai[ti].point);zn(Wn),zn(Wn=ai[Wn].otherPos),gi.points.push(ai[Wn].point),!((Wn=Jt(Wn,ai,wi,Ki))==Ki||Wn>=ai.length)&&ai[Wn];);Ri.push(gi)}};for(ti=0,si=ai.length;ti<si;ti++)Ii();return Ri}(function(vn,ti,si,ai,wi,Ri){for(var Ii,ui,gi,zn=new n(It),Wn=[],Ki=Math.min(ai[2],wi[2]);vn.length!==0;){var un=vn.pop();if(Wn.push(un),Ri===I&&un.point[0]>Ki||Ri===P&&un.point[0]>ai[2])break;if(un.left){ui=Ii=zn.insert(un),Ii=Ii!==(gi=zn.minNode())?zn.prev(Ii):null,ui=zn.next(ui);var Vn=Ii?Ii.key:null;if(k(un,Vn,Ri),ui&&dt(un,ui.key,vn)===2&&(k(un,Vn,Ri),k(ui.key,un,Ri)),Ii&&dt(Ii.key,un,vn)===2){var Ci=Ii;k(Vn,(Ci=Ci!==gi?zn.prev(Ci):null)?Ci.key:null,Ri),k(un,Vn,Ri)}}else ui=Ii=zn.find(un=un.otherEvent),Ii&&ui&&(Ii=Ii!==gi?zn.prev(Ii):null,ui=zn.next(ui),zn.remove(un),ui&&Ii&&dt(Ii.key,ui.key,vn))}return Wn}(en,0,0,Mt,Rt,et)),Sn=[],kn=0;kn<rn.length;kn++){var On=rn[kn];if(On.isExterior()){for(var Un=[On.points],hn=0;hn<On.holeIds.length;hn++)Un.push(rn[On.holeIds[hn]].points);Sn.push(Un)}}return Sn}var Ei={UNION:C,DIFFERENCE:P,INTERSECTION:I,XOR:D};r.diff=function(pe,ye){return Cn(pe,ye,P)},r.intersection=function(pe,ye){return Cn(pe,ye,I)},r.operations=Ei,r.union=function(pe,ye){return Cn(pe,ye,C)},r.xor=function(pe,ye){return Cn(pe,ye,D)},Object.defineProperty(r,"__esModule",{value:!0})}(UI.exports)),UI.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function p0(r,e,n,a){const c=[],f=a===0?(p,_,x,T,I,C)=>{p.push(new at(C,x+(C-_)/(T-_)*(I-x)))}:(p,_,x,T,I,C)=>{p.push(new at(_+(C-x)/(I-x)*(T-_),C))};for(const p of r){const _=[];for(const x of p){if(x.length<=2)continue;const T=[];for(let P=0;P<x.length-1;P++){const D=x[P].x,k=x[P].y,j=x[P+1].x,H=x[P+1].y,$=a===0?D:k,K=a===0?j:H;$<e?K>e&&f(T,D,k,j,H,e):$>n?K<n&&f(T,D,k,j,H,n):T.push(x[P]),K<e&&$>=e&&f(T,D,k,j,H,e),K>n&&$<=n&&f(T,D,k,j,H,n)}let I=x[x.length-1];const C=a===0?I.x:I.y;C>=e&&C<=n&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),_.push(T))}_.length&&c.push(_)}return c}function eB(r,e){const n=cb(r),a=cb([e]),c=VI.intersection(n,a);return c==null?[]:$I(c)}function tB(r,e){let a=cb(r,65536);const c=[];for(;e.valid();e.next()){const[f,p]=e.get(),_=f.x*65536,x=f.y*65536,T=p.x*65536,I=p.y*65536,C=T-_,P=I-x,D=Math.hypot(C,P);if(D===0)continue;const k=Math.trunc(P/D*3),j=-Math.trunc(C/D*3);c.push([[[_,x],[T,I],[T+k,I+j],[_+k,x+j],[_,x]]])}return c.length>0&&(a=VI.diff(a,c)),$I(a,1/65536)}function cb(r,e=1){return[r.map(n=>n.map(a=>[a.x*e,a.y*e]))]}function $I(r,e=1){return r.map(n=>n.map((a,c)=>{const f=a.map(p=>new at(p[0]*e,p[1]*e).round());return c>0&&f.reverse(),f}))}class ub{constructor(e,n){this.layoutVertexArray=new Yl,this.indexArray=new kr,this.lineIndexArray=new vs,this.triangleSegments=new er,this.lineSegments=new er,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new sl)}update(e,n,a,c,f,p,_,x){this.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,x)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,BN.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,jN.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,a,c,f,p,_){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,a,c,f,p,void 0,_)}}class db{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ub(e,!1),this.elevationBufferData=new ub(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,a,c){}populate(e,n,a,c){this.hasPattern=ab("fill",this.layers,this.pixelRatio,n);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:_,id:x,index:T,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,P=Le(_,C);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),P,a))continue;const D=f?f.evaluate(P,{},a,n.availableImages):void 0,k={id:x,properties:_.properties,type:_.type,sourceLayerIndex:I,index:T,geometry:C?P.geometry:Se(_,a,c),patterns:{},sortKey:D};p.push(k)}f&&p.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of p){const{geometry:x,index:T,sourceLayerIndex:I}=_;if(this.hasPattern){const C=lb("fill",this.layers,_,this.zoom,this.pixelRatio,n);this.patternFeatures.push(C)}else this.addFeature(_,x,T,a,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[T].feature,x,T,I,this.index)}}update(e,n,a,c,f,p,_){this.bufferData.update(e,n,a,c,f,p,_,this.worldview),this.elevationBufferData.update(e,n,a,c,f,p,_,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,a,c,f,p,_,this.worldview)}addFeatures(e,n,a,c,f,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,c,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,a,c,f,p=[],_,x){const T=c_(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,c,a,x):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,a,f,p,c,_,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,f,p,c,_,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,a,c,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,a,c,f,this.worldview))}addElevatedRoadFeature(e,n,a,c,f){const p=new Array,_=pi.getElevationFeature(e,f);if(!_)return void this.addGeometry(n,this.bufferData);{const T=this.clipPolygonsToTile(n,1);T.length>0&&p.push({polygons:T,elevationFeature:_,elevationTileID:a})}const x={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:c};for(const T of p)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ws(T.elevationTileID,this.layers,this.zoom,this.lut));const C=T.elevationFeature.isTunnel();let P=0;e.properties.hasOwnProperty($e)&&(P=+e.properties[$e]);for(const D of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,D,C,T.elevationFeature,P)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new Si(a,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,x)}}addElevatedGeometry(e,n,a,c,f,p){const _={elevation:a,elevationSampler:n,bias:c,index:f,featureInfo:p},[x,T]=this.addGeometry(e,this.elevationBufferData,_);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:x,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,x),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,n,a){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=null;a&&(p=a.elevationSampler.constantElevation(a.elevation,a.bias),p!=null&&(c=p,f=p));const _=(x,T,I)=>{if(a!=null)if(T.push(x),p!=null)n.elevatedLayoutVertexArray.emplaceBack(p),I.push(p);else{const C=a.elevationSampler.pointElevation(x,a.elevation,a.bias);n.elevatedLayoutVertexArray.emplaceBack(C),I.push(C),c=Math.min(c,C),f=Math.max(f,C)}};for(const x of e){let T=0;for(const ee of x)T+=ee.length;const I=n.triangleSegments.prepareSegment(T,n.layoutVertexArray,n.indexArray),C=I.vertexLength,P=[],D=[],k=[],j=[],H=[],$=n.layoutVertexArray.length;for(const ee of x){if(ee.length===0)continue;ee!==x[0]&&D.push(P.length/2);const se=n.lineSegments.prepareSegment(ee.length,n.layoutVertexArray,n.lineIndexArray),_e=se.vertexLength;a&&H.push(n.layoutVertexArray.length-$),_(ee[0],k,j),n.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),n.lineIndexArray.emplaceBack(_e+ee.length-1,_e),P.push(ee[0].x),P.push(ee[0].y);for(let fe=1;fe<ee.length;fe++)_(ee[fe],k,j),n.layoutVertexArray.emplaceBack(ee[fe].x,ee[fe].y),n.lineIndexArray.emplaceBack(_e+fe-1,_e+fe),P.push(ee[fe].x),P.push(ee[fe].y);se.vertexLength+=ee.length,se.primitiveLength+=ee.length}const K=Ep(P,D);for(let ee=0;ee<K.length;ee+=3)n.indexArray.emplaceBack(C+K[ee],C+K[ee+1],C+K[ee+2]);if(K.length>0&&a&&this.elevationMode==="hd-road-base"){const ee=a.elevation.isTunnel(),se=a.elevation.safeArea,_e=this.elevatedStructures.addVertices(k,j);this.elevatedStructures.addTriangles(K,_e,ee);const fe=H.length;if(fe>0){for(let xe=0;xe<fe-1;xe++)this.elevatedStructures.addRenderableRing(a.index,H[xe]+_e,H[xe+1]-H[xe],ee,se,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,H[fe-1]+_e,k.length-H[fe-1],ee,se,a.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=K.length/3}return[c,f]}prepareElevatedPolygons(e,n,a){const c=1/Z(a),f=[];for(const p of e){const _=tB(p,new oi(n,c));f.push(..._)}return f}clipPolygonsToTile(e,n){const a=-n,c=-n,f=Et+n,p=Et+n;let _=0;const x=[],T=[];for(;_<e.length;_++){const P=e[_],D=el(P);(D.min.x>=a&&D.max.x<=f&&D.min.y>=c&&D.max.y<=p?x:T).push(P)}if(x.length===e.length)return e;const I=[new at(a,c),new at(f,c),new at(f,p),new at(a,p),new at(a,c)],C=x;for(const P of T)C.push(...eB(P,I));return C}}let GI,HI,WI,qI;jt(db,"FillBucket",{omit:["layers","patternFeatures"]}),jt(ub,"FillBufferData"),jt(ws,"ElevatedStructures");class m0{constructor(e,n,a,c){if(this.triangleCount=n.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,p]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const P=e[C];f.x=Math.min(f.x,P.x),f.y=Math.min(f.y,P.y),p.x=Math.max(p.x,P.x),p.y=Math.max(p.y,P.y)}if(c){const C=Math.ceil(Math.max(p.x-f.x,p.y-f.y)/c);a=Math.max(a,C)}if(a===0)return;this.min=f,this.max=p;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const x=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/x)),this.cellsY=Math.max(1,Math.ceil(_.y/x)),this.xScale=1/x,this.yScale=1/x;const T=[];for(let C=0;C<this.triangleCount;C++){const P=e[n[3*C+0]].sub(this.min),D=e[n[3*C+1]].sub(this.min),k=e[n[3*C+2]].sub(this.min),j=tc(Math.floor(Math.min(P.x,D.x,k.x)),this.xScale,this.cellsX),H=tc(Math.floor(Math.max(P.x,D.x,k.x)),this.xScale,this.cellsX),$=tc(Math.floor(Math.min(P.y,D.y,k.y)),this.yScale,this.cellsY),K=tc(Math.floor(Math.max(P.y,D.y,k.y)),this.yScale,this.cellsY),ee=new at(0,0),se=new at(0,0),_e=new at(0,0),fe=new at(0,0);for(let xe=$;xe<=K;++xe){ee.y=se.y=xe*x,_e.y=fe.y=(xe+1)*x;for(let Ie=j;Ie<=H;++Ie)ee.x=_e.x=Ie*x,se.x=fe.x=(Ie+1)*x,(Io(P,D,k,ee,se,fe)||Io(P,D,k,ee,fe,_e))&&T.push({cellIdx:xe*this.cellsX+Ie,triIdx:C})}}if(T.length===0)return;T.sort((C,P)=>C.cellIdx-P.cellIdx||C.triIdx-P.triIdx);let I=0;for(;I<T.length;){const C=T[I].cellIdx,P={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===C;)++P.len,this.payload.push(T[I++].triIdx);this.cells[C]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=tc(e.x-this.min.x,this.xScale,this.cellsX),c=tc(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[c*this.cellsX+a];if(f){this._lazyInitLookup();for(let p=0;p<f.len;p++){const _=this.payload[f.start+p],x=Math.floor(_/8),T=1<<_%8;if(!(this.lookup[x]&T)&&(this.lookup[x]|=T,n.push(_),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const c=tc(e.x-this.min.x,this.xScale,this.cellsX),f=tc(n.x-this.min.x,this.xScale,this.cellsX),p=tc(e.y-this.min.y,this.yScale,this.cellsY),_=tc(n.y-this.min.y,this.yScale,this.cellsY);for(let x=p;x<=_;x++)for(let T=c;T<=f;T++){const I=this.cells[x*this.cellsX+T];if(I)for(let C=0;C<I.len;C++){const P=this.payload[I.start+C],D=Math.floor(P/8),k=1<<P%8;if(!(this.lookup[D]&k)&&(this.lookup[D]|=k,a.push(P),a.length===this.triangleCount))return}}}}function tc(r,e,n){return Math.max(0,Math.min(n-1,Math.floor(r*e)))}jt(m0,"TriangleGridIndex");class ZI{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const a of this.footprints)n.push({footprint:a,id:e})}updateAppearances(e,n,a,c){}populate(e,n,a,c){const f=[];for(const{feature:p,id:_,index:x,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,C=Le(p,I);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),C,a))continue;const P={id:_,properties:p.properties,type:p.type,sourceLayerIndex:T,index:x,geometry:I?C.geometry:Se(p,a,c),patterns:{}};f.push(P)}for(const p of f){const{geometry:_,index:x,sourceLayerIndex:T}=p;this.addFeature(p,_,x,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[x].feature,_,x,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,c,f,p,_){}destroy(){}addFeature(e,n,a,c,f,p=[],_){for(const x of c_(n,2)){const T=[],I=[],C=[],P=new at(1/0,1/0),D=new at(-1/0,-1/0);for(const H of x)if(H.length!==0){H!==x[0]&&C.push(I.length/2);for(let $=0;$<H.length;$++)I.push(H[$].x),I.push(H[$].y),T.push(H[$]),P.x=Math.min(P.x,H[$].x),P.y=Math.min(P.y,H[$].y),D.x=Math.max(D.x,H[$].x),D.y=Math.max(D.y,H[$].y)}const k=Ep(I,C),j=new m0(T,k,8,256);this.footprints.push({vertices:T,indices:k,grid:j,min:P,max:D})}}}jt(ZI,"ClipBucket",{omit:["layers"]});const nB=jn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),iB=jn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rB=jn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),oB=jn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),sB=jn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),aB=jn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),lB=jn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:cB}=nB,u_=Number.MAX_SAFE_INTEGER,XI=u_-1;function YI(r,e,n,a){return r.order<e||r.order===u_||!(r.clipMask&n)||function(c,f){return f.length!==0&&f.find(p=>p===c)===void 0}(a,r.clipScope)}function g0(r,e){return r.x-e.x||r.y-e.y}function KI(r,e){return g0(r.min,e.min)===0&&g0(r.max,e.max)===0}function hb(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function _0(r,e){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(r[n].sourceId!==e[n].sourceId||!KI(r[n],e[n])||r[n].order!==e[n].order||r[n].clipMask!==e[n].clipMask||!bo(r[n].clipScope,e[n].clipScope))return!1;return!0}function QI(r,e,n){const a=1/Et,c=1/(1<<n.canonical.z),f=(e.x*a+n.canonical.x)*c+n.wrap,p=(e.y*a+n.canonical.y)*c;return{min:new at((r.x*a+n.canonical.x)*c+n.wrap,(r.y*a+n.canonical.y)*c),max:new at(f,p)}}function uB(r,e,n){const a=1<<n.canonical.z,c=((e.x-n.wrap)*a-n.canonical.x)*Et,f=(e.y*a-n.canonical.y)*Et;return{min:new at(((r.x-n.wrap)*a-n.canonical.x)*Et,(r.y*a-n.canonical.y)*Et),max:new at(c,f)}}function fb(r,e,n,a,c,f,p){const _=r.indices,x=r.vertices,T=[];for(let I=a;I<a+c;I+=3){const C=e[n[I+0]+f],P=e[n[I+1]+f],D=e[n[I+2]+f],k=Math.min(C.x,P.x,D.x),j=Math.max(C.x,P.x,D.x),H=Math.min(C.y,P.y,D.y),$=Math.max(C.y,P.y,D.y);T.length=0,r.grid.query(new at(k,H),new at(j,$),T);for(let K=0;K<T.length;K++){const ee=T[K];if(Io(x[_[3*ee+0]],x[_[3*ee+1]],x[_[3*ee+2]],C,P,D,p))return!0}}return!1}function JI(r,e,n,a){if(!r||!n)return!1;let c=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<r.vertices.length)return JI(n,a,r,e);const f=e.canonical,p=a.canonical,_=Math.pow(2,p.z-f.z);c=r.vertices.map(x=>new at((x.x+f.x*Et)*_-p.x*Et,(x.y+f.y*Et)*_-p.y*Et))}return fb(n,c,r.indices,0,r.indices.length,0,0)}function eC(r,e,n,a){const c=Math.pow(2,a.z-n.z);return new at((r+n.x*Et)*c-a.x*Et,(e+n.y*Et)*c-a.y*Et)}function tC(r,e){const n=[];e.grid.queryPoint(r,n);const a=e.indices,c=e.vertices;for(let f=0;f<n.length;f++){const p=n[f];if(Pi([c[a[3*p+0]],c[a[3*p+1]],c[a[3*p+2]]],r))return!0}return!1}const pb=[new at(0,0),new at(Et,0),new at(Et,Et),new at(0,Et)];function nC(r,e){const n=[];let a=[];if(!e||r.length<2)return[r];if(r.length===2)return go(r[0],r[1],pb)?[r]:[];for(let c=0;c<r.length+2;c++){const f=r[c%r.length],p=r[(c+1)%r.length],_=go(c===0?r[r.length-1]:r[(c-1)%r.length],f,pb),x=go(f,p,pb),T=_||x;T&&a.push(f),T&&x||a.length>0&&(a.length>1&&n.push(a),a=[])}return a.length>1&&n.push(a),n}const mb=Re.types,dB=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],hB=["fill-extrusion-flood-light-ground-radius"],fB=Math.pow(2,13),pB=Math.pow(2,15)-1,iC=new at(0,1),Vc=2147483648,rC=7,oC=450;function d_(r,e,n,a,c,f,p,_){r.emplaceBack((e<<1)+p,(n<<1)+f,(Math.floor(a*fB)<<1)+c,Math.round(_))}function h_(r,e,n){r.emplaceBack(e.x*Et,e.y*Et,n?1:0)}function y0(r,e,n,a,c,f){r.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+c,f)}function f_(r,e,n){r.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class sC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class aC{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class lC{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let c=!!this.borders;n.x<e.min.x?(e.min.x=n.x,c=!0):n.x>e.max.x&&(e.max.x=n.x,c=!0),n.y<e.min.y?(e.min.y=n.y,c=!0):n.y>e.max.y&&(e.max.y=n.y,c=!0),((n.x===0||n.x===Et)&&n.x===a.x)!=((n.y===0||n.y===Et)&&n.y===a.y)&&this.processBorderOverlap(n,a),c&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,fn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Et!=e.x>Et&&this.addBorderIntersection(1,fn(n.y,e.y,(Et-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,fn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Et!=e.y>Et&&this.addBorderIntersection(3,fn(n.x,e.x,(Et-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function cC(r,e){const n=r.add(e)._unit(),a=W(r.x*n.x+r.y*n.y,-1,1);var c,f,p;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*pB*((f=r).x*(p=e).y-f.y*p.x<0?-1:1)}const mB=[r=>r.x<0,r=>r.x>Et,r=>r.y<0,r=>r.y>Et];function gB(r,e,n,a){const c=[4];if(a===0)return c;n._mult(a);const f=r.sub(n),p=e.sub(n),_=[r,e,f,p];for(let x=0;x<4;x++)for(const T of _)if(mB[x](T)){c.push(x);break}return c}class gb{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Bg,this.indexArray=new kr,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut},n=>hB.includes(n)),this._segments=new er,this.hiddenByLandmarkVertexArray=new fp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new er}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,c=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let x;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const T=e[0],I=e[1];x=cC(T.sub(e[f-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<f;T++){const I=T===f-1?0:T+1,C=e[T],P=e[I],D=e[I===f-1?0:I+1],k=P.sub(C)._perp()._unit(),j=cC(k,D.sub(P)._perp()._unit()),H=x,$=j;if(_b(C,P,n)||c&&hC(C,n)&&hC(P,n)){x=j;continue}const K=_.vertexLength;y0(this.vertexArray,C,P,1,1,H),y0(this.vertexArray,C,P,1,0,H),y0(this.vertexArray,C,P,0,1,$),y0(this.vertexArray,C,P,0,0,$),_.vertexLength+=4;const ee=gB(C,P,k,a);for(const se of ee)this._segmentToGroundQuads[p].push({id:K,region:se}),this._segmentToRegionTriCounts[p][se]+=2,_.primitiveLength+=2;x=j}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((c,f)=>c.region-f.region);for(let a=0;a<n;a++){const c=this._segmentToGroundQuads[a],f=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((x,T)=>x+T,0);let _=0;for(let x=0;x<=4;x++){const T=p[x];if(T!==0){let I=this.regionSegments[x];I||(I=this.regionSegments[x]=new er);const C={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+_,vertexLength:f.vertexLength,primitiveLength:T};I.get().push(C)}_+=T}for(let x=0;x<c.length;x++){const T=c[x].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,c,f,p,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,c,f,p,void 0,_)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,iB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,rB.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,c,f,p,_,x){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,c,f,p,_,x)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Vc))}updateHiddenByLandmarkRange(e,n,a){if(!this.hasData())return;const c=n+e;if(n!==0){for(let f=e;f<c;++f)this.hiddenByLandmarkVertexArray.emplace(f,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,aB.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class v0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new kr,this.footprintVertices=new Yl,this.footprintSegments=[],this.layoutVertexArray=new Pu,this.centroidVertexArray=new s0,this.wallVertexArray=new rh,this.indexArray=new kr,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut},n=>dB.includes(n)),this.segments=new er,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new gb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,a,c){}populate(e,n,a,c){this.features=[],this.hasPattern=ab("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Z(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:p,index:_,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Le(f,T);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),I,a))continue;const C={id:p,sourceLayerIndex:x,index:_,geometry:T?I.geometry:Se(f,a,c),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length,D=mb[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:lb("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const k of C.geometry)for(const j of nC(k,D))this.addFeature(f.id,C,[j],_,a,{},n.availableImages,c,n.brightness);else this.addFeature(f.id,C,C.geometry,_,a,{},n.availableImages,c,n.brightness);n.featureIndex.insert(f,C.geometry,_,x,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,c,f,p){for(const{featureId:_,feature:x}of this.features){const T=mb[x.type]==="Polygon",{geometry:I}=x;if(this.wallMode)for(const C of I)for(const P of nC(C,T))this.addFeature(_,x,[P],x.index,n,a,c,f,p);else this.addFeature(_,x,I,x.index,n,a,c,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,c,f,p,_){this.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,this.worldview),this.groundEffect.update(e,n,f,a,c,p,_,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cB),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,sB.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,lB.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,oB.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,c,f,p,_,x,T){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new at(0,0),new at(Et,Et)],P=x.projection,D=P.name==="globe",k=this.wallMode||mb[n.type]==="Polygon",j=new lC;j.centroidDataIndex=this.centroidData.length;const H=new aC;H.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(H.buildingId=n.properties.building_id);const $=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},f)<=0,K=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},f);let ee;if(H.height=K,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ap),this.wallMode){if(D)return void Ot("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;ee=function(ke){const Je=ke[0].x===ke[ke.length-1].x&&ke[0].y===ke[ke.length-1].y;(function(Nt){let Wt=0;const Fn=Nt.length;for(let wt=0;wt<Fn;wt++)Wt+=(Nt[(wt+1)%Fn].x-Nt[wt].x)*(Nt[(wt+1)%Fn].y+Nt[wt].y);return Wt>=0})(ke)||(ke=ke.reverse());const ot={geometry:[],joinNormals:[],indices:[]},ht=[],pt=[],ct=[];let ut=ke.length;for(;ut>=2&&ke[ut-1].equals(ke[ut-2]);)ut--;if(ut<(Je?3:2))return ot;let Qe,Ye,dt,It,vt,Jt=0;for(;Jt<ut-1&&ke[Jt].equals(ke[Jt+1]);)Jt++;Je&&(Qe=ke[ut-2],vt=ke[Jt].sub(Qe)._unit()._perp());for(let Nt=Jt;Nt<ut;Nt++){if(dt=Nt===ut-1?Je?ke[Jt+1]:void 0:ke[Nt+1],dt&&ke[Nt].equals(dt))continue;vt&&(It=vt),Qe&&(Ye=Qe),Qe=ke[Nt],vt=dt?dt.sub(Qe)._unit()._perp():It,It=It||vt;let Wt=It.add(vt);Wt.x===0&&Wt.y===0||Wt._unit();const Fn=Wt.x*vt.x+Wt.y*vt.y,wt=Fn!==0?1/Fn:1/0,Zt=It.x*vt.y-It.y*vt.x>0;let xn="miter";const Hn=2;xn==="miter"&&wt>Hn&&(xn="bevel"),xn==="bevel"&&(wt>100&&(xn="flipbevel"),wt<Hn&&(xn="miter"));const qn=(Cn,Ei,pe,ye)=>{const et=new at(Cn.x,Cn.y),ft=new at(Cn.x,Cn.y);et.x+=Ei.x*ye,et.y+=Ei.y*ye,ft.x-=Ei.x*Math.max(pe,1),ft.y-=Ei.y*Math.max(pe,1),ct.push(Ei),ht.push(et),pt.push(ft)};if(xn==="miter")Wt._mult(wt),qn(Qe,Wt,0,0);else if(xn==="flipbevel")Wt=vt.mult(-1),qn(Qe,Wt,0,0),qn(Qe,Wt.mult(-1),0,0);else{const Cn=-Math.sqrt(wt*wt-1),Ei=Zt?Cn:0,pe=Zt?0:Cn;Ye&&qn(Qe,It,Ei,pe),dt&&qn(Qe,vt,Ei,pe)}}ot.geometry=[...ht,...pt.reverse(),ht[0]],ot.joinNormals=[...ct,...ct.reverse(),ct[ct.length-1]];const Lt=ot.geometry.length-1;for(let Nt=0;Nt<Lt/2;Nt++)if(Nt+1<Lt/2){let Wt=Nt,Fn=Nt+1,wt=Lt-1-Nt,Zt=Lt-2-Nt;Wt=Wt===0?Lt-1:Wt-1,Fn=Fn===0?Lt-1:Fn-1,wt=wt===0?Lt-1:wt-1,Zt=Zt===0?Lt-1:Zt-1,ot.indices.push(wt),ot.indices.push(Fn),ot.indices.push(Wt),ot.indices.push(wt),ot.indices.push(Zt),ot.indices.push(Fn)}return ot}(a[0]),a=[ee.geometry]}const se=(ke,Je)=>ke<(Je.length-1)/2||ke===Je.length-1,_e=this.wallMode?[a]:c_(a,500);for(let ke=_e.length-1;ke>=0;ke--){const Je=_e[ke];(Je.length===0||(fe=Je[0]).every(rt=>rt.x<=0)||fe.every(rt=>rt.x>=Et)||fe.every(rt=>rt.y<=0)||fe.every(rt=>rt.y>=Et))&&_e.splice(ke,1)}var fe;let xe;if(D)xe=gC(_e,C,f);else{xe=[];for(const ke of _e)xe.push({polygon:ke,bounds:C})}const Ie=k?this.edgeRadius:0,Pe=Ie>0&&this.zoom<17,Xe=(ke,Je)=>{if(ke.length===0)return!1;const rt=ke[ke.length-1];return Je.x===rt.x&&Je.y===rt.y};for(const{polygon:ke,bounds:Je}of xe){let rt=0,ot=0;for(const ut of ke)k&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),ot+=k?ut.length-1:ut.length;const ht=this.segments.prepareSegment((k?5:4)*ot,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const pt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ct=new sC;if(ct.vertexOffset=this.footprintVertices.length,ct.indexOffset=3*this.footprintIndices.length,ct.ringIndices=[],k){const ut=[],Qe=[];rt=ht.vertexLength;for(let dt=0;dt<ke.length;dt++){const It=ke[dt];It.length&&dt!==0&&Qe.push(ut.length/2);const vt=[];let Jt,Lt;Jt=It[1].sub(It[0])._perp()._unit(),ct.ringIndices.push(It.length-1);for(let Nt=1;Nt<It.length;Nt++){const Wt=It[Nt],Fn=It[Nt===It.length-1?1:Nt+1],wt=Wt.clone();if(Ie){Lt=Fn.sub(Wt)._perp()._unit();const Zt=Jt.add(Lt)._unit(),xn=Ie*Math.min(4,1/(Jt.x*Zt.x+Jt.y*Zt.y));wt.x+=xn*Zt.x,wt.y+=xn*Zt.y,wt.x=Math.round(wt.x),wt.y=Math.round(wt.y),Jt=Lt}if(!$||Ie!==0&&!Pe||Xe(vt,wt)||vt.push(wt),d_(this.layoutVertexArray,wt.x,wt.y,0,0,1,1,0),this.wallMode){const Zt=se(Nt,It);h_(this.wallVertexArray,ee.joinNormals[Nt],!Zt)}ht.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),ut.push(Wt.x,Wt.y),D&&f_(this.layoutVertexExtArray,P.projectTilePoint(wt.x,wt.y,f),P.upVector(f,wt.x,wt.y))}$&&(Ie===0||Pe)&&(vt.length!==0&&Xe(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,Je,I))}const Ye=this.wallMode?ee.indices:Ep(ut,Qe);for(let dt=0;dt<Ye.length;dt+=3)this.footprintIndices.emplaceBack(ct.vertexOffset+Ye[dt+0],ct.vertexOffset+Ye[dt+1],ct.vertexOffset+Ye[dt+2]),this.indexArray.emplaceBack(rt+Ye[dt],rt+Ye[dt+2],rt+Ye[dt+1]),ht.primitiveLength++;ct.indexCount+=Ye.length,ct.vertexCount+=this.footprintVertices.length-ct.vertexOffset}for(let ut=0;ut<ke.length;ut++){const Qe=ke[ut];j.startRing(H,Qe[0]);let Ye=Qe.length>4&&fC(Qe[Qe.length-2],Qe[0],Qe[1]),dt=Ie?_B(Qe[Qe.length-2],Qe[0],Qe[1],Ie):0;const It=[];let vt,Jt,Lt;Jt=Qe[1].sub(Qe[0])._perp()._unit();let Nt=!0;for(let Wt=1,Fn=0;Wt<Qe.length;Wt++){let wt=Qe[Wt-1],Zt=Qe[Wt];const xn=Qe[Wt===Qe.length-1?1:Wt+1];if(j.appendEdge(H,Zt,wt),_b(Zt,wt,Je)){Ie&&(Jt=xn.sub(Zt)._perp()._unit(),Nt=!Nt);continue}const Hn=Zt.sub(wt)._perp(),qn=Hn.x/(Math.abs(Hn.x)+Math.abs(Hn.y)),Cn=Hn.y>0?1:0,Ei=wt.dist(Zt);if(Fn+Ei>32768&&(Fn=0),Ie){Lt=xn.sub(Zt)._perp()._unit();let ft=dC(wt,Zt,xn,uC(Jt,Lt),Ie);isNaN(ft)&&(ft=0);const Mt=Zt.sub(wt)._unit();wt=wt.add(Mt.mult(dt))._round(),Zt=Zt.add(Mt.mult(-ft))._round(),dt=ft,Jt=Lt,$&&this.zoom>=17&&(Xe(It,wt)||It.push(wt),Xe(It,Zt)||It.push(Zt))}const pe=ht.vertexLength,ye=Qe.length>4&&fC(wt,Zt,xn);let et=pC(Fn,Ye,Nt);if(d_(this.layoutVertexArray,wt.x,wt.y,qn,Cn,0,0,et),d_(this.layoutVertexArray,wt.x,wt.y,qn,Cn,0,1,et),this.wallMode){const ft=se(Wt-1,Qe),Mt=ee.joinNormals[Wt-1];h_(this.wallVertexArray,Mt,ft),h_(this.wallVertexArray,Mt,ft)}if(Fn+=Ei,et=pC(Fn,ye,!Nt),Ye=ye,d_(this.layoutVertexArray,Zt.x,Zt.y,qn,Cn,0,0,et),d_(this.layoutVertexArray,Zt.x,Zt.y,qn,Cn,0,1,et),this.wallMode){const ft=se(Wt,Qe),Mt=ee.joinNormals[Wt];h_(this.wallVertexArray,Mt,ft),h_(this.wallVertexArray,Mt,ft)}if(ht.vertexLength+=4,this.indexArray.emplaceBack(pe+0,pe+1,pe+2),this.indexArray.emplaceBack(pe+1,pe+3,pe+2),ht.primitiveLength+=2,Ie){const ft=rt+(Wt===1?Qe.length-2:Wt-2),Mt=Wt===1?rt:ft+1;if(this.indexArray.emplaceBack(pe+1,ft,pe+3),this.indexArray.emplaceBack(ft,Mt,pe+3),ht.primitiveLength+=2,vt===void 0&&(vt=pe),!_b(xn,Qe[Wt],Je)){const Rt=Wt===Qe.length-1?vt:ht.vertexLength;this.indexArray.emplaceBack(pe+2,pe+3,Rt),this.indexArray.emplaceBack(pe+3,Rt+1,Rt),this.indexArray.emplaceBack(pe+3,Mt,Rt+1),ht.primitiveLength+=3}Nt=!Nt}if(D){const ft=this.layoutVertexExtArray,Mt=P.projectTilePoint(wt.x,wt.y,f),Rt=P.projectTilePoint(Zt.x,Zt.y,f),en=P.upVector(f,wt.x,wt.y),rn=P.upVector(f,Zt.x,Zt.y);f_(ft,Mt,en),f_(ft,Mt,en),f_(ft,Rt,rn),f_(ft,Rt,rn)}}k&&(rt+=Qe.length-1),$&&Ie&&this.zoom>=17&&(It.length!==0&&Xe(It,It[0])&&It.pop(),this.groundEffect.addData(It,Je,I,Ie>0))}this.footprintSegments.push(ct),pt.triangleCount=this.indexArray.length-pt.triangleArrayOffset,this.polygonSegments.push(pt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=j.borders?iC:this.encodeCentroid(j,H),this.centroidData.push(H),j.borders){this.featuresOnBorder.push(j);const ke=this.featuresOnBorder.length-1;for(let Je=0;Je<j.borders.length;Je++)j.borders[Je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Je].push(ke)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,_,f,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,c,p,_,f,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,K)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const x=this.centroidData[_],T=+(x.min.y+x.max.y>Et),I=2*T+(+(x.min.x+x.max.x>Et)^T);for(let C=0;C<x.polygonSegLen;C++){const P=x.polygonSegIdx+C;e.push({centroidIdx:_,subtile:I,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const n=new kr;e.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let a=0,c=0,f=0;for(const _ of e){if(_.triangleSegmentIdx!==a)break;f++}const p=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let _=0,x=c,T=c;for(let I=x;I<f&&e[I].subtile===_;I++)T++;for(;x!==f;){const I=e[x];_=I.subtile;const C=this.centroidData[I.centroidIdx].min.clone(),P=this.centroidData[I.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=x;k<T;k++){const j=e[k],H=this.polygonSegments[j.polygonSegmentIdx],$=this.centroidData[j.centroidIdx].min,K=this.centroidData[j.centroidIdx].max,ee=this.indexArray.uint16;for(let se=H.triangleArrayOffset;se<H.triangleArrayOffset+H.triangleCount;se++)n.emplaceBack(ee[3*se],ee[3*se+1],ee[3*se+2]);D.primitiveLength+=H.triangleCount,C.x=Math.min(C.x,$.x),C.y=Math.min(C.y,$.y),P.x=Math.max(P.x,K.x),P.y=Math.max(P.y,K.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:C,max:P}),x=T;for(let k=x;k<f&&e[k].subtile===e[x].subtile;k++)T++}c=f;for(let I=c;I<p&&e[I].triangleSegmentIdx===e[c].triangleSegmentIdx;I++)f++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){const c=new er;if(this.wallMode){for(const j of this.triangleSubSegments)c.segments.push(j.segment);return c}let f=0,p=0;const _=1<<e.canonical.z;if(n){const j=n.getMinMaxForTile(e);j&&(f=j.min,p=j.max)}p+=this.maxHeight;const x=e.toUnwrapped();let T;const I=[x.canonical.x/_+x.wrap,x.canonical.y/_],C=[(x.canonical.x+1)/_+x.wrap,(x.canonical.y+1)/_],P=(j,H,$)=>[j[0]*(1-$[0])+H[0]*$[0],j[1]*(1-$[1])+H[1]*$[1]],D=[],k=[];for(const j of this.triangleSubSegments){D[0]=j.min.x/Et,D[1]=j.min.y/Et,k[0]=j.max.x/Et,k[1]=j.max.y/Et;const H=P(I,C,D),$=P(I,C,k);if(new Yt([H[0],H[1],f],[$[0],$[1],p]).intersectsPrecise(a)===0){T&&(c.segments.push(T),T=void 0);continue}const K=j.segment;T&&T.vertexOffset!==K.vertexOffset&&(c.segments.push(T),T=void 0),T?(T.vertexLength+=K.vertexLength,T.primitiveLength+=K.primitiveLength):T={vertexOffset:K.vertexOffset,primitiveLength:K.primitiveLength,vertexLength:K.vertexLength,primitiveOffset:K.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&c.segments.push(T),c}encodeCentroid(e,n){const a=e.centroid(),c=n.span(),f=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new at(W(a.x,1,Et-1)<<3|f,W(a.y,1,Et-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new at(0,0);const n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){const c=n[0][0]!==a?0:1;return new at(6|(n[0][0]!==a?0:65528),(n[c][0]+n[c][1])/2<<3|6)}{const c=n[2][0]!==a?2:3;return new at((n[c][0]+n[c][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Vc?iC:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==c.y||f!==c.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());if(_0(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){if(p.order<a)continue;const _=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingIds)for(const x of this.centroidData)x.flags&Vc||p.min.x>x.max.x||x.min.x>p.max.x||p.min.y>x.max.y||x.min.y>p.max.y||p.footprint.buildingIds.has(x.buildingId)&&(x.flags|=Vc);else for(const x of this.centroidData)if(!(x.flags&Vc||p.min.x>x.max.x||x.min.x>p.max.x||p.min.y>x.max.y||x.min.y>p.max.y))for(let T=0;T<x.footprintSegLen;T++){const I=this.footprintSegments[x.footprintSegIdx+T];if(f.length=0,yB(this.footprintVertices,I.vertexOffset,I.vertexCount,p.footprintTileId.canonical,e.canonical,f),fb(p.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-_)){x.flags|=Vc;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let c=!1;for(let f=0;f<a.footprintSegLen;f++){const p=this.footprintSegments[a.footprintSegIdx+f];let _=0;for(const x of p.ringIndices){for(let T=_,I=x+_-1;T<x+_;I=T++){const C=this.footprintVertices.int16[2*(T+p.vertexOffset)+0],P=this.footprintVertices.int16[2*(T+p.vertexOffset)+1],D=this.footprintVertices.int16[2*(I+p.vertexOffset)+1];P>n!=D>n&&e<(this.footprintVertices.int16[2*(I+p.vertexOffset)+0]-C)*(n-P)/(D-P)+C&&(c=!c)}_=x}}return c}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0;const f=4*(e+Et)*Et+(n+Et);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Vc)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||p.height<=a||this.footprintContainsPoint(e,n,p)&&(a=p.height,this.partLookup[f]=p,c=!!(p.flags&Vc));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[f]=void 0}}function uC(r,e){const n=r.add(e)._unit();return r.x*n.x+r.y*n.y}function _B(r,e,n,a){const c=e.sub(r)._perp()._unit(),f=n.sub(e)._perp()._unit();return dC(r,e,n,uC(c,f),a)}function dC(r,e,n,a,c){const f=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(n)/3,c*f/a)}function _b(r,e,n){return r.x<n[0].x&&e.x<n[0].x||r.x>n[1].x&&e.x>n[1].x||r.y<n[0].y&&e.y<n[0].y||r.y>n[1].y&&e.y>n[1].y}function hC(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function fC(r,e,n){if(r.x<0||r.x>=Et||e.x<0||e.x>=Et||n.x<0||n.x>=Et)return!1;const a=n.sub(e),c=a.perp(),f=r.sub(e);return(a.x*f.x+a.y*f.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(f.x*f.x+f.y*f.y))>-.866&&c.x*f.x+c.y*f.y<0}function pC(r,e,n){const a=e?2|r:-3&r;return n?1|a:-2&a}function mC(){const r=Math.PI/32,e=Math.tan(r),n=u;return n*Math.sqrt(1+2*e*e)-n}function gC(r,e,n){const a=1<<n.z,c=M(n.x/a),f=M((n.x+1)/a),p=O(n.y/a),_=O((n.y+1)/a);return function(x,T,I,C,P=0,D){const k=[];if(!x.length||!I||!C)return k;const j=(fe,xe)=>{for(const Ie of fe)k.push({polygon:Ie,bounds:xe})},H=Math.ceil(Math.log2(I)),$=Math.ceil(Math.log2(C)),K=H-$,ee=[];for(let fe=0;fe<Math.abs(K);fe++)ee.push(K>0?0:1);for(let fe=0;fe<Math.min(H,$);fe++)ee.push(0),ee.push(1);let se=x;if(se=p0(se,T[0].y-P,T[1].y+P,1),se=p0(se,T[0].x-P,T[1].x+P,0),!se.length)return k;const _e=[];for(ee.length?_e.push({polygons:se,bounds:T,depth:0}):j(se,T);_e.length;){const fe=_e.pop(),xe=fe.depth,Ie=ee[xe],Pe=fe.bounds[0],Xe=fe.bounds[1],ke=Ie===0?Pe.x:Pe.y,Je=Ie===0?Xe.x:Xe.y,rt=D?D(Ie,ke,Je):.5*(ke+Je),ot=p0(fe.polygons,ke-P,rt+P,Ie),ht=p0(fe.polygons,rt-P,Je+P,Ie);if(ot.length){const pt=[Pe,new at(Ie===0?rt:Xe.x,Ie===1?rt:Xe.y)];ee.length>xe+1?_e.push({polygons:ot,bounds:pt,depth:xe+1}):j(ot,pt)}if(ht.length){const pt=[new at(Ie===0?rt:Pe.x,Ie===1?rt:Pe.y),Xe];ee.length>xe+1?_e.push({polygons:ht,bounds:pt,depth:xe+1}):j(ht,pt)}}return k}(r,e,Math.ceil((f-c)/11.25),Math.ceil((p-_)/11.25),1,(x,T,I)=>{if(x===0)return .5*(T+I);{const C=O((n.y+T/Et)/a);return(E(.5*(O((n.y+I/Et)/a)+C))*a-n.y)*Et}})}function yB(r,e,n,a,c,f){const p=Math.pow(2,a.z-c.z);for(let _=0;_<n;_++){let x=r.int16[2*(_+e)+0],T=r.int16[2*(_+e)+1];x=(x+c.x*Et)*p-a.x*Et,T=(T+c.y*Et)*p-a.y*Et,f.push(new at(x,T))}}let _C,yC;jt(v0,"FillExtrusionBucket",{omit:["layers","features"]}),jt(aC,"PartData"),jt(sC,"FootprintSegment"),jt(lC,"BorderCentroidData"),jt(gb,"GroundEffect");class ph extends at{constructor(e,n,a){super(e,n),this.z=a}}class vC extends ph{constructor(e,n,a,c){super(e,n,a),this.w=c}}function xC(r,e,n,a){const c=n==="x"?"y":"x",f=(a-r[n])/(e[n]-r[n]);r[c]=Math.round(r[c]+(e[c]-r[c])*f),r[n]=a,r.hasOwnProperty("z")&&(r.z=fn(r.z,e.z,f)),r.hasOwnProperty("w")&&(r.w=fn(r.w,e.w,f))}function wC(r,e,n,a){const c=n,f=a;for(const p of["x","y"]){let _=r,x=e;_[p]>=x[p]&&(_=e,x=r),_[p]<c&&x[p]>c&&xC(_,x,p,c),_[p]<f&&x[p]>f&&xC(x,_,p,f)}}function x0(r,e,n,a,c,f){const p=[];for(let _=0;_<r.length;_++){const x=r[_];let T;const I=p.length;let C=0;for(let P=0;P<x.length-1;P++){let D=x[P],k=x[P+1],j=0;const H=C;let $,K;f&&(j=Math.hypot(k.x-D.x,k.y-D.y),C+=j,$=D,K=k),D.x<e&&k.x<e||(D.x<e?D=new at(e,D.y+(e-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<e&&(k=new at(e,D.y+(e-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<n&&k.y<n||(D.y<n?D=new at(D.x+(n-D.y)/(k.y-D.y)*(k.x-D.x),n)._round():k.y<n&&(k=new at(D.x+(n-D.y)/(k.y-D.y)*(k.x-D.x),n)._round()),D.x>=a&&k.x>=a||(D.x>=a?D=new at(a,D.y+(a-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=a&&(k=new at(a,D.y+(a-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=c&&k.y>=c||(D.y>=c?D=new at(D.x+(c-D.y)/(k.y-D.y)*(k.x-D.x),c)._round():k.y>=c&&(k=new at(D.x+(c-D.y)/(k.y-D.y)*(k.x-D.x),c)._round()),T&&D.equals(T[T.length-1])||(T=[D],p.push(T),f&&f.push({progress:{min:H+bC($,K,D)*j,max:1},parentIndex:_,prevPoint:$,nextPoint:K})),T.push(k),f&&(f[f.length-1].progress.max=H+bC($,K,k)*j,f[f.length-1].nextPoint=K)))))}if(f&&C>0)for(let P=I;P<p.length;P++)f[P].progress.min/=C,f[P].progress.max/=C}return p}function vB(r,e,n,a,c){if(r.length<2)return void a.push(r);const f=[];for(;e.valid();){const[T,I]=e.get();for(let C=0;C<r.length-1;C++){const P=r[C],D=r[C+1],k=Ln(P,D,T,I);if(k){const[j]=k,H=new at(fn(P.x,D.x,j),fn(P.y,D.y,j));f.push({t:C+j,distance:0,point:H})}}e.next()}if(f.length===0)return void a.push(r);f.sort((T,I)=>T.t-I.t);let p=0,_=0,x=[];for(a.push(x);p!==r.length;){if(_===f.length){for(;p!==r.length;)x.length!==0&&x[x.length-1].equals(r[p])||x.push(r[p]),p++;break}f[_].t<=p?(x.length!==0&&x[x.length-1].equals(f[_].point)||x.push(f[_].point),Math.trunc(f[_].t),_++):(x.length!==0&&x[x.length-1].equals(r[p])||x.push(r[p]),p++)}}function bC(r,e,n){return r.x!==e.x?(n.x-r.x)/(e.x-r.x):r.y!==e.y?(n.y-r.y)/(e.y-r.y):0}function p_(r,e){return r.x*e.x+r.y*e.y}function TC(r,e){if(r.length===1){let n=0;const a=e[n++];let c;for(;!c||a.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const f=e[n],p=r[0],_=c.sub(a),x=f.sub(a),T=p.sub(a),I=p_(_,_),C=p_(_,x),P=p_(x,x),D=p_(T,_),k=p_(T,x),j=I*P-C*C,H=(P*D-C*k)/j,$=(I*k-C*D)/j,K=a.z*(1-H-$)+c.z*H+f.z*$;if(isFinite(K))return K}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}function SC(r,e,n){let a=1/0;di(n,e)&&(a=TC(n,e[0]));for(let c=0;c<e.length;c++){const f=e[c],p=r[c];for(let _=0;_<f.length-1;_++){const x=f[_],T=[x,f[_+1],p[_+1],p[_],x];ri(n,T)&&(a=Math.min(a,TC(n,T)))}}return a!==1/0&&a}function EC(r,e,n,a,c,f,p,_,x,T,I){return r.projection.name==="globe"?function(C,P,D,k,j,H,$,K,ee,se,_e){const fe=[],xe=[],Ie=C.projection.upVectorScale(_e,C.center.lat,C.worldSize).metersToTile,Pe=[0,0,0,1],Xe=[0,0,0,1],ke=(rt,ot,ht,pt)=>{rt[0]=ot,rt[1]=ht,rt[2]=pt,rt[3]=1},Je=mC();D>0&&(D+=Je),k+=Je;for(const rt of P){const ot=[],ht=[];for(const pt of rt){const ct=pt.x+j.x,ut=pt.y+j.y,Qe=C.projection.projectTilePoint(ct,ut,_e),Ye=C.projection.upVector(_e,pt.x,pt.y);let dt=D,It=k;if($){const vt=IC(ct,ut,D,k,$,K,ee,se);dt+=vt.base,It+=vt.top}D!==0?ke(Pe,Qe.x+Ye[0]*Ie*dt,Qe.y+Ye[1]*Ie*dt,Qe.z+Ye[2]*Ie*dt):ke(Pe,Qe.x,Qe.y,Qe.z),ke(Xe,Qe.x+Ye[0]*Ie*It,Qe.y+Ye[1]*Ie*It,Qe.z+Ye[2]*Ie*It),li(Pe,Pe,H),li(Xe,Xe,H),ot.push(new ph(Pe[0],Pe[1],Pe[2])),ht.push(new ph(Xe[0],Xe[1],Xe[2]))}fe.push(ot),xe.push(ht)}return[fe,xe]}(r,e,n,a,c,f,p,_,x,T,I):p?function(C,P,D,k,j,H,$,K,ee){const se=[],_e=[],fe=[0,0,0,1];for(const xe of C){const Ie=[],Pe=[];for(const Xe of xe){const ke=Xe.x+k.x,Je=Xe.y+k.y,rt=IC(ke,Je,P,D,H,$,K,ee);fe[0]=ke,fe[1]=Je,fe[2]=rt.base,fe[3]=1,oo(fe,fe,j),fe[3]=Math.max(fe[3],1e-5);const ot=new ph(fe[0]/fe[3],fe[1]/fe[3],fe[2]/fe[3]);fe[0]=ke,fe[1]=Je,fe[2]=rt.top,fe[3]=1,oo(fe,fe,j),fe[3]=Math.max(fe[3],1e-5);const ht=new ph(fe[0]/fe[3],fe[1]/fe[3],fe[2]/fe[3]);Ie.push(ot),Pe.push(ht)}se.push(Ie),_e.push(Pe)}return[se,_e]}(e,n,a,c,f,p,_,x,T):function(C,P,D,k,j){const H=[],$=[],K=j[8]*P,ee=j[9]*P,se=j[10]*P,_e=j[11]*P,fe=j[8]*D,xe=j[9]*D,Ie=j[10]*D,Pe=j[11]*D;for(const Xe of C){const ke=[],Je=[];for(const rt of Xe){const ot=rt.x+k.x,ht=rt.y+k.y,pt=j[0]*ot+j[4]*ht+j[12],ct=j[1]*ot+j[5]*ht+j[13],ut=j[2]*ot+j[6]*ht+j[14],Qe=j[3]*ot+j[7]*ht+j[15],Ye=pt+K,dt=ct+ee,It=ut+se,vt=Math.max(Qe+_e,1e-5),Jt=pt+fe,Lt=ct+xe,Nt=ut+Ie,Wt=Math.max(Qe+Pe,1e-5);ke.push(new ph(Ye/vt,dt/vt,It/vt)),Je.push(new ph(Jt/Wt,Lt/Wt,Nt/Wt))}H.push(ke),$.push(Je)}return[H,$]}(e,n,a,c,f)}function IC(r,e,n,a,c,f,p,_){const x=p*c.getElevationAt(r,e,!0,!0),T=f[0]!==0,I=T?f[1]===0?p*(f[0]/rC-oC):p*function(C,P,D){const k=Math.floor(P[0]/8),j=Math.floor(P[1]/8),H=10*(P[0]-8*k),$=10*(P[1]-8*j),K=C.getElevationAt(k,j,!0,!0),ee=C.getMeterToDEM(D),se=Math.floor(.5*(H*ee-1)),_e=Math.floor(.5*($*ee-1)),fe=C.tileCoordToPixel(k,j),xe=2*se+1,Ie=2*_e+1,Pe=function(ht,pt,ct,ut,Qe){return[ht.getElevationAtPixel(pt,ct,!0),ht.getElevationAtPixel(pt+Qe,ct,!0),ht.getElevationAtPixel(pt,ct+Qe,!0),ht.getElevationAtPixel(pt+ut,ct+Qe,!0)]}(C,fe.x-se,fe.y-_e,xe,Ie),Xe=Math.abs(Pe[0]-Pe[1]),ke=Math.abs(Pe[2]-Pe[3]),Je=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),rt=Math.min(.25,.5*ee*(Xe+ke)/xe),ot=Math.min(.25,.5*ee*Je/Ie);return K+Math.max(rt*H,ot*$)}(c,f,_):x;return{base:x+(n===0?-1:n),top:T?Math.max(I+a,x+n+2):x+a}}class xB{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class wB{constructor(){this.tasks={},this.taskQueue=[],Oe(["process"],this),this.invoker=new xB(this.process),this.nextId=0}add(e,n){const a=this.nextId++,c=function({type:f,isSymbolTile:p,zoom:_}){return _=_||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-_:f==="maybePrepare"&&p?400-_:500:200-_:100-_}(n);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const f=this.tasks[this.taskQueue[c]];f.priority<n&&(n=f.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class CC{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Oe(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new wB}send(e,n,a,c,f=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[_]=a);const x=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:nl(n,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(n.mustQueue||Qn(self)){const c=this.callbacks[a],f=this.scheduler.add(()=>this.processTask(a,n),c&&c.metadata||{type:"message"});f&&(this.cancelCallbacks[a]=f)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Xl(n.error)):a(null,Xl(n.data)))}else{const a=new Set,c=n.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?nl(p):null,data:nl(_,a)},a)}:()=>{},f=Xl(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,f,c);else if(this.parent.getWorkerSource){const p=n.type.split("."),{source:_,scope:x}=f;this.parent.getWorkerSource(n.sourceMapId,p[0],_,x)[p[1]](f,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var m_={workerUrl:"",workerClass:null,workerParams:void 0};const yb="mapboxgl_preloaded_worker_pool";class mh{constructor(e){this.active={},this.name=e}acquire(e,n=mh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;){const c=(a=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,m_.workerClass!=null?new m_.workerClass:new self.Worker(m_.workerUrl,Object.assign({name:a},m_.workerParams)));this.workers.push(c)}var a;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yb]}numActive(){return Object.keys(this.active).length}}mh.workerCount=2;class Cp{constructor(e,n,a="Worker",c=mh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=De();const f=this.workerPool.acquire(this.id,c);for(let p=0;p<f.length;p++){const _=new Cp.Actor(f[p],n,this.id);_.name=`${a} ${p}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,a){Ce(this.actors,(c,f)=>{c.send(e,n,f)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let g_,vb;function w0(){return g_||(g_=new mh),g_}Cp.Actor=CC;const xb=4096;class bB{constructor(e){this.module=e,this.memoryStack=this.module.malloc(xb),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>xb?-1:(new Int32Array(this.module.heap32.buffer,n,e.length).set(e),n)}createFloatArray(e){const n=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>xb?-1:(new Float32Array(this.module.heapF32.buffer,n,e.length).set(e),n)}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.normalScale;this.module.setStyle(n[0],n[1],n[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,a){this.module.setFauxFacadeOptions(e?1:0,n?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){this.memoryStackNextFree=this.memoryStack;for(const _ of e){const x=this.createIntArray(_.ringIndices),T=this.createFloatArray(_.coordinates);if(x===-1||T===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(_.id,_.sourceId,_.minHeight,_.height,_.roofType,T,x,_.ringIndices.length-1)}for(const _ of n){let x;x=_.entrances?JSON.parse(_.entrances):[];const T=this.createFloatArray(x),I=this.createFloatArray(_.coordinates);if(T===-1||I===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(_.sourceId,_.crossPerc,_.distanceToRoad,T,x.length,I,_.coordinates.length)}if(!this.module.generateMesh()){const _=this.module.getLastError();return this.readStringBuffer(_)}const a=this.module.getMeshCount(),c=new Array(a);for(let _=0;_<a;_++){const x=this.module.getPositionsPtr(_),T=this.module.getPositionsLength(_),I=new Float32Array(this.module.heapF32.buffer,x,T),C=this.module.getNormalsPtr(_),P=this.module.getNormalsLength(_),D=new Float32Array(this.module.heapF32.buffer,C,P),k=this.module.getAOPtr(_),j=this.module.getAOLength(_),H=new Float32Array(this.module.heapF32.buffer,k,j),$=this.module.getUVPtr(_),K=this.module.getUVLength(_),ee=new Float32Array(this.module.heapF32.buffer,$,K),se=this.module.getFauxFacadePtr(_),_e=this.module.getFauxFacadeLength(_),fe=new Uint8Array(this.module.heapU8.buffer,se,_e),xe=this.module.getIndicesPtr(_),Ie=this.module.getIndicesLength(_),Pe=new Int16Array(this.module.heap16.buffer,xe,Ie),Xe=this.module.getBuildingPart(_);c[_]={positions:I,normals:D,ao:H,uv:ee,isFauxFacade:fe,indices:Pe,buildingPart:Xe}}const f=this.module.getRingCount(),p=[];for(let _=0;_<f;_++){const x=this.module.getRingPtr(_),T=this.module.getRingLength(_),I=new Float32Array(this.module.heapF32.buffer,x,T);p.push(I)}return{meshes:c,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let __,wb,pl,Ap,bb,Pp=null,Mp=null,AC=null,b0=null;function PC(){return Qn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:wb||$n.DRACO_URL}function MC(){if(Qn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ap)return Ap;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ap=WebAssembly.validate(r)?$n.MESHOPT_SIMD_URL:$n.MESHOPT_URL,Ap}function TB(){return b0}const T0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},SB={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},y_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function RC(r,e,n){const a=n.json.bufferViews.length,c=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:c,byteLength:r.byteLength},n.buffers[c]=r}const Tb="KHR_draco_mesh_compression";function EB(r,e){const n=r.extensions&&r.extensions[Tb];if(!n)return;const a=new pl.Decoder,c=zC(e,n.bufferView),f=new pl.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[r.indices],_=T0[p.componentType],x=p.count*_.BYTES_PER_ELEMENT,T=pl._malloc(x);_===Uint16Array?a.GetTrianglesUInt16Array(f,x,T):a.GetTrianglesUInt32Array(f,x,T),RC(pl.memory.buffer.slice(T,T+x),p,e),pl._free(T);for(const I of Object.keys(n.attributes)){const C=a.GetAttributeByUniqueId(f,n.attributes[I]),P=e.json.accessors[r.attributes[I]],D=SB[P.componentType],k=P.count*y_[P.type]*T0[P.componentType].BYTES_PER_ELEMENT,j=pl._malloc(k);a.GetAttributeDataArrayForAllPoints(f,C,pl[D],k,j),RC(pl.memory.buffer.slice(j,j+k),P,e),pl._free(j)}a.destroy(),f.destroy(),delete r.extensions[Tb]}const S0="EXT_meshopt_compression";function IB(r,e){if(!r.extensions||!r.extensions[S0])return;const n=r.extensions[S0],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),c=new Uint8Array(n.count*n.byteStride);bb.decodeGltfBuffer(c,n.count,n.byteStride,a,n.mode,n.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=c.buffer,delete r.extensions[S0]}const DC=1179937895,LC=new TextDecoder("utf8");function kC(r,e){return new URL(r,e).href}function CB(r,e,n,a){return fetch(kC(r.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[n]=c})}function zC(r,e){const n=r.json.bufferViews[e];return new Uint8Array(r.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function AB(r,e,n,a){if(r.uri){const c=kC(r.uri,a);return fetch(c).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[n]=f})}if(r.bufferView!==void 0){const c=zC(e,r.bufferView),f=new Blob([c],{type:r.mimeType});return createImageBitmap(f).then(p=>{e.images[n]=p})}}function OC(r,e=0,n){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===DC){const I=new Uint32Array(r,e);let C=2;const P=(I[C++]>>2)-3,D=I[C++]>>2;if(C++,a.json=JSON.parse(LC.decode(I.subarray(C,C+D))),C+=D,C<P){const k=I[C++];C++;const j=e+(C<<2);a.buffers[0]=r.slice(j,j+k)}}else a.json=JSON.parse(LC.decode(new Uint8Array(r,e)));const{buffers:c,images:f,meshes:p,extensionsUsed:_,bufferViews:x}=a.json;let T=Promise.resolve();if(c){const I=[];for(let C=0;C<c.length;C++){const P=c[C];P.uri?I.push(CB(P,a,C,n)):a.buffers[C]||(a.buffers[C]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],C=_&&_.includes(Tb),P=_&&_.includes(S0);if(C&&I.push(function(){if(!pl)return __??(__=function(D){let k,j=null;function H(){k=new Uint8Array(j.buffer)}function $(){throw new Error("Unexpected Draco error.")}const K={a:{a:$,d:function(ee,se,_e){return k.copyWithin(ee,se,se+_e)},c:function(ee){const se=k.length,_e=Math.max(ee>>>0,Math.ceil(1.2*se)),fe=Math.ceil((_e-se)/65536);try{return j.grow(fe),H(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,K):D.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,K))).then(ee=>{const{Rb:se,Qb:_e,P:fe,T:xe,X:Ie,Ja:Pe,La:Xe,Qa:ke,Va:Je,Wa:rt,eb:ot,jb:ht,f:pt,e:ct,yb:ut,zb:Qe,Ab:Ye,Bb:dt,Db:It,Gb:vt}=ee.instance.exports;j=ct;const Jt=(()=>{let Lt=0,Nt=0,Wt=0,Fn=0;return wt=>{Wt&&(se(Fn),se(Lt),Nt+=Wt,Wt=Lt=0),Lt||(Nt+=128,Lt=_e(Nt));const Zt=wt.length+7&-8;let xn=Lt;Zt>=Nt&&(Wt=Zt,xn=Fn=_e(Zt));for(let Hn=0;Hn<wt.length;Hn++)k[xn+Hn]=wt[Hn];return xn}})();return H(),pt(),{memory:ct,_free:se,_malloc:_e,Mesh:class{constructor(){this.ptr=fe()}destroy(){xe(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){ht(this.ptr)}DecodeArrayToMesh(Lt,Nt,Wt){const Fn=Jt(Lt),wt=Xe(this.ptr,Fn,Nt,Wt.ptr);return!!Ie(wt)}GetAttributeByUniqueId(Lt,Nt){return{ptr:ke(this.ptr,Lt.ptr,Nt)}}GetTrianglesUInt16Array(Lt,Nt,Wt){Je(this.ptr,Lt.ptr,Nt,Wt)}GetTrianglesUInt32Array(Lt,Nt,Wt){rt(this.ptr,Lt.ptr,Nt,Wt)}GetAttributeDataArrayForAllPoints(Lt,Nt,Wt,Fn,wt){ot(this.ptr,Lt.ptr,Nt.ptr,Wt,Fn,wt)}},DT_INT8:ut(),DT_UINT8:Qe(),DT_INT16:Ye(),DT_UINT16:dt(),DT_UINT32:It(),DT_FLOAT32:vt()}})}(fetch(PC())),__.then(D=>{pl=D,__=void 0}))}()),P&&I.push(function(){if(bb)return;const D=function(k){let j;const H=WebAssembly.instantiateStreaming(k,{}).then(ee=>{j=ee.instance,j.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},K={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:H,supported:!0,decodeGltfBuffer(ee,se,_e,fe,xe,Ie){(function(Pe,Xe,ke,Je,rt,ot,ht){const pt=Pe.exports.sbrk,ct=Je+3&-4,ut=pt(ct*rt),Qe=pt(ot.length),Ye=new Uint8Array(Pe.exports.memory.buffer);Ye.set(ot,Qe);const dt=Xe(ut,Je,rt,Qe,ot.length);if(dt===0&&ht&&ht(ut,ct,rt),ke.set(Ye.subarray(ut,ut+Je*rt)),pt(ut-pt(0)),dt!==0)throw new Error(`Malformed buffer data: ${dt}`)})(j,j.exports[K[xe]],ee,se,_e,fe,j.exports[$[Ie]])}}}(fetch(MC()));return D.ready.then(()=>{bb=D})}()),f)for(let D=0;D<f.length;D++)I.push(AB(f[D],a,D,n));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(C&&p)for(const{primitives:D}of p)for(const k of D)EB(k,a);if(P&&p&&x)for(const D of x)IB(D,a);return a})})}function FC(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>OC(e,0,r))}function Sb(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Eb(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ib{constructor(e,n,a,c){this.context=e,this.format=a,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:c&&c.premultiply})}update(e,n){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:p}=f,{x:_,y:x}=n&&n.position?n.position:{x:0,y:0},T=_+a,I=x+c;!this.size||this.size[0]===T&&this.size[1]===I||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!n||n.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;p.texStorage2D(p.TEXTURE_2D,P,this.format,T,I),this.size=[T,I]}this.size&&(C?p.texSubImage2D(p.TEXTURE_2D,0,_,x,Sb(this.format),Eb(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,_,x,a,c,Sb(this.format),Eb(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,n,a=!1){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,c,f){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),n!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?e===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,c),this.wrapT=c),f!==this.compareMode&&(f?(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_FUNC,f)):_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_MODE,_.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class v_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}}const PB=jn([{name:"a_pos_3f",components:3,type:"Float32"}]),MB=jn([{name:"a_color_3f",components:3,type:"Float32"}]),RB=jn([{name:"a_color_4f",components:4,type:"Float32"}]),DB=jn([{name:"a_uv_2f",components:2,type:"Float32"}]),LB=jn([{name:"a_normal_3f",components:3,type:"Float32"}]),kB=jn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),zB=jn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function NC(r,e){const n=E0(r.projection,r.zoom,r.width,r.height),a=function(f,p,_,x,T){const I=new s(_.lng-180*Bu,_.lat),C=new s(_.lng+180*Bu,_.lat),P=f.project(I.lng,I.lat),D=f.project(C.lng,C.lat),k=-Math.atan2(D.y-P.y,D.x-P.x),j=ne.fromLngLat(_);j.y=W(j.y,-1+Bu,1-Bu);const H=j.toLngLat(),$=f.project(H.lng,H.lat),K=ne.fromLngLat(H);K.x+=Bu;const ee=K.toLngLat(),se=f.project(ee.lng,ee.lat),_e=jC(se.x-$.x,se.y-$.y,k),fe=ne.fromLngLat(H);fe.y+=Bu;const xe=fe.toLngLat(),Ie=f.project(xe.lng,xe.lat),Pe=jC(Ie.x-$.x,Ie.y-$.y,k),Xe=Math.abs(_e.x)/Math.abs(Pe.y),ke=le([]);Te(ke,ke,-k*(1-(T?0:x)));const Je=le([]);return Me(Je,Je,[1,1-(1-Xe)*x,1]),Je[4]=-Pe.x/Pe.y*x,Te(Je,Je,k),oe(Je,ke,Je),Je}(r.projection,0,r.center,n,e),c=BC(r);return Me(a,a,[c,c,1]),a}function BC(r){const e=r.projection,n=E0(r.projection,r.zoom,r.width,r.height),a=Cb(e,r.center),c=Cb(e,s.convert(e.center));return Math.pow(2,a*n+(1-n)*c)}function E0(r,e,n,a,c=1/0){const f=r.range;if(!f)return 0;const p=Math.min(c,Math.max(n,a)),_=Math.log2(p/1024);return Q(f[0]+_,f[1]+_,e)}const Bu=1/4e4;function Cb(r,e){const n=W(e.lat,-F,F),a=new s(e.lng-180*Bu,n),c=new s(e.lng+180*Bu,n),f=r.project(a.lng,n),p=r.project(c.lng,n),_=ne.fromLngLat(a),x=ne.fromLngLat(c),T=p.x-f.x,I=p.y-f.y,C=x.x-_.x,P=x.y-_.y,D=Math.sqrt((C*C+P*P)/(T*T+I*I));return Math.log2(D)}function jC(r,e,n){const a=Math.cos(n),c=Math.sin(n);return{x:r*a-e*c,y:r*c+e*a}}function UC(r,e,n){le(r),Te(r,r,Bn(e[2])),Ne(r,r,Bn(e[0])),je(r,r,Bn(e[1])),Me(r,r,n),oe(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function I0(r,e,n,a,c,f,p,_){const x=[n[0]-e[0],n[1]-e[1],0],T=[a[0]-e[0],a[1]-e[1],0];if(Tt(x)<1e-12||Tt(T)<1e-12)return fo(r);const I=An([],x,T);_n(I,I),He(T,a,e),x[2]=(f-c)*_,T[2]=(p-c)*_;const C=x;return An(C,x,T),_n(C,C),Ta(r,I,C)}function C0(r,e,n=!1){const a=Fu(e.zoom),c=function(f,p,_){const x=p.worldSize,T=[f[12],f[13],f[14]],I=O(T[1]/x),C=M(T[0]/x),P=le([]),D=A(1,I)*x,k=A(1,0)*x*U(I,p.zoom),j=1/nb(x);let H=k*j;if(_){const se=E0(p.projection,p.zoom,p.width,p.height,1024);H=j*p.projection.pixelSpaceConversion(p.center.lat,x,se)}const $=ku(I,C);ze($,$,Kt([],_n([],$),D*H*T[2]));const K=function(se){const _e=[se[0],se[1],se[2]];let fe=[0,1,0];const xe=An([],fe,_e);return An(fe,_e,xe),nn(fe)===0&&(fe=[0,1,0],An(xe,_e,fe)),_n(xe,xe),_n(fe,fe),_n(_e,_e),[xe[0],xe[1],xe[2],0,fe[0],fe[1],fe[2],0,_e[0],_e[1],_e[2],0,se[0],se[1],se[2],1]}($);Me(P,P,[H,H,H*D]),ue(P,P,[-T[0],-T[1],-T[2]]);const ee=oe([],p.globeMatrix,K);return oe(ee,ee,P),oe(ee,ee,f),ee}(r,e,n);if(a>0){const f=function(p,_){const x=_.worldSize,T=A(1,0)*x*U(_.center.lat,_.zoom)/nb(x),I=A(1,_.center.lat)*x,C=le([]);je(C,C,Bn(_.center.lng)),Ne(C,C,Bn(_.center.lat)),ue(C,C,[0,0,Eo]),Me(C,C,[T,T,T*I]);const P=_.point;return ue(C,C,[-P.x,-P.y,0]),oe(C,C,p),oe(C,_.globeMatrix,C)}(r,e);return function(p,_,x){const T=(k,j,H)=>{const $=Tt(k),K=Tt(j),ee=fl(k,j,H);return Kt(ee,ee,1/Tt(ee)*fn($,K,H))},I=T([p[0],p[1],p[2]],[_[0],_[1],_[2]],x),C=T([p[4],p[5],p[6]],[_[4],_[5],_[6]],x),P=T([p[8],p[9],p[10]],[_[8],_[9],_[10]],x),D=fl([p[12],p[13],p[14]],[_[12],_[13],_[14]],x);return[I[0],I[1],I[2],0,C[0],C[1],C[2],0,P[0],P[1],P[2],0,D[0],D[1],D[2],1]}(c,f,a)}return c}function Ab(r,e,n,a){const c=Yt.projectAabbCorners(a,n);let f=Number.MAX_VALUE;for(let _=0;_<c.length;++_){const x=c[_];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<f&&(f=x[2])}const p=function(_){const x=[];let T=0;for(let D=1;D<_.length;D++)(_[D][0]<_[T][0]||_[D][0]===_[T][0]&&_[D][1]<_[T][1])&&(T=D);let I,C=T;const P=new Uint8Array(_.length);do{if(P[C])break;x.push(new at(_[C][0],_[C][1])),P[C]=1,I=(C+1)%_.length;for(let D=0;D<_.length;D++){if(_[D][0]===_[I][0]&&_[D][1]===_[I][1]||_[D][0]===_[C][0]&&_[D][1]===_[C][1])continue;const k=[_[D][0]-_[C][0],_[D][1]-_[C][1]],j=[_[I][0]-_[C][0],_[I][1]-_[C][1]],H=k[0]*j[1]-k[1]*j[0];(H>0||H===0&&k[0]*j[0]+k[1]*j[1]>=0&&k[0]*k[0]+k[1]*k[1]>j[0]*j[0]+j[1]*j[1])&&(I=D)}C=I}while(C!==T);return x.length>0&&x.push(x[0]),x}(c);if(ri(r,p))return f}const gh=64,Rp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function A0(r,e,n,a,c,f,p,_,x,T=!1){const I=n.zoom,C=n.project(a),P=U(a.lat,I),D=1/P;le(r),ue(r,r,[C.x+p[0]*D,C.y+p[1]*D,p[2]]);let k=1,j=1;const H=n.worldSize;if(T){if(n.projection.name==="mercator"){let se=0;n.elevation&&(se=n.elevation.getAtPointOrZero(new ne(C.x/H,C.y/H),0));const _e=oo([],[C.x,C.y,se,1],n.projMatrix)[3]/n.cameraToCenterDistance;k=_e,j=_e*U(n.center.lat,I)}else if(n.projection.name==="globe"){const se=C0(r,n),_e=[0,0,0,1];oo(_e,_e,oe([],n.projMatrix,se));const fe=_e[3]/n.cameraToCenterDistance,xe=Fu(I),Ie=n.projection.pixelsPerMeter(a.lat,H)*U(a.lat,I),Pe=n.projection.pixelsPerMeter(n.center.lat,H)*U(n.center.lat,I);k=fe/fn(Ie,V(n.center.lat),xe),j=fe*P/Ie,k*=Pe,j*=Pe}}else k=D;Me(r,r,[k,k,j]);const $=[...r],K=e.orientation,ee=[];if(UC(ee,[K[0]+(c?c[0]:0),K[1]+(c?c[1]:0),K[2]+(c?c[2]:0)],f),oe(r,$,ee),_&&n.elevation){let se=0;const _e=[];if(x&&n.elevation){se=function(xe,Ie,Pe,Xe,ke){const Je=Ie.elevation;if(!Je)return 0;const rt=Yt.projectAabbCorners(Pe,Xe),ot=A(1,ke.lat)*Ie.worldSize,ht=function(Nt,Wt){const Fn=[0,0,1],wt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Zt of wt){const xn=Nt[Zt.corners[0]],Hn=Nt[Zt.corners[1]],qn=Nt[Zt.corners[2]],Cn=[Hn[0]-xn[0],Hn[1]-xn[1],Wt*(Hn[2]-xn[2])],Ei=An(Cn,Cn,[qn[0]-xn[0],qn[1]-xn[1],Wt*(qn[2]-xn[2])]);_n(Ei,Ei),Zt.dotProductWithUp=En(Ei,Fn)}return wt.sort((Zt,xn)=>Zt.dotProductWithUp-xn.dotProductWithUp),wt[0].corners}(rt,ot),pt=rt[ht[0]],ct=rt[ht[1]],ut=rt[ht[2]],Qe=rt[ht[3]],Ye=Je.getAtPointOrZero(new ne(pt[0]/Ie.worldSize,pt[1]/Ie.worldSize),0),dt=Je.getAtPointOrZero(new ne(ct[0]/Ie.worldSize,ct[1]/Ie.worldSize),0),It=Je.getAtPointOrZero(new ne(ut[0]/Ie.worldSize,ut[1]/Ie.worldSize),0),vt=Je.getAtPointOrZero(new ne(Qe[0]/Ie.worldSize,Qe[1]/Ie.worldSize),0),Jt=(Ye+vt)/2,Lt=(dt+It)/2;return Jt>Lt?dt<It?I0(xe,ct,Qe,pt,dt,vt,Ye,ot):I0(xe,ut,pt,Qe,It,Ye,vt,ot):Ye<vt?I0(xe,pt,ct,ut,Ye,dt,It,ot):I0(xe,Qe,ut,ct,vt,It,dt,ot),Math.max(Jt,Lt)}(_e,n,e.aabb,r,a);const fe=oe([],cn([],_e),ee);oe(r,$,fe)}else se=n.elevation.getAtPointOrZero(new ne(C.x/H,C.y/H),0);se!==0&&(r[14]+=se)}}class VC{constructor(e,n,a,c,f){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=a!=null?new s(a[0],a[1]):new s(0,0),this.orientation=c??[0,0,0],this.nodes=f,this.uploaded=!1,this.aabb=new Yt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){oe(e.globalMatrix,n,e.localMatrix);const a=this.nodeOverrides.get(e.name);if(a!==void 0){const p=[];f=a.orientation,le(c=p),je(c,c,Bn(f[1])),Te(c,c,Bn(f[2])),Ne(c,c,Bn(f[0])),oe(e.globalMatrix,e.globalMatrix,p)}var c,f;if(e.meshes)for(const p of e.meshes){const _=Yt.applyTransformFast(p.aabb,e.globalMatrix);this.aabb.encapsulate(_)}if(e.children)for(const p of e.children)this._applyTransformations(p,e.globalMatrix)}computeBoundsAndApplyParent(){const e=le([]);this.aabb=new Yt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,a,c,f,p,_=!1){A0(this.matrix,this,e.transform,this.position,n,a,c,f,p,_)}upload(e){if(!this.uploaded){for(const n of this.nodes)Pb(n,e);for(const n of this.nodes)P0(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)Mb(e)}}function x_(r,e,n=!1){r.uploaded||(r.gfxTexture=new Ib(e,r.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function OB(r,e,n){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,PB.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,LB.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,DB.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?MB:RB).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,zB.members,!0)),r.segments=er.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&x_(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&x_(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&x_(a.normalTexture,e),a.occlusionTexture&&x_(a.occlusionTexture,e,n),a.emissionTexture&&x_(a.emissionTexture,e)}function Pb(r,e,n){if(r.meshes)for(const a of r.meshes)OB(a,e,n);if(r.children)for(const a of r.children)Pb(a,e,n)}function P0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)P0(e)}function Mb(r){if(r.meshes)for(const n of r.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const n of r.children)Mb(n)}function _h(r,e){const n=r.json.bufferViews[e.bufferView],a=T0[e.componentType];return new a(r.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==y_[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:y_[e.type]))}function Rb(r,e,n,a){const c=T0[e.componentType],f=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),p=r.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:y_[e.type],x=n.float32,T=x.length/n.capacity;for(let I=0,C=0;I<e.count*_;I+=_,C+=T)for(let P=0;P<T;P++)x[C+P]=a[I+P]*f;n._trim()}function FB(r,e,n){const a=r.indices,c=r.attributes,f={};f.indexArray=new kr;const p=e.json.accessors[a],_=p.count/3;f.indexArray.reserve(_);const x=_h(e,p);for(let P=0;P<_;P++)f.indexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);f.indexArray._trim(),f.vertexArray=new ys;const T=e.json.accessors[c.POSITION];f.vertexArray.reserve(T.count);const I=_h(e,T);for(let P=0;P<T.count;P++)f.vertexArray.emplaceBack(I[3*P],I[3*P+1],I[3*P+2]);if(f.vertexArray._trim(),f.aabb=new Yt(T.min,T.max),f.centroid=function(P,D){const k=[0,0,0],j=P.length;if(j>0){for(let H=0;H<j;H++){const $=3*P[H];k[0]+=D[$],k[1]+=D[$+1],k[2]+=D[$+2]}k[0]/=j,k[1]/=j,k[2]/=j}return k}(x,I),c.COLOR_0!==void 0){const P=e.json.accessors[c.COLOR_0],D=y_[P.type],k=_h(e,P);f.colorArray=D===3?new ys:new Kl,f.colorArray.resize(P.count),Rb(e,P,f.colorArray,k)}if(c.NORMAL!==void 0){f.normalArray=new ys;const P=e.json.accessors[c.NORMAL];f.normalArray.resize(P.count);const D=_h(e,P);Rb(e,P,f.normalArray,D)}if(c.TEXCOORD_0!==void 0&&n.length>0){f.texcoordArray=new Oa;const P=e.json.accessors[c.TEXCOORD_0];f.texcoordArray.resize(P.count);const D=_h(e,P);Rb(e,P,f.texcoordArray,D)}if(c._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=_h(e,P))}c._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(_h(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const C=r.material;return f.material=function(P,D){const{emissiveFactor:k=[0,0,0],alphaMode:j="OPAQUE",alphaCutoff:H=.5,normalTexture:$,occlusionTexture:K,emissiveTexture:ee,doubleSided:se,name:_e}=P,{baseColorFactor:fe=[1,1,1,1],metallicFactor:xe=1,roughnessFactor:Ie=1,baseColorTexture:Pe,metallicRoughnessTexture:Xe}=P.pbrMetallicRoughness||{},ke=K?D[K.index]:void 0;if(K&&K.extensions&&K.extensions.KHR_texture_transform&&ke){const Je=K.extensions.KHR_texture_transform;ke.offsetScale=[Je.offset[0],Je.offset[1],Je.scale[0],Je.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new vi(...fe),metallicFactor:xe,roughnessFactor:Ie,baseColorTexture:Pe?D[Pe.index]:void 0,metallicRoughnessTexture:Xe?D[Xe.index]:void 0},doubleSided:se,emissiveFactor:new vi(...k),alphaMode:j,alphaCutoff:H,normalTexture:$?D[$.index]:void 0,occlusionTexture:ke,emissionTexture:ee?D[ee.index]:void 0,defined:P.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},n),f}function $C(r,e,n){const{matrix:a,rotation:c,translation:f,scale:p,mesh:_,extras:x,children:T,name:I}=r,C={};if(C.name=I,C.localMatrix=a||function(P,D,k,j){var H=D[0],$=D[1],K=D[2],ee=D[3],se=H+H,_e=$+$,fe=K+K,xe=H*se,Ie=H*_e,Pe=H*fe,Xe=$*_e,ke=$*fe,Je=K*fe,rt=ee*se,ot=ee*_e,ht=ee*fe,pt=j[0],ct=j[1],ut=j[2];return P[0]=(1-(Xe+Je))*pt,P[1]=(Ie+ht)*pt,P[2]=(Pe-ot)*pt,P[3]=0,P[4]=(Ie-ht)*ct,P[5]=(1-(xe+Je))*ct,P[6]=(ke+rt)*ct,P[7]=0,P[8]=(Pe+ot)*ut,P[9]=(ke-rt)*ut,P[10]=(1-(xe+Xe))*ut,P[11]=0,P[12]=k[0],P[13]=k[1],P[14]=k[2],P[15]=1,P}([],c||[0,0,0,1],f||[0,0,0],p||[1,1,1]),C.globalMatrix=te(C.localMatrix),_!==void 0){C.meshes=n[_];const P=C.anchor=[0,0];for(const D of C.meshes){const{min:k,max:j}=D.aabb;P[0]+=k[0]+j[0],P[1]+=k[1]+j[1]}P[0]=Math.floor(P[0]/C.meshes.length/2),P[1]=Math.floor(P[1]/C.meshes.length/2)}if(x&&(x.id&&(C.id=x.id),x.lights&&(C.lights=function(P){if(!P.length)return[];const D=function(K){const ee=atob(K),se=new Uint8Array(ee.length);for(let _e=0;_e<ee.length;_e++)se[_e]=ee.codePointAt(_e);return se}(P),k=[],j=D.length/24,H=new Uint16Array(D.buffer),$=new Float32Array(D.buffer);for(let K=0;K<j;K++){const ee=H[2*K*6]/30,se=H[2*K*6+1]/30,_e=H[2*K*6+10]/100,fe=$[6*K+1],xe=$[6*K+2],Ie=$[6*K+3],Pe=$[6*K+4],Xe=Ie-fe,ke=Pe-xe,Je=Math.hypot(Xe,ke);k.push({pos:[fe+.5*Xe,xe+.5*ke,se],normal:[ke/Je,-Xe/Je,0],width:Je,height:ee,depth:_e,points:[fe,xe,Ie,Pe]})}return k}(x.lights)),x.MAPBOX_geometry_bloom&&(C.isGeometryBloom=x.MAPBOX_geometry_bloom)),T){const P=[];for(const D of T)P.push($C(e.json.nodes[D],e,n));C.children=P}return C}function NB(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new m0(r.vertices,r.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:n,max:a}}function BB(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const a=[];for(const p of n){if(!Array.isArray(p)||p.length!==2)continue;const _=p[0],x=p[1];typeof _=="number"&&typeof x=="number"&&a.push(new at(_,x))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let p=0;p<a.length;p++){const _=a[p],x=a[(p+1)%a.length],T=a[(p+2)%a.length];c+=(_.x-x.x)*(T.y-x.y)-(T.x-x.x)*(_.y-x.y)}c>0&&a.reverse();const f=Ep(a.flatMap(p=>[p.x,p.y]),[]);return f.length===0?null:{vertices:a,indices:f}}function jB(r,e){const n=[],a=[];let c=0;const f=[];for(const p of r){c=n.length;const _=p.vertexArray.float32,x=p.indexArray.uint16;for(let T=0;T<p.vertexArray.length;T++)f[0]=_[3*T+0],f[1]=_[3*T+1],f[2]=_[3*T+2],li(f,f,e),n.push(new at(f[0],f[1]));for(let T=0;T<3*p.indexArray.length;T++)a.push(x[T]+c)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){const _=n[a[p+0]],x=n[a[p+1]],T=n[a[p+2]];(_.x-x.x)*(T.y-x.y)-(T.x-x.x)*(_.y-x.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function Db(r){const e=function(x,T){const I=[],C=WebGL2RenderingContext;if(x.json.textures)for(const P of x.json.textures){const D={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};P.sampler!==void 0&&Object.assign(D,x.json.samplers[P.sampler]),I.push({image:T[P.source],sampler:D,uploaded:!1})}return I}(r,r.images),n=function(x,T){const I=[];for(const C of x.json.meshes){const P=[];for(const D of C.primitives)P.push(FB(D,x,T));I.push(P)}return I}(r,e),{scenes:a,scene:c,nodes:f}=r.json,p=a?a[c||0].nodes:[...f.keys()],_=[];for(const x of p)_.push($C(f[x],r,n));return function(x,T,I){const C={},P=new Set;for(let D=0;D<x.length;D++){const k=I[T[D]];if(!k.extras)continue;const j=k.extras["mapbox:footprint:version"],H=k.extras["mapbox:footprint:id"];(j||H)&&P.add(D),j==="1.0.0"&&H&&(C[H]=D)}for(let D=0;D<x.length;D++){if(P.has(D))continue;const k=x[D],j=I[T[D]];if(!j.extras)continue;let H=null;k.id in C&&(H=jB(x[C[k.id]].meshes,k.localMatrix)),H||(H=BB(j)),H&&(k.footprint=NB(H))}if(P.size>0){const D=Array.from(P.values()).sort((k,j)=>k-j);for(let k=D.length-1;k>=0;k--)x.splice(D[k],1)}}(_,p,r.json.nodes),_}function UB(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,n=r.aabb.min[0]-1,a=r.aabb.min[1]-1,c=gh/(r.aabb.max[0]-n+2),f=gh/(r.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const _=e[p+2],x=(e[p+0]-n)*c|0,T=(e[p+1]-a)*f|0;_>r.heightmap[T*gh+x]&&(r.heightmap[T*gh+x]=_)}}function GC(r,e,n,a,c){n.reserve(n.length+4*r.length),a.reserve(a.length+10*r.length),c.reserve(c.length+10*r.length);let f=a.length;for(const p of r){const _=Math.min(10,Math.max(4,1.3*p.height))*e,x=[-p.normal[1],p.normal[0],0],T=Math.min(.29,.1*p.width/p.depth),I=p.width-2*p.depth*e*(T+.01),C=mn([],p.pos,x,I/2),P=mn([],p.pos,x,-I/2),D=[C[0],C[1],C[2]+p.height],k=[P[0],P[1],P[2]+p.height],j=mn([],p.normal,x,T);Kt(j,j,_);const H=mn([],p.normal,x,-T);Kt(H,H,_),ze(j,C,j),ze(H,P,H),C[2]+=.1,P[2]+=.1,a.emplaceBack(j[0],j[1],j[2]),a.emplaceBack(H[0],H[1],H[2]),a.emplaceBack(C[0],C[1],C[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(C[0],C[1],C[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(j[0],j[1],j[2]),a.emplaceBack(H[0],H[1],H[2]);const $=I/_/2;c.emplaceBack(-$-T,-1,$,.8),c.emplaceBack($+T,-1,$,.8),c.emplaceBack(-$,0,$,1.3),c.emplaceBack($,0,$,1.3),c.emplaceBack($+T,-.8,$,.7),c.emplaceBack($+T,-.8,$,.7),c.emplaceBack(0,0,$,1.3),c.emplaceBack(0,0,$,1.3),c.emplaceBack($+T,-1.2,$,.8),c.emplaceBack($+T,-1.2,$,.8),n.emplaceBack(6+f,4+f,8+f),n.emplaceBack(7+f,9+f,5+f),n.emplaceBack(0+f,1+f,2+f),n.emplaceBack(1+f,3+f,2+f),f+=10}}function VB(r,e){const n={};n.indexArray=new kr,n.vertexArray=new ys,n.colorArray=new Kl,GC(r,e,n.indexArray,n.vertexArray,n.colorArray);const a={defined:!0};a.emissiveFactor=vi.black;const c={};return c.baseColorFactor=vi.white,a.pbrMetallicRoughness=c,n.material=a,n.aabb=new Yt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const HC=jn([{name:"a_pos_3f",components:3,type:"Float32"}]),$B=jn([{name:"a_normal_3",components:3,type:"Int16"}]),GB=jn([{name:"a_centroid_3",components:3,type:"Int16"}]),WC=jn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),HB=jn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),WB=jn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),qB=jn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),ZB=jn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),XB=jn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),qC=Re.types,M0=32767;function YB(r,e){const n=Et+e;for(const a of r)for(const c of a)if(c.x<-e||c.x>n||c.y<-e||c.y>n)return!1;return!0}function KB(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class Lb{constructor(){this.layoutVertexArray=new ys,this.layoutAttenuationArray=new Kl,this.layoutColorArray=new vs,this.indexArray=new kr,this.indexArrayForConflation=new kr,this.segmentsBucket=new er}}class kb{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new er,this.entranceBloom=new Lb;const n=66560;this.layoutVertexArray=new ys,this.layoutVertexArray.reserve(n),this.layoutNormalArray=new Au,this.layoutNormalArray.reserve(n),this.layoutCentroidArray=new Au,this.layoutCentroidArray.reserve(n),this.layoutColorArray=new vs,this.layoutColorArray.reserve(n),this.layoutFloodLightDataArray=new Ql,this.layoutFloodLightDataArray.reserve(n),this.layoutAOArray=new fp,this.layoutAOArray.reserve(n),this.indexArray=new kr,this.indexArray.reserve(66560),this.indexArrayForConflation=new kr,this.segmentsBucket=new er,this.entranceBloom=new Lb,e&&(this.layoutFacadePaintArray=new vs,this.layoutFacadeDataArray=new Nc,this.layoutFacadeVerticalRangeArray=new vs)}reserve(e,n,a){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(n),a&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class ZC{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Oa,this.footprintsIndices=new Ql,this.footprintsMin=new at(1/0,1/0),this.footprintsMax=new at(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new kb(!1),this.buildingWithFacade=new kb(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.groundEffect=new gb(e),this.groundEffect.groundRadiusArray=new sl,this.hasAppearances=null}updateFootprints(e,n){const a=new m0([],[],1),c={vertices:[],indices:new Uint32Array(0),grid:a,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};n.push({footprint:c,id:e})}updateAppearances(e,n,a,c){}prepare(){return function(){if(b0!=null||AC!=null)return null;if(Mp!=null)return Mp;const e=fetch($n.BUILDING_GEN_URL);return Mp=function(n){let a,c,f,p,_;function x(){a=new Uint8Array(_.buffer),c=new Int16Array(_.buffer),f=new Int32Array(_.buffer),p=new Float32Array(_.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const I=()=>{},C={a:{a:T,f:function(P){const D=a.length,k=Math.max(P>>>0,Math.ceil(1.2*D)),j=Math.ceil((k-D)/65536);try{return _.grow(j),x(),!0}catch{return!1}},g:T,b:I,c:I,d:I,e:I}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,C):n.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,C))).then(P=>{const D=P.instance.exports;return(0,D.g)(),_=D.f,x(),new bB({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getOuterRingLength:D.s,getMeshCount:D.t,getPositionsPtr:D.u,getPositionsLength:D.v,getNormalsPtr:D.w,getNormalsLength:D.x,getAOPtr:D.y,getAOLength:D.z,getUVPtr:D.A,getUVLength:D.B,getFauxFacadePtr:D.C,getFauxFacadeLength:D.D,getIndicesPtr:D.E,getIndicesLength:D.F,getBuildingPart:D.G,getRingCount:D.H,getRingPtr:D.I,getRingLength:D.J,malloc:D.K,free:D.L,heapU8:a,heap16:c,heap32:f,heapF32:p})})}(e).then(n=>(Mp=null,b0=n,b0)).catch(n=>{Ot("Could not load building-gen"),Mp=null,AC=n}),Mp}()}populate(e,n,a,c){const f=TB();if(!f)return;const p=Z(a);this.tileToMeter=p,this.brightness=n.brightness,f.setStyle({normalScale:[1,-1,p],tileToMeters:p}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const _=new Map,x=new Map;let T=0;for(const{feature:$}of e){if(qC[$.type]!=="LineString"){_.set($.id,$.properties.source_id);continue}const K=this.layers[0]._featureFilter.needGeometry;if(K&&!this.layers[0]._featureFilter.filter(new Bi(this.zoom),$,a))continue;const ee=Le($,K);if(!K&&!this.layers[0]._featureFilter.filter(new Bi(this.zoom),ee,a))continue;const se=K?ee.geometry:Se($,a,c),_e=[];for(const Pe of se)for(const Xe of Pe)_e.push(Xe.x),_e.push(Xe.y);const fe={coordinates:_e,crossPerc:$.properties.cross_perc,distanceToRoad:$.properties.distance_to_road,entrances:$.properties.entrances,sourceId:0},xe=$.properties.source_id;let Ie=x.get(xe);Ie||(Ie=[],x.set(xe,Ie)),Ie.push(fe),++T}this.maxHeight=0;const I=new Array,C=new Set,P=$=>{$!=null&&C.add($)},D=($,K)=>{$!=null&&I.push({buildingId:$,footprintIndex:K})},k=64*(e.length-T),j=k/2;this.buildingWithFacade.reserve(k,j,!0),this.buildingWithoutFacade.reserve(2*k,2*j,!1),this.footprintsIndices.reserve(16*(e.length-T)),this.footprintsVertices.reserve(8*(e.length-T));for(const{feature:$,id:K,index:ee,sourceLayerIndex:se}of e){if(qC[$.type]==="LineString")continue;const _e=this.layers[0]._featureFilter.needGeometry;if(_e&&!this.layers[0]._featureFilter.filter(new Bi(this.zoom),$,a))continue;let fe=null;if($.properties&&$.properties.hasOwnProperty("building_id")&&(fe=$.properties.building_id,C.has(fe)))continue;const xe=Le($,_e);if(!_e&&!this.layers[0]._featureFilter.filter(new Bi(this.zoom),xe,a))continue;const Ie=_e?xe.geometry:Se($,a,c),Pe=c_(Ie,500);let Xe=!1;for(const dn of Pe)if(dn.length!==1){Xe=!0;break}if(Xe){P(fe);continue}if(!YB(Ie,163)){P(fe);continue}const ke=this.layers[0],Je=KB(ke.layout.get("building-roof-shape").evaluate($,{},a)),rt=ke.layout.get("building-base").evaluate($,{},a),ot=ke.layout.get("building-height").evaluate($,{},a),ht=ke.layout.get("building-flood-light-ground-radius").evaluate($,{},a),pt=ke.paint.get("building-ambient-occlusion-intensity"),ct=ht/this.tileToMeter;$.properties["building-part"]="roof";const ut=ke.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),Qe=ke.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="wall";const Ye=ke.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),dt=ke.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="window";const It=ke.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=ke.paint.get("building-emissive-strength").evaluate($,{},this.canonical);$.properties["building-part"]="door";const Jt=ke.paint.get("building-color").evaluate($,{},this.canonical).toPremultipliedRenderColor(this.lut),Lt=ke.paint.get("building-emissive-strength").evaluate($,{},this.canonical);let Nt=ke.layout.get("building-flood-light-wall-radius").evaluate($,{},a);Nt=W(Nt,0,2048);const Wt=Nt/2048*M0,Fn=_.get(K),wt=x.get(Fn)||[],Zt=wt.length!==0&&ke.layout.get("building-facade").evaluate($,{},a);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(Zt,!1,1);let xn=0,Hn=0,qn=0,Cn=0,Ei=0,pe=0,ye=0,et=0,ft=0,Mt=0,Rt=0;if(Zt){let dn=Math.round(ke.layout.get("building-facade-floors").evaluate($,{},a));if(rt===0){dn=Math.max(1,dn-(wt.length>0?1:0));let bi=4;if(ot>100){const Xi=[10,13,15];bi=Xi[$.id?$.id%Xi.length:0]}else ot<=10&&(bi=3);f.setFacadeOptions(bi,!0),Ei=(ot<15?1.3:1.61803)*bi/p}else Ei=rt/p;pe=ot/p,Ei=Math.min(Ei,pe),qn=ke.layout.get("building-facade-unit-width").evaluate($,{},a)/p,Cn=(pe-Ei)/dn,f.setFauxFacadeOptions(!0,!0,qn);const ir=ke.layout.get("building-facade-window").evaluate($,{},a);xn=ir[0],Hn=ir[1],ye=Math.floor(65535*Math.min(1,Ei/Et)),et=Math.floor(65535*Math.min(1,pe/Et)),ft=Math.floor(255*xn)<<8|Math.floor(255*Hn),Mt=Math.floor(65535*Math.min(1,qn/Et)),Rt=Math.floor(65535*Math.min(1,Cn/Et))}const en=Array(Pe.length),rn={x:1/0,y:1/0},Sn={x:-1/0,y:-1/0},kn={x:0,y:0};let On=0;for(let dn=0;dn<Pe.length;dn++){const ir=Pe[dn];if(ir.length>0){const bi=[],Xi=Array(ir.length+1);Xi[0]=0;for(let Fr=0;Fr<ir.length;Fr++){const Yr=ir[Fr];for(let Rr=0;Rr<Yr.length;Rr++){const Dr=Yr[Yr.length-Rr-1];rn.x=Math.min(rn.x,Dr.x),rn.y=Math.min(rn.y,Dr.y),Sn.x=Math.max(Sn.x,Dr.x),Sn.y=Math.max(Sn.y,Dr.y),kn.x+=Dr.x,kn.y+=Dr.y,On++,bi.push(Dr.x),bi.push(Dr.y)}Xi[Fr+1]=bi.length}en[dn]={id:$.id?$.id:0,height:ot,minHeight:rt,sourceId:0,roofType:Je,coordinates:bi,ringIndices:Xi}}}kn.x/=On||1,kn.y/=On||1;const Un=f.generateMesh(en,wt);if(typeof Un=="string"){Ot(`Unable to generate building ${$.id}: ${Un}`),P(fe);continue}if(Un.meshes.length===0||Un.modifiedPolygonRings.length===0){P(fe);continue}const hn=Zt?this.buildingWithFacade:this.buildingWithoutFacade;let vn=0;for(const dn of Un.meshes)vn+=dn.positions.length/3;const ti=hn.segmentsBucket.prepareSegment(vn,hn.layoutVertexArray,hn.indexArray),si=[];let ai=null,wi=0,Ri=-1;const Ii=hn.layoutVertexArray.length,ui=Ii+vn;hn.layoutVertexArray.resize(ui),hn.layoutCentroidArray.resize(ui),hn.layoutNormalArray.resize(ui),hn.layoutAOArray.resize(ui),hn.layoutColorArray.resize(ui),hn.layoutFloodLightDataArray.resize(ui),Zt&&(hn.layoutFacadePaintArray.resize(ui),hn.layoutFacadeDataArray.resize(ui),hn.layoutFacadeVerticalRangeArray.resize(ui));const gi=hn.indexArray.length;let zn=0,Wn=Ii;for(const dn of Un.meshes){let ir,bi;if(dn.buildingPart===1)ir=ut,bi=Qe;else if(dn.buildingPart===0)ir=Ye,bi=dt;else if(dn.buildingPart===2)ir=It,bi=vt;else{if(dn.buildingPart!==3)continue;ir=Jt,bi=Lt}if(bi=W(bi,0,1),dn.buildingPart===3){const Ni=new Array;for(let Nr=0;Nr<dn.positions.length;Nr+=12){const ja=dn.positions[Nr+0],ic=dn.positions[Nr+1],_o=dn.positions[Nr+3],Go=dn.positions[Nr+4],Ts=dn.positions[Nr+2],$u=dn.positions[Nr+8]-Ts,Gp=1,vl=_o-ja,xl=Go-ic,G_=Math.hypot(vl,xl);Ni.push({pos:[ja+.5*vl,ic+.5*xl,Ts],normal:[xl/G_,-vl/G_,0],width:G_,height:$u,depth:Gp,points:[ja,ic,_o,Go]})}const _r=hn.entranceBloom.segmentsBucket.prepareSegment(10*Ni.length,hn.entranceBloom.layoutVertexArray,hn.entranceBloom.indexArray),Tr=hn.entranceBloom.layoutVertexArray.length;wi=hn.entranceBloom.indexArray.length,GC(Ni,.5/this.tileToMeter,hn.entranceBloom.indexArray,hn.entranceBloom.layoutVertexArray,hn.entranceBloom.layoutAttenuationArray);const as=hn.entranceBloom.layoutVertexArray.length-Tr;Ri=hn.entranceBloom.indexArray.length-wi;for(let Nr=0;Nr<as;Nr++)hn.entranceBloom.layoutColorArray.emplaceBack(255*Jt.r<<8|255*Jt.g,255*Jt.b<<8|51*Lt);_r.vertexLength+=as,_r.primitiveLength+=Ri,ai={part:dn.buildingPart,vertexOffset:Tr,vertexLength:as}}hn.layoutVertexArray.float32.set(dn.positions,3*Wn);const Xi=dn.positions.length/3;for(let Ni=0;Ni<Xi;++Ni){const _r=3*Ni;zn=Math.max(zn,dn.positions[_r+2]);const Tr=dn.normals[_r+1]*M0,as=dn.normals[_r+2]*M0,Nr=3*(Wn+Ni);hn.layoutNormalArray.int16[Nr]=dn.normals[_r]*M0,hn.layoutNormalArray.int16[Nr+1]=Tr,hn.layoutNormalArray.int16[Nr+2]=as;const ja=dn.ao[Ni];hn.layoutAOArray.uint8[Wn+Ni]=255*ja;const ic=1+(ja-1)*pt,_o=255*ir.b*ic<<8|255*bi;hn.layoutColorArray.uint16[2*(Wn+Ni)]=255*ir.r*ic<<8|255*ir.g*ic,hn.layoutColorArray.uint16[2*(Wn+Ni)+1]=_o}const Fr=Math.floor(kn.x),Yr=Math.floor(kn.y),Rr=Math.floor(ot);for(let Ni=0;Ni<Xi;++Ni){const _r=3*(Wn+Ni);hn.layoutCentroidArray.int16[_r]=Fr,hn.layoutCentroidArray.int16[_r+1]=Yr,hn.layoutCentroidArray.int16[_r+2]=Rr}if(hn.layoutFloodLightDataArray.uint16.fill(dn.buildingPart===0?Wt:0,Wn,Wn+Xi),Zt){const Ni=255*It.r<<8|255*It.g,_r=255*It.b<<8|255*vt;for(let Tr=0;Tr<Xi;++Tr){const as=2*(Wn+Tr);hn.layoutFacadePaintArray.uint16[as]=Ni,hn.layoutFacadePaintArray.uint16[as+1]=_r}for(let Tr=0;Tr<Xi;++Tr)if(dn.isFauxFacade[Tr]){const as=Math.min(65535,Math.floor(dn.uv[2*Tr]*Un.outerRingLength));hn.layoutFacadeDataArray.emplace(Wn+Tr,1|as,ft,Mt,Rt),hn.layoutFacadeVerticalRangeArray.emplace(Wn+Tr,ye,et)}else hn.layoutFacadeDataArray.emplace(Wn+Tr,0,0,0,0),hn.layoutFacadeVerticalRangeArray.emplace(Wn+Tr,0,0)}const Dr=ti.vertexLength,Vr=dn.indices.length/3,es=hn.indexArray.length;hn.indexArray.resize(es+Vr);for(let Ni=0;Ni<Vr;++Ni){const _r=3*Ni,Tr=3*es+_r;hn.indexArray.uint16[Tr]=Dr+dn.indices[_r],hn.indexArray.uint16[Tr+1]=Dr+dn.indices[_r+1],hn.indexArray.uint16[Tr+2]=Dr+dn.indices[_r+2]}dn.buildingPart!==1&&dn.buildingPart!==0&&dn.buildingPart!==2&&dn.buildingPart!==3||si.push({part:dn.buildingPart,vertexOffset:Wn,vertexLength:dn.positions.length/3}),Wn+=Xi,ti.vertexLength+=Xi,ti.primitiveLength+=dn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,zn);const Ki=hn.indexArray.length-gi,un=this.footprintsIndices.length,Vn=this.footprintsVertices.length,Ci=[],ki=new at(1/0,1/0),ji=new at(-1/0,-1/0),br=this.groundEffect.vertexArray.length;for(const dn of Un.modifiedPolygonRings){const ir=[],bi=new at(1/0,1/0),Xi=new at(-1/0,-1/0);for(let Fr=0;Fr<dn.length;Fr+=2){const Yr=dn.length-Fr-2;bi.x=Math.min(bi.x,dn[Yr]),bi.y=Math.min(bi.y,dn[Yr+1]),Xi.x=Math.max(Xi.x,dn[Yr]),Xi.y=Math.max(Xi.y,dn[Yr+1]);const Rr=new at(dn[Yr],dn[Yr+1]);ir.push(Rr),Ci.push(Rr.x,Rr.y),this.footprintsVertices.emplaceBack(Rr.x,Rr.y)}ki.x=Math.min(ki.x,bi.x),ki.y=Math.min(ki.y,bi.y),ji.x=Math.max(ji.x,Xi.x),ji.y=Math.max(ji.y,Xi.y),this.groundEffect.addData(ir,[bi,Xi],ct)}const Fi=this.groundEffect.vertexArray.length-br;this.groundEffect.groundRadiusArray.reserveForAdditional(Fi);for(let dn=0;dn<Fi;dn++)this.groundEffect.groundRadiusArray.emplaceBack(ht);(rn.x<0||Sn.x>Et||rn.y<0||Sn.y>Et)&&this.featuresOnBorder.push({featureId:$.id,footprintIndex:this.footprints.length});{const dn=Ep(Ci,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+dn.length),this.footprintsIndices.uint16.set(dn,un),this.buildingIds.add(fe??$.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,ki.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,ki.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ji.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ji.y);const ir={footprintVertexOffset:Vn,footprintVertexLength:this.footprintsVertices.length-Vn,footprintIndexOffset:un,footprintIndexLength:this.footprintsIndices.length-un,min:ki,max:ji,hiddenFlags:0,indicesOffset:gi,indicesLength:Ki,bloomIndicesOffset:wi,bloomIndicesLength:Ri,groundEffectVertexOffset:br,groundEffectVertexLength:Fi,hasFauxFacade:Zt,height:zn,promoteId:K,feature:xe,parts:si,buildingBloom:ai},bi=this.footprints.length;$.id!==void 0&&this.featureFootprintLookup.set($.id,bi),D(fe,bi),this.footprints.push(ir)}this.programConfigurations.populatePaintArrays(hn.layoutVertexArray.length,$,ee,{},n.availableImages,a,n.brightness),this.groundEffect.addPaintPropertiesData($,ee,{},n.availableImages,a,n.brightness),n.featureIndex.insert($,Ie,ee,se,this.index,Ii)}I.forEach(({buildingId:$,footprintIndex:K})=>{C.has($)&&(this.footprints[K].hiddenFlags|=4)});const H=new Set;this.buildingIds.forEach(($,K,ee)=>{C.has($)||H.add($)}),this.buildingIds=H,this.groundEffect.prepareBorderSegments()}update(e,n,a,c,f,p,_){this.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_),this.groundEffect.update(e,n,f,a,c,p,_),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,HC.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,$B.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,GB.members),a.layoutFloodLightDataBuffer=e.createVertexBuffer(a.layoutFloodLightDataArray,XB.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,WB.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,qB.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,HC.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,ZB.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,a=!0){let c=!1;const f=a?n:0,p=0|(a?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of e){const x=this.footprints[_],T=x.hiddenFlags&p|f;x.hiddenFlags!==T&&(x.hiddenFlags=T,c=!0,this.groundEffect.updateHiddenByLandmarkRange(x.groundEffectVertexOffset,x.groundEffectVertexLength,x.hiddenFlags!==0))}return c&&(this.indexArrayForConflationUploaded=!1),c}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=c=>{c.indexArray.length!==0&&(c.indexArrayForConflation.resize(c.indexArray.length),c.indexArrayForConflation.uint16.set(c.indexArray.uint16),c.entranceBloom.indexArrayForConflation.resize(c.entranceBloom.indexArray.length),c.entranceBloom.indexArrayForConflation.uint16.set(c.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const c of this.footprints){const f=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=c.indicesOffset+c.indicesLength;if(c.hiddenFlags!==0){for(let x=c.indicesOffset;x<p;x++)f.indexArrayForConflation.uint16[3*x+0]=0,f.indexArrayForConflation.uint16[3*x+1]=0,f.indexArrayForConflation.uint16[3*x+2]=0;const _=c.bloomIndicesOffset+c.bloomIndicesLength;for(let x=c.bloomIndicesOffset;x<_;x++)f.entranceBloom.indexArrayForConflation.uint16[3*x+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*x+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*x+2]=0}}const a=c=>{c.indexArray.length!==0&&(c.indexBuffer?c.indexBuffer.updateData(c.indexArrayForConflation):c.indexBuffer=e.createIndexBuffer(c.indexArrayForConflation,!0),c.entranceBloom.indexBuffer?c.entranceBloom.indexBuffer.updateData(c.entranceBloom.indexArrayForConflation):c.entranceBloom.indexBuffer=e.createIndexBuffer(c.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,WC.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,HB.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,WC.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const a=e.paint.get("building-ambient-occlusion-intensity");for(const c of this.footprints){if(4&c.hiddenFlags)continue;const f=n[c.promoteId],p=c.feature;p.properties["building-part"]="roof";const _=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),x=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="wall";const T=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="door";const D=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical),j=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const $ of c.parts){let K,ee=_;$.part===1?(ee=_,K=x):$.part===0?(ee=T,K=I):$.part===2?(ee=C,K=P):$.part===3&&(ee=D,K=k),K=W(K,0,1);for(let se=0;se<$.vertexLength;se++){const _e=$.vertexOffset+se,fe=1+(j.layoutAOArray.uint8[_e]/255-1)*a;j.layoutColorArray.emplace(_e,ee.r*fe*255<<8|ee.g*fe*255,ee.b*fe*255<<8|255*K),c.hasFauxFacade&&j.layoutFacadePaintArray.emplace(_e,255*C.r<<8|255*C.g,255*C.b<<8|255*P)}}const H=c.buildingBloom;if(H)for(let $=0;$<H.vertexLength;$++)j.entranceBloom.layoutColorArray.emplace(H.vertexOffset+$,255*D.r<<8|255*D.g,255*D.b<<8|51*k)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());if(_0(this.activeReplacements,c))return;this.activeReplacements=c;for(const p of this.footprints)p.hiddenFlags&=-2;const f=[];for(const p of this.activeReplacements){if(p.order<=XI)continue;const _=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const x of this.footprints)x.min.x>p.max.x||x.max.x<p.min.x||x.min.y>p.max.y||x.max.y<p.min.y||(f.length=0,JB(this.footprintsVertices,x.footprintVertexOffset,x.footprintVertexLength,p.footprintTileId.canonical,e.canonical,f),fb(p.footprint,f,this.footprintsIndices.uint16,x.footprintIndexOffset,x.footprintIndexLength,0,-_)&&(x.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,c=!0;const f=4*(e+Et)*Et+(n+Et);if(this.footprintLookup.hasOwnProperty(f)){const _=this.footprintLookup[f];return _?{height:_.height,hidden:_.hiddenFlags!==0}:void 0}const p=new at(e,n);for(const _ of this.footprints)e>_.max.x||_.min.x>e||n>_.max.y||_.min.y>n||_.height<=a||QB(p,this.footprintsVertices.float32.subarray(2*_.footprintVertexOffset,2*(_.footprintVertexOffset+_.footprintVertexLength)),this.footprintsIndices.uint16.subarray(_.footprintIndexOffset,_.footprintIndexOffset+_.footprintIndexLength))&&(a=_.height,this.footprintLookup[f]=_,c=_.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.footprintLookup[f]=void 0}}function QB(r,e,n){for(let a=0;a<n.length;a+=3){const c=n[a],f=n[a+1],p=n[a+2],_=e[2*c+0],x=e[2*c+1],T=e[2*f+0],I=e[2*f+1],C=e[2*p+0],P=e[2*p+1],D=(_-C)*(r.y-P)-(x-P)*(r.x-C),k=(T-_)*(r.y-x)-(I-x)*(r.x-_);if(D<0!=k<0&&D!==0&&k!==0)continue;const j=(C-T)*(r.y-I)-(P-I)*(r.x-T);if(j===0||j<0==D+k<=0)return!0}return!1}function JB(r,e,n,a,c,f){const p=Math.pow(2,a.z-c.z);for(let _=0;_<n;_++){let x=r.float32[2*(_+e)+0],T=r.float32[2*(_+e)+1];x=(x+c.x*Et)*p-a.x*Et,T=(T+c.y*Et)*p-a.y*Et,f.push(new at(x,T))}}let XC,YC;jt(ZC,"BuildingBucket",{omit:["layers"]}),jt(kb,"BuildingGeometry"),jt(Lb,"BuildingBloomGeometry");const e5=jn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),t5=jn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:n5}=e5,i5=jn([{name:"a_packed",components:3,type:"Float32"}]),{members:r5}=i5,o5=jn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:s5}=o5;class KC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Nu({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const a=this.getKey(e,n);return this.positions[a]}trim(){const e=this.width,n=this.height=We(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){const c=[];let f=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,_=!0;c.push({left:f,right:p,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let T=1;T<e.length;T++){_=!_;const I=e[T];f=x*a,x+=I,p=x*a,c.push({left:f,right:p,isDash:_,zeroLength:I===0})}return c}addRoundDash(e,n,a){const c=n/2;for(let f=-a;f<=a;f++){const p=this.width*(this.nextRow+a+f);let _=0,x=e[_];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++_]);const I=Math.abs(T-x.left),C=Math.abs(T-x.right),P=Math.min(I,C);let D;const k=f/a*(c+1);if(x.isDash){const j=c-Math.abs(k);D=Math.sqrt(P*P+j*j)}else D=c-Math.sqrt(P*P+k*k);this.image.data[p+T]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,n){for(let x=e.length-1;x>=0;--x){const T=e[x],I=e[x+1];T.zeroLength?e.splice(x,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(x,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const f=this.width*this.nextRow;let p=0,_=e[p];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++p]);const T=Math.abs(x-_.left),I=Math.abs(x-_.right),C=Math.min(T,I);this.image.data[f+x]=Math.max(0,Math.min(255,(_.isDash?C:-C)+n+128))}}addDash(e,n){const a=this.getKey(e,n);if(this.positions[a])return this.positions[a];const c=n==="round",f=c?7:0,p=2*f+1;if(this.nextRow+p>this.height)return Ot("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let I=0;I<e.length;I++)e[I]<0&&(Ot("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),_+=e[I];if(_!==0){const I=this.width/_,C=this.getDashRanges(e,this.width,I);c?this.addRoundDash(C,I,f):this.addRegularDash(C,n==="square"?.5*I:0)}const x=this.nextRow+f;this.nextRow+=p;const T={tl:[x,f],br:[_,0]};return this.positions[a]=T,T}}jt(KC,"LineAtlas");const a5=Re.types,l5=Math.cos(Math.PI/180*37.5),c5=Math.cos(Math.PI/180*5);class zb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new sp,this.layoutVertexArray2=new ys,this.patternVertexArray=new ys,this.indexArray=new kr,this.programConfigurations=new ua(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new er,this.maxLineLength=0,this.zOffsetVertexArray=new ys,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Et/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,a,c){}populate(e,n,a,c){this.hasPattern=ab("line",this.layers,this.pixelRatio,n);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Z(a);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const P=this.layers[0].layout.get("line-z-offset"),D=P.isConstant()&&!P.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&p==="none"&&Ot(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const _=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&_!==void 0;const x=[];for(const{feature:P,id:D,index:k,sourceLayerIndex:j}of e){const H=this.layers[0]._featureFilter.needGeometry,$=Le(P,H);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),$,a))continue;const K=f?f.evaluate($,{},a):void 0,ee={id:D,properties:P.properties,type:P.type,sourceLayerIndex:j,index:k,geometry:H?$.geometry:Se(P,a,c),patterns:{},sortKey:K};x.push(ee)}f&&x.sort((P,D)=>P.sortKey-D.sortKey);const{lineAtlas:T,featureIndex:I}=n,C=this.addConstantDashes(T);for(const P of x){const{geometry:D,index:k,sourceLayerIndex:j}=P;if(C&&this.addFeatureDashes(P,T),this.hasPattern){const H=lb("line",this.layers,P,this.zoom,this.pixelRatio,n);this.patternFeatures.push(H)}else this.addFeature(P,D,k,a,T.positions,n.availableImages,n.brightness,n.elevationFeatures);I.insert(e[k].feature,D,k,j,this.index)}}addConstantDashes(e){let n=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(c.kind!=="constant"||f.kind!=="constant")n=!0;else{const p=f.value,_=c.value;if(!_)continue;e.addDash(_,p)}}return n}addFeatureDashes(e,n){const a=this.zoom;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let _,x;if(f.kind==="constant"){if(_=f.value,!_)continue}else _=f.evaluate({zoom:a},e);x=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(_,x),e.patterns[c.id]=[n.getKey(_,x)]}}update(e,n,a,c,f,p,_,x){this.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,x)}addFeatures(e,n,a,c,f,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,a,c,p,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,r5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,s5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,t5.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let a,c;if(n&&n>0?(a=`mapbox_clip_start_${n}`,c=`mapbox_clip_end_${n}`):(a="mapbox_clip_start",c="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(c))return{start:+e.properties[a],end:+e.properties[c]}}addFeature(e,n,a,c,f,p,_,x){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),C=T.get("line-cap").evaluate(e,{}),P=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const k=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const j=this.layers[0].paint.get("line-width").value;if(j.kind!=="constant"&&j.isLineProgressConstant===!1&&(this.variableWidthValue=j),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,c,x,I,C,P,D)){const[$,K]=this.clipRuntimeLinesToTile(n,1);for(let ee=0;ee<$.length;ee++){const se=$[ee],_e=K[ee],fe={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,se),prevDir:this.computeSegPrevDir(_e,se)};this.addLine(se,e,c,I,C,P,D,fe,k&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(H)}}else for(let H=0;H<n.length;H++)this.addLine(n[H],e,c,I,C,P,D,void 0,k&&H>0?H:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,p,c,_,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return x0(e,-n,-n,Et+n,Et+n)}clipRuntimeLinesToTile(e,n){const a=[];return[x0(e,-n,-n,Et+n,Et+n,a),a]}addElevatedRoadFeature(e,n,a,c,f,p,_,x){const T=[],I=pi.getElevationFeature(e,c);if(I){const C=this.clipLinesToTile(n,1),P=this.prepareElevatedLines(C,I,a);for(const D of P)T.push({geometry:D,elevation:I,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const C of T){const P=this.layoutVertexArray.length;this.addLine(C.geometry,e,a,f,p,_,x);const D=new Si(a,C.elevationTileID);if(C.elevation)for(let k=P;k<this.layoutVertexArray.length;k++){const j=new at(this.layoutVertexArray.int16[6*k]>>1,this.layoutVertexArray.int16[6*k+1]>>1),H=D.pointElevation(j,C.elevation,.05);this.updateHeightRange(H),this.zOffsetVertexArray.emplaceBack(H,0,0)}else this.fillNonElevatedRoadSegment(P)}return!0}prepareElevatedLines(e,n,a){if(n.constantHeight!=null)return e;const c=[],f=1/Z(a);for(const p of e)vB(p,new oi(n,f),0,c);return c}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,a,c,f,p,_,x,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(n,T):this.lineClips;const I=c==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=x&&x.progress.min>0,P=x&&x.progress.max<1;if(this.lineClips){let Pe={min:this.lineClips.start,max:this.lineClips.end},Xe=1;if(x){const rt=this.lineClips.end-this.lineClips.start;Pe=function(ot,ht,pt){return{min:Li(ot.min,ht,pt),max:Li(ot.max,ht,pt)}}(x.progress,{min:0,max:1},Pe),rt>0&&(Xe=(Pe.max-Pe.min)/rt)}const ke=+n.properties.mapbox_clip_feature_len,Je=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(ke)||Number.isNaN(Je)){for(let ot=0;ot<e.length-1;ot++)this.totalDistance+=e[ot].dist(e[ot+1]);const rt=this.totalDistance/(Pe.max-Pe.min);this.totalFeatureLength=Number.isFinite(rt)?rt:0,this.lineClips.start=Pe.min,this.lineClips.end=Pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ke,this.distance=Je*Xe,this.lineClips.start=Pe.min,this.lineClips.end=Pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=a5[n.type]==="Polygon";let k=e.length;for(;k>=2&&e[k-1].equals(e[k-2]);)k--;let j=0;for(;j<k-1&&e[j].equals(e[j+1]);)j++;if(k<(D?3:2))return;c==="bevel"&&(p=1.05);const H=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let $,K,ee,se,_e,fe,xe,Ie;x&&x.prevDir&&(fe=x.prevDir.perp()),x&&x.nextDir&&(xe=x.nextDir.perp()),this.e1=this.e2=-1,D&&($=e[k-2],_e=e[j].sub($)._unit()._perp());for(let Pe=j;Pe<k;Pe++){if(ee=Pe===k-1?D?e[j+1]:void 0:e[Pe+1],ee&&e[Pe].equals(ee))continue;_e&&(se=_e),$&&(K=$),$=e[Pe],Ie=this.evaluateLineProgressFeatures(K?K.dist($):0),_e=ee?ee.sub($)._unit()._perp():se,se=se||_e;const Xe=K&&ee;let ke=Xe?c:D||I?"butt":f;const Je=se.x*_e.x+se.y*_e.y;if(I){const Ye=function(dt){if(dt.patternJoinNone){const It=dt.segmentPoints.length/2,vt=dt.lineSoFar-dt.segmentStart;for(let Jt=0;Jt<It;++Jt){const Lt=dt.segmentPoints[2*Jt+1],Nt=Math.round(dt.segmentPoints[2*Jt])+.5+.25*Lt;dt.patternVertexArray.emplaceBack(Nt,vt,dt.segmentStart),dt.patternVertexArray.emplaceBack(Nt,vt,dt.segmentStart)}dt.segmentPoints.length=0}dt.e1=dt.e2=-1};if(Xe&&Je<c5){this.updateDistance(K,$),this.addCurrentVertex($,se,1,1,H,Ie),Ye(this),this.addCurrentVertex($,_e,-1,-1,H,Ie);continue}if(K){if(!ee){this.updateDistance(K,$),this.addCurrentVertex($,se,1,1,H,Ie),Ye(this);continue}ke="miter"}}let rt=se.add(_e);rt.x===0&&rt.y===0||rt._unit();const ot=rt.x*_e.x+rt.y*_e.y,ht=ot!==0?1/ot:1/0,pt=2*Math.sqrt(2-2*ot),ct=ot<l5&&K&&ee,ut=se.x*_e.y-se.y*_e.x>0,Qe=this.overscaling<=16?15*Et/(512*this.overscaling):0;if(Xe&&ke==="round"){if(ht<_)ke="miter";else if(ht<=2){const Ye=Ob($,-10,Et+10);ke=this.elevationType==="offset"&&(Ye||this.hasCrossSlope)?"miter":"fakeround"}}if(ke==="miter"&&ht>p&&(ke="bevel"),ke==="bevel"&&(ht>2&&(ke="flipbevel"),ht<p&&(ke="miter")),K&&!(ke==="miter"&&ct)&&this.updateDistance(K,$),ke==="miter")if(ct){const Ye=$.dist(K);if(Ye>2*Qe){const It=$.sub($.sub(K)._mult(Qe/Ye)._round());this.updateDistance(K,It),this.addCurrentVertex(It,se,0,0,H,Ie),K=It}this.updateDistance(K,$),rt._mult(ht),this.addCurrentVertex($,rt,0,0,H,Ie);const dt=$.dist(ee);if(dt>2*Qe){const It=$.add(ee.sub($)._mult(Qe/dt)._round());this.updateDistance($,It),this.addCurrentVertex(It,_e,0,0,H,Ie),$=It}}else rt._mult(ht),this.addCurrentVertex($,rt,0,0,H,Ie);else if(ke==="flipbevel"){if(ht>100)rt=_e.mult(-1);else{const Ye=ht*se.add(_e).mag()/se.sub(_e).mag();rt._perp()._mult(Ye*(ut?-1:1))}this.addCurrentVertex($,rt,0,0,H,Ie),this.addCurrentVertex($,rt.mult(-1),0,0,H,Ie)}else if(ke==="bevel"||ke==="fakeround"){Ie!=null&&K&&this.addCurrentVertex($,xe||se,-1,-1,H,Ie);const Ye=$.dist(K)<=2*Qe&&ke!=="bevel",dt=rt.mult(ut?1:-1);dt._mult(ht);const It=_e.mult(ut?-1:1),vt=se.mult(ut?-1:1),Jt=this.evaluateLineProgressFeatures(this.distance);if(Ie==null&&(this.addHalfVertex($,dt.x,dt.y,!1,!ut,0,H,Jt),Ye||this.addHalfVertex($,dt.x+2*vt.x,dt.y+2*vt.y,!1,ut,0,H,Jt)),ke==="fakeround"){const Lt=Math.round(180*pt/Math.PI/20);this.addHalfVertex($,vt.x,vt.y,!1,ut,0,H,Jt);for(let Nt=0;Nt<Lt;Nt++){let Wt=Nt/Lt;if(Wt!==.5){const wt=Wt-.5;Wt+=Wt*wt*(Wt-1)*((1.0904+Je*(Je*(3.55645-1.43519*Je)-3.2452))*wt*wt+(.848013+Je*(.215638*Je-1.06021)))}const Fn=It.sub(vt)._mult(Wt)._add(vt)._unit();this.addHalfVertex($,Fn.x,Fn.y,!1,ut,0,H,Jt)}this.addHalfVertex($,It.x,It.y,!1,ut,0,H,Jt)}Ye||Ie!=null||this.addHalfVertex($,dt.x+2*It.x,dt.y+2*It.y,!1,ut,0,H,Jt),Ie!=null&&ee&&this.addCurrentVertex($,fe||_e,1,1,H,Ie)}else if(ke==="butt")this.addCurrentVertex($,rt,0,0,H,Ie);else if(ke==="square"){if(!K){const Ye=C?0:-1;this.addCurrentVertex($,rt,Ye,Ye,H,Ie)}if(this.addCurrentVertex($,rt,0,0,H,Ie),K){const Ye=P?0:1;this.addCurrentVertex($,rt,Ye,Ye,H,Ie)}}else if(ke==="round"){if(K){const Ye=!Xe&&xe?xe:se;this.addCurrentVertex($,Ye,0,0,H,Ie),!Xe&&P||this.addCurrentVertex($,Ye,1,1,H,Ie,!0)}if(ee){const Ye=!Xe&&fe?fe:_e;!Xe&&C||this.addCurrentVertex($,Ye,-1,-1,H,Ie,!0),this.addCurrentVertex($,Ye,0,0,H,Ie)}}}}addVerticesTo(e,n,a,c,f,p,_,x,T,I){const C=(n.w-e.w)/this.tessellationStep|0;let P=0;const D=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const j=(n.x-e.x)/C,H=(n.y-e.y)/C,$=(n.z-e.z)/C,K=(n.w-e.w)/C;for(let ee=1;ee<C;++ee){e.x+=j,e.y+=H,e.z+=$,this.lineSoFar+=K,P+=K;const se=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(e,a,c,I,!1,_,T,se),this.addHalfVertex(e,f,p,I,!0,-x,T,se)}}this.lineSoFar=n.w,this.scaledDistance=D;const k=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,a,c,I,!1,_,T,k),this.addHalfVertex(n,f,p,I,!0,-x,T,k)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ot(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,a,c,f,p,_=!1){const x=n.x+n.y*a,T=n.y-n.x*a,I=n.y*c-n.x,C=-n.y-n.x*c;if(p!=null){const P=this.elevationType==="offset",D=-10,k=Et+10,j=p.zOffset,H=new vC(e.x,e.y,j,this.lineSoFar),$=!!P&&Ob(e,D,k),K=this.lineSoFar,ee=this.distance;if(this.currentVertex)if($){const se=this.currentVertexIsOutside,_e=this.currentVertex,fe=new vC(e.x,e.y,j,this.lineSoFar);if(wC(_e,fe,D,k),!Ob(fe,D,k)){if(se){this.e1=this.e2=-1,this.distance-=_e.dist(H),this.lineSoFar=_e.w;const xe=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,x,T,_,!1,a,f,xe),this.addHalfVertex(_e,I,C,_,!0,-c,f,xe),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(fe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,fe,x,T,I,C,a,c,f,_),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{const se=this.currentVertex;if(this.currentVertexIsOutside){wC(se,H,D,k),this.e1=this.e2=-1,this.distance-=se.dist(H),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=se.w;const _e=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,x,T,_,!1,a,f,_e),this.addHalfVertex(se,I,C,_,!0,-c,f,_e),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(se,H,x,T,I,C,a,c,f,_)}else $||(this.addHalfVertex(e,x,T,_,!1,a,f,p),this.addHalfVertex(e,I,C,_,!0,-c,f,p));this.currentVertex=H,this.currentVertexIsOutside=$,this.lineSoFar=K}else this.addHalfVertex(e,x,T,_,!1,a,f,p),this.addHalfVertex(e,I,C,_,!0,-c,f,p)}addHalfVertex({x:e,y:n},a,c,f,p,_,x,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=fn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const I=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),x.primitiveLength++),p?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function Ob(r,e,n){return r.x<e||r.x>n||r.y<e||r.y>n}let QC,JC;function eA(r,e,n){return e*(Et/(r.tileSize*Math.pow(2,n-r.tileID.overscaledZ)))}jt(zb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const tA=(r,e,n)=>(1-n)*r+n*e;function nA(r,e){return 1/eA(r,1,e.tileZoom)}function iA(r,e,n,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const rA=r=>{const e=[];oA(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=r.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=r.layout.get("line-join").constantOr("miter")==="none",c=!!r.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function oA(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Fb;const sA=()=>Fb||(Fb={layout:QC||(QC=new dr({"line-cap":new Pt(Fe.layout_line["line-cap"]),"line-join":new Pt(Fe.layout_line["line-join"]),"line-miter-limit":new bt(Fe.layout_line["line-miter-limit"]),"line-round-limit":new bt(Fe.layout_line["line-round-limit"]),"line-sort-key":new Pt(Fe.layout_line["line-sort-key"]),"line-z-offset":new Pt(Fe.layout_line["line-z-offset"]),"line-elevation-reference":new bt(Fe.layout_line["line-elevation-reference"]),"line-cross-slope":new bt(Fe.layout_line["line-cross-slope"]),visibility:new bt(Fe.layout_line.visibility),"line-width-unit":new bt(Fe.layout_line["line-width-unit"])})),paint:JC||(JC=new dr({"line-opacity":new Pt(Fe.paint_line["line-opacity"]),"line-color":new Pt(Fe.paint_line["line-color"]),"line-translate":new bt(Fe.paint_line["line-translate"]),"line-translate-anchor":new bt(Fe.paint_line["line-translate-anchor"]),"line-width":new Pt(Fe.paint_line["line-width"]),"line-gap-width":new Pt(Fe.paint_line["line-gap-width"]),"line-offset":new Pt(Fe.paint_line["line-offset"]),"line-blur":new Pt(Fe.paint_line["line-blur"]),"line-dasharray":new Pt(Fe.paint_line["line-dasharray"]),"line-pattern":new Pt(Fe.paint_line["line-pattern"]),"line-pattern-cross-fade":new bt(Fe.paint_line["line-pattern-cross-fade"]),"line-gradient":new zc(Fe.paint_line["line-gradient"]),"line-trim-offset":new bt(Fe.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(Fe.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(Fe.paint_line["line-trim-color"]),"line-emissive-strength":new Pt(Fe.paint_line["line-emissive-strength"]),"line-border-width":new Pt(Fe.paint_line["line-border-width"]),"line-border-color":new Pt(Fe.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(Fe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},Fb);class u5 extends Pt{possiblyEvaluate(e,n){return n=new Bi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,a,c){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,a,c)}}let w_;function aA(r,e){return e>0?e+2*r:r}const d5=jn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),h5=jn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),f5=jn([{name:"a_projected_pos",components:4,type:"Float32"}],4);jn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const p5=jn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),m5=jn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),g5=jn([{name:"a_texb",components:2,type:"Uint16"}]),_5=jn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),y5=jn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);jn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lA=jn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),v5=jn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);jn([{name:"triangle",components:3,type:"Uint16"}]),jn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),jn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),jn([{type:"Float32",name:"offsetX"}]),jn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xr=24;function x5(r,e,n){return r.sections.forEach(a=>{a.text=function(c,f,p){const _=f.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),ol.applyArabicShaping&&(c=ol.applyArabicShaping(c)),c}(a.text,e,n)}),r}const b_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function w5(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function b5(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const Nb=4294967296,cA=1/Nb,uA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let R0=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,n=this.length){for(;this.pos<n;){const a=this.readVarint(),c=a>>3,f=this.pos;this.type=7&a,r(c,e,this),this.pos===f&&this.skip(a)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Nb;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Nb;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let n,a;return a=e[this.pos++],n=127&a,a<128?n:(a=e[this.pos++],n|=(127&a)<<7,a<128?n:(a=e[this.pos++],n|=(127&a)<<14,a<128?n:(a=e[this.pos++],n|=(127&a)<<21,a<128?n:(a=e[this.pos],n|=(15&a)<<28,function(c,f,p){const _=p.buf;let x,T;if(T=_[p.pos++],x=(112&T)>>4,T<128||(T=_[p.pos++],x|=(127&T)<<3,T<128)||(T=_[p.pos++],x|=(127&T)<<10,T<128)||(T=_[p.pos++],x|=(127&T)<<17,T<128)||(T=_[p.pos++],x|=(127&T)<<24,T<128)||(T=_[p.pos++],x|=(1&T)<<31,T<128))return Dp(c,x,f);throw new Error("Expected varint not more than 10 bytes")}(n,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&uA?uA.decode(this.buf.subarray(e,r)):function(n,a,c){let f="",p=a;for(;p<c;){const _=n[p];let x,T,I,C=null,P=_>239?4:_>223?3:_>191?2:1;if(p+P>c)break;P===1?_<128&&(C=_):P===2?(x=n[p+1],(192&x)==128&&(C=(31&_)<<6|63&x,C<=127&&(C=null))):P===3?(x=n[p+1],T=n[p+2],(192&x)==128&&(192&T)==128&&(C=(15&_)<<12|(63&x)<<6|63&T,(C<=2047||C>=55296&&C<=57343)&&(C=null))):P===4&&(x=n[p+1],T=n[p+2],I=n[p+3],(192&x)==128&&(192&T)==128&&(192&I)==128&&(C=(15&_)<<18|(63&x)<<12|(63&T)<<6|63&I,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,P=1):C>65535&&(C-=65536,f+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),f+=String.fromCharCode(C),p+=P}return f}(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const n=this.readPackedEnd();for(;this.pos<n;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*cA),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*cA),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(e,n){let a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(a=~(-e%4294967296),c=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,p,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(a,0,n),function(f,p){const _=(7&f)<<4;p.buf[p.pos++]|=_|((f>>>=3)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=function(a,c,f){for(let p,_,x=0;x<c.length;x++){if(p=c.charCodeAt(x),p>55295&&p<57344){if(!_){p>56319||x+1===c.length?(a[f++]=239,a[f++]=191,a[f++]=189):_=p;continue}if(p<56320){a[f++]=239,a[f++]=191,a[f++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(a[f++]=239,a[f++]=191,a[f++]=189,_=null);p<128?a[f++]=p:(p<2048?a[f++]=p>>6|192:(p<65536?a[f++]=p>>12|224:(a[f++]=p>>18|240,a[f++]=p>>12&63|128),a[f++]=p>>6&63|128),a[f++]=63&p|128)}return f}(this.buf,r,this.pos);const n=this.pos-e;n>=128&&dA(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=r[n]}writeRawMessage(r,e){this.pos++;const n=this.pos;r(e,this);const a=this.pos-n;a>=128&&dA(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a}writeMessage(r,e,n){this.writeTag(r,2),this.writeRawMessage(e,n)}writePackedVarint(r,e){e.length&&this.writeMessage(r,T5,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,S5,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,C5,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,E5,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,I5,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,A5,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,P5,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,M5,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,R5,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function Dp(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function dA(r,e,n){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(a);for(let c=n.pos-1;c>=r;c--)n.buf[c+a]=n.buf[c]}function T5(r,e){for(let n=0;n<r.length;n++)e.writeVarint(r[n])}function S5(r,e){for(let n=0;n<r.length;n++)e.writeSVarint(r[n])}function E5(r,e){for(let n=0;n<r.length;n++)e.writeFloat(r[n])}function I5(r,e){for(let n=0;n<r.length;n++)e.writeDouble(r[n])}function C5(r,e){for(let n=0;n<r.length;n++)e.writeBoolean(r[n])}function A5(r,e){for(let n=0;n<r.length;n++)e.writeFixed32(r[n])}function P5(r,e){for(let n=0;n<r.length;n++)e.writeSFixed32(r[n])}function M5(r,e){for(let n=0;n<r.length;n++)e.writeFixed64(r[n])}function R5(r,e){for(let n=0;n<r.length;n++)e.writeSFixed64(r[n])}const Bb=3;function D5(r,e,n){e.glyphs=[],r===1&&n.readMessage(L5,e)}function L5(r,e,n){if(r===3){const{id:a,bitmap:c,width:f,height:p,left:_,top:x,advance:T}=n.readMessage(k5,{});e.glyphs.push({id:a,bitmap:new Nu({width:f+2*Bb,height:p+2*Bb},c),metrics:{width:f,height:p,left:_,top:x,advance:T}})}else r===4?e.ascender=n.readSVarint():r===5&&(e.descender=n.readSVarint())}function k5(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const hA=Bb,bs={horizontal:1,vertical:2,horizontalOnly:3};class T_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const a=new T_;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new T_;return n.image=e,n}}class Lp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,a){const c=new Lp;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?c.addImageSection(p,a):c.addTextSection(p,n)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let c="";for(let f=0;f<n.length;f++){const p=n.charCodeAt(f+1)||null,_=n.charCodeAt(f-1)||null;c+=!a&&(p&&Xf(p)&&!b_[n[f+1]]||_&&Xf(_)&&!b_[n[f-1]])||!b_[n[f]]?n[f]:b_[n[f]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&D0[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&D0[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new Lp;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(T_.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e,n){const a=e.image?e.image.getPrimary():null;if(!a)return void Ot("Can't add FormattedSection with an empty image.");a.scaleSelf(n);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(T_.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ot("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jb(r,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j=1){const H=Lp.fromFeature(r,c,j);C===bs.vertical&&H.verticalizePunctuation(P);let $=[];const K=function(xe,Ie,Pe,Xe,ke,Je){if(!xe)return[];const rt=[],ot=function(ut,Qe,Ye,dt,It,vt){let Jt=0;for(let Lt=0;Lt<ut.length();Lt++){const Nt=ut.getSection(Lt);Jt+=fA(ut.getCodePoint(Lt),Nt,dt,It,Qe,vt)}return Jt/Math.max(1,Math.ceil(Jt/Ye))}(xe,Ie,Pe,Xe,ke,Je),ht=xe.text.indexOf("")>=0;let pt=0;for(let ut=0;ut<xe.length();ut++){const Qe=xe.getSection(ut),Ye=xe.getCodePoint(ut);if(D0[Ye]||(pt+=fA(Ye,Qe,Xe,ke,Ie,Je)),ut<xe.length()-1){const dt=!((ct=Ye)<11904||!(ln["Bopomofo Extended"](ct)||ln.Bopomofo(ct)||ln["CJK Compatibility Forms"](ct)||ln["CJK Compatibility Ideographs"](ct)||ln["CJK Compatibility"](ct)||ln["CJK Radicals Supplement"](ct)||ln["CJK Strokes"](ct)||ln["CJK Symbols and Punctuation"](ct)||ln["CJK Unified Ideographs Extension A"](ct)||ln["CJK Unified Ideographs"](ct)||ln["Enclosed CJK Letters and Months"](ct)||ln["Halfwidth and Fullwidth Forms"](ct)||ln.Hiragana(ct)||ln["Ideographic Description Characters"](ct)||ln["Kangxi Radicals"](ct)||ln["Katakana Phonetic Extensions"](ct)||ln.Katakana(ct)||ln["Vertical Forms"](ct)||ln["Yi Radicals"](ct)||ln["Yi Syllables"](ct)));(z5[Ye]||dt||Qe.image)&&rt.push(mA(ut+1,pt,ot,rt,O5(Ye,xe.getCodePoint(ut+1),dt&&ht),!1))}}var ct;return gA(mA(xe.length(),pt,ot,rt,0,!0))}(H,T,f,e,a,D),{processBidirectionalText:ee,processStyledBidirectionalText:se}=ol;if(ee&&H.sections.length===1){const xe=ee(H.toString(),K);for(const Ie of xe){const Pe=new Lp;Pe.text=Ie,Pe.sections=H.sections;for(let Xe=0;Xe<Ie.length;Xe++)Pe.sectionIndex.push(0);$.push(Pe)}}else if(se){const xe=se(H.text,H.sectionIndex,K);for(const Ie of xe){const Pe=new Lp;Pe.text=Ie[0],Pe.sectionIndex=Ie[1],Pe.sections=H.sections,$.push(Pe)}}else $=function(xe,Ie){const Pe=[],Xe=xe.text;let ke=0;for(const Je of Ie)Pe.push(xe.substring(ke,Je)),ke=Je;return ke<Xe.length&&Pe.push(xe.substring(ke,Xe.length)),Pe}(H,K);const _e=[],fe={positionedLines:_e,text:H.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(xe,Ie,Pe,Xe,ke,Je,rt,ot,ht,pt,ct,ut){let Qe=0,Ye=0,dt=0;const It=ot==="right"?1:ot==="left"?0:.5;let vt=!1;for(const wt of ke){const Zt=wt.getSections();for(const xn of Zt){if(xn.image)continue;const Hn=Ie[xn.fontStack];if(Hn&&(vt=Hn.ascender!==void 0&&Hn.descender!==void 0,!vt))break}if(!vt)break}let Jt=0;for(const wt of ke){wt.trim();const Zt=wt.getMaxScale(),xn=(Zt-1)*Xr,Hn={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Jt]=Hn;const qn=Hn.positionedGlyphs;let Cn=0;if(!wt.length()){Ye+=Je,++Jt;continue}let Ei=0,pe=0;for(let et=0;et<wt.length();et++){const ft=wt.getSection(et),Mt=wt.getSectionIndex(et),Rt=wt.getCodePoint(et);let en=ft.scale,rn=null,Sn=null,kn=null,On=Xr,Un=0,hn=ht;hn===bs.vertical&&((Lt=Rt)===12312||Lt===12313||Lt===12316||Lt===12540||Lt===12448)&&(hn=bs.horizontal);const vn=!(hn===bs.horizontal||!ct&&!Zf(Rt)||ct&&(D0[Rt]||Yf(Rt)));if(ft.image){const ti=Xe.get(ft.image.toString());if(!ti)continue;kn=ft.image,xe.iconsInText=xe.iconsInText||!0,Sn=ti.paddedRect;const si=ti.displaySize;en=en*Xr/ut,rn={width:si[0],height:si[1],left:0,top:-hA,advance:vn?si[1]:si[0],localGlyph:!1},Un=vt?-rn.height*en:Zt*Xr-17-si[1]*en,On=rn.advance;const ai=(vn?si[0]:si[1])*en-Xr*Zt;ai>0&&ai>Cn&&(Cn=ai)}else{const ti=Pe[ft.fontStack];if(!ti)continue;ti[Rt]&&(Sn=ti[Rt]);const si=Ie[ft.fontStack];if(!si)continue;const ai=si.glyphs[Rt];if(!ai)continue;if(rn=ai.metrics,On=Rt!==8203?Xr:0,vt){const wi=si.ascender!==void 0?Math.abs(si.ascender):0,Ri=si.descender!==void 0?Math.abs(si.descender):0,Ii=(wi+Ri)*en;Ei<Ii&&(Ei=Ii,pe=(wi-Ri)/2*en),Un=-wi*en}else Un=(Zt-en)*Xr-17}vn?(xe.verticalizable=!0,qn.push({glyph:Rt,image:kn,x:Qe,y:Ye+Un,vertical:vn,scale:en,localGlyph:rn.localGlyph,fontStack:ft.fontStack,sectionIndex:Mt,metrics:rn,rect:Sn}),Qe+=On*en+pt):(qn.push({glyph:Rt,image:kn,x:Qe,y:Ye+Un,vertical:vn,scale:en,localGlyph:rn.localGlyph,fontStack:ft.fontStack,sectionIndex:Mt,metrics:rn,rect:Sn}),Qe+=rn.advance*en+pt)}qn.length!==0&&(dt=Math.max(Qe-pt,dt),vt?_A(qn,It,Cn,pe,Je*Zt/2):_A(qn,It,Cn,0,Je/2)),Qe=0;const ye=Je*Zt+Cn;Hn.lineOffset=Math.max(Cn,xn),Ye+=ye,++Jt}var Lt;const Nt=Ye,{horizontalAlign:Wt,verticalAlign:Fn}=Ub(rt);(function(wt,Zt,xn,Hn,qn,Cn){const Ei=(Zt-xn)*qn,pe=-Cn*Hn;for(const ye of wt)for(const et of ye.positionedGlyphs)et.x+=Ei,et.y+=pe})(xe.positionedLines,It,Wt,Fn,dt,Nt),xe.top+=-Fn*Nt,xe.bottom=xe.top+Nt,xe.left+=-Wt*dt,xe.right=xe.left+dt,xe.hasBaseline=vt}(fe,e,n,a,$,p,_,x,C,T,P,k),!function(xe){for(const Ie of xe)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(_e))return fe}const D0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},z5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fA(r,e,n,a,c,f){if(e.image){const p=a.get(e.image.toString());return p?p.displaySize[0]*e.scale*Xr/f+c:0}{const p=n[e.fontStack],_=p&&p.glyphs[r];return _?_.metrics.advance*e.scale+c:0}}function pA(r,e,n,a){const c=Math.pow(r-e,2);return a?r<e?c/2:2*c:c+Math.abs(n)*n}function O5(r,e,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function mA(r,e,n,a,c,f){let p=null,_=pA(e,n,c,f);for(const x of a){const T=pA(e-x.x,n,c,f)+x.badness;T<=_&&(p=x,_=T)}return{index:r,x:e,priorBreak:p,badness:_}}function gA(r){return r?gA(r.priorBreak).concat(r.index):[]}function Ub(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function _A(r,e,n,a,c){if(!(e||n||a||c))return;const f=r.length-1,p=r[f],_=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=f;x++)r[x].x-=_,r[x].y+=n+a+c}function Vb(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function L0(r,e,n,a){const{horizontalAlign:c,verticalAlign:f}=Ub(a),p=n[0]-r.displaySize[0]*c,_=n[1]-r.displaySize[1]*f;return{imagePrimary:r,imageSecondary:e,top:_,bottom:_+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function $b(r,e,n,a,c,f){const p=r.imagePrimary;let _;if(p.content){const H=p.content,$=p.pixelRatio||1;_=[H[0]/$,H[1]/$,p.displaySize[0]-H[2]/$,p.displaySize[1]-H[3]/$]}const x=e.left*f,T=e.right*f;let I,C,P,D;n==="width"||n==="both"?(D=c[0]+x-a[3],C=c[0]+T+a[1]):(D=c[0]+(x+T-p.displaySize[0])/2,C=D+p.displaySize[0]);const k=e.top*f,j=e.bottom*f;return n==="height"||n==="both"?(I=c[1]+k-a[0],P=c[1]+j+a[2]):(I=c[1]+(k+j-p.displaySize[1])/2,P=I+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:I,right:C,bottom:P,left:D,collisionPadding:_}}function yA(r){return!r.imagePrimary.stretchX}function vA(r){return!r.imagePrimary.stretchY}function xA(r){return{width:r.right-r.left,height:r.bottom-r.top}}const ml=128;function kp(r,e,n){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Bi(r+1,{worldview:n}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=a;let p=0;for(;p<c.length&&c[p]<=r;)p++;p=Math.max(0,p-1);let _=p;for(;_<c.length&&c[_]<r+1;)_++;_=Math.min(c.length-1,_);const x=c[p],T=c[_];return a.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:x,maxZoom:T,minSize:a.evaluate(new Bi(x,{worldview:n})),maxSize:a.evaluate(new Bi(T,{worldview:n})),interpolationType:f}}}function Gb(r,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/ml:r.kind==="composite"?fn(a/ml,c/ml,n):e}function zp(r,e,n=1){let a=0,c=0;if(r.kind==="constant")c=r.layoutSize*n;else if(r.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:_}=r,x=f?W(_s.interpolationFactor(f,e,p,_),0,1):0;r.kind==="camera"?c=fn(r.minSize,r.maxSize,x)*n:a=x*n}return{uSizeT:a,uSize:c}}class $c extends at{constructor(e,n,a,c,f){super(e,n),this.angle=c,this.z=a,f!==void 0&&(this.segment=f)}clone(){return new $c(this.x,this.y,this.z,this.angle,this.segment)}}function wA(r,e,n,a,c){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,_=0;for(;_>-n/2;){if(p--,p<0)return!1;_-=r[p].dist(f),f=r[p]}_+=r[p].dist(r[p+1]),p++;const x=[];let T=0;for(;_<n/2;){const I=r[p],C=r[p+1];if(!C)return!1;let P=r[p-1].angleTo(I)-I.angleTo(C);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:P}),T+=P;_-x[0].distance>a;)T-=x.shift().angleDelta;if(T>c)return!1;p++,_+=I.dist(C)}return!0}function bA(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function TA(r,e,n){return r?.6*e*n:0}function SA(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function F5(r,e,n,a,c,f){const p=TA(n,c,f),_=SA(n,a)*f;let x=0;const T=bA(r)/2;for(let I=0;I<r.length-1;I++){const C=r[I],P=r[I+1],D=C.dist(P);if(x+D>T){const k=(T-x)/D,j=fn(C.x,P.x,k),H=fn(C.y,P.y,k),$=new $c(j,H,0,P.angleTo(C),I);return!p||wA(r,$,_,p,e)?$:void 0}x+=D}}function N5(r,e,n,a,c,f,p,_,x){const T=TA(a,f,p),I=SA(a,c),C=I*p,P=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return e-C<e/4&&(e=C+e/4),EA(r,P?e/2*_%e:(I/2+2*f)*p*_%e,e,T,n,C,P,!1,x)}function EA(r,e,n,a,c,f,p,_,x){const T=f/2,I=bA(r);let C=0,P=e-n,D=[];for(let k=0;k<r.length-1;k++){const j=r[k],H=r[k+1],$=j.dist(H),K=H.angleTo(j);for(;P+n<C+$;){P+=n;const ee=(P-C)/$,se=fn(j.x,H.x,ee),_e=fn(j.y,H.y,ee);if(se>=0&&se<x&&_e>=0&&_e<x&&P-T>=0&&P+T<=I){const fe=new $c(se,_e,0,K,k);a&&!wA(r,fe,f,a,c)||D.push(fe)}}C+=$}return _||D.length||p||(D=EA(r,C/2,n,a,c,f,p,!0,x)),D}function IA(r){let e=0,n=0;for(const p of r)e+=p.w*p.h,n=Math.max(n,p.w);r.sort((p,_)=>_.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,f=0;for(const p of r)for(let _=a.length-1;_>=0;_--){const x=a[_];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,f=Math.max(f,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===x.w&&p.h===x.h){const T=a.pop();T&&_<a.length&&(a[_]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(a.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}jt($c,"Anchor");const yh=1;class S_{static getImagePositionScale(e,n,a){if(n&&e){const{sx:c,sy:f}=e;return{x:c,y:f}}return{x:a,y:a}}constructor(e,n,a,c){this.paddedRect=e;const{pixelRatio:f,version:p,stretchX:_,stretchY:x,content:T,sdf:I,usvg:C}=n;this.pixelRatio=f,this.stretchX=_,this.stretchY=x,this.content=T,this.version=p,this.padding=a,this.sdf=I,this.usvg=C,this.scale=S_.getImagePositionScale(c,C,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Hb(r,e,n){const a=Qa.parse(r),c=function(f,p,_=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*_[0])+2*p,h:(f.data?f.data.height:f.height*_[1])+2*p}}(e,n,[a.sx,a.sy]);return{bin:c,imagePosition:new S_(c,e,n,a),imageVariant:a}}class CA{constructor(e,n,a){const c=new Map,f=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,c,yh,p),this.addImages(n,f,2,p);const{w:_,h:x}=IA(p),T=new Ao({width:_||1,height:x||1});for(const[I,C]of e.entries()){const P=c.get(I).paddedRect;Ao.copy(C.data,T,{x:0,y:0},{x:P.x+yh,y:P.y+yh},C.data,null,C.sdf)}for(const[I,C]of n.entries()){const P=f.get(I),D=P.paddedRect;let k=P.padding;const j=D.x+k,H=D.y+k,$=C.data.width,K=C.data.height;k=k>1?k-1:k,Ao.copy(C.data,T,{x:0,y:0},{x:j,y:H},C.data,a),Ao.copy(C.data,T,{x:0,y:K-k},{x:j,y:H-k},{width:$,height:k},a),Ao.copy(C.data,T,{x:0,y:0},{x:j,y:H+K},{width:$,height:k},a),Ao.copy(C.data,T,{x:$-k,y:0},{x:j-k,y:H},{width:k,height:K},a),Ao.copy(C.data,T,{x:0,y:0},{x:j+$,y:H},{width:k,height:K},a),Ao.copy(C.data,T,{x:$-k,y:K-k},{x:j-k,y:H-k},{width:k,height:k},a),Ao.copy(C.data,T,{x:0,y:K-k},{x:j+$,y:H-k},{width:k,height:k},a),Ao.copy(C.data,T,{x:0,y:0},{x:j+$,y:H+K},{width:k,height:k},a),Ao.copy(C.data,T,{x:$-k,y:0},{x:j-k,y:H+K},{width:k,height:k},a)}this.lut=a,this.image=T,this.iconPositions=c,this.patternPositions=f}addImages(e,n,a,c){for(const[f,p]of e.entries()){const{bin:_,imagePosition:x,imageVariant:T}=Hb(f,p,a);n.set(f,x),c.push(_),p.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c of e.getUpdatedImages(a)){for(const f of this.iconPositions.keys()){const p=Qa.parse(f);if(Lo.isEqual(p.id,c)){const _=e.getImage(c,a);this.patchUpdatedImage(this.iconPositions.get(f),_,n,null)}}for(const f of this.patternPositions.keys()){const p=Qa.parse(f);if(Lo.isEqual(p.id,c)){const _=e.getImage(c,a);this.patchUpdatedImage(this.patternPositions.get(f),_,n,this.lut)}}}}patchUpdatedImage(e,n,a,c=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[f,p]=e.tl,_=e.sdf;if(this.lut||_){const x={width:n.data.width,height:n.data.height},T=new Ao(x);Ao.copy(n.data,T,{x:0,y:0},{x:0,y:0},x,c,_),a.update(T,{position:{x:f,y:p}})}else a.update(n.data,{position:{x:f,y:p}})}}jt(S_,"ImagePosition"),jt(CA,"ImageAtlas");const E_=1e20;function AA(r,e,n,a,c,f,p,_,x){for(let T=e;T<e+a;T++)PA(r,n*f+T,f,c,p,_,x);for(let T=n;T<n+c;T++)PA(r,T*f+e,1,a,p,_,x)}function PA(r,e,n,a,c,f,p){f[0]=0,p[0]=-E_,p[1]=E_,c[0]=r[e];for(let _=1,x=0,T=0;_<a;_++){c[_]=r[e+_*n];const I=_*_;do{const C=f[x];T=(c[_]-c[C]+I-C*C)/(_-C)/2}while(T<=p[x]&&--x>-1);x++,f[x]=_,p[x]=T,p[x+1]=E_}for(let _=0,x=0;_<a;_++){for(;p[x+1]<_;)x++;const T=f[x],I=_-T;r[e+_*n]=c[T]+I*I}}const gl=2,Wb={none:0,ideographs:1,all:2};class Op{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const a=[],c=this.url||$n.GLYPHS_URL;for(const f in e)for(const p of e[f])a.push({stack:f,id:p});Ce(a,({stack:f,id:p},_)=>{let x=this.entries[f];x||(x=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=x.glyphs[p];if(T!==void 0)return void _(null,{stack:f,id:p,glyph:T});if(T=this._tinySDF(x,f,p),T)return x.glyphs[p]=T,void _(null,{stack:f,id:p,glyph:T});const I=Math.floor(p/256);if(256*I>65535)return Ot("glyphs > 65535 not supported"),void _(null,{stack:f,id:p,glyph:T});if(x.ranges[I])return void _(null,{stack:f,id:p,glyph:T});let C=x.requests[I];C||(C=x.requests[I]=[],Op.loadGlyphRange(f,I,c,this.requestManager,(P,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const k in D.glyphs)this._doesCharSupportLocalGlyph(+k)||(x.glyphs[+k]=D.glyphs[+k]);x.ranges[I]=!0}for(const k of C)k(P,D);delete x.requests[I]})),C.push((P,D)=>{P?_(P):D&&_(null,{stack:f,id:p,glyph:D.glyphs[p]||null})})},(f,p)=>{if(f)n(f);else if(p){const _={};for(const{stack:x,id:T,glyph:I}of p)_[x]===void 0&&(_[x]={}),_[x].glyphs===void 0&&(_[x].glyphs={}),_[x].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;n(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Wb.none&&(this.localGlyphMode===Wb.all?!!this.localFontFamily:!!this.localFontFamily&&(ln["CJK Unified Ideographs"](e)||ln["Hangul Syllables"](e)||ln.Hiragana(e)||ln.Katakana(e)||ln["CJK Symbols and Punctuation"](e)||ln["CJK Unified Ideographs Extension A"](e)||ln["CJK Unified Ideographs Extension B"](e)||ln.Osage(e)))}_tinySDF(e,n,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let j="400";/bold/i.test(n)?j="900":/medium/i.test(n)?j="500":/light/i.test(n)&&(j="200"),f=e.tinySDF=new Op.TinySDF({fontFamily:c,fontWeight:j,fontSize:24*gl,buffer:3*gl,radius:8*gl}),f.fontWeight=j}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const p=String.fromCodePoint(a),{data:_,width:x,height:T,glyphWidth:I,glyphHeight:C,glyphLeft:P,glyphTop:D,glyphAdvance:k}=f.draw(p);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new Nu({width:x,height:T},_),metrics:{width:I/gl,height:C/gl,left:P/gl,top:D/gl-27,advance:k/gl,localGlyph:!0}}}}Op.loadGlyphRange=function(r,e,n,a,c){const f=256*e,p=f+255,_=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",r).replace("{range}",`${f}-${p}`),Pd.Glyphs);Ka(_,(x,T)=>{if(x)c(x);else if(T){const I={},C=function(P){return new R0(P).readFields(D5,{})}(T);for(const P of C.glyphs)I[P.id]=P;c(null,{glyphs:I,ascender:C.ascender,descender:C.descender})}})},Op.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:p="normal",lang:_=null}={}){this.buffer=e,this.cutoff=a,this.radius=n,this.lang=_;const x=this.size=r+4*e,T=this._createCanvas(x),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${p} ${f} ${r}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(r),p=Math.ceil(n),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),x=Math.min(this.size-this.buffer,p+Math.ceil(a)),T=_+2*this.buffer,I=x+2*this.buffer,C=Math.max(T*I,0),P=new Uint8ClampedArray(C),D={data:P,width:T,height:I,glyphWidth:_,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return D;const{ctx:k,buffer:j,gridInner:H,gridOuter:$}=this;this.lang&&(k.lang=this.lang),k.clearRect(j,j,_,x),k.fillText(r,j,j+p);const K=k.getImageData(j,j,_,x);$.fill(E_,0,C),H.fill(0,0,C);for(let ee=0;ee<x;ee++)for(let se=0;se<_;se++){const _e=K.data[4*(ee*_+se)+3]/255;if(_e===0)continue;const fe=(ee+j)*T+se+j;if(_e===1)$[fe]=0,H[fe]=E_;else{const xe=.5-_e;$[fe]=xe>0?xe*xe:0,H[fe]=xe<0?xe*xe:0}}AA($,0,0,T,I,T,this.f,this.v,this.z),AA(H,j,j,_,x,T,this.f,this.v,this.z);for(let ee=0;ee<C;ee++){const se=Math.sqrt($[ee])-Math.sqrt(H[ee]);P[ee]=Math.round(255-255*(se/this.radius+this.cutoff))}return D}};const nc=yh;function MA(r,e){return r+e[1]-e[0]}function qb(r,e,n,a,c=1){const f=[],p=r.imagePrimary,_=p.pixelRatio,x=p.paddedRect.w-2*nc,T=p.paddedRect.h-2*nc,I=(r.right-r.left)*c,C=(r.bottom-r.top)*c,P=p.stretchX||[[0,x]],D=p.stretchY||[[0,T]],k=P.reduce(MA,0),j=D.reduce(MA,0),H=x-k,$=T-j;let K=0,ee=k,se=0,_e=j,fe=0,xe=H,Ie=0,Pe=$;if(p.content&&a){const ke=p.content;K=k0(P,0,ke[0]),se=k0(D,0,ke[1]),ee=k0(P,ke[0],ke[2]),_e=k0(D,ke[1],ke[3]),fe=ke[0]-K,Ie=ke[1]-se,xe=ke[2]-ke[0]-ee,Pe=ke[3]-ke[1]-_e}const Xe=(ke,Je,rt,ot)=>{const ht=z0(ke.stretch-K,ee,I,r.left*c),pt=O0(ke.fixed-fe,xe,ke.stretch,k),ct=z0(Je.stretch-se,_e,C,r.top*c),ut=O0(Je.fixed-Ie,Pe,Je.stretch,j),Qe=z0(rt.stretch-K,ee,I,r.left*c),Ye=O0(rt.fixed-fe,xe,rt.stretch,k),dt=z0(ot.stretch-se,_e,C,r.top*c),It=O0(ot.fixed-Ie,Pe,ot.stretch,j),vt=new at(ht,ct),Jt=new at(Qe,ct),Lt=new at(Qe,dt),Nt=new at(ht,dt),Wt=new at(pt/_,ut/_),Fn=new at(Ye/_,It/_),wt=e*Math.PI/180;if(wt){const Ei=Math.sin(wt),pe=Math.cos(wt),ye=[pe,-Ei,Ei,pe];vt._matMult(ye),Jt._matMult(ye),Nt._matMult(ye),Lt._matMult(ye)}const Zt=ke.stretch+ke.fixed,xn=rt.stretch+rt.fixed,Hn=Je.stretch+Je.fixed,qn=ot.stretch+ot.fixed,Cn=r.imageSecondary;return{tl:vt,tr:Jt,bl:Nt,br:Lt,texPrimary:{x:p.paddedRect.x+nc+Zt,y:p.paddedRect.y+nc+Hn,w:xn-Zt,h:qn-Hn},texSecondary:Cn?{x:Cn.paddedRect.x+nc+Zt,y:Cn.paddedRect.y+nc+Hn,w:xn-Zt,h:qn-Hn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wt,pixelOffsetBR:Fn,minFontScaleX:xe/_/I,minFontScaleY:Pe/_/C,isSDF:n}};if(a&&(p.stretchX||p.stretchY)){const ke=RA(P,H,k),Je=RA(D,$,j);for(let rt=0;rt<ke.length-1;rt++){const ot=ke[rt],ht=ke[rt+1];for(let pt=0;pt<Je.length-1;pt++)f.push(Xe(ot,Je[pt],ht,Je[pt+1]))}}else f.push(Xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:T+1}));return f}function B5(r,e){const n=r.stretchY||[[0,r.paddedRect.h-2*nc]];return e&&(r.stretchX||r.stretchY)?DA(r.stretchX||[[0,r.paddedRect.w-2*nc]])*DA(n):1}function k0(r,e,n){let a=0;for(const c of r)a+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return a}function RA(r,e,n){const a=[{fixed:-nc,stretch:0}];for(const[c,f]of r){const p=a[a.length-1];a.push({fixed:c-p.stretch,stretch:p.stretch}),a.push({fixed:c-p.stretch,stretch:p.stretch+(f-c)})}return a.push({fixed:e+nc,stretch:n}),a}function DA(r){return 2*r.length+1}function z0(r,e,n,a){return r/e*n+a}function O0(r,e,n,a){return r-e*n/a}function j5(r,e,n,a){const c=e+r.positionedLines[a].lineOffset;return a===0?n+c/2:n+(c+(e+r.positionedLines[a-1].lineOffset))/2}function U5(r,e=1,n=!1){let a=1/0,c=1/0,f=-1/0,p=-1/0;const _=r[0];for(let D=0;D<_.length;D++){const k=_[D];(!D||k.x<a)&&(a=k.x),(!D||k.y<c)&&(c=k.y),(!D||k.x>f)&&(f=k.x),(!D||k.y>p)&&(p=k.y)}const x=Math.min(f-a,p-c);let T=x/2;const I=new If([],V5);if(x===0)return new at(a,c);for(let D=a;D<f;D+=x)for(let k=c;k<p;k+=x)I.push(new Fp(D+T,k+T,T,r));let C=function(D){let k=0,j=0,H=0;const $=D[0];for(let K=0,ee=$.length,se=ee-1;K<ee;se=K++){const _e=$[K],fe=$[se],xe=_e.x*fe.y-fe.x*_e.y;j+=(_e.x+fe.x)*xe,H+=(_e.y+fe.y)*xe,k+=3*xe}return new Fp(j/k,H/k,0,D)}(r),P=I.length;for(;I.length;){const D=I.pop();(D.d>C.d||!C.d)&&(C=D,n&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,P)),D.max-C.d<=e||(T=D.h/2,I.push(new Fp(D.p.x-T,D.p.y-T,T,r)),I.push(new Fp(D.p.x+T,D.p.y-T,T,r)),I.push(new Fp(D.p.x-T,D.p.y+T,T,r)),I.push(new Fp(D.p.x+T,D.p.y+T,T,r)),P+=4)}return n&&(console.log(`num probes: ${P}`),console.log(`best distance: ${C.d}`)),C.p}function V5(r,e){return e.max-r.max}class Fp{constructor(e,n,a,c){this.p=new at(e,n),this.h=a,this.d=function(f,p){let _=!1,x=1/0;for(let T=0;T<p.length;T++){const I=p[T];for(let C=0,P=I.length,D=P-1;C<P;D=C++){const k=I[C],j=I[D];k.y>f.y!=j.y>f.y&&f.x<(j.x-k.x)*(f.y-k.y)/(j.y-k.y)+k.x&&(_=!_),x=Math.min(x,gr(f,k,j))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const $5=Object.keys,Zb=Number.POSITIVE_INFINITY,G5=Math.sqrt(2);function ju(r,e,n,a,c){const f=Vb(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],p={top:r.top-f[1],bottom:r.bottom+f[3],left:r.left-f[0],right:r.right+f[2],scaled:!1};return a!==void 0&&function(_,x){_.top*=x,_.bottom*=x,_.left*=x,_.right*=x,_.scaled=!0}(p,a),n&&function(_,x){if(!x)return;const T=Bn(x),I=new at(_.left,_.top),C=new at(_.right,_.top),P=new at(_.left,_.bottom),D=new at(_.right,_.bottom),k=new at(0,0);I._rotateAround(T,k),C._rotateAround(T,k),P._rotateAround(T,k),D._rotateAround(T,k),_.left=Math.min(I.x,C.x,P.x,D.x),_.right=Math.max(I.x,C.x,P.x,D.x),_.top=Math.min(I.y,C.y,P.y,D.y),_.bottom=Math.max(I.y,C.y,P.y,D.y)}(p,n),c&&(p.left+=c[0],p.right+=c[0],p.top+=c[1],p.bottom+=c[1]),e?{top:Math.min(e.top,p.top),bottom:Math.max(e.bottom,p.bottom),left:Math.min(e.left,p.left),right:Math.max(e.right,p.right),scaled:e.scaled||p.scaled}:p}function LA(r,[e,n]){let a=0,c=0;if(n===Zb){e<0&&(e=0);const f=e/G5;switch(r){case"top-right":case"top-left":c=f-7;break;case"bottom-right":case"bottom-left":c=7-f;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(r){case"top-right":case"bottom-right":a=-f;break;case"top-left":case"bottom-left":a=f;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),r){case"top-right":case"top-left":case"top":c=n-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-n}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function H5(r,e,n,a,c,f,p,_,x,T,I,C,P,D){const k=r.layers[0],j=k.appearances;if(j.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const H={iconBBox:null,iconVerticalBBox:null},$={textBBox:null,textVerticalBBox:null},{baseIconRotate:K,baseTextRotate:ee,iconScaleFactor:se}=function(fe,xe,Ie){const Pe=fe.get("icon-rotate").evaluate(xe,{},Ie),Xe=fe.get("text-rotate").evaluate(xe,{},Ie),[ke,Je]=fe.get("icon-size-scale-range");return{baseIconRotate:Pe,baseTextRotate:Xe,iconScaleFactor:W(1,ke,Je)}}(a,c,f);e&&(H.iconBBox=ju(e,H.iconBBox,K,p),n)&&(H.iconVerticalBBox=ju(n,H.iconVerticalBBox,K+90,p));const _e=N0(C.horizontal);_e&&($.textBBox=ju(_e,$.textBBox,ee,1,D)),C.vertical&&($.textVerticalBBox=ju(C.vertical,$.textVerticalBBox,ee+90,1,D));for(const fe of j)fe.hasIconProperties()&&W5(H,r,k,fe,c,f,_,K,p,x,e,T,se,I),fe.hasTextProperties()&&q5($,k,fe,c,f,D,ee,P,_e,C.vertical);return{iconBBox:H.iconBBox,iconVerticalBBox:H.iconVerticalBBox,textBBox:$.textBBox,textVerticalBBox:$.textVerticalBBox}}function W5(r,e,n,a,c,f,p,_,x,T,I,C,P,D){const{appearanceIconOffset:k,appearanceIconRotate:j,appearanceIconSize:H}=function(se,_e,fe,xe,Ie,Pe,Xe,ke){const Je=se.hasProperty("icon-offset")?_e.getAppearanceValueAndResolveTokens(se,"icon-offset",fe,xe,[]):null,rt=Je&&Array.isArray(Je)?Je:Ie,ot=se.hasProperty("icon-rotate")?_e.getAppearanceValueAndResolveTokens(se,"icon-rotate",fe,xe,[]):null,ht=typeof ot=="number"?ot:Pe,pt=se.hasProperty("icon-size")?_e.getAppearanceValueAndResolveTokens(se,"icon-size",fe,xe,[]):null;return{appearanceIconOffset:rt,appearanceIconRotate:ht,appearanceIconSize:typeof pt=="number"?pt*ke.iconScaleFactor:Xe}}(a,n,c,f,p,_,x,T);let $=null,K=null,ee=null;a.hasProperty("icon-image")?ee=function(se,_e,fe,xe,Ie,Pe,Xe){let ke=null;const Je=_e.getAppearanceValueAndResolveTokens(fe,"icon-image",xe,Ie,[]);if(Je){const rt=se.getResolvedImageFromTokens(Je),ot=fe.getUnevaluatedProperty("icon-size"),ht=I_(rt,kp(se.zoom,ot,se.worldview),ot,Ie,se.zoom,xe,se.pixelRatio,Xe,se.worldview);ke=Pe.get(ht.iconPrimary.toString())}return ke}(e,n,a,c,f,C,P):I&&(ee=I.imagePrimary),ee&&($=L0(ee,null,k,D),e.allowVerticalPlacement&&(K=L0(ee,null,k,D))),$&&(r.iconBBox=ju($,r.iconBBox,j,H)),K&&(r.iconVerticalBBox=ju(K,r.iconVerticalBBox,j+90,H))}function q5(r,e,n,a,c,f,p,_,x,T){const{appearanceTextOffset:I,appearanceTextRotate:C,appearanceTextSize:P}=function(k,j,H,$,K,ee,se){const _e=k.hasProperty("text-offset")?j.getAppearanceValueAndResolveTokens(k,"text-offset",H,$,[]):null,fe=_e&&Array.isArray(_e)?[_e[0]*Xr,_e[1]*Xr]:K,xe=k.hasProperty("text-rotate")?j.getAppearanceValueAndResolveTokens(k,"text-rotate",H,$,[]):null,Ie=typeof xe=="number"?xe:ee,Pe=k.hasProperty("text-size")?j.getAppearanceValueAndResolveTokens(k,"text-size",H,$,[]):null;return{appearanceTextOffset:fe,appearanceTextRotate:Ie,appearanceTextSize:typeof Pe=="number"?Pe:se}}(n,e,a,c,f,p,_),D=P/_;x&&(r.textBBox=ju(x,r.textBBox,C,D,I)),T&&(r.textVerticalBBox=ju(T,r.textVerticalBBox,C+90,D,I))}function F0(r,e,n,a,c,f,p,_,x){if(!e||!e.usvg)return;const T=xA(a),I=xA(c),C=f!=="both"&&f!=="width"||!yA(a)?1:I.width/T.width,P=f!=="both"&&f!=="height"||!vA(a)?1:I.height/T.height;n.scaleSelf(C,P);const D=n.toString();p.set(D,n),_.set(D,e);const{imagePosition:k}=Hb(D,e,yh);x.set(D,k)}function kA(r,e,n,a,c,f,p,_,x){if(!r)return;const T=function(I,C,P,D,k,j){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const H=C.possiblyEvaluate(new Bi(I.maxZoom,{worldview:j}),P).evaluate(k,{},P),$=C.possiblyEvaluate(new Bi(I.minZoom,{worldview:j}),P).evaluate(k,{},P);return Math.max(H,$)}return C.possiblyEvaluate(new Bi(D,{worldview:j})).evaluate(k,{},P)}(e,n,a,c,f,x);return r.scaleSelf(T*_*p)}function I_(r,e,n,a,c,f,p,_,x){return{iconPrimary:kA(r.getPrimary(),e,n,a,c,f,p,_,x),iconSecondary:kA(r.getSecondary(),e,n,a,c,f,p,_,x)}}function Z5(r,e,n){if(!e)return;const a=n.get(r.toString()),c=n.get(e.toString());a&&c&&(a.paddedRect.w===c.paddedRect.w&&a.paddedRect.h===c.paddedRect.h||Ot(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),a.usvg!==c.usvg&&Ot(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function zA(r,e,n,a){if(!r)return;const c=e.get(n.toString());if(r.imagePrimary=c,a){const f=e.get(a.toString());r.imageSecondary=f}}function X5(r,e){for(const n in r.horizontal)OA(r.horizontal[n],e);OA(r.vertical,e)}function OA(r,e){if(r){for(const n of r.positionedLines)for(const a of n.positionedGlyphs)if(a.image!==null){const c=a.image.toString();a.rect=e.get(c).paddedRect}}}function Xb(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Y5(r,e,n,a,c,f,p,_,x){const T=N0(f.horizontal)||f.vertical,I=n.get("icon-text-fit-padding").evaluate(a,{},c);let C,P=e;return e&&x!=="none"&&(r.allowVerticalPlacement&&f.vertical&&(C=$b(e,f.vertical,x,I,_,p)),T&&(P=$b(e,T,x,I,_,p))),{defaultShapedIcon:P,verticallyShapedIcon:C}}function K5(r,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K,ee,se,_e,fe,xe){let Ie=p.textMaxSize.evaluate(e,{},P);Ie===void 0?Ie=_*p.textScaleFactor:Ie*=p.textScaleFactor;const Pe=r.layers[0].layout,Xe=Xr,ke=_*p.textScaleFactor/Xe,Je=N0(n.horizontal)||n.vertical;if(H!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const Lt=r.appearanceFeatureData[e.index];Lt&&(Lt.textShaping=Je,Lt.iconTextFitPadding=Pe.get("icon-text-fit-padding").evaluate(e,{},P),Lt.fontScale=ke)}const rt=D.name==="globe",ot=r.tilePixelRatio*Ie/Xe,ht=(dt=r.overscaling,r.zoom>18&&dt>2&&(dt>>=1),Math.max(Et/(512*dt),1)*Pe.get("symbol-spacing")),pt=Pe.get("text-padding")*r.tilePixelRatio,ct=Pe.get("icon-padding")*r.tilePixelRatio,ut=Bn(Pe.get("text-max-angle")),Qe=Pe.get("icon-rotation-alignment")==="map"&&ee!=="point",Ye=ht/2;var dt;r.hasAnyIconTextFit===!1&&H!=="none"&&(r.hasAnyIconTextFit=!0);const It=e.properties?+e.properties[Ke]:null,vt=It&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(It):65535,Jt=(Lt,Nt,Wt)=>{if(Nt.x<0||Nt.x>=Et||Nt.y<0||Nt.y>=Et)return;let Fn=null;if(rt){const{x:wt,y:Zt,z:xn}=D.projectTilePoint(Nt.x,Nt.y,Wt);Fn={anchor:new $c(wt,Zt,xn,0,void 0),up:D.upVector(Wt,Nt.x,Nt.y)}}(function(wt,Zt,xn,Hn,qn,Cn,Ei,pe,ye,et,ft,Mt,Rt,en,rn,Sn,kn,On,Un,hn,vn,ti,si,ai,wi,Ri,Ii,ui,gi,zn,Wn,Ki,un){const Vn=wt.addToLineVertexArray(Zt,Hn);let Ci,ki,ji,br,Fi,dn,ir,bi=0,Xi=0,Fr=0,Yr=0,Rr=-1,Dr=-1;const Vr={};let es=pf("");const Ni=xn?xn.anchor:Zt,_r=ui!=="none";let Tr=0,as=0;if(ye._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _o=ye.layout.get("text-offset").evaluate(vn,{},wi);Tr=_o[0]*Xr,as=_o[1]*Xr}else Tr=ye.layout.get("text-radial-offset").evaluate(vn,{},wi)*Xr,as=Zb;if(wt.allowVerticalPlacement&&qn.vertical){const _o=qn.vertical;if(rn)dn=Yb(_o),pe&&(ir=Yb(pe));else{const Go=ye.layout.get("text-rotate").evaluate(vn,{},wi)+90;ji=B0(et,Ni,Zt,ft,Mt,Rt,_o,en,Go,Sn,Ki),pe&&(br=B0(et,Ni,Zt,ft,Mt,Rt,pe,On,Go,null,Wn))}}if(Cn){const _o=wt.iconSizeData,Go=ye.layout.get("icon-rotate").evaluate(vn,{},wi),Ts=qb(Cn,Go,si,_r,ti.iconScaleFactor),$u=pe?qb(pe,Go,si,_r,ti.iconScaleFactor):void 0;ki=B0(et,Ni,Zt,ft,Mt,Rt,Cn,On,Go,null,zn);const Gp=function(xl,G_,tM,cj,nM,iM,uj,dj){const rM=xl.layers[0],oM=rM.appearances;let Hp=G_.length;if(tM&&(Hp=Math.max(Hp,tM.length)),oM.length===0)return Hp;const[hj,fj]=cj.get("icon-size-scale-range"),pj=W(1,hj,fj);for(const sM of oM){const aM=sM.getUnevaluatedProperties();if(aM._values["icon-image"].value!==void 0){const lM=rM.getAppearanceValueAndResolveTokens(sM,"icon-image",nM,iM,[]);if(lM){const cM=xl.getResolvedImageFromTokens(lM);if(cM){const uM=aM._values["icon-size"],mj=I_(cM,kp(xl.zoom,uM,xl.worldview),uM,iM,xl.zoom,nM,xl.pixelRatio,pj,xl.worldview),gj=uj.get(mj.iconPrimary.toString());Hp=Math.max(Hp,B5(gj,dj))}}}}return Hp}(wt,Ts,$u,ye.layout,vn,wi,wt.iconAtlasPositions,_r);bi=4*Gp;let vl=null;_o.kind==="source"?(vl=[ml*ye.layout.get("icon-size").evaluate(vn,{},wi)*ti.iconScaleFactor],vl[0]>Gc&&Ot(`${wt.layerIds[0]}: Value for "icon-size" is >= ${C_}. Reduce your "icon-size".`)):_o.kind==="composite"&&(vl=[ml*ti.compositeIconSizes[0].evaluate(vn,{},wi)*ti.iconScaleFactor,ml*ti.compositeIconSizes[1].evaluate(vn,{},wi)*ti.iconScaleFactor],(vl[0]>Gc||vl[1]>Gc)&&Ot(`${wt.layerIds[0]}: Value for "icon-size" is >= ${C_}. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,Ts,vl,hn,Un,vn,void 0,xn,Zt,Vn.lineStartIndex,Vn.lineLength,-1,ai,wi,Ri,Ii,wt.symbolInstances.length,Gp),Rr=wt.icon.placedSymbolArray.length-1,$u&&(Xi=4*Gp,wt.addSymbols(wt.icon,$u,vl,hn,Un,vn,bs.vertical,xn,Zt,Vn.lineStartIndex,Vn.lineLength,-1,ai,wi,Ri,Ii,wt.symbolInstances.length,Gp),Dr=wt.icon.placedSymbolArray.length-1)}for(const _o in qn.horizontal){const Go=_o,Ts=qn.horizontal[Go];Ci||(es=pf(Ts.text),rn?Fi=Yb(Ts):Ci=B0(et,Ni,Zt,ft,Mt,Rt,Ts,en,ye.layout.get("text-rotate").evaluate(vn,{},wi),Sn,Ki));const $u=Ts.positionedLines.length===1;if(Fr+=FA(wt,xn,Zt,Ts,Ei,ye,rn,vn,Sn,Vn,qn.vertical?bs.horizontal:bs.horizontalOnly,$u?$5(qn.horizontal):[Go],Vr,Rr,ti,ai,wi,wt.symbolInstances.length,Ri),$u)break}qn.vertical&&(Yr+=FA(wt,xn,Zt,qn.vertical,Ei,ye,rn,vn,Sn,Vn,bs.vertical,["vertical"],Vr,Dr,ti,ai,wi,wt.symbolInstances.length,Ri));let Nr=-1;const ja=(_o,Go)=>_o?Math.max(_o,Go):Go;Nr=ja(Fi,Nr),Nr=ja(dn,Nr),Nr=ja(ir,Nr);const ic=Nr>-1?1:0;wt.glyphOffsetArray.length>=65535&&Ot("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,vn.sortKey),wt.symbolInstances.emplaceBack(Zt.x,Zt.y,Ni.x,Ni.y,Ni.z,Vr.right>=0?Vr.right:-1,Vr.center>=0?Vr.center:-1,Vr.left>=0?Vr.left:-1,Vr.vertical>=0?Vr.vertical:-1,Rr,Dr,es,Ci!==void 0?Ci:wt.collisionBoxArray.length,Ci!==void 0?Ci+1:wt.collisionBoxArray.length,ji!==void 0?ji:wt.collisionBoxArray.length,ji!==void 0?ji+1:wt.collisionBoxArray.length,ki!==void 0?ki:wt.collisionBoxArray.length,ki!==void 0?ki+1:wt.collisionBoxArray.length,br||wt.collisionBoxArray.length,br?br+1:wt.collisionBoxArray.length,ft,Fr,Yr,bi,Xi,ic,0,Tr,as,Nr,0,_r?1:0,gi)})(r,Nt,Fn,Lt,n,a,f,c,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,pt,K,T,0,ct,Qe,$,e,p,I,C,P,k,j,H,vt,se,_e,fe)};if(ee==="line")for(const Lt of x0(e.geometry,0,0,Et,Et)){const Nt=N5(Lt,ht,ut,n.vertical||Je,a,Xe,ot,r.overscaling,Et);for(const Wt of Nt)Je&&Q5(r,Je.text,Ye,Wt)||Jt(Lt,Wt,P)}else if(ee==="line-center"){for(const Lt of e.geometry)if(Lt.length>1){const Nt=F5(Lt,ut,n.vertical||Je,a,Xe,ot);Nt&&Jt(Lt,Nt,P)}}else if(e.type==="Polygon")for(const Lt of c_(e.geometry,0)){const Nt=U5(Lt,16);Jt(Lt[0],new $c(Nt.x,Nt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const Lt of e.geometry)Jt(Lt,new $c(Lt[0].x,Lt[0].y,0,0,void 0),P);else if(e.type==="Point")for(const Lt of e.geometry)for(const Nt of Lt)Jt([Nt],new $c(Nt.x,Nt.y,0,0,void 0),P)}const C_=255,Gc=C_*ml;function FA(r,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K){const ee=function(fe,xe,Ie,Pe,Xe,ke,Je,rt){const ot=[];if(xe.positionedLines.length===0)return ot;const ht=Pe.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,pt=function(dt){const It=dt[0],vt=dt[1],Jt=It*vt;return Jt>0?[It,-vt]:Jt<0?[-It,vt]:It===0?[vt,It]:[vt,-It]}(Ie);let ct=Math.abs(xe.top-xe.bottom);for(const dt of xe.positionedLines)ct-=dt.lineOffset;const ut=xe.positionedLines.length,Qe=ct/ut;let Ye=xe.top-Ie[1];for(let dt=0;dt<ut;++dt){const It=xe.positionedLines[dt];Ye=j5(xe,Qe,Ye,dt);for(const vt of It.positionedGlyphs){if(!vt.rect)continue;const Jt=vt.rect||{};let Lt=hA+1,Nt=!0,Wt=1,Fn=0;if(vt.image){const kn=Je.get(vt.image.toString());if(!kn)continue;if(kn.sdf){Ot("SDF images are not supported in formatted text and will be ignored.");continue}Nt=!1,Wt=kn.pixelRatio,Lt=yh/Wt}const wt=(Xe||rt)&&vt.vertical,Zt=vt.metrics.advance*vt.scale/2,xn=vt.metrics,Hn=vt.rect;if(Hn===null)continue;rt&&xe.verticalizable&&(Fn=vt.image?Zt-vt.metrics.width*vt.scale/2:0);const qn=Xe?[vt.x+Zt,vt.y]:[0,0];let Cn=[0,0],Ei=[0,0],pe=!1;Xe||(wt?(Ei=[vt.x+Zt+pt[0],vt.y+pt[1]-Fn],pe=!0):Cn=[vt.x+Zt+Ie[0],vt.y+Ie[1]-Fn]);const ye=Hn.w*vt.scale/(Wt*(vt.localGlyph?gl:1)),et=Hn.h*vt.scale/(Wt*(vt.localGlyph?gl:1));let ft,Mt,Rt,en;if(wt){const kn=vt.y-Ye,On=new at(-Zt,Zt-kn),Un=-Math.PI/2,hn=new at(...Ei);ft=new at(-Zt+Cn[0],Cn[1]),ft._rotateAround(Un,On)._add(hn),ft.x+=-kn+Zt,ft.y-=(xn.left-Lt)*vt.scale;const vn=vt.image?xn.advance*vt.scale:Xr*vt.scale,ti=String.fromCodePoint(vt.glyph);w5(ti)?ft.x+=(1-Lt)*vt.scale:b5(ti)?ft.x+=vn-xn.height*vt.scale+(-Lt-1)*vt.scale:ft.x+=vt.image||xn.width+2*Lt===Hn.w&&xn.height+2*Lt===Hn.h?(vn-et)/2:(vn-(xn.height+2*Lt)*vt.scale)/2,Mt=new at(ft.x,ft.y-ye),Rt=new at(ft.x+et,ft.y),en=new at(ft.x+et,ft.y-ye)}else{const kn=(xn.left-Lt)*vt.scale-Zt+Cn[0],On=(-xn.top-Lt)*vt.scale+Cn[1],Un=kn+ye,hn=On+et;ft=new at(kn,On),Mt=new at(Un,On),Rt=new at(kn,hn),en=new at(Un,hn)}if(ht){let kn;kn=Xe?new at(0,0):pe?new at(pt[0],pt[1]):new at(Ie[0],Ie[1]),ft._rotateAround(ht,kn),Mt._rotateAround(ht,kn),Rt._rotateAround(ht,kn),en._rotateAround(ht,kn)}const rn=new at(0,0),Sn=new at(0,0);ot.push({tl:ft,tr:Mt,bl:Rt,br:en,texPrimary:Jt,texSecondary:void 0,writingMode:xe.writingMode,glyphOffset:qn,sectionIndex:vt.sectionIndex,isSDF:Nt,pixelOffsetTL:rn,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,a,x,f,p,_,c,r.allowVerticalPlacement),se=r.textSizeData;let _e=null;se.kind==="source"?(_e=[ml*f.layout.get("text-size").evaluate(_,{},H)*k.textScaleFactor],_e[0]>Gc&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= ${C_}. Reduce your "text-size".`)):se.kind==="composite"&&(_e=[ml*k.compositeTextSizes[0].evaluate(_,{},H)*k.textScaleFactor,ml*k.compositeTextSizes[1].evaluate(_,{},H)*k.textScaleFactor],(_e[0]>Gc||_e[1]>Gc)&&Ot(`${r.layerIds[0]}: Value for "text-size" is >= ${C_}. Reduce your "text-size".`)),r.addSymbols(r.text,ee,_e,x,p,_,I,e,n,T.lineStartIndex,T.lineLength,D,j,H,K,!1,$,ee.length);for(const fe of C)P[fe]=r.text.placedSymbolArray.length-1;return 4*ee.length}function N0(r){for(const e in r)return r[e];return null}function B0(r,e,n,a,c,f,p,_,x,T,I){let C,P,D,k;if(C=I?I.top:p.top,P=I?I.bottom:p.bottom,D=I?I.left:p.left,k=I?I.right:p.right,Vb(p)&&p.collisionPadding){const j=p.collisionPadding;D-=j[0],C-=j[1],k+=j[2],P+=j[3]}if(x){const j=new at(D,C),H=new at(k,C),$=new at(D,P),K=new at(k,P),ee=Bn(x);let se=new at(0,0);T&&(se=new at(T[0],T[1])),j._rotateAround(ee,se),H._rotateAround(ee,se),$._rotateAround(ee,se),K._rotateAround(ee,se),D=Math.min(j.x,H.x,$.x,K.x),k=Math.max(j.x,H.x,$.x,K.x),C=Math.min(j.y,H.y,$.y,K.y),P=Math.max(j.y,H.y,$.y,K.y)}return r.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,C,k,P,_,a,c,f),r.length-1}function Yb(r){Vb(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Q5(r,e,n,a){const c=r.compareText;if(e in c){const f=c[e];for(let p=f.length-1;p>=0;p--)if(a.dist(f[p])<n)return!0}else c[e]=[];return c[e].push(a),!1}function NA(r,e){const n=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,c=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),f=Math.sin(n)*c/Math.sin(Math.max(Math.PI/2-r._pitch-n,.01));let p=Math.sin(r._pitch)*f+c;const _=c*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let x=Math.max(r.zoom-17,0);r.isOrthographic&&(x/=10),p*=1+x}return Math.min(1.01*p,_)}function A_(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const n=Math.pow(2,-r.z),a=r.x*n,c=(r.x+1)*n,f=r.y*n,p=(r.y+1)*n,_=M(a),x=M(c),T=O(f),I=O(p),C=e.project(_,T),P=e.project(x,T),D=e.project(x,I),k=e.project(_,I);let j=Math.min(C.x,P.x,D.x,k.x),H=Math.min(C.y,P.y,D.y,k.y),$=Math.max(C.x,P.x,D.x,k.x),K=Math.max(C.y,P.y,D.y,k.y);const ee=n/16;function se(fe,xe,Ie,Pe,Xe,ke){const Je=(Ie+Xe)/2,rt=(Pe+ke)/2,ot=e.project(M(Je),O(rt)),ht=Math.max(0,j-ot.x,H-ot.y,ot.x-$,ot.y-K);j=Math.min(j,ot.x),$=Math.max($,ot.x),H=Math.min(H,ot.y),K=Math.max(K,ot.y),ht>ee&&(se(fe,ot,Ie,Pe,Je,rt),se(ot,xe,Je,rt,Xe,ke))}se(C,P,a,f,c,f),se(P,D,c,f,c,p),se(D,k,c,p,a,p),se(k,C,a,p,a,f),j-=ee,H-=ee,$+=ee,K+=ee;const _e=1/Math.max($-j,K-H);return{scale:_e,x:j*_e,y:H*_e,x2:$*_e,y2:K*_e,projection:e}}function BA(r,{x:e,y:n},a=0){return new at(((e-a)*r.scale-r.x)*Et,(n*r.scale-r.y)*Et)}const J5=le(new Float32Array(16));class Uu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new s(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a,c=!0){return e._coordinatePoint(e.locationCoordinate(n,a),c)}pixelsPerMeter(e,n){return A(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return NA(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,c){const f=e.horizonLineFromTop(!1),p=new at(n,Math.max(f,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,n,a){const c=new at(n,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return J5}createTileMatrix(e,n,a){let c,f,p;const _=a.canonical,x=le(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=A_(_,this);c=1,f=T.x+a.wrap*T.scale,p=T.y,Me(x,x,[c/T.scale,c/T.scale,e.pixelsPerMeter/n])}else c=n/e.zoomScale(_.z),f=(_.x+Math.pow(2,_.z)*a.wrap)*c,p=_.y*c;return ue(x,x,[f,p,0]),Me(x,x,[c/Et,c/Et,1]),x}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class e4 extends Uu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Bn(n));this.n=(c+Math.sin(Bn(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:a,c,r0:f}=this,p=Bn(e-this.center[0]),_=Bn(n),x=Math.sqrt(c-2*a*Math.sin(_))/a;return{x:x*Math.sin(p*a),y:x*Math.cos(p*a)-f,z:0}}unproject(e,n){const{n:a,c,r0:f}=this,p=f+n;let _=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));const x=Bn(this.center[0])*a;_=de(_,-Math.PI-x,Math.PI-x);const T=W(Ro(_/a)+this.center[0],-180,180),I=Math.asin(W((c-(e*e+p*p)*a*a)/(2*a),-1,1)),C=W(Ro(I),-F,F);return new s(T,C)}}const P_=1.340264,M_=-.081106,R_=893e-6,D_=.003796,j0=Math.sqrt(3)/2;class t4 extends Uu{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(j0*Math.sin(n)),c=a*a,f=c*c*c;return{x:.5*(e*Math.cos(a)/(j0*(P_+3*M_*c+f*(7*R_+9*D_*c)))/Math.PI+.5),y:1-.5*(a*(P_+M_*c+f*(R_+D_*c))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=a*a,f=c*c*c;for(let I,C,P,D=0;D<12&&(C=a*(P_+M_*c+f*(R_+D_*c))-n,P=P_+3*M_*c+f*(7*R_+9*D_*c),I=C/P,a=W(a-I,-Math.PI/3,Math.PI/3),c=a*a,f=c*c*c,!(Math.abs(I)<1e-12));++D);const p=j0*e*(P_+3*M_*c+f*(7*R_+9*D_*c))/Math.cos(a),_=Math.asin(Math.sin(a)/j0),x=W(180*p/Math.PI,-180,180),T=W(180*_/Math.PI,-F,F);return new s(x,T)}}class n4 extends Uu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const a=360*(e-.5),c=W(360*(.5-n),-F,F);return new s(a,c)}}const Np=Math.PI/2;function U0(r){return Math.tan((Np+r)/2)}class i4 extends Uu{constructor(e){super(e),this.center=e.center||[0,30];const[n,a]=this.parallels=e.parallels||[30,30];let c=Bn(n),f=Bn(a);this.southernCenter=c+f<0,this.southernCenter&&(c=-c,f=-f);const p=Math.cos(c),_=U0(c);this.n=c===f?Math.sin(c):Math.log(p/Math.cos(f))/Math.log(U0(f)/_),this.f=p*Math.pow(U0(c),this.n)/this.n}project(e,n){n=Bn(n),this.southernCenter&&(n=-n),e=Bn(e-this.center[0]);const a=1e-6,{n:c,f}=this;f>0?n<-Np+a&&(n=-Np+a):n>Np-a&&(n=Np-a);const p=f/Math.pow(U0(n),c);let _=p*Math.sin(c*e),x=f-p*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:c}=this,f=c-n,p=Math.sign(f),_=Math.sign(a)*Math.sqrt(e*e+f*f);let x=Math.atan2(e,Math.abs(f))*p;f*a<0&&(x-=Math.PI*Math.sign(e)*p);const T=W(Ro(x/a)+this.center[0],-180,180),I=W(Ro(2*Math.atan(Math.pow(c/_,1/a))-Np),-F,F);return new s(T,this.southernCenter?-I:I)}}class jA extends Uu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:b(e),y:E(n),z:0}}unproject(e,n){const a=M(e),c=O(n);return new s(a,c)}}const UA=Bn(F);class r4 extends Uu{project(e,n){const a=(n=Bn(n))*n,c=a*a;return{x:.5*((e=Bn(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,c=25,f=0,p=a*a;do{p=a*a;const T=p*p;f=(a*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-n)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),a=W(a-f,-UA,UA)}while(Math.abs(f)>1e-6&&--c>0);p=a*a;const _=W(Ro(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=Ro(a);return new s(_,x)}}const VA=Bn(F);class o4 extends Uu{project(e,n){n=Bn(n),e=Bn(e);const a=Math.cos(n),c=2/Math.PI,f=Math.acos(a*Math.cos(e/2)),p=Math.sin(f)/f,_=.5*(e*c+2*a*Math.sin(e/2)/p)||0,x=.5*(n+Math.sin(n)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,c=n=(2*(1-n)-1)*Math.PI,f=25;const p=1e-6;let _=0,x=0;do{const T=Math.cos(c),I=Math.sin(c),C=2*I*T,P=I*I,D=T*T,k=Math.cos(a/2),j=Math.sin(a/2),H=2*k*j,$=j*j,K=1-D*k*k,ee=K?1/K:0,se=K?Math.acos(T*k)*Math.sqrt(1/K):0,_e=.5*(2*se*T*j+2*a/Math.PI)-e,fe=.5*(se*I+c)-n,xe=.5*ee*(D*$+se*T*k*P)+1/Math.PI,Ie=ee*(H*C/4-se*I*j),Pe=.125*ee*(C*j-se*I*D*H),Xe=.5*ee*(P*k+se*$*T)+.5,ke=Ie*Pe-Xe*xe;_=(fe*Ie-_e*Xe)/ke,x=(_e*Pe-fe*xe)/ke,a=W(a-_,-Math.PI,Math.PI),c=W(c-x,-VA,VA)}while((Math.abs(_)>p||Math.abs(x)>p)&&--f>0);return new s(Ro(a),Ro(c))}}class $A extends Uu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Bn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:a,cosPhi:c}=this;return{x:Bn(e)*c*a+.5,y:-Math.sin(Bn(n))/c*a+.5,z:0}}unproject(e,n){const{scale:a,cosPhi:c}=this,f=-(n-.5)/a,p=W(Ro((e-.5)/a)/c,-180,180),_=Math.asin(W(f*c,-1,1)),x=W(Ro(_),-F,F);return new s(p,x)}}class s4 extends jA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){const c=i_(e,n,a);return li(c,c,d0(ha(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,n,a){const c=ku(n.lat,n.lng),f=_n([],c),p=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;mn(c,c,f,A(1,0)*Et*p);const _=le(new Float64Array(16));return oe(_,e.pixelMatrix,e.globeMatrix),li(c,c,_),new at(c[0],c[1])}pixelsPerMeter(e,n){return A(1,0)*n}pixelSpaceConversion(e,n,a){const c=A(1,e)*n,f=fn(A(1,45)*n,c,a);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,a){const c=tb(ha(a.canonical));return oe(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,n){const{center:a}=e,c=d0(ha(n));return je(c,c,Bn(a.lng)),Ne(c,c,Bn(a.lat)),Me(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,n,a,c){return Ou(e,n,a,!0)||new ne(0,0)}pointCoordinate3D(e,n,a){const c=this.pointCoordinate(e,n,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,n){return!Ou(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(c,f){const p=c.cameraToCenterDistance,_=c._centerAltitude*f,x=c._camera,T=c._camera.forward(),I=ze([],Kt([],T,-p),[0,0,_]),C=c.worldSize/(2*Math.PI),P=[0,0,-C],D=c.width/c.height,k=Math.tan(c.fovAboveCenter),j=Kt([],x.up(),k),H=Kt([],x.right(),k*D),$=_n([],ze([],ze([],T,j),H)),K=[];let ee;if(new Ut(I,$).closestPointOnSphere(P,C,K)){const se=ze([],K,P),_e=Di([],se,I);ee=Math.cos(c.fovAboveCenter)*Tt(_e)}else{const se=Di([],I,P),_e=Di([],P,I);_n(_e,_e);const fe=Tt(se)-C;ee=Math.sqrt(fe*(fe+2*C));const xe=Math.acos(ee/(C+fe))-Math.acos(En(T,_e));ee*=Math.cos(xe)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Fu(e.zoom);if(a>0){const c=NA(e,A(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return fn(n,c+f*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return i_(n,a,e,1)}upVectorScale(e){return{metersToTile:Na(u0(ha(e)))}}}function GA(r){const e=r.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new jA(r);case"equirectangular":return new n4(r);case"naturalEarth":return new r4(r);case"equalEarth":return new t4(r);case"winkelTripel":return new o4(r);case"albers":return n?new $A(r):new e4(r);case"lambertConformalConic":return n?new $A(r):new i4(r);case"globe":return new s4(r)}throw new Error(`Invalid projection name: ${r.name}`)}const a4=Re.types,l4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function L_(r,e,n,a,c,f,p,_,x,T,I,C,P){const D=_?Math.min(Gc,Math.round(_[0])):0,k=_?Math.min(Gc,Math.round(_[1])):0;r.emplaceBack(e,n,Math.round(32*a),Math.round(32*c),f,p,(D<<1)+(x?1:0),0+(k<<1),16*T,16*I,256*C,256*P)}function k_(r,e,n){r.emplaceBack(e,n)}function z_(r,e,n,a,c,f,p){r.emplaceBack(e,n,a,c,f,p)}const V0=(r,e,n,a)=>{for(let c=0;c<e;c++)r.emplaceBack(n[0],n[1],n[2],a[0],a[1],a[2])};function Bp(r,e,n,a,c){r.emplaceBack(e,n,a,c),r.emplaceBack(e,n,a,c),r.emplaceBack(e,n,a,c),r.emplaceBack(e,n,a,c)}function c4(r){for(const e of r.sections)if(Bw(e.text))return!0;return!1}class Kb{constructor(e){this.layoutVertexArray=new jg,this.indexArray=new kr,this.programConfigurations=e,this.segments=new er,this.dynamicLayoutVertexArray=new Kl,this.opacityVertexArray=new lp,this.placedSymbolArray=new i0,this.iconTransitioningVertexArray=new vs,this.globeExtVertexArray=new Ug,this.zOffsetVertexArray=new sl,this.orientationVertexArray=new Gg,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,n){const a=[],c=this.layoutVertexArray.uint16;for(let f=0;f<n;++f){const p=12*(e+f);a.push(...c.slice(p,p+12))}return a}updateIconVertexData(e,n,a,c,f,p,_,x,T,I,C,P,D){const k=this.layoutVertexArray.uint16,j=12*e;k[j]=n,k[j+1]=a,k[j+2]=c,k[j+3]=f,k[j+4]=p,k[j+5]=_,k[j+6]=x,k[j+7]=T,k[j+8]=I,k[j+9]=C,k[j+10]=P,k[j+11]=D}upload(e,n,a,c,f,p){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d5.members,!!p),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,f5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,l4,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,g5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,h5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,p5.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,m5.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}jt(Kb,"SymbolBuffers");class Qb{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new er,this.collisionVertexArray=new Vg,this.collisionVertexArrayExt=new Kl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,_5.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,y5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt(Qb,"CollisionBuffers");class $0{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=le([]),this.placementViewportMatrix=le([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=kp(this.zoom,n["text-size"],this.worldview),this.iconSizeData=kp(this.zoom,n["icon-size"],this.worldview);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>bs[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();return!(!n||n.length===0)&&n.some(a=>a.getProperty(e)!=null)}createArrays(){this.text=new Kb(new ua(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Kb(new ua(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new gp,this.lineVertexArray=new o0,this.symbolInstances=new Xg}calculateGlyphDependencies(e,n,a,c,f){for(const p of e){const _=p.codePointAt(0);if(_===void 0)break;if(n[_]=!0,c&&f&&_<=65535){const x=b_[p];x&&(n[x.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,a,c,f,p){let _=1;const x=e.getUnevaluatedProperties()._values["icon-size"],T=kp(this.zoom,x,this.worldview),I=zp(T,n);if(T.kind!=="constant"&&T.kind!=="camera"||(_=I.uSize),T.kind==="composite"){const{minZoom:C,maxZoom:P}=T,D=x.possiblyEvaluate(new Bi(C,{worldview:this.worldview}),c),k=x.possiblyEvaluate(new Bi(P,{worldview:this.worldview}),c),j=D.evaluate(a,{},c,f);_=j+(k.evaluate(a,{},c,f)-j)*I.uSizeT}return T.kind==="source"&&(_=x.possiblyEvaluate(new Bi(this.zoom,{worldview:this.worldview}),c).evaluate(a,{},c,f)),_*p}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!_0(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Bo.build(e):e}populate(e,n,a,c){const f=this.layers[0],p=f.layout,_=this.projection.name==="globe",x=p.get("text-font"),T=p.get("text-field"),I=p.get("icon-image"),[C,P]=p.get("icon-size-scale-range"),D=W(n.scaleFactor||1,C,P),k=(T.value.kind!=="constant"||T.value.value instanceof No&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),j=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,H=this.hasAnyAppearanceProperty("icon-image"),$=p.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!k&&!j&&!H)return;const K=n.iconDependencies,ee=n.glyphDependencies,se=n.availableImages,_e=new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),fe=xe=>{const Ie=xe.id.toString();K.has(Ie)?K.get(Ie).push(xe):K.set(Ie,[xe])};for(const xe of e){const{feature:Ie,id:Pe,index:Xe,sourceLayerIndex:ke}=xe,Je=f._featureFilter.needGeometry,rt=Le(Ie,Je);if(!f._featureFilter.filter(_e,rt,a))continue;if(Je||(rt.geometry=Se(Ie,a,c)),_&&Ie.type!==1&&a.z<=5){const dt=rt.geometry,It=.98078528056,vt=(Jt,Lt)=>En(i_(Jt.x,Jt.y,a,1),i_(Lt.x,Lt.y,a,1))<It;for(let Jt=0;Jt<dt.length;Jt++)dt[Jt]=ge(dt[Jt],vt)}let ot,ht;if(k){const dt=f.getValueAndResolveTokens("text-field",rt,a,se),It=No.factory(dt);c4(It)&&(this.hasRTLText=!0),(!this.hasRTLText||th()==="unavailable"||this.hasRTLText&&ol.isParsed())&&(ot=x5(It,f,rt))}if(j){const dt=f.getValueAndResolveTokens("icon-image",rt,a,se);ht=this.getResolvedImageFromTokens(dt)}const pt=this.layers[0];let ct=!1;if(!ht&&H){const dt=pt.getAppearances();for(const It of dt)if(It.getProperty("icon-image")){const vt=pt.getAppearanceValueAndResolveTokens(It,"icon-image",rt,a,se);if(vt){ht=this.getResolvedImageFromTokens(vt),ct=!0;break}}}if(!ot&&!ht)continue;const ut=this.sortFeaturesByKey?$.evaluate(rt,{},a):void 0,Qe={id:Pe,text:ot,icon:ht,index:Xe,sourceLayerIndex:ke,geometry:rt.geometry,properties:Ie.properties,type:a4[Ie.type],sortKey:ut};if(this.features.push(Qe),this.featureToAppearanceIndex[Xe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Pe,properties:Ie.properties,usesAppearanceIconAsPlaceholder:ct,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),ht){const dt=pt._unevaluatedLayout._values,{iconPrimary:It,iconSecondary:vt}=I_(ht,this.iconSizeData,dt["icon-size"],a,this.zoom,Qe,this.pixelRatio,D,this.worldview);fe(It),vt&&(this.hasAnySecondaryIcon=!0,fe(vt))}const Ye=pt.getAppearances();if(Ye.length!==0&&Ye.forEach(dt=>{if(!dt.getProperty("icon-image"))return;const It=this.getCombinedIconPrimary(dt,pt,rt,a,se,Qe,D);It&&fe(It)}),ot){const dt=x.evaluate(rt,{},a).join(","),It=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(bs.vertical)>=0;for(const vt of ot.sections)if(vt.image){const Jt=vt.image.getPrimary().scaleSelf(this.pixelRatio),Lt=Jt.id.toString(),Nt=K.get(Lt)||[];Nt.push(Jt),K.set(Lt,Nt)}else{const Jt=Jd(ot.toString()),Lt=vt.fontStack||dt,Nt=ee[Lt]=ee[Lt]||{};this.calculateGlyphDependencies(vt.text,Nt,It,this.allowVerticalPlacement,Jt)}}}if(p.get("symbol-placement")==="line"&&(this.features=function(xe){const Ie={},Pe={},Xe=[];let ke=0;function Je(pt){Xe.push(xe[pt]),ke++}function rt(pt,ct,ut){const Qe=Pe[pt];return delete Pe[pt],Pe[ct]=Qe,Xe[Qe].geometry[0].pop(),Xe[Qe].geometry[0]=Xe[Qe].geometry[0].concat(ut[0]),Qe}function ot(pt,ct,ut){const Qe=Ie[ct];return delete Ie[ct],Ie[pt]=Qe,Xe[Qe].geometry[0].shift(),Xe[Qe].geometry[0]=ut[0].concat(Xe[Qe].geometry[0]),Qe}function ht(pt,ct,ut){const Qe=ut?ct[0][ct[0].length-1]:ct[0][0];return`${pt}:${Qe.x}:${Qe.y}`}for(let pt=0;pt<xe.length;pt++){const ct=xe[pt],ut=ct.geometry,Qe=ct.text?ct.text.toString():null;if(!Qe){Je(pt);continue}const Ye=ht(Qe,ut),dt=ht(Qe,ut,!0);if(Ye in Pe&&dt in Ie&&Pe[Ye]!==Ie[dt]){const It=ot(Ye,dt,ut),vt=rt(Ye,dt,Xe[It].geometry);delete Ie[Ye],delete Pe[dt],Pe[ht(Qe,Xe[vt].geometry,!0)]=vt,Xe[It].geometry=null}else Ye in Pe?rt(Ye,dt,ut):dt in Ie?ot(Ye,dt,ut):(Je(pt),Ie[Ye]=ke-1,Pe[dt]=ke-1)}return Xe.filter(pt=>pt.geometry)}(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const xe of n.elevationFeatures)this.elevationFeatureIdToIndex.set(xe.id,this.elevationFeatures.length),this.elevationFeatures.push(xe)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((xe,Ie)=>xe.sortKey-Ie.sortKey)}getCombinedIconPrimary(e,n,a,c,f,p,_){let x,T;const I=e.getUnevaluatedProperties();if(I._values["icon-image"].value!==void 0){const C=n.getAppearanceValueAndResolveTokens(e,"icon-image",a,c,f);x=this.getResolvedImageFromTokens(C)}else{const C=n.getValueAndResolveTokens("icon-image",a,c,f);x=this.getResolvedImageFromTokens(C)}if(x){const C=I._values["icon-size"]||n._unevaluatedLayout._values["icon-size"];T=I_(x,kp(this.zoom,C,this.worldview),C,c,this.zoom,p,this.pixelRatio,_,this.worldview).iconPrimary}return T}updateAppearanceBasedIconTextures(e,n,a,c){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const f=this.layers[0];let p=!1,_=0;const x=f.layout,[T,I]=x.get("icon-size-scale-range"),C=W(1,T,I);for(let P=0;P<this.symbolInstances.length;P++){const D=this.symbolInstances.get(P),k=this.featureToAppearanceIndex[D.featureIndex],j=k!==void 0?this.appearanceFeatureData[k]:void 0;if(j&&D.placedIconSymbolIndex>=0){const H=j.id,$=n&&H!==void 0?n[String(H)]:void 0,K={type:"Point",id:j.id,properties:j.properties,geometry:[]},ee=this.layers[0].appearances&&this.layers[0].appearances.find(se=>se.isActive({globals:c,feature:K,canonical:e,featureState:$}));if(j.activeAppearance===ee){_+=D.numIconVertices;continue}if(ee){j.activeAppearance=ee;const se=this.getCombinedIconPrimary(ee,f,K,e,a,{sortKey:void 0,text:void 0,icon:null,index:D.featureIndex,sourceLayerIndex:D.featureIndex,geometry:[],properties:j.properties,type:"Point",id:j.id},C);if(!se)continue;const _e=se.toString(),fe=this.iconAtlasPositions&&this.iconAtlasPositions.get(_e);if(fe){const xe=f.getAppearanceValueAndResolveTokens(ee,"icon-offset",K,e,a),Ie=xe&&Array.isArray(xe)?xe:[0,0];let Pe=L0(fe,void 0,Ie,f.layout.get("icon-anchor").evaluate(K,{},e));const Xe=f.getAppearanceValueAndResolveTokens(ee,"icon-rotate",K,e,a),ke=typeof Xe=="number"?Xe:0,Je=fe.sdf,rt=f.layout.get("icon-text-fit").constantOr("none");rt!=="none"&&j.textShaping&&j.iconTextFitPadding&&j.fontScale&&(Pe=$b(Pe,j.textShaping,rt,j.iconTextFitPadding,Ie,j.fontScale));const ot=this.calculateEffectiveAppearanceIconSize(ee,c.zoom,K,e,a,C),ht=0,pt=1+(Math.min(Gc,Math.round(ot*ml))<<1),ct=qb(Pe,ke,Je,rt!=="none",C);j.isUsingAppearanceVertexData||(j.isUsingAppearanceVertexData=!0,j.layoutBasedVertexData=this.icon.getIconVertexData(_,D.numIconVertices));for(let Qe=0;Qe<ct.length;++Qe){const Ye=ct[Qe],dt=j.layoutBasedVertexData[0]||D.tileAnchorX,It=j.layoutBasedVertexData[1]||D.tileAnchorY,vt=16*Ye.pixelOffsetTL.x,Jt=16*Ye.pixelOffsetTL.y,Lt=16*Ye.pixelOffsetBR.x,Nt=16*Ye.pixelOffsetBR.y,Wt=16*Ye.minFontScaleX,Fn=16*Ye.minFontScaleY;this.icon.updateIconVertexData(_,dt,It,Math.round(32*Ye.tl.x),Math.round(32*Ye.tl.y),Ye.texPrimary.x,Ye.texPrimary.y,ht,pt,vt,Jt,Wt,Fn),this.icon.updateIconVertexData(_+1,dt,It,Math.round(32*Ye.tr.x),Math.round(32*Ye.tr.y),Ye.texPrimary.x+Ye.texPrimary.w,Ye.texPrimary.y,ht,pt,Lt,Jt,Wt,Fn),this.icon.updateIconVertexData(_+2,dt,It,Math.round(32*Ye.bl.x),Math.round(32*Ye.bl.y),Ye.texPrimary.x,Ye.texPrimary.y+Ye.texPrimary.h,ht,pt,vt,Nt,Wt,Fn),this.icon.updateIconVertexData(_+3,dt,It,Math.round(32*Ye.br.x),Math.round(32*Ye.br.y),Ye.texPrimary.x+Ye.texPrimary.w,Ye.texPrimary.y+Ye.texPrimary.h,ht,pt,Lt,Nt,Wt,Fn),_+=4}const ut=D.numIconVertices-4*ct.length;for(let Qe=0;Qe<ut;++Qe)this.icon.updateIconVertexData(_+Qe,0,0,0,0,0,0,0,0,0,0,0,0);p=!0}else _+=D.numIconVertices}else if(j.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(_,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(_+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(_+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(_+3,0,0,0,0,0,0,0,0,0,0,0,0),p=!0),_+=D.numIconVertices,j.activeAppearance=null;else if(j.isUsingAppearanceVertexData){const _e=j.layoutBasedVertexData.length/12;for(let fe=0;fe<_e;++fe){const xe=fe*12;this.icon.updateIconVertexData(_+fe,j.layoutBasedVertexData[xe+0],j.layoutBasedVertexData[xe+1],j.layoutBasedVertexData[xe+2],j.layoutBasedVertexData[xe+3],j.layoutBasedVertexData[xe+4],j.layoutBasedVertexData[xe+5],j.layoutBasedVertexData[xe+6],j.layoutBasedVertexData[xe+7],j.layoutBasedVertexData[xe+8],j.layoutBasedVertexData[xe+9],j.layoutBasedVertexData[xe+10],j.layoutBasedVertexData[xe+11])}_+=_e,j.isUsingAppearanceVertexData=!1,j.activeAppearance=null,p=!0}else _+=D.numIconVertices,j.activeAppearance=null}}return p}update(e,n,a,c,f,p,_){this.text.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,f,a,c,p,_,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const a=Z(e),c=1/a;let f=!1,p=!1;for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_),T=xt(1,0,0),I=xt(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:P,numIconVertices:D,numVerticalIconVertices:k}=x,j=C>0||P>0,H=D>0,$=this.elevationFeatures[x.elevationFeatureIndex];if($){const K=new at(x.tileAnchorX,x.tileAnchorY),ee=.075+$.pointElevation(K);x.zOffset!==ee&&(n=!0,x.zOffset=ee),ee!==0&&(this.hasAnyZOffset=!0);const se=$.computeSlopeNormal(K,c),_e=Ta(Js(),xt(0,0,1),se);Qr(T,T,_e),Qr(I,I,_e),T[2]*=a,I[2]*=a,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(f=f||j,p=p||H)}if(j&&(V0(this.text.orientationVertexArray,C,T,I),V0(this.text.orientationVertexArray,P,T,I)),H){const{placedIconSymbolIndex:K,verticalPlacedIconSymbolIndex:ee}=x;K>=0&&V0(this.icon.orientationVertexArray,D,T,I),ee>=0&&V0(this.icon.orientationVertexArray,k,T,I)}}f||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,p,_)=>{a+=p,a>f.length&&f.resize(a);for(let x=-p;x<0;x++)f.emplace(x+a,_)},n=(f,p,_)=>{c+=p,c>f.length&&f.resize(c);for(let x=-p;x<0;x++)f.emplace(x+c,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:T}=p,I=p.zOffset,C=T>0;if((_>0||x>0)&&(e(this.text.zOffsetVertexArray,_,I),e(this.text.zOffsetVertexArray,x,I)),C){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:D}=p;P>=0&&n(this.icon.zOffsetVertexArray,T,I),D>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,a,c,f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(p=>p.appearances&&p.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,a,c){return!!(e&&n&&a)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,n,a,c)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=GA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:f}of n)this.lineVertexArray.emplaceBack(c,f);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,c,f,p,_,x,T,I,C,P,D,k,j,H,$,K){const ee=e.indexArray,se=e.layoutVertexArray,_e=e.globeExtVertexArray,fe=e.segments.prepareSegment(4*K,se,ee,this.canOverlap?p.sortKey:void 0),xe=this.glyphOffsetArray.length,Ie=fe.vertexLength,Pe=this.allowVerticalPlacement&&_===bs.vertical?Math.PI/2:0,Xe=p.text&&p.text.sections;for(let rt=0;rt<n.length;rt++){const{tl:ot,tr:ht,bl:pt,br:ct,texPrimary:ut,texSecondary:Qe,pixelOffsetTL:Ye,pixelOffsetBR:dt,minFontScaleX:It,minFontScaleY:vt,glyphOffset:Jt,isSDF:Lt,sectionIndex:Nt}=n[rt],Wt=fe.vertexLength,Fn=Jt[1];if(L_(se,T.x,T.y,ot.x,Fn+ot.y,ut.x,ut.y,a,Lt,Ye.x,Ye.y,It,vt),L_(se,T.x,T.y,ht.x,Fn+ht.y,ut.x+ut.w,ut.y,a,Lt,dt.x,Ye.y,It,vt),L_(se,T.x,T.y,pt.x,Fn+pt.y,ut.x,ut.y+ut.h,a,Lt,Ye.x,dt.y,It,vt),L_(se,T.x,T.y,ct.x,Fn+ct.y,ut.x+ut.w,ut.y+ut.h,a,Lt,dt.x,dt.y,It,vt),x){const{x:wt,y:Zt,z:xn}=x.anchor,[Hn,qn,Cn]=x.up;z_(_e,wt,Zt,xn,Hn,qn,Cn),z_(_e,wt,Zt,xn,Hn,qn,Cn),z_(_e,wt,Zt,xn,Hn,qn,Cn),z_(_e,wt,Zt,xn,Hn,qn,Cn),Bp(e.dynamicLayoutVertexArray,wt,Zt,xn,Pe)}else Bp(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Pe);if(H){const wt=Qe||ut;k_(e.iconTransitioningVertexArray,wt.x,wt.y),k_(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y),k_(e.iconTransitioningVertexArray,wt.x,wt.y+wt.h),k_(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y+wt.h)}ee.emplaceBack(Wt,Wt+1,Wt+2),ee.emplaceBack(Wt+1,Wt+2,Wt+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jt[0]),rt!==n.length-1&&Nt===n[rt+1].sectionIndex||e.programConfigurations.populatePaintArrays(se.length,p,p.index,{},D,k,j,Xe&&Xe[Nt],this.worldview)}const ke=K-n.length;ke!==0&&this._addNullVertices(ke,se,a,x,_e,e,H,fe,ee);const Je=x?x.anchor:T;e.placedSymbolArray.emplaceBack(Je.x,Je.y,Je.z,T.x,T.y,xe,this.glyphOffsetArray.length-xe,Ie,I,C,T.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],_,0,0,0,P,0),e.symbolInstanceIndices.push($)}_addNullVertices(e,n,a,c,f,p,_,x,T){for(let I=0;I<e;I++){for(let P=0;P<4;P++)L_(n,0,0,0,0,0,0,a,!1,0,0,0,0),c&&z_(f,0,0,0,0,0,0),Bp(p.dynamicLayoutVertexArray,0,0,0,0),_&&k_(p.iconTransitioningVertexArray,0,0);const C=x.vertexLength;T.emplaceBack(C,C+1,C+2),T.emplaceBack(C+1,C+2,C+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,a,c,f,p,_){e.emplaceBack(n,a,c,f,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,n,a,c,f,p,_){const x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),T=x.vertexLength,I=_.tileAnchorX,C=_.tileAnchorY;for(let D=0;D<4;D++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,f,p,I,C,new at(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,f,p,I,C,new at(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,f,p,I,C,new at(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,f,p,I,C,new at(e.x1,e.y2)),x.vertexLength+=4;const P=a.indexArray;P.emplaceBack(T,T+1),P.emplaceBack(T+1,T+2),P.emplaceBack(T+2,T+3),P.emplaceBack(T+3,T),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,c,f,p){for(let _=c;_<f;_++){const x=a.get(_),T=this.getSymbolInstanceTextSize(e,p,n,_);this._addCollisionDebugVertices(x,T,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,c,f,p){for(let _=c;_<f;_++){const x=a.get(_),T=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(x,T,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qb(up,lA.members,vs),this.iconCollisionBox=new Qb(up,lA.members,vs);const c=zp(this.iconSizeData,e),f=zp(this.textSizeData,e,a);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(f,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,n,a,c){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=Gb(this.textSizeData,e,f)/Xr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){const c=this.icon.placedSymbolArray.get(a),f=Gb(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,a,c){e.emplaceBack(n,-a,-a,c),e.emplaceBack(n,a,-a,c),e.emplaceBack(n,a,a,c),e.emplaceBack(n,-a,a,c)}_updateTextDebugCollisionBoxes(e,n,a,c,f,p,_){for(let x=c;x<f;x++){const T=a.get(x),I=this.getSymbolInstanceTextSize(e,p,n,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,c,f,p,_){for(let x=c;x<f;x++){const T=a.get(x),I=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n,a,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=zp(this.iconSizeData,e,c),p=zp(this.textSizeData,e,a);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(p,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x,a),this._updateTextDebugCollisionBoxes(p,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,a),this._updateIconDebugCollisionBoxes(f,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x,c),this._updateIconDebugCollisionBoxes(f,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,c,f,p,_,x,T){const I={};if(n<a){const{x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(n);I.textBox={x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se},I.textFeatureIndex=_e}if(c<f){const{x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(c);I.verticalTextBox={x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se},I.verticalTextFeatureIndex=_e}if(p<_){const{x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(p);I.iconBox={x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se},I.iconFeatureIndex=_e}if(x<T){const{x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se,featureIndex:_e}=e.get(x);I.verticalIconBox={x1:C,y1:P,x2:D,y2:k,padding:j,projectedAnchorX:H,projectedAnchorY:$,projectedAnchorZ:K,tileAnchorX:ee,tileAnchorY:se},I.verticalIconFeatureIndex=_e}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),c=[],f=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.tileAnchorX+a*x.tileAnchorY)),f.push(x.featureIndex)}return p.sort((_,x)=>c[_]-c[x]||f[x]-f[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:T}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let a;return this.elevationFeatures&&n<this.elevationFeatures.length&&(a=this.elevationFeatures[n]),a}}function HA(r,e){return e.replace(/{([^{}]+)}/g,(n,a)=>a in r?String(r[a]):"")}let WA,qA,Jb;jt($0,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),$0.addDynamicAttributes=Bp;class ZA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:oa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt(ZA,"FormatSectionOverride",{omit:["defaultValue"]});const eT=()=>Jb||(Jb={layout:WA||(WA=new dr({"symbol-placement":new bt(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pt(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(Fe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(Fe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bt(Fe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bt(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pt(Fe.layout_symbol["icon-size"]),"icon-size-scale-range":new bt(Fe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Pt(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pt(Fe.layout_symbol["icon-image"]),"icon-image-use-theme":new bt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Pt(Fe.layout_symbol["icon-rotate"]),"icon-padding":new bt(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Pt(Fe.layout_symbol["icon-offset"]),"icon-anchor":new Pt(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new Pt(Fe.layout_symbol["text-field"]),"text-font":new Pt(Fe.layout_symbol["text-font"]),"text-size":new Pt(Fe.layout_symbol["text-size"]),"text-size-scale-range":new bt(Fe.layout_symbol["text-size-scale-range"]),"text-max-width":new Pt(Fe.layout_symbol["text-max-width"]),"text-line-height":new Pt(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Pt(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new Pt(Fe.layout_symbol["text-justify"]),"text-radial-offset":new Pt(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Pt(Fe.layout_symbol["text-anchor"]),"text-max-angle":new bt(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new Pt(Fe.layout_symbol["text-rotate"]),"text-padding":new bt(Fe.layout_symbol["text-padding"]),"text-keep-upright":new bt(Fe.layout_symbol["text-keep-upright"]),"text-transform":new Pt(Fe.layout_symbol["text-transform"]),"text-offset":new Pt(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new bt(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new bt(Fe.layout_symbol["text-optional"]),visibility:new bt(Fe.layout_symbol.visibility)})),paint:qA||(qA=new dr({"icon-opacity":new Pt(Fe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pt(Fe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pt(Fe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pt(Fe.paint_symbol["text-emissive-strength"]),"icon-color":new Pt(Fe.paint_symbol["icon-color"]),"icon-halo-color":new Pt(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pt(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pt(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(Fe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new bt(Fe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pt(Fe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pt(Fe.paint_symbol["text-occlusion-opacity"]),"text-color":new Pt(Fe.paint_symbol["text-color"],{runtimeType:Yo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Pt(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new Pt(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Pt(Fe.paint_symbol["text-halo-blur"]),"text-translate":new bt(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new bt(Fe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(Fe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(Fe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(Fe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(Fe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Pt(Fe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},Jb);class G0 extends Vo{constructor(e,n,a,c){super(e,eT(),n,a,c,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=le([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach(c=>{c.recalculate(e,n,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const f of a)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,c){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(f,p,_,x){f=sr(f),p=ni(p);const T=be(),I=f/3,C=1-2*I,P=[C,I,I,0,I,C,I,0,I,I,C,0,0,0,0,1],D=.5-.5*p,k=x-_;return oe(T,[k,0,0,0,0,k,0,0,0,0,k,0,_,_,_,1],[p,0,0,0,0,p,0,0,0,0,p,0,D,D,D,1]),oe(T,T,P),T}(e,n,a,c),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,c){const f=this.layout.get(e).evaluate(n,{},a,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Kd(p.value)||!f?f:HA(n.properties,f)}getAppearanceValueAndResolveTokens(e,n,a,c,f){const p=e.getProperty(n);if(!p)return;const _=p.evaluate(a,{},c,f),x=e.getUnevaluatedProperties()._values[n];return x.isDataDriven()||Kd(x.value)||!_||typeof _!="string"?_:HA(a.properties,_)}createBucket(e){return new $0(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of eT().paint.overridableProperties){if(!G0.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new ZA(n),c=new Wf(a,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new Eu("source",c):new Rc("composite",c,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new Lc(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&G0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),c=eT().paint.properties[n];let f=!1;const p=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof No)p(a.value.value.sections);else if(a.value.kind==="source"){const _=T=>{f||(T instanceof Ja&&Zr(T.value)===Od?p(T.value.sections):T instanceof Ma?p(T.sections):T.eachChild(_))},x=a.value;x._styleExpression&&_(x._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,a){return{config:new Jl(this,{zoom:n,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let XA,YA,KA,QA;var tT=jn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function H0(r,e,n,a,c,f,p,_){const x=[r,e,1,n,a,1,c,f,1],T=[p,_,1],I=J([],x),[C,P,D]=Ar(T,T,I);return ie(x,x,[C,0,0,0,P,0,0,0,D])}function JA(r,e,n,a,c,f,p,_){const x=function(T,I,C,P,D,k,j,H){const $=H0(0,0,1,0,1,1,0,1),K=H0(T,I,C,P,D,k,j,H);return ie(K,K,J([],$))}(r,e,n,a,c,f,p,_);return[x[2]/x[8]/Et,x[5]/x[8]/Et]}function W0(r){return[r[0],Math.min(Math.max(r[1],-F),F)]}class eP extends Ec{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Aa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ff(this.map._requestManager.transformRequest(this.url,Pd.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ld(a)):c&&(this.image=c instanceof HTMLImageElement?qr.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new v_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Aa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof v_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(const f of e)f[1]>a&&(a=f[1]),f[1]<n&&(n=f[1]);const c=(a+n)/2;if(c>F?this.onNorthPole=!0:c<-F&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(ne.fromLngLat);this.tileID=function(p){let _=1/0,x=1/0,T=-1/0,I=-1/0;for(const j of p)_=Math.min(_,j.x),x=Math.min(x,j.y),T=Math.max(T,j.x),I=Math.max(I,j.y);const C=Math.max(T-_,I-x),P=Math.max(0,Math.floor(-Math.log2(C))),D=Math.pow(2,P);let k=Math.floor((_+T)/2*D);return k>1&&(k-=1),new Mi(P,k,Math.floor((x+I)/2*D))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Aa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof v_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const $ in this.tiles){const K=this.tiles[$];K.state!=="loaded"&&(K.state="loaded",K.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=A_(new Mi(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const K=$[1].x-$[0].x,ee=$[1].y-$[0].y,se=$[2].x-$[1].x,_e=$[2].y-$[1].y,fe=$[3].x-$[2].x,xe=$[3].y-$[2].y,Ie=$[0].x-$[3].x,Pe=$[0].y-$[3].y,Xe=K*_e-se*ee,ke=se*xe-fe*_e,Je=fe*Pe-Ie*xe,rt=Ie*ee-K*Pe;return Xe>0&&ke>0&&Je>0&&rt>0||Xe<0&&ke<0&&Je<0&&rt<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=A_(this.tileID,this.map.transform.projection),[f,p,_,x]=this.coordinates.map($=>{const K=c.projection.project($[0],$[1]);return BA(c,K)._round()});this.perspectiveTransform=JA(f.x,f.y,p.x,p.y,_.x,_.y,x.x,x.y);const T=this._boundsArray=new Pu;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(p.x,p.y,Et,0),T.emplaceBack(x.x,x.y,0,Et),T.emplaceBack(_.x,_.y,Et,Et),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,tT.members),this.boundsSegments=er.simpleSegment(0,0,4,2);const I=[],C=[W0((P=this.coordinates)[0]),W0(P[1]),W0(P[2]),W0(P[3])];var P;const[D,k,j,H]=function($){let K=$[0][0],ee=K,se=$[0][1],_e=se;for(let fe=1;fe<$.length;fe++)$[fe][0]<K?K=$[fe][0]:$[fe][0]>ee&&(ee=$[fe][0]),$[fe][1]<se?se=$[fe][1]:$[fe][1]>_e&&(_e=$[fe][1]);return[K,se,ee-K,_e-se]}(C);{const $=new Pu,[K,ee,se,_e]=function(ct){let ut=ct[0].x,Qe=ut,Ye=ct[0].y,dt=Ye;for(let It=1;It<ct.length;It++)ct[It].x<ut?ut=ct[It].x:ct[It].x>Qe&&(Qe=ct[It].x),ct[It].y<Ye?Ye=ct[It].y:ct[It].y>dt&&(dt=ct[It].y);return[ut,Ye,Qe-ut,dt-Ye]}(a),fe=ct=>[(ct.x-K)/se,(ct.y-ee)/_e],[xe,Ie,Pe,Xe]=a.map(fe),ke=function(ct,ut,Qe,Ye,dt,It,vt,Jt){const Lt=H0(0,0,1,0,1,1,0,1);return ie(Lt,Lt,J([],H0(ct,ut,Qe,Ye,dt,It,vt,Jt)))}(xe[0],xe[1],Ie[0],Ie[1],Pe[0],Pe[1],Xe[0],Xe[1]);this.elevatedGlobePerspectiveTransform=JA(xe[0],xe[1],Ie[0],Ie[1],Pe[0],Pe[1],Xe[0],Xe[1]);const Je=(ct,ut)=>{I.push(ct.lng);const Qe=Math.round((ct.lng-D)/j*Et),Ye=Math.round((ct.lat-k)/H*Et),dt=fe(ut),It=Ar([],[dt[0],dt[1],1],ke),vt=Math.round(It[0]/It[2]*Et),Jt=Math.round(It[1]/It[2]*Et);$.emplaceBack(Qe,Ye,vt,Jt)},rt=a[3].x-a[0].x,ot=a[3].y-a[0].y,ht=a[2].x-a[1].x,pt=a[2].y-a[1].y;for(let ct=0;ct<65;ct++){const ut=ct/64,Qe=[a[0].x+ut*rt,a[0].y+ut*ot],Ye=[a[1].x+ut*ht,a[1].y+ut*pt],dt=Ye[0]-Qe[0],It=Ye[1]-Qe[1];for(let vt=0;vt<65;vt++){const Jt=vt/64,Lt={x:Qe[0]+dt*Jt,y:Qe[1]+It*Jt};Je(n.projection.unproject(Lt.x,Lt.y),Lt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,tT.members)}{this.maxLongitudeTriangleSize=0;let $=[],K=new kr;const ee=(se,_e,fe)=>{K.emplaceBack(se,_e,fe);const xe=I[se],Ie=I[_e],Pe=I[fe],Xe=Math.min(Math.min(xe,Ie),Pe),ke=Math.max(Math.max(xe,Ie),Pe)-Xe;ke>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ke),$.push(Xe+ke/2)};for(let se=0;se<64;se++)for(let _e=0;_e<64;_e++){const fe=65*se+_e,xe=fe+1,Ie=fe+65,Pe=Ie+1;ee(fe,Ie,xe),ee(xe,Ie,Pe)}[$,K]=function(se,_e){const fe=Array.from({length:se.length},(Pe,Xe)=>Xe);fe.sort((Pe,Xe)=>se[Pe]-se[Xe]);const xe=[],Ie=new kr;for(let Pe=0;Pe<fe.length;Pe++){const Xe=fe[Pe];xe.push(se[Xe]);const ke=3*Xe,Je=ke+1;Ie.emplaceBack(_e.uint16[ke],_e.uint16[Je],_e.uint16[Je+1])}return[xe,Ie]}($,K),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(K)}this.elevatedGlobeSegments=er.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Et,0,H/Et,0,0,k,D,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof v_||(this.texture?this.texture.update(this.image):(this.texture=new Ib(n,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(f=e+180)+360*Math.round((a[0]-f)/360);var f;const p=new er,_=(C,P)=>{p.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:n.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=x){const C=or(a,0,a.length,c+x);return C===a.length||_(C,Lr(a,C+1,a.length,c+360-x)-C),p}c<a[0]&&(c+=360);const T=Lr(a,0,a.length,c-x);if(T===a.length)return _(0,a.length),p;_(0,T-0);const I=or(a,T+1,a.length,c+x);return I!==a.length&&_(I,a.length-I),p}}const u4=(Math.pow(256,2)-1)/16907520;class tP extends Vo{constructor(e,n,a,c){super(e,{layout:KA||(KA=new dr({visibility:new bt(Fe.layout_raster.visibility)})),paint:QA||(QA=new dr({"raster-opacity":new bt(Fe.paint_raster["raster-opacity"]),"raster-color":new zc(Fe.paint_raster["raster-color"]),"raster-color-mix":new bt(Fe.paint_raster["raster-color-mix"]),"raster-color-range":new bt(Fe.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(Fe.paint_raster["raster-saturation"]),"raster-contrast":new bt(Fe.paint_raster["raster-contrast"]),"raster-resampling":new bt(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(Fe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(Fe.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(Fe.paint_raster["raster-array-band"]),"raster-elevation":new bt(Fe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},n,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof eP&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=r_({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let nP,iP,rP,oP,sP;class aP extends Vo{constructor(e,n,a,c){super(e,{layout:nP||(nP=new dr({visibility:new bt(Fe["layout_raster-particle"].visibility)})),paint:iP||(iP=new dr({"raster-particle-array-band":new bt(Fe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(Fe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new zc(Fe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(Fe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(Fe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(Fe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(Fe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(Fe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},n,a,c),this._updateColorRamp(),this.lastInvalidatedAt=qr.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=r_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=qr.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class d4 extends Vo{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function nT(r,e,n){const a=[0,0,1],c=fo([]);return ea(c,c,n?-Bn(r)+Math.PI:Bn(r)),vo(c,c,-Bn(e)),Qr(a,a,c),_n(a,a)}const lP={None:0,Model:1,Symbol:2,FillExtrusion:4};class q0{constructor(e,n,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function iT(r,e){const n=r.indexOf("://")===-1;try{return new URL(r,n&&e?"http://example.com":void 0),!0}catch{return!1}}class cP{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uP{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new qg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,a=this.instancedDataArray.float32;let c=Math.floor(a[n+2]);const f=1.05*(a[n+2]-c);return c/=100,[a[n]%1*1.05,a[n+1]%1*1.05,f,c]}tileCoordinatesForInstance(e){const n=16*e,a=this.instancedDataArray.float32;let c=a[n+0];return c=c>Et?c-Et:c,new at(Math.trunc(c),Math.trunc(a[n+1]))}translationForInstance(e){const n=16*e,a=this.instancedDataArray.float32;return[a[n+4],a[n+5],a[n+6]]}rotationScaleForInstance(e){const n=16*e,a=this.instancedDataArray.float32;return[a[n+7],a[n+8],a[n+9],a[n+10],a[n+11],a[n+12],a[n+13],a[n+14],a[n+15]]}transformForInstance(e){const n=16*e,a=this.instancedDataArray.float32;return[a[n+7],a[n+8],a[n+9],a[n+4],a[n+10],a[n+11],a[n+12],a[n+5],a[n+13],a[n+14],a[n+15],a[n+6],0,0,0,1]}}class rT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,a,c){}populate(e,n,a,c){this.tileToMeter=Z(a);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:_,index:x,sourceLayerIndex:T}of e){const I=_??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),C=Le(p,f);if(!this.layers[0]._featureFilter.filter(new Bi(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),C,a))continue;const P={id:I,sourceLayerIndex:T,index:x,geometry:f?C.geometry:Se(p,a,c),properties:p.properties,type:p.type,patterns:{}},D=this.addFeature(P,P.geometry,C);D&&n.featureIndex.insert(p,P.geometry,x,T,this.index,this.instancesPerModel[D].instancedDataArray.length,Et/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let a=0;for(const c of this.modelUris){const f=e.getModel(c,n);if(!f)continue;const p=this.instancesPerModel[c];if(p){const _=.5*Yn(f.aabb.max,f.aabb.min)*p.maxScale+p.maxXYTranslationDistance,x=Math.min(Et,Math.max(_/this.tileToMeter,Et/32));a=Math.max(x,a)}}return a}update(e,n,a,c){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];for(const c of a.features){const f=this.layers[0],p=c.feature,_=this.canonical,x=f.paint.get("model-rotation").evaluate(p,{},_),T=f.paint.get("model-scale").evaluate(p,{},_),I=f.paint.get("model-translation").evaluate(p,{},_);Sr(c.rotation,x)&&Sr(c.scale,T)&&Sr(c.translation,I)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a,c){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const f=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(_0(this.activeReplacements,f))return!1;this.activeReplacements=f;let p=!1;for(const _ in this.instancesPerModel){const x=this.instancesPerModel[_],T=x.instancedDataArray;for(const I of x.features){const C=I.instancedDataOffset,P=I.instancedDataCount;for(let D=0;D<P;D++){const k=16*(D+C);let j=T.float32[k+0];const H=j>Et;j=H?j-Et:j;const $=Math.floor(j),K=Math.floor(T.float32[k+1]);let ee=!1;for(const se of this.activeReplacements)if(!YI(se,a,lP.Model,c)&&!(se.min.x>$||$>se.max.x||se.min.y>K||K>se.max.y)&&(ee=tC(eC($,K,e.canonical,se.footprintTileId.canonical),se.footprint),ee))break;T.float32[k]=ee?j+Et:j,p=p||ee!==H}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,kB.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const a in this.instancesPerModel){const c=this.instancesPerModel[a];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(e&&n&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)n.removeModel(a,"",!0)}addFeature(e,n,a){const c=this.layers[0],f=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!f)return Ot(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),f;(iT(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new uP);const p=this.instancesPerModel[f],_=p.instancedDataArray,x=new cP(a,_.length);for(const T of n)for(const I of T){if(I.x<0||I.x>=Et||I.y<0||I.y>=Et)continue;if(this.lookupDim!==0){const P=(this.lookupDim-1)/Et,D=this.lookupDim*(I.y*P|0)+I.x*P|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}}this.instanceCount++;const C=_.length;_.resize(C+1),p.instancesEvaluatedElevation.push(0),_.float32[16*C]=I.x,_.float32[16*C+1]=I.y}return x.instancedDataCount=p.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(x),this.evaluate(x,{},p,!1)),f}getModelUris(){return this.modelUris}evaluate(e,n,a,c){const f=this.layers[0],p=e.feature,_=this.canonical,x=e.rotation=f.paint.get("model-rotation").evaluate(p,n,_),T=e.scale=f.paint.get("model-scale").evaluate(p,n,_),I=e.translation=f.paint.get("model-translation").evaluate(p,n,_),C=Object.assign({},f.paint.get("model-color").evaluate(p,n,_));C.a=f.paint.get("model-color-mix-intensity").evaluate(p,n,_);const P=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]);const D=I[0]*I[0]+I[1]*I[1],k=D>0?Math.sqrt(D):0;a.maxScale=Math.max(Math.max(a.maxScale,T[0]),Math.max(T[1],T[2])),a.maxXYTranslationDistance=Math.max(a.maxXYTranslationDistance,k),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),UC(P,x,T);const j=Math.round(100*C.a)+C.b/1.05;for(let H=0;H<e.instancedDataCount;++H){const $=e.instancedDataOffset+H,K=16*$,ee=a.instancedDataArray.float32;let se=0;c&&(se=ee[K+6]-a.instancesEvaluatedElevation[$]);const _e=0|ee[K+1];ee[K]=(0|ee[K])+C.r/1.05,ee[K+1]=_e+C.g/1.05,ee[K+2]=j,ee[K+3]=1/(_.z>10?this.tileToMeter:Z(_,_e)),ee[K+4]=I[0],ee[K+5]=I[1],ee[K+6]=I[2]+se,ee[K+7]=P[0],ee[K+8]=P[1],ee[K+9]=P[2],ee[K+10]=P[4],ee[K+11]=P[5],ee[K+12]=P[6],ee[K+13]=P[8],ee[K+14]=P[9],ee[K+15]=P[10],a.instancesEvaluatedElevation[$]=I[2]}}}let dP,hP;jt(rT,"ModelBucket",{omit:["layers"]}),jt(uP,"PerModelAttributes"),jt(cP,"ModelFeature");class jp{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){const c=a||e.findDEMTileFor(n);if(!c||!c.dem)return;const f=c.dem,p=c.tileID,_=1<<n.canonical.z-p.canonical.z;return new jp(c,f.dim/Et/_,[(n.canonical.x/_-p.canonical.x)*f.dim,(n.canonical.y/_-p.canonical.y)*f.dim])}tileCoordToPixel(e,n){const a=n*this._scale+this._offset[1];return new at(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,n,a,c){const f=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],_=Math.floor(f),x=Math.floor(p),T=this._dem;return c=!!c,a?fn(fn(T.get(_,x,c),T.get(_,x+1,c),p-x),fn(T.get(_+1,x,c),T.get(_+1,x+1,c),p-x),f-_):T.get(_,x,c)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*A(1,e)*this._dem.stride}}const oT=new Float32Array(262144),vh=new Uint8Array(262144);function fP(r){let e=0;if(r.meshes)for(const n of r.meshes)e=Math.max(e,n.aabb.max[2]);if(r.children)for(const n of r.children)e=Math.max(e,fP(n));return e}function pP(r,e,n){if(r.meshes)for(const a of r.meshes){if(a.aabb.min[0]===1/0)continue;const c=Yt.applyTransform(a.aabb,r.globalMatrix);n.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(r.children)for(const a of r.children)pP(a,e,n)}const mP=["","wall","door","roof","window","lamp","logo"];class gP{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:fP(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Yt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Yt([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Yt.applyTransformFast(a.aabb,this.node.globalMatrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Z0{constructor(e,n,a,c,f,p,_,x){this.id=a,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Rp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Rp.HasMapboxMeshFeatures),f&&(this.modelTraits|=Rp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=x,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of n)this.nodesInfo.push(new gP(T)),pP(T,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const a of this.getNodesInfo()){const c=a.node;c.footprint&&n.push({footprint:c.footprint,id:e})}}updateAppearances(e,n,a,c){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const a=n?this.stateDependentLayers:this.layers;if(!bo(e,this.states))for(const c of a)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const a of n){const c=a.node;this.uploaded?this.updatePbrBuffer(c):Pb(c,e,!0)}for(const a of n)P0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){const c=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;if(!this.uploaded||this.dirty||c.name!==this.projection.name||O_(a.paint.get("model-color").value,p)||O_(a.paint.get("model-color-mix-intensity").value,p)||O_(a.paint.get("model-roughness").value,p)||O_(a.paint.get("model-emissive-strength").value,p)||O_(a.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=c,this.brightness=f;const _=this.getNodesInfo();for(const x of _)x.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const f of a){const p=f.feature;f.evaluatedTranslation=n.paint.get("model-translation").evaluate(p,{},c),f.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e,n){const a=this.getNodesInfo();for(const c of a){if(!c.node.meshes)continue;const f=c.feature,p=n&&n[f.id];if(bo(p,c.state))continue;c.state=structuredClone(p);const _=c.node.meshes&&c.node.meshes[0].featureData,x=c.evaluatedColor[2],T=c.evaluatedRMEA[2],I=this.id.canonical;if(c.hasTranslucentParts=!1,_){for(let C=0;C<mP.length;C++){const P=mP[C];P.length&&(f.properties.part=P);const D=e.paint.get("model-color").evaluate(f,p,I).toPremultipliedRenderColor(null),k=e.paint.get("model-color-mix-intensity").evaluate(f,p,I);c.evaluatedColor[C]=[D.r,D.g,D.b,k],c.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(f,p,I),c.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I),c.evaluatedRMEA[C][3]=D.a,c.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,p,I),!c.hasTranslucentParts&&D.a<1&&(c.hasTranslucentParts=!0)}delete f.properties.part,f4(c,x!==c.evaluatedColor[2]||T!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,p,I),c.evaluatedScale=e.paint.get("model-scale").evaluate(f,p,I),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,c){const f=e.findDEMTileFor(a);if(f&&(f.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=jp.create(e,a,f);if(!p)return;this.modelTraits&Rp.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,c);for(const _ of this.getNodesInfo()){const x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const T=x.footprint.vertices;let I=p.getElevationAt(T[0].x,T[0].y,!0,!0);for(let C=1;C<T.length;C++)I=Math.min(I,p.getElevationAt(T[C].x,T[C].y,!0,!0));x.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,c){let f=n._dem._modifiedForSources[c];if(f===void 0&&(n._dem._modifiedForSources[c]=[],f=n._dem._modifiedForSources[c]),f.includes(a.canonical))return;const p=n._dem.dim;f.push(a.canonical);let _=!1;for(const x of this.getNodesInfo()){const T=x.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,C=n.tileCoordToPixel(I.min.x,I.min.y),P=n.tileCoordToPixel(I.max.x,I.max.y),D=Math.min(Math.min(p-P.y,C.x),Math.min(C.y,p-P.x));if(D<0)continue;const k=W(D,2,5);let j=Math.max(0,C.x-k),H=Math.max(0,C.y-k),$=Math.min(P.x+k,p-1),K=Math.min(P.y+k,p-1);for(let fe=H;fe<=K;++fe)for(let xe=j;xe<=$;++xe)vh[fe*p+xe]=255;let ee=0,se=0;for(let fe=0;fe<I.cellsY;++fe)for(let xe=0;xe<I.cellsX;++xe){if(!I.cells[fe*I.cellsX+xe])continue;const Ie=n.tileCoordToPixel(I.min.x+xe/I.xScale,I.min.y+fe/I.yScale),Pe=n.tileCoordToPixel(I.min.x+(xe+1)/I.xScale,I.min.y+(fe+1)/I.yScale);for(let Xe=Ie.y;Xe<=Math.min(Pe.y+1,p-1);++Xe)for(let ke=Ie.x;ke<=Math.min(Pe.x+1,p-1);++ke)vh[Xe*p+ke]===255&&(vh[Xe*p+ke]=0,ee+=n.getElevationAtPixel(ke,Xe),se++)}const _e=ee/se;j=Math.max(1,C.x-k),H=Math.max(1,C.y-k),$=Math.min(P.x+k,p-2),K=Math.min(P.y+k,p-2),_=!0;for(let fe=H;fe<=K;++fe)for(let xe=j;xe<=$;++xe)vh[fe*p+xe]===0&&(oT[fe*p+xe]=n._dem.set(xe,fe,_e));for(let fe=1;fe<k;++fe){j=Math.max(1,C.x-fe),H=Math.max(1,C.y-fe),$=Math.min(P.x+fe,p-2),K=Math.min(P.y+fe,p-2);for(let xe=H;xe<=K;++xe)for(let Ie=j;Ie<=$;++Ie){const Pe=xe*p+Ie;if(vh[Pe]===255){let Xe=0,ke=0,Je=-1,rt=-1;for(let ot=-1;ot<=1;++ot)for(let ht=-1;ht<=1;++ht){const pt=(xe+ot)*p+Ie+ht;if(vh[pt]>=fe)continue;const ct=oT[pt],ut=Math.abs(ct);ut>ke&&(Xe=ct,ke=ut,Je=ht,rt=ot)}if(ke>.1){const ot=1-(fe+.5*Math.abs(Je*rt))/k;let ht=n._dem.get(Ie,xe)+Xe*ot;const pt=n._dem.get(Ie+Je,xe+rt),ct=n._dem.get(Ie-Je,xe-rt,!0);(ht-pt)*(ht-ct)>0&&(ht=(pt+ct)/2),oT[Pe]=n._dem.set(Ie,xe,ht),vh[Pe]=fe}}}}}_&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=qr.now())}setFilter(e){this.filter=e?tp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Bi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)P0(n.node),Mb(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const f=c.node.footprint;c.hiddenByReplacement=!!f&&!a.find(p=>p.footprint===f)}}getHeightAtTileCoord(e,n){const a=[],c=[0,0,0],f=le([]);for(const p of this.getNodesInfo()){const _=p.node.meshes[0],x=_.transformedAabb;if(e<x.min[0]||n<x.min[1]||e>x.max[0]||n>x.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};ce(f,p.node.globalMatrix),c[0]=e,c[1]=n,li(c,c,f);const T=(c[0]-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*gh|0,I=Math.min(63,(c[1]-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*gh|0)*gh+Math.min(63,T),C=_.heightmap[I];if(!(C<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:C,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new at(e,n),new at(e,n),a),a.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function O_(r,e){return r instanceof Eu&&!r.isLightConstant&&e}function h4(r,e,n,a,c,f,p,_){let x=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;n[3]>0&&(x=fn(x,255*n[0],n[3]),T=fn(T,255*n[1],n[3]),I=fn(I,255*n[2],n[3]));const C=x<<8|T,P=I<<8|Math.floor(255*a[3]),D=function(fe){const xe=W(fe,0,2);return Math.min(Math.round(.5*xe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],k=W(c[0],0,1),j=W(c[1],0,1),H=W(c[2],0,1),$=W(c[3],0,1);let K,ee,se,_e;if(k!==j&&p!==f&&j!==k){const fe=p-f;ee=1/(fe*(j-k)),se=-(f+fe*k)/(fe*(j-k));const xe=W(c[4],-1,1);_e=Math.pow(10,xe),K=255*H<<8|255*$}else K=65535,ee=0,se=1,_e=1;if(r.emplaceBack(C,P,D,K,ee,se,_e),_){const fe=_.length;_.clear();for(let xe=0;xe<fe;xe++)_.emplaceBack(C,P,D,K,ee,se,_e)}}function f4(r,e,n){const a=r.node;let c=0;const f=n&Rp.HasMeshoptCompression;for(const p of a.meshes){if(a.lights&&a.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new hp,p.featureArray.reserve(p.featureData.length);let _=e;for(const x of p.featureData){const T=f?65535&x:x>>16&65535,I=f?x>>16&65535:65535&x,C=(15&I)<8?15&I:0,P=r.evaluatedRMEA[C],D=r.evaluatedColor[C],k=r.emissionHeightBasedParams[C];let j;if(_&&C===2&&a.lights&&(j=new hp,j.resize(10*a.lights.length)),h4(p.featureArray,T,D,P,k,p.aabb.min[2],p.aabb.max[2],j),j&&_){_=!1;const H=a.meshes[a.lightMeshIndex];H.featureArray=j,H.featureArray._trim()}}p.featureArray._trim(),c++}}jt(Z0,"Tiled3dModelBucket",{omit:["layers"]}),jt(gP,"Tiled3dModelFeature");const p4=["id","tile","layer","source","sourceLayer","state"];class xh{constructor(e,n,a,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=c,this.properties=e?e.properties:{},this.id=f}clone(){const e=new xh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of p4)this[n]!==void 0&&(e[n]=this[n]);return e}}class wh extends Ec{constructor(e,n,a,c){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=n,this._modelsInfo=new Map}load(){const e=[];for(const n in this._options.models){const a=this._options.models[n],c=this._modelsInfo.get(n);if(c){const f=c.model;f.position=a.position!=null?new s(a.position[0],a.position[1]):new s(0,0),f.orientation=a.orientation!=null?a.orientation:[0,0,0],c.modelSpec=a,wh.applyModelSpecification(f,a),f.computeBoundsAndApplyParent(),this.models.push(f)}else{const f=FC(this.map._requestManager.transformRequest(a.uri,Pd.Model).url).then(p=>{if(!p)return;const _=Db(p),x=new VC(n,a.uri,a.position,a.orientation,_);wh.applyModelSpecification(x,a),x.computeBoundsAndApplyParent(),this.models.push(x),this._modelsInfo.set(n,{modelSpec:a,model:x})}).catch(p=>{this.fire(new Ld(new Error(`Could not load model ${n} from ${a.uri}: ${p.message}`)))});e.push(f)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Aa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new Ld(new Error(`Could not load models: ${n.message}`)))})}static applyModelSpecification(e,n){n.nodeOverrides&&wh.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&wh.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every(a=>typeof a=="string")){e.nodeOverrideNames=[];for(const a of n)e.nodeOverrideNames.push(a)}else Object.entries(n).forEach(([a,c])=>{const f={orientation:[0,0,0]};if(c.hasOwnProperty("orientation")){const p=c.orientation;p&&(f.orientation=p)}e.nodeOverrides.set(a,f)})}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every(a=>typeof a=="string")){e.materialOverrideNames=[];for(const a of n)e.materialOverrideNames.push(a)}else Object.entries(n).forEach(([a,c])=>{const f={color:new vi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},p=c["model-color"];p!==void 0&&(f.color.r=p[0],f.color.g=p[1],f.color.b=p[2]);const _=c["model-color-mix-intensity"];_!==void 0&&(f.colorMix=_);const x=c["model-emissive-strength"];x!==void 0&&(f.emissionStrength=x);const T=c["model-opacity"];T!==void 0&&(f.opacity=T),e.materialOverrides.set(a,f)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=ca(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const n=new Map;for(const a in e){const c=e[a];if(this._modelsInfo.has(a)){const f=this._modelsInfo.get(a);f&&f.modelSpec.uri===c.uri&&n.set(a,f)}}this._modelsInfo=n,this._options.models=e,this._loaded=!1,this.load()}}function sT(r,e,n,a){const c=1<<r.z;e.lat=O((a/Et+r.y)/c),e.lng=M((n/Et+r.x)/c)}function m4(r,e,n,a){const c=r.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let f=Number.MAX_VALUE;const p=c.node,_=n.tile,x=a.calculatePosMatrix(_.tileID.toUnwrapped(),a.worldSize),T=c.evaluatedScale;let I=0;a.elevation&&p.elevation&&(I=p.elevation*a.elevation.exaggeration()),ue(x,x,[(p.anchor?p.anchor[0]:0)*(T[0]-1),(p.anchor?p.anchor[1]:0)*(T[1]-1),I]),Me(x,x,T);const C=n.queryGeometry,P=C.isPointQuery()?C.screenBounds:C.screenGeometry,D=function(j){const H=oe([],x,j.globalMatrix);oe(H,a.expandedFarZProjMatrix,H);for(let $=0;$<j.meshes.length;++$){const K=j.meshes[$];if($===j.lightMeshIndex)continue;const ee=Ab(P,a,H,K.aabb);ee!=null&&(f=Math.min(ee,f))}if(j.children)for(const $ of j.children)D($)};if(D(p),f===Number.MAX_VALUE)return;const k=new s(0,0);return sT(_.tileID.canonical,k,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:f,position:k,feature:c.feature}}const g4={circle:class extends Vo{constructor(r,e,n,a){super(r,{layout:Jo||(Jo=new dr({"circle-sort-key":new Pt(Fe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bt(Fe.layout_circle["circle-elevation-reference"]),visibility:new bt(Fe.layout_circle.visibility)})),paint:hr||(hr=new dr({"circle-radius":new Pt(Fe.paint_circle["circle-radius"]),"circle-color":new Pt(Fe.paint_circle["circle-color"]),"circle-blur":new Pt(Fe.paint_circle["circle-blur"]),"circle-opacity":new Pt(Fe.paint_circle["circle-opacity"]),"circle-translate":new bt(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pt(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pt(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pt(Fe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(Fe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}createBucket(r){return new xi(r)}queryRadius(r){const e=r;return Co("circle-radius",this,e)+Co("circle-stroke-width",this,e)+so(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,n,a,c,f,p,_){const x=Hs(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return TI(r,a,f,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,n){const a=bI(this);return{config:new Jl(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Vo{createBucket(r){return new EI(r)}constructor(r,e,n,a){super(r,{layout:II||(II=new dr({visibility:new bt(Fe.layout_heatmap.visibility)})),paint:CI||(CI=new dr({"heatmap-radius":new Pt(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pt(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zc(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(Fe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=r_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Co("heatmap-radius",this,r)}queryIntersectsFeature(r,e,n,a,c,f,p,_){const x=this.paint.get("heatmap-radius").evaluate(e,n);return TI(r,a,f,p,_,!0,!0,new at(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,n){return r==="heatmap"?{config:new Jl(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Vo{constructor(r,e,n,a){super(r,{layout:AI||(AI=new dr({visibility:new bt(Fe.layout_hillshade.visibility)})),paint:PI||(PI=new dr({"hillshade-illumination-direction":new bt(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(Fe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(Fe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}},fill:class extends Vo{constructor(r,e,n,a){super(r,{layout:GI||(GI=new dr({"fill-sort-key":new Pt(Fe.layout_fill["fill-sort-key"]),visibility:new bt(Fe.layout_fill.visibility),"fill-elevation-reference":new bt(Fe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Pt(Fe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:HI||(HI=new dr({"fill-antialias":new bt(Fe.paint_fill["fill-antialias"]),"fill-opacity":new Pt(Fe.paint_fill["fill-opacity"]),"fill-color":new Pt(Fe.paint_fill["fill-color"]),"fill-outline-color":new Pt(Fe.paint_fill["fill-outline-color"]),"fill-translate":new bt(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pt(Fe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new bt(Fe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new bt(Fe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Pt(Fe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Pt(Fe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Pt(Fe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(r,e,n){return{config:new Jl(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new db(r)}queryRadius(){return so(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,n,a,c,f){return!r.queryGeometry.isAboveHorizon&&di(xs(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Vo{constructor(r,e,n,a){super(r,{layout:_C||(_C=new dr({visibility:new bt(Fe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yC||(yC=new dr({"fill-extrusion-opacity":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Pt(Fe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(Fe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new v0(r)}queryRadius(){return so(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,n,a,c,f,p,_,x){const T=Hs(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),P=[0,0],D=_&&f.elevation,k=f.elevation?f.elevation.exaggeration():1,j=r.tile.getBucket(this);if(D&&j instanceof v0){const se=j.centroidVertexArray,_e=x+1;_e<se.length&&(P[0]=se.geta_centroid_pos0(_e),P[1]=se.geta_centroid_pos1(_e))}if(P[0]===0&&P[1]===1)return!1;f.projection.name==="globe"&&(a=gC([a],[new at(0,0),new at(Et,Et)],r.tileID.canonical).map(se=>se.polygon).flat());const H=D?_:null,[$,K]=EC(f,a,C,I,T,p,H,P,k,f.center.lat,r.tileID.canonical),ee=r.queryGeometry;return SC($,K,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},building:class extends Vo{constructor(r,e,n,a){super(r,{layout:XC||(XC=new dr({visibility:new bt(Fe.layout_building.visibility),"building-facade":new Pt(Fe.layout_building["building-facade"]),"building-facade-floors":new Pt(Fe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Pt(Fe.layout_building["building-facade-unit-width"]),"building-facade-window":new Pt(Fe.layout_building["building-facade-window"]),"building-roof-shape":new Pt(Fe.layout_building["building-roof-shape"]),"building-height":new Pt(Fe.layout_building["building-height"]),"building-base":new Pt(Fe.layout_building["building-base"]),"building-flood-light-wall-radius":new Pt(Fe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Pt(Fe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Pt(Fe.layout_building["building-flip-roof-orientation"])})),paint:YC||(YC=new dr({"building-opacity":new bt(Fe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new bt(Fe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new bt(Fe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new bt(Fe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new bt(Fe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new bt(Fe.paint_building["building-vertical-scale"]),"building-cast-shadows":new bt(Fe.paint_building["building-cast-shadows"]),"building-color":new Pt(Fe.paint_building["building-color"]),"building-emissive-strength":new Pt(Fe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new bt(Fe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new bt(Fe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new bt(Fe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new bt(Fe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new bt(Fe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new ZC(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,n,a,c,f,p,_,x){let T=this.layout.get("building-height").evaluate(e,n);const I=this.layout.get("building-base").evaluate(e,n),C=r.tile.getBucket(this).getFootprint(e);if(C){if(C.hiddenFlags!==0)return!1;T=C.height}const[P,D]=EC(f,a,I,T,new at(0,0),p,null,[0,0],1,f.center.lat,r.tileID.canonical),k=r.queryGeometry;return SC(P,D,k.isPointQuery()?k.screenBounds:k.screenGeometry)}},line:class extends Vo{constructor(r,e,n,a){const c=sA();super(r,c,e,n,a),c.layout&&(this.layout=new kc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(w_)return w_;const n=sA();return w_=new u5(n.paint.properties["line-width"].specification),w_.useIntegerZoom=!0,w_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new zb(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,n){const a=rA(this);return{config:new Jl(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(r){const e=r,n=aA(Co("line-width",this,e),Co("line-gap-width",this,e)),a=Co("line-offset",this,e);return n/2+Math.abs(a)+so(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,n,a,c,f){if(r.queryGeometry.isAboveHorizon)return!1;const p=xs(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),_=r.pixelToTileUnitsFactor/2*aA(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),x=this.paint.get("line-offset").evaluate(e,n);return x&&(a=function(T,I){const C=[],P=new at(0,0);for(let D=0;D<T.length;D++){const k=T[D],j=[];for(let H=0;H<k.length;H++){const $=k[H],K=k[H+1],ee=H===0?P:$.sub(k[H-1])._unit()._perp(),se=H===k.length-1?P:K.sub($)._unit()._perp(),_e=ee._add(se)._unit();_e._mult(1/(_e.x*se.x+_e.y*se.y)),j.push(_e._mult(I)._add($))}C.push(j)}return C}(a,x*r.pixelToTileUnitsFactor)),function(T,I,C){for(let P=0;P<I.length;P++){const D=I[P];if(T.length>=3){for(let k=0;k<D.length;k++)if(Pi(T,D[k]))return!0}if(ar(T,D,C))return!0}return!1}(p,a,_)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:G0,background:class extends Vo{constructor(r,e,n,a){super(r,{layout:XA||(XA=new dr({visibility:new bt(Fe.layout_background.visibility)})),paint:YA||(YA=new dr({"background-pitch-alignment":new bt(Fe.paint_background["background-pitch-alignment"]),"background-color":new bt(Fe.paint_background["background-color"]),"background-pattern":new bt(Fe.paint_background["background-pattern"]),"background-opacity":new bt(Fe.paint_background["background-opacity"]),"background-emissive-strength":new bt(Fe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,n){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:tP,"raster-particle":aP,sky:class extends Vo{constructor(r,e,n,a){super(r,{layout:rP||(rP=new dr({visibility:new bt(Fe.layout_sky.visibility)})),paint:oP||(oP=new dr({"sky-type":new bt(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new zc(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(Fe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=r_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,f=r.style.light,p=f.properties.get("position");return c&&f.properties.get("anchor")==="viewport"&&Ot("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?nT(p.azimuthal,90-p.polar,e):nT(a[0],90-a[1],e)}const n=this.paint.get("sky-gradient-center");return nT(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Vo{constructor(r,e,n,a){super(r,{paint:sP||(sP=new dr({}))},e,null)}},model:class extends Vo{constructor(r,e,n,a){super(r,{layout:dP||(dP=new dr({visibility:new bt(Fe.layout_model.visibility),"model-id":new Pt(Fe.layout_model["model-id"])})),paint:hP||(hP=new dr({"model-opacity":new Pt(Fe.paint_model["model-opacity"]),"model-rotation":new Pt(Fe.paint_model["model-rotation"]),"model-scale":new Pt(Fe.paint_model["model-scale"]),"model-translation":new Pt(Fe.paint_model["model-translation"]),"model-color":new Pt(Fe.paint_model["model-color"]),"model-color-mix-intensity":new Pt(Fe.paint_model["model-color-mix-intensity"]),"model-type":new bt(Fe.paint_model["model-type"]),"model-cast-shadows":new bt(Fe.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(Fe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(Fe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pt(Fe.paint_model["model-emissive-strength"]),"model-roughness":new Pt(Fe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pt(Fe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(Fe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(Fe.paint_model["model-front-cutoff"]),"model-elevation-reference":new bt(Fe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new rT(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Z0?Et-1:0}queryRenderedFeatures(r,e,n){const a=e.getSource();if(!(a&&a instanceof wh))return{};const c=a,f={};f[this.id]=[];const p=f[this.id];let _=0;for(const x of c.models){const T=e.getFeatureState(this.sourceLayer,x.id),I={type:"Unknown",id:x.id,properties:x.featureProperties},C=this.paint.get("model-rotation").evaluate(I,T),P=this.paint.get("model-scale").evaluate(I,T),D=this.paint.get("model-translation").evaluate(I,T),k=this.paint.get("model-elevation-reference");let j=[];A0(j,x,n,x.position,C,P,D,k==="ground",k==="ground",!1),n.projection.name==="globe"&&(j=C0(j,n));const H=oe([],n.projMatrix,j),$=Ab(r.isPointQuery()?r.screenBounds:r.screenGeometry,n,H,x.aabb);if($!=null){const K=new xh(void 0,0,0,0,x.id);K.layer=this.layer,K.properties=structuredClone(x.featureProperties),K.properties.layer=this.id,K.properties.uri=x.uri,K.properties.orientation=x.orientation,K.sourceLayer=this.sourceLayer,K.geometry={type:"Point",coordinates:[x.position.lng,x.position.lat]},K.state=T,K.source=this.source,p.push({featureIndex:_,feature:K,intersectionZ:$})}++_}return f}queryIntersectsFeature(r,e,n,a,c,f){if(!this.modelManager)return!1;const p=this.modelManager,_=r.tile.getBucket(this);if(!(_&&_ instanceof rT))return!1;for(const x in _.instancesPerModel){const T=_.instancesPerModel[x],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const C=T.features[T.idToFeaturesIndex[I]],P=p.getModel(x,this.scope);if(!P)return!1;let D=[];const k=new s(0,0),j=_.canonical;let H=Number.MAX_VALUE;for(let $=0;$<C.instancedDataCount;++$){const K=16*(C.instancedDataOffset+$),ee=T.instancedDataArray.float32,se=[ee[K+4],ee[K+5],ee[K+6]];sT(j,k,Math.floor(ee[K]),Math.floor(ee[K+1])),A0(D,P,f,k,C.rotation,C.scale,se,!1,!1,!1),f.projection.name==="globe"&&(D=C0(D,f));const _e=oe([],f.projMatrix,D),fe=r.queryGeometry,xe=Ab(fe.isPointQuery()?fe.screenBounds:fe.screenGeometry,f,_e,P.aabb);xe!=null&&(H=Math.min(xe,H))}return H!==Number.MAX_VALUE&&H}}return!1}_handleOverridablePaintPropertyUpdate(r,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Rc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Vo{constructor(r,e,n,a){super(r,{layout:WI||(WI=new dr({"clip-layer-types":new bt(Fe.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(Fe.layout_clip["clip-layer-scope"])})),paint:qI||(qI=new dr({}))},e,n,a)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new ZI(r)}is3D(r){return!0}}},aT=new vi(0,0,0),lT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},cT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},X0={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},_4={PAINT_ORDER_FILL_AND_STROKE:1},F_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},_P={MASK_TYPE_LUMINANCE:1};function y4(r,e,n){r===1&&e.icons.push(function(a,c){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:p}=f;if(p.content_area){const{content_area:_}=p;_.left==null&&(_.left=0),_.top==null&&(_.top=_.left),_.width==null&&(_.width=f.usvg_tree.width),_.height==null&&(_.height=_.width)}if(p.text_placeholder){const{text_placeholder:_}=p;_.top==null&&(_.top=_.left),_.height==null&&(_.height=_.width)}return p.stretch_x&&p.stretch_x.length&&yP(p,"x"),p.stretch_y&&p.stretch_y.length&&yP(p,"y"),f}(a.readFields(v4,{name:void 0},c))}(n,n.readVarint()+n.pos))}function yP(r,e){const n=[],a=r[`stretch_${e}`];let c=null;for(let f=0;f<a.length;f++)c===null?c=n.length===0?a[0]:n[n.length-1][1]+a[f]:(n.push([c,c+a[f]]),c=null);r[`stretch_${e}_areas`]=n}function v4(r,e,n){r===1?e.name=n.readString():r===2?e.metadata=function(a,c){return a.readFields(x4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(n,n.readVarint()+n.pos):r===3&&(e.usvg_tree=function(a,c){return a.readFields(T4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function x4(r,e,n){r===1?e.stretch_x=n.readPackedVarint():r===2?e.stretch_y=n.readPackedVarint():r===3?e.content_area=vP(n,n.readVarint()+n.pos):r===4?e.variables.push(function(a,c){return a.readFields(b4,{name:void 0},c)}(n,n.readVarint()+n.pos)):r===5&&(e.text_placeholder=vP(n,n.readVarint()+n.pos))}function vP(r,e){return r.readFields(w4,{},e)}function w4(r,e,n){r===1?e.left=n.readVarint():r===2?e.width=n.readVarint():r===3?e.top=n.readVarint():r===4&&(e.height=n.readVarint())}function b4(r,e,n){r===1?e.name=n.readString():r===2&&(e.rgb_color=Q0(n.readVarint()),e.value="rgb_color")}function T4(r,e,n){r===1?e.width=e.height=n.readVarint():r===2?e.height=n.readVarint():r===3?e.children.push(Y0(n,n.readVarint()+n.pos)):r===4?e.linear_gradients.push(function(a,c){return a.readFields(M4,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(n,n.readVarint()+n.pos)):r===5?e.radial_gradients.push(function(a,c){return a.readFields(D4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(n,n.readVarint()+n.pos)):r===7?e.clip_paths.push(function(a,c){return a.readFields(L4,{children:[]},c)}(n,n.readVarint()+n.pos)):r===8&&e.masks.push(function(a,c){const f=a.readFields(k4,{left:0,width:20,mask_type:_P.MASK_TYPE_LUMINANCE,children:[]},c);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(n,n.readVarint()+n.pos))}function Y0(r,e){return r.readFields(S4,{},e)}function S4(r,e,n){r===1?(e.group=function(a,c){return a.readFields(E4,{opacity:255,children:[]},c)}(n,n.readVarint()+n.pos),e.node="group"):r===2&&(e.path=function(a,c){return a.readFields(C4,{paint_order:1,commands:[],step:1,diffs:[],rule:lT.PATH_RULE_NON_ZERO},c)}(n,n.readVarint()+n.pos),e.node="path")}function E4(r,e,n){r===1?e.transform=K0(n,n.readVarint()+n.pos):r===2?e.opacity=n.readVarint():r===5?e.clip_path_idx=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(Y0(n,n.readVarint()+n.pos))}function K0(r,e){return r.readFields(I4,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function I4(r,e,n){r===1?e.sx=n.readFloat():r===2?e.ky=n.readFloat():r===3?e.kx=n.readFloat():r===4?e.sy=n.readFloat():r===5?e.tx=n.readFloat():r===6&&(e.ty=n.readFloat())}function C4(r,e,n){r===1?e.fill=function(a,c){return a.readFields(A4,{rgb_color:aT,paint:"rgb_color",opacity:255},c)}(n,n.readVarint()+n.pos):r===2?e.stroke=function(a,c){return a.readFields(P4,{rgb_color:aT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(n,n.readVarint()+n.pos):r===3?e.paint_order=n.readVarint():r===5?n.readPackedVarint(e.commands):r===6?e.step=n.readFloat():r===7?n.readPackedSVarint(e.diffs):r===8&&(e.rule=n.readVarint())}function A4(r,e,n){r===1?(e.rgb_color=Q0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=n.readVarint())}function Q0(r){return new vi((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function P4(r,e,n){r===1?(e.rgb_color=Q0(n.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):r===5?n.readPackedFloat(e.dasharray):r===6?e.dashoffset=n.readFloat():r===7?e.miterlimit=n.readFloat():r===8?e.opacity=n.readVarint():r===9?e.width=n.readFloat():r===10?e.linecap=n.readVarint():r===11&&(e.linejoin=n.readVarint())}function M4(r,e,n){r===1?e.transform=K0(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(xP(n,n.readVarint()+n.pos)):r===4?e.x1=n.readFloat():r===5?e.y1=n.readFloat():r===6?e.x2=n.readFloat():r===7&&(e.y2=n.readFloat())}function xP(r,e){return r.readFields(R4,{offset:0,opacity:255,rgb_color:aT},e)}function R4(r,e,n){r===1?e.offset=n.readFloat():r===2?e.opacity=n.readVarint():r===3&&(e.rgb_color=Q0(n.readVarint()))}function D4(r,e,n){r===1?e.transform=K0(n,n.readVarint()+n.pos):r===2?e.spread_method=n.readVarint():r===3?e.stops.push(xP(n,n.readVarint()+n.pos)):r===4?e.cx=n.readFloat():r===5?e.cy=n.readFloat():r===6?e.r=n.readFloat():r===7?e.fx=n.readFloat():r===8?e.fy=n.readFloat():r===9&&(e.fr=n.readFloat())}function L4(r,e,n){r===1?e.transform=K0(n,n.readVarint()+n.pos):r===2?e.clip_path_idx=n.readVarint():r===3&&e.children.push(Y0(n,n.readVarint()+n.pos))}function k4(r,e,n){r===1?e.left=e.top=n.readFloat():r===2?e.width=e.height=n.readFloat():r===3?e.top=n.readFloat():r===4?e.height=n.readFloat():r===5?e.mask_type=n.readVarint():r===6?e.mask_idx=n.readVarint():r===7&&e.children.push(Y0(n,n.readVarint()+n.pos))}class z4{static calculate(e={},n=[]){const a=new Map,c=new Map;if(Object.keys(e).length===0)return a;n.forEach(f=>{c.set(f.name,f.rgb_color||new vi(0,0,0))});for(const[f,p]of Object.entries(e))c.has(f)?a.set(c.get(f).toString(),p):console.warn(`Ignoring unknown image variable "${f}"`);return a}}function Up(r,e=255,n){const a=e/255,c=r.toString(),f=n.has(c)?n.get(c).clone():r.clone();return f.a*=a,f.toString()}function N_(r,e){if(!Ea()){const n=document.createElement("canvas");return n.width=r,n.height=e,n}return new OffscreenCanvas(r,e)}let uT,B_=null;function dT(r,e,n,a,c){for(const f of a.children)wP(r,e,n,f,c)}function wP(r,e,n,a,c){a.group?(r.save(),function(f,p,_,x,T){const I=x.mask_idx!=null?_.masks[x.mask_idx]:null,C=x.clip_path_idx!=null?_.clip_paths[x.clip_path_idx]:null;if(x.transform&&(p=Vp(x.transform).preMultiplySelf(p)),!function(k,j,H){return k.opacity!==255||j||H}(x,C!=null,I!=null))return void dT(f,p,_,x,T);const P=N_(f.canvas.width,f.canvas.height),D=P.getContext("2d");dT(D,p,_,x,T),C&&AP(D,p,_,C),I&&PP(D,p,_,I,T),f.globalAlpha=x.opacity/255,f.drawImage(P,0,0)}(r,e,n,a.group,c),r.restore()):a.path&&(r.save(),function(f,p,_,x,T){f.setTransform(p),x.paint_order===_4.PAINT_ORDER_FILL_AND_STROKE?(bP(f,_,x,T),SP(f,_,x,T)):(SP(f,_,x,T),bP(f,_,x,T))}(r,e,n,a.path,c),r.restore())}function bP(r,e,n,a){const c=n.fill;if(!c)return;const f=c.opacity/255;switch(r.save(),r.beginPath(),MP(n,r),c.paint){case"rgb_color":r.fillStyle=Up(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":{const p=e.linear_gradients[c.linear_gradient_idx];p.transform&&r.setTransform(Vp(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=EP(r,p,f,a);break}case"radial_gradient_idx":{const p=e.radial_gradients[c.radial_gradient_idx];p.transform&&r.setTransform(Vp(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=IP(r,p,f,a)}}r.fill(TP(n)),r.restore()}function TP(r){return r.rule===lT.PATH_RULE_NON_ZERO?"nonzero":r.rule===lT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function SP(r,e,n,a){const c=n.stroke;if(!c)return;const f=RP(n);r.lineWidth=c.width,r.miterLimit=c.miterlimit,r.setLineDash(c.dasharray),r.lineDashOffset=c.dashoffset;const p=c.opacity/255;switch(c.paint){case"rgb_color":r.strokeStyle=Up(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":r.strokeStyle=EP(r,e.linear_gradients[c.linear_gradient_idx],p,a,!0);break;case"radial_gradient_idx":r.strokeStyle=IP(r,e.radial_gradients[c.radial_gradient_idx],p,a,!0)}switch(c.linejoin){case X0.LINE_JOIN_MITER_CLIP:case X0.LINE_JOIN_MITER:r.lineJoin="miter";break;case X0.LINE_JOIN_ROUND:r.lineJoin="round";break;case X0.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(c.linecap){case cT.LINE_CAP_BUTT:r.lineCap="butt";break;case cT.LINE_CAP_ROUND:r.lineCap="round";break;case cT.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(f)}function EP(r,e,n,a,c=!1){if(e.stops.length===1){const P=e.stops[0];return Up(P.rgb_color,P.opacity*n,a)}const{x1:f,y1:p,x2:_,y2:x}=e;let T=new DOMPoint(f,p),I=new DOMPoint(_,x);if(c){const P=Vp(e.transform);T=P.transformPoint(T),I=P.transformPoint(I)}const C=r.createLinearGradient(T.x,T.y,I.x,I.y);for(const P of e.stops)C.addColorStop(P.offset,Up(P.rgb_color,P.opacity*n,a));return C}function IP(r,e,n,a,c=!1){if(e.stops.length===1){const $=e.stops[0];return Up($.rgb_color,$.opacity*n,a)}const f=Vp(e.transform),{fx:p,fy:_,fr:x,cx:T,cy:I,r:C}=e;let P=new DOMPoint(p,_),D=new DOMPoint(T,I),k=x,j=C;if(c){P=f.transformPoint(P),D=f.transformPoint(D);const $=(f.a+f.d)/2;k=x*$,j=e.r*$}const H=r.createRadialGradient(P.x,P.y,k,D.x,D.y,j);for(const $ of e.stops)H.addColorStop($.offset,Up($.rgb_color,$.opacity*n,a));return H}function CP(r,e,n,a){const c=a.transform?Vp(a.transform).preMultiplySelf(e):e,f=N_(r.canvas.width,r.canvas.height),p=f.getContext("2d");for(const x of a.children)if(x.group)CP(p,c,n,x.group);else if(x.path){const T=x.path,I=new Path2D;I.addPath(RP(T),c),p.fill(I,TP(T))}const _=a.clip_path_idx!=null?n.clip_paths[a.clip_path_idx]:null;_&&AP(p,c,n,_),r.globalCompositeOperation="source-over",r.drawImage(f,0,0)}function AP(r,e,n,a){const c=N_(r.canvas.width,r.canvas.height);CP(c.getContext("2d"),e,n,a),r.globalCompositeOperation="destination-in",r.drawImage(c,0,0)}function PP(r,e,n,a,c){if(a.children.length===0)return;const f=a.mask_idx!=null?n.masks[a.mask_idx]:null;f&&PP(r,e,n,f,c);const p=r.canvas.width,_=r.canvas.height,x=N_(p,_),T=x.getContext("2d"),I=a.width,C=a.height,P=a.left,D=a.top,k=new Path2D,j=new Path2D;j.rect(P,D,I,C),k.addPath(j,e),T.clip(k);for(const K of a.children)wP(T,e,n,K,c);const H=T.getImageData(0,0,p,_),$=H.data;if(a.mask_type===_P.MASK_TYPE_LUMINANCE)for(let K=0;K<$.length;K+=4)$[K+3]=$[K+3]/255*(.2126*$[K]+.7152*$[K+1]+.0722*$[K+2]);T.putImageData(H,0,0),r.globalCompositeOperation="destination-in",r.drawImage(x,0,0)}function Vp(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function MP(r,e){const n=r.step;let a=r.diffs[0]*n,c=r.diffs[1]*n;e.moveTo(a,c);for(let f=0,p=2;f<r.commands.length;f++)switch(r.commands[f]){case F_.PATH_COMMAND_MOVE:a+=r.diffs[p++]*n,c+=r.diffs[p++]*n,e.moveTo(a,c);break;case F_.PATH_COMMAND_LINE:a+=r.diffs[p++]*n,c+=r.diffs[p++]*n,e.lineTo(a,c);break;case F_.PATH_COMMAND_QUAD:{const _=a+r.diffs[p++]*n,x=c+r.diffs[p++]*n;a=_+r.diffs[p++]*n,c=x+r.diffs[p++]*n,e.quadraticCurveTo(_,x,a,c);break}case F_.PATH_COMMAND_CUBIC:{const _=a+r.diffs[p++]*n,x=c+r.diffs[p++]*n,T=_+r.diffs[p++]*n,I=x+r.diffs[p++]*n;a=T+r.diffs[p++]*n,c=I+r.diffs[p++]*n,e.bezierCurveTo(_,x,T,I,a,c);break}case F_.PATH_COMMAND_CLOSE:e.closePath()}return e}function RP(r){return MP(r,new Path2D)}class J0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}jt(J0,"LRUCache");class hT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ao(e,e.data)}getFromCache(e,n,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new J0(150)),this.cacheMap.get(a).get(ca(e.toString(),n))}setInCache(e,n,a,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new J0(150));const f=this.cacheDependenciesMap.get(c),p=ca(e.id.toString(),a);f.get(p)||f.set(p,new Set);const _=this.cacheMap.get(c),x=e.toString();f.get(p).add(x),_.put(ca(e.toString(),a),n)}removeImagesFromCacheByIds(e,n,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const c=this.cacheMap.get(a),f=this.cacheDependenciesMap.get(a);for(const p of e){const _=ca(p.toString(),n);if(f.has(_)){for(const x of f.get(_))c.delete(x);f.delete(_)}}}rasterize(e,n,a,c){const f=this.getFromCache(e,a,c);if(f)return f.clone();const p=function(x,T){const I=z4.calculate(T.params,x.metadata?x.metadata.variables:[]),C=x.usvg_tree,P=C.width,D=C.height,k=Math.max(1,Math.round(P*T.sx)),j=Math.max(1,Math.round(D*T.sy)),H=new DOMMatrix([k/P,0,0,j/D,0,0]);return B_===null&&(B_=N_(10,10),uT=B_.getContext("2d",{willReadFrequently:!0})),B_.width=k,B_.height=j,dT(uT,H,C,C,I),uT.getImageData(0,0,k,j)}(n.icon,e),_=hT._getImage(p);return this.setInCache(e,_,a,c),_.clone()}}class DP{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function LP(r,e,n,a){let c=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<r[p]||n[p]>e[p])return null}else{const _=1/a[p];let x=(r[p]-n[p])*_,T=(e[p]-n[p])*_;if(x>T){const I=x;x=T,T=I}if(x>c&&(c=x),T<f&&(f=T),c>f)return null}return c}function kP(r,e,n,a,c,f,p,_,x,T,I){const C=a-r,P=c-e,D=f-n,k=p-r,j=_-e,H=x-n,$=I[1]*H-I[2]*j,K=I[2]*k-I[0]*H,ee=I[0]*j-I[1]*k,se=C*$+P*K+D*ee;if(Math.abs(se)<1e-15)return null;const _e=1/se,fe=T[0]-r,xe=T[1]-e,Ie=T[2]-n,Pe=(fe*$+xe*K+Ie*ee)*_e;if(Pe<0||Pe>1)return null;const Xe=xe*D-Ie*P,ke=Ie*C-fe*D,Je=fe*P-xe*C,rt=(I[0]*Xe+I[1]*ke+I[2]*Je)*_e;return rt<0||Pe+rt>1?null:(k*Xe+j*ke+H*Je)*_e}function zP(r,e,n){return(r-e)/(n-e)}function OP(r,e,n,a,c,f,p,_,x){const T=1<<n,I=f-a,C=p-c,P=(r+1)/T*I+a,D=(e+0)/T*C+c,k=(e+1)/T*C+c;_[0]=(r+0)/T*I+a,_[1]=D,x[0]=P,x[1]=k}class FP{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const p=Math.ceil(Math.log2(f.dim/8)),_=[];let x=Math.ceil(Math.pow(2,p));const T=1/x,I=(D,k,j,H,$)=>{const K=H?1:0,ee=(D+1)*j-K,se=k*j,_e=(k+1)*j-K;$[0]=D*j,$[1]=se,$[2]=ee,$[3]=_e};let C=new DP(x);const P=[];for(let D=0;D<x*x;D++){I(D%x,Math.floor(D/x),T,!1,P);const k=Vu(P[0],P[1],f),j=Vu(P[2],P[1],f),H=Vu(P[2],P[3],f),$=Vu(P[0],P[3],f);C.minimums.push(Math.min(k,j,H,$)),C.maximums.push(Math.max(k,j,H,$)),C.leaves.push(1)}for(_.push(C),x/=2;x>=1;x/=2){const D=_[_.length-1];C=new DP(x);for(let k=0;k<x*x;k++){I(k%x,Math.floor(k/x),2,!0,P);const j=D.getElevation(P[0],P[1]),H=D.getElevation(P[2],P[1]),$=D.getElevation(P[2],P[3]),K=D.getElevation(P[0],P[3]),ee=D.isLeaf(P[0],P[1]),se=D.isLeaf(P[2],P[1]),_e=D.isLeaf(P[2],P[3]),fe=D.isLeaf(P[0],P[3]),xe=Math.min(j.min,H.min,$.min,K.min),Ie=Math.max(j.max,H.max,$.max,K.max),Pe=ee&&se&&_e&&fe;C.maximums.push(Ie),C.minimums.push(xe),C.leaves.push(Ie-xe<=5&&Pe?1:0)}_.push(C)}return _}(this.dem),a=n.length-1,c=n[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,c,f,p,_=1){return LP([e,n,-100],[a,c,this.maximums[0]*_],f,p)}raycast(e,n,a,c,f,p,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,n,a,c,f,p,_);if(x==null)return null;const T=[],I=[],C=[],P=[],D=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:k,t:j,nodex:H,nodey:$,depth:K}=D.pop();if(this.leaves[k]){OP(H,$,K,e,n,a,c,C,P);const se=1<<K,_e=(H+0)/se,fe=(H+1)/se,xe=($+0)/se,Ie=($+1)/se,Pe=Vu(_e,xe,this.dem)*_,Xe=Vu(fe,xe,this.dem)*_,ke=Vu(fe,Ie,this.dem)*_,Je=Vu(_e,Ie,this.dem)*_,rt=kP(C[0],C[1],Pe,P[0],C[1],Xe,P[0],P[1],ke,f,p),ot=kP(P[0],P[1],ke,C[0],P[1],Je,C[0],C[1],Pe,f,p),ht=Math.min(rt!==null?rt:Number.MAX_VALUE,ot!==null?ot:Number.MAX_VALUE);if(ht!==Number.MAX_VALUE)return ht;{const pt=mn([],f,p,j);if(NP(Pe,Xe,Je,ke,zP(pt[0],C[0],P[0]),zP(pt[1],C[1],P[1]))>=pt[2])return j}continue}let ee=0;for(let se=0;se<this._siblingOffset.length;se++){OP((H<<1)+this._siblingOffset[se][0],($<<1)+this._siblingOffset[se][1],K+1,e,n,a,c,C,P),C[2]=-100,P[2]=this.maximums[this.childOffsets[k]+se]*_;const _e=LP(C,P,f,p);if(_e!=null){const fe=_e;T[se]=fe;let xe=!1;for(let Ie=0;Ie<ee&&!xe;Ie++)fe>=T[I[Ie]]&&(I.splice(Ie,0,se),xe=!0);xe||(I[ee]=se),ee++}}for(let se=0;se<ee;se++){const _e=I[se];D.push({idx:this.childOffsets[k]+_e,t:T[_e],nodex:(H<<1)+this._siblingOffset[_e][0],nodey:($<<1)+this._siblingOffset[_e][1],depth:K+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,c,f){if(e[c].isLeaf(n,a)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=c-1,_=e[p];let x=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const C=2*n+this._siblingOffset[I][0],P=2*a+this._siblingOffset[I][1],D=_.getElevation(C,P),k=_.isLeaf(C,P),j=this._addNode(D.min,D.max,k);k&&(x|=1<<I),T||(T=j)}for(let I=0;I<this._siblingOffset.length;I++)x&1<<I||this._construct(e,2*n+this._siblingOffset[I][0],2*a+this._siblingOffset[I][1],p,T+I)}}function NP(r,e,n,a,c,f){return fn(fn(r,n,f),fn(e,a,f),c)}function Vu(r,e,n){const a=n.dim,c=W(r*a-.5,0,a-1),f=W(e*a-.5,0,a-1),p=Math.floor(c),_=Math.floor(f),x=Math.min(p+1,a-1),T=Math.min(_+1,a-1);return NP(n.get(p,_),n.get(x,_),n.get(p,T),n.get(x,T),c-p,f-_)}const O4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function F4(r,e,n){return(256*r*256+256*e+n)/10-1e4}function N4(r,e,n){return 256*r+e+n/256-32768}class ex{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,c=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Ot(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const f=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let x=0;x<f;x++)p[this._idx(-1,x)]=p[this._idx(0,x)],p[this._idx(f,x)]=p[this._idx(f-1,x)],p[this._idx(x,-1)]=p[this._idx(x,0)],p[this._idx(x,f)]=p[this._idx(x,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const _=a==="terrarium"?N4:F4;for(let x=0;x<p.length;++x){const T=4*x;this.floatView[x]=_(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=qr.now()}_buildQuadTree(){this._tree=new FP(this)}get(e,n,a=!1){a&&(e=W(e,-1,this.dim),n=W(n,-1,this.dim));const c=this._idx(e,n);return this.floatView[c]}set(e,n,a){const c=this._idx(e,n),f=this.floatView[c];return this.floatView[c]=a,a-f}static getUnpackVector(e){return O4[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const a=[0,0,0,0],c=ex.getUnpackVector(n);let f=Math.floor((e+c[3])/c[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new DI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,f=n*this.dim+this.dim,p=a*this.dim,_=a*this.dim+this.dim;switch(n){case-1:c=f-1;break;case 1:f=c+1}switch(a){case-1:p=_-1;break;case 1:_=p+1}const x=-n*this.dim,T=-a*this.dim;for(let I=p;I<_;I++)for(let C=c;C<f;C++){const P=4*this._idx(C,I),D=4*this._idx(C+x,I+T);this.pixels[P+0]=e.pixels[D+0],this.pixels[P+1]=e.pixels[D+1],this.pixels[P+2]=e.pixels[D+2],this.pixels[P+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function B4(r,e,n){r===1?e.headerLength=n.readFixed32():r===2?e.x=n.readVarint():r===3?e.y=n.readVarint():r===4?e.z=n.readVarint():r===5&&e.layers.push(function(a,c){return a.readFields(G4,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(n,n.readVarint()+n.pos))}function j4(r,e,n){r===1?(e.delta_filter=function(a,c){return a.readFields(U4,{blockSize:0},c)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):r===2?(n.readVarint(),e.filter="zigzag_filter"):r===3?(n.readVarint(),e.filter="bitshuffle_filter"):r===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function U4(r,e,n){r===1&&(e.blockSize=n.readVarint())}function V4(r,e,n){r===1?(n.readVarint(),e.codec="gzip_data"):r===2?(n.readVarint(),e.codec="jpeg_image"):r===3?(n.readVarint(),e.codec="webp_image"):r===4&&(n.readVarint(),e.codec="png_image")}function $4(r,e,n){let a=0,c=0;r===1?e.firstByte=n.readFixed64():r===2?e.lastByte=n.readFixed64():r===3?e.filters.push(function(f,p){return f.readFields(j4,{},p)}(n,n.readVarint()+n.pos)):r===4?e.codec=function(f,p){return f.readFields(V4,{},p)}(n,n.readVarint()+n.pos):r===5?c=n.readFloat():r===6?a=n.readFloat():r===7?e.bands.push(n.readString()):r===8?e.offset=n.readDouble():r===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=a)}function G4(r,e,n){r===1?e.version=n.readVarint():r===2?e.name=n.readString():r===3?e.units=n.readString():r===4?e.tileSize=n.readVarint():r===5?e.buffer=n.readVarint():r===6?e.pixelFormat=n.readVarint():r===7&&e.dataIndex.push(function(a,c){return a.readFields($4,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(n,n.readVarint()+n.pos))}function H4(r,e,n){if(r===2)(function(a,c,f){a.readFields(W4,f,c)})(n,n.readVarint()+n.pos,e);else if(r===3)throw new Error("Not implemented")}function W4(r,e,n){if(r===1){let a=0;const c=n.readVarint()+n.pos;for(;n.pos<c;)e[a++]=n.readVarint()}}function q4(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){const c=a===1?1:0,f=a===2?1:0;for(let p=0;p<e[0];p++){const _=e[1]*p;for(let x=c;x<e[1];x++){const T=e[2]*(x+_);for(let I=f;I<e[2];I++){const C=e[3]*(I+T);for(let P=0;P<e[3];P++){const D=C+P;r[D]+=r[D-n]}}}}n*=e[a]}return r}function Z4(r){for(let e=0,n=r.length;e<n;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function X4(r,e){switch(e){case"uint32":return r;case"uint16":for(let n=0;n<r.length;n+=2){const a=r[n],c=r[n+1];r[n]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,r[n+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return r;case"uint8":for(let n=0;n<r.length;n+=4){const a=r[n],c=r[n+1],f=r[n+2],p=r[n+3];r[n+0]=(192&a)>>6|(192&c)>>4|(192&f)>>2|192&p,r[n+1]=(48&a)>>4|(48&c)>>2|48&f|(48&p)<<2,r[n+2]=(12&a)>>2|12&c|(12&f)<<2|(12&p)<<4,r[n+3]=3&a|(3&c)<<2|(3&f)<<4|(3&p)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}jt(ex,"DEMData"),jt(FP,"DemMinMaxQuadTree",{omit:["dem"]});var fa=Uint8Array,j_=Uint16Array,Y4=Int32Array,BP=new fa([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),jP=new fa([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),K4=new fa([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UP=function(r,e){for(var n=new j_(31),a=0;a<31;++a)n[a]=e+=1<<r[a-1];var c=new Y4(n[30]);for(a=1;a<30;++a)for(var f=n[a];f<n[a+1];++f)c[f]=f-n[a]<<5|a;return{b:n,r:c}},VP=UP(BP,2),$P=VP.b,Q4=VP.r;$P[28]=258,Q4[258]=28;for(var J4=UP(jP,0).b,GP=new j_(32768),Ur=0;Ur<32768;++Ur){var $p=(43690&Ur)>>1|(21845&Ur)<<1;GP[Ur]=((65280&($p=(61680&($p=(52428&$p)>>2|(13107&$p)<<2))>>4|(3855&$p)<<4))>>8|(255&$p)<<8)>>1}var U_=function(r,e,n){for(var a=r.length,c=0,f=new j_(e);c<a;++c)r[c]&&++f[r[c]-1];var p,_=new j_(e);for(c=1;c<e;++c)_[c]=_[c-1]+f[c-1]<<1;p=new j_(1<<e);var x=15-e;for(c=0;c<a;++c)if(r[c])for(var T=c<<4|r[c],I=e-r[c],C=_[r[c]-1]++<<I,P=C|(1<<I)-1;C<=P;++C)p[GP[C]>>x]=T;return p},V_=new fa(288);for(Ur=0;Ur<144;++Ur)V_[Ur]=8;for(Ur=144;Ur<256;++Ur)V_[Ur]=9;for(Ur=256;Ur<280;++Ur)V_[Ur]=7;for(Ur=280;Ur<288;++Ur)V_[Ur]=8;var HP=new fa(32);for(Ur=0;Ur<32;++Ur)HP[Ur]=5;var ej=U_(V_,9),tj=U_(HP,5),fT=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},_l=function(r,e,n){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(7&e)&n},pT=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(7&e)},nj=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],yl=function(r,e,n){var a=new Error(e||nj[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,yl),!n)throw a;return a},ij=new fa(0),rj=typeof TextDecoder<"u"&&new TextDecoder;try{rj.decode(ij,{stream:!0})}catch{}const oj={gzip_data:"gzip"};class Ba extends Error{constructor(e){super(e),this.name="MRTError"}}const sj={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},WP={uint32:1,uint16:2,uint8:4},aj={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let mT;class tx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new Ba(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new Ba("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new Ba(`Expected header with length >= ${a} but got buffer of length ${n.length}`);const c=new mT(n.subarray(0,a)).readFields(B4,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new Ba(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const f of c.layers)this.layers[f.name]=new qP(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],a=this.getLayer(e.layerName);for(let c of e.blockIndices){const f=a.dataIndex[c],p=f.firstByte-e.firstByte,_=f.lastByte-e.firstByte;if(a._blocksInProgress.has(c))continue;const x={layerName:a.name,firstByte:p,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[f.bands.length].concat(a.bandShape),buffer:a.buffer,codec:f.codec.codec,filters:f.filters.map(T=>T.filter)};a._blocksInProgress.add(c),n.push(x)}return new ZP(n,()=>{n.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,f)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),c)throw c;f.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class qP{constructor({version:e,name:n,units:a,tileSize:c,pixelFormat:f,buffer:p,dataIndex:_},x){if(this.version=e,this.version!==1)throw new Ba(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=c,this.buffer=p,this.pixelFormat=sj[f],this.dataIndex=_,this.bandShape=[c+2*p,c+2*p,WP[this.pixelFormat]],this._decodedBlocks=new J0(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return WP[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[a,c]of this.dataIndex.entries()){for(const[f,p]of c.bands.entries())if(p===e)return{bandIndex:n+f,blockIndex:a,blockBandIndex:f};n+=c.bands.length}break;case"number":for(const[a,c]of this.dataIndex.entries()){if(e>=n&&e<n+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=c.bands.length}break;default:throw new Ba(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,a=-1/0;const c=[],f=new Set;for(const p of e){const{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new Ba(`Invalid band: ${JSON.stringify(p)}`);const x=this.dataIndex[_];c.includes(_)||c.push(_),f.add(_),n=Math.min(n,x.firstByte),a=Math.max(a,x.lastByte)}if(f.size>this.cacheSize)throw new Ba(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:a,blockIndices:c}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e);if(n<0)throw new Ba(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(n.toString());if(!c)throw new Ba(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[n],p=this.bandShape.reduce((T,I)=>T*I,1),_=a*p,x=c.subarray(_,_+p);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}tx.setPbf=function(r){mT=r};class ZP{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}tx.performDecoding=function(r,e){const n=new Uint8Array(r);return Promise.all(e.tasks.map(a=>{const{layerName:c,firstByte:f,lastByte:p,pixelFormat:_,blockShape:x,blockIndex:T,filters:I,codec:C}=a,P=n.subarray(f,p+1),D=new Uint32Array(x[0]*x[1]*x[2]);let k;if(C!=="gzip_data")throw new Ba(`Unhandled codec: ${C}`);return k=function(j,H){if(!globalThis.DecompressionStream&&H==="gzip_data")return Promise.resolve(((se=function(xe){xe[0]==31&&xe[1]==139&&xe[2]==8||yl(6,"invalid gzip data");var Ie=xe[3],Pe=10;4&Ie&&(Pe+=2+(xe[10]|xe[11]<<8));for(var Xe=(Ie>>3&1)+(Ie>>4&1);Xe>0;Xe-=!xe[Pe++]);return Pe+(2&Ie)}(ee=j))+8>ee.length&&yl(6,"invalid gzip data"),function(xe,Ie,Pe,Xe){var ke=xe.length;if(!ke||Ie.f&&!Ie.l)return Pe||new fa(0);var Je=!Pe,rt=Je||Ie.i!=2,ot=Ie.i;Je&&(Pe=new fa(3*ke));var ht,pt,ct=function(Ii){var ui=Pe.length;if(Ii>ui){var gi=new fa(Math.max(2*ui,Ii));gi.set(Pe),Pe=gi}},ut=Ie.f||0,Qe=Ie.p||0,Ye=Ie.b||0,dt=Ie.l,It=Ie.d,vt=Ie.m,Jt=Ie.n,Lt=8*ke;do{if(!dt){ut=_l(xe,Qe,1);var Nt=_l(xe,Qe+1,3);if(Qe+=3,!Nt){var Wt=xe[(et=4+((Qe+7)/8|0))-4]|xe[et-3]<<8,Fn=et+Wt;if(Fn>ke){ot&&yl(0);break}rt&&ct(Ye+Wt),Pe.set(xe.subarray(et,Fn),Ye),Ie.b=Ye+=Wt,Ie.p=Qe=8*Fn,Ie.f=ut;continue}if(Nt==1)dt=ej,It=tj,vt=9,Jt=5;else if(Nt==2){var wt=_l(xe,Qe,31)+257,Zt=_l(xe,Qe+10,15)+4,xn=wt+_l(xe,Qe+5,31)+1;Qe+=14;for(var Hn=new fa(xn),qn=new fa(19),Cn=0;Cn<Zt;++Cn)qn[K4[Cn]]=_l(xe,Qe+3*Cn,7);Qe+=3*Zt;var Ei=fT(qn),pe=(1<<Ei)-1,ye=U_(qn,Ei);for(Cn=0;Cn<xn;){var et,ft=ye[_l(xe,Qe,pe)];if(Qe+=15&ft,(et=ft>>4)<16)Hn[Cn++]=et;else{var Mt=0,Rt=0;for(et==16?(Rt=3+_l(xe,Qe,3),Qe+=2,Mt=Hn[Cn-1]):et==17?(Rt=3+_l(xe,Qe,7),Qe+=3):et==18&&(Rt=11+_l(xe,Qe,127),Qe+=7);Rt--;)Hn[Cn++]=Mt}}var en=Hn.subarray(0,wt),rn=Hn.subarray(wt);vt=fT(en),Jt=fT(rn),dt=U_(en,vt),It=U_(rn,Jt)}else yl(1);if(Qe>Lt){ot&&yl(0);break}}rt&&ct(Ye+131072);for(var Sn=(1<<vt)-1,kn=(1<<Jt)-1,On=Qe;;On=Qe){var Un=(Mt=dt[pT(xe,Qe)&Sn])>>4;if((Qe+=15&Mt)>Lt){ot&&yl(0);break}if(Mt||yl(2),Un<256)Pe[Ye++]=Un;else{if(Un==256){On=Qe,dt=null;break}var hn=Un-254;Un>264&&(hn=_l(xe,Qe,(1<<(si=BP[Cn=Un-257]))-1)+$P[Cn],Qe+=si);var vn=It[pT(xe,Qe)&kn],ti=vn>>4;if(vn||yl(3),Qe+=15&vn,rn=J4[ti],ti>3){var si=jP[ti];rn+=pT(xe,Qe)&(1<<si)-1,Qe+=si}if(Qe>Lt){ot&&yl(0);break}rt&&ct(Ye+131072);var ai=Ye+hn;if(Ye<rn){var wi=0-rn,Ri=Math.min(rn,ai);for(wi+Ye<0&&yl(3);Ye<Ri;++Ye)Pe[Ye]=(void 0)[wi+Ye]}for(;Ye<ai;++Ye)Pe[Ye]=Pe[Ye-rn]}}Ie.l=dt,Ie.p=On,Ie.b=Ye,Ie.f=ut,dt&&(ut=1,Ie.m=vt,Ie.d=It,Ie.n=Jt)}while(!ut);return Ye!=Pe.length&&Je?(ht=Pe,((pt=Ye)==null||pt>ht.length)&&(pt=ht.length),new fa(ht.subarray(0,pt))):Pe.subarray(0,Ye)}(ee.subarray(se,-8),{i:2},new fa((($=ee)[(K=$.length)-4]|$[K-3]<<8|$[K-2]<<16|$[K-1]<<24)>>>0))));var $,K,ee,se;const _e=oj[H];if(!_e)throw new Error(`Unhandled codec: ${H}`);const fe=new globalThis.DecompressionStream(_e);return new Response(new Blob([j]).stream().pipeThrough(fe)).arrayBuffer().then(xe=>new Uint8Array(xe))}(P,C).then(j=>(function(H,$){H.readFields(H4,$)}(new mT(j),D),new aj[_](D.buffer))),k.then(j=>{for(let H=I.length-1;H>=0;H--)switch(I[H]){case"delta_filter":q4(j,x);break;case"zigzag_filter":Z4(j);break;case"bitshuffle_filter":X4(j,_);break;default:throw new Ba(`Unhandled filter "${I[H]}"`)}return{layerName:c,blockIndex:T,data:j}}).catch(j=>{throw j})}))},jt(ZP,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),jt(tx,"MapboxRasterTile"),jt(qP,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class XP{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class YP{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Iu(Et,16,0),this.featureIndexArray=new Kg,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,a,c,f,p=0,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,f,p);const T=this.grid;for(let I=0;I<n.length;I++){const C=n[I],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<C.length;D++){const k=C[D];P[0]=Math.min(P[0],k.x),P[1]=Math.min(P[1],k.y),P[2]=Math.max(P[2],k.x),P[3]=Math.max(P[3],k.y)}_!==0&&(P[0]-=_,P[1]-=_,P[2]+=_,P[3]+=_),P[0]<Et&&P[1]<Et&&P[2]>=0&&P[3]>=0&&T.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ue(new R0(this.rawTileData)).layers,this.sourceLayerCoder=new XP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:a,transform:c,tileTransform:f,pixelPosMatrix:p,availableImages:_,worldview:x}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const T=n.queryRadius?n.queryRadius:0,I=a.bufferedTilespaceBounds,C=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(j,H,$,K)=>$o(a.bufferedTilespaceGeometry,j-T,H-T,$+T,K+T));C.sort(lj);let P=null;c.elevation&&C.length>0&&(P=jp.create(c.elevation,this.tileID));const D={};let k;for(let j=0;j<C.length;j++){const H=C[j];if(H===k)continue;k=H;const $=this.featureIndexArray.get(H);let K=null;this.is3DTile?this.loadMatchingModelFeature(D,$,e,a,c,x):this.loadMatchingFeature(D,$,e,_,x,(ee,se,_e,fe=0)=>(K||(K=Se(ee,this.tileID.canonical,f)),se.queryIntersectsFeature(a,ee,_e,K,this.z,c,p,P,fe)))}return D}loadMatchingFeature(e,n,a,c,f,p){const{featureIndex:_,bucketIndex:x,sourceLayerIndex:T,layoutVertexArrayOffset:I}=n,C=this.bucketLayerIDs[x],P=a.layers,D=Object.keys(P);if(D.length&&!Bt(D,C))return;const k=a.sourceCache,j=this.sourceLayerCoder.decode(T),H=this.vtLayers[j].feature(_),$=this.getId(H,j);for(let K=0;K<C.length;K++){const ee=C[K];if(!P[ee])continue;const{styleLayer:se,targets:_e}=P[ee];let fe={};$!==void 0&&(fe=k.getFeatureState(se.sourceLayer,$));const xe=!p||p(H,se,fe,I);if(!xe)continue;const Ie=new xh(H,this.z,this.x,this.y,$);Ie.tile=this.tileID.canonical,Ie.state=fe;let Pe=this.serializedLayersCache.get(ee);Pe||(Pe=se.serialize(),Pe.id=ee,this.serializedLayersCache.set(ee,Pe)),Ie.source=Pe.source,Ie.sourceLayer=Pe["source-layer"],Ie.layer=Object.assign({},Pe),Ie.layer.paint=KP(Pe.paint,se.paint,H,fe,c),Ie.layer.layout=KP(Pe.layout,se.layout,H,fe,c);let Xe=!1;for(const ke of _e){this.updateFeatureProperties(Ie,ke);const{filter:Je}=ke;if(Je){if(H.properties=Ie.properties,Je.needGeometry){const rt=Le(H,!0);if(!Je.filter(new Bi(this.tileID.overscaledZ,{worldview:f}),rt,this.tileID.canonical))continue}else if(!Je.filter(new Bi(this.tileID.overscaledZ,{worldview:f}),H))continue}Xe=!0,ke.targetId&&this.addFeatureVariant(Ie,ke)}Xe&&this.appendToResult(e,ee,_,Ie,xe)}}loadMatchingModelFeature(e,n,a,c,f,p){const{featureIndex:_,bucketIndex:x}=n,T=this.bucketLayerIDs[x],I=a.layers,C=Object.keys(I);if(!C.length||Bt(C,T))for(let P=0;P<T.length;P++){const D=T[P],{styleLayer:k,targets:j}=I[D];if(k.type!=="model")continue;const H=c.tile,$=H.getBucket(k);if(!($&&$ instanceof Z0))continue;const K=m4($,_,c,f);if(!K)continue;const{z:ee,x:se,y:_e}=H.tileID.canonical,{feature:fe,intersectionZ:xe,position:Ie}=K;let Pe={};fe.id!==void 0&&(Pe=a.sourceCache.getFeatureState(k.sourceLayer,fe.id));const Xe=new xh({},ee,se,_e,fe.id);Xe.tile=this.tileID.canonical,Xe.state=Pe,Xe.properties=fe.properties,Xe.geometry={type:"Point",coordinates:[Ie.lng,Ie.lat]};let ke=this.serializedLayersCache.get(D);ke||(ke=k.serialize(),ke.id=D,this.serializedLayersCache.set(D,ke)),Xe.source=ke.source,Xe.sourceLayer=ke["source-layer"],Xe.layer=Object.assign({},ke);let Je=!1;for(const rt of j){this.updateFeatureProperties(Xe,rt);const{filter:ot}=rt;if(ot){if(fe.properties=Xe.properties,ot.needGeometry){if(!ot.filter(new Bi(this.tileID.overscaledZ,{worldview:p}),fe,this.tileID.canonical))continue}else if(!ot.filter(new Bi(this.tileID.overscaledZ,{worldview:p}),fe))continue}Je=!0,rt.targetId&&this.addFeatureVariant(Xe,rt)}Je&&this.appendToResult(e,D,_,Xe,xe)}}updateFeatureProperties(e,n,a){if(n.properties){const c={};for(const f in n.properties){const p=n.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);p!=null&&(c[f]=p)}e.properties=c}}addFeatureVariant(e,n,a){const c={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(c)}appendToResult(e,n,a,c,f){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:c,intersectionZ:f})}lookupSymbolFeatures(e,n,a,c,f,p){const _={};this.loadVTLayers();for(const x of e)this.loadMatchingFeature(_,{bucketIndex:n,sourceLayerIndex:a,featureIndex:x,layoutVertexArrayOffset:0},c,f,p);return _}loadFeature(e){const{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),f=this.vtFeatures[c];if(f[n])return f[n];const p=this.vtLayers[c].feature(n);return f[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const f=Zl(c);if(f.result!=="success"){const p=f.value.map(_=>`${_.key}: ${_.message}`).join(", ");return void Ot(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=f.value}a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[c];typeof a=="boolean"&&(a=Number(a))}return a}}function KP(r,e,n,a,c){return Ge(r,(f,p)=>{const _=e instanceof kc?e.get(p):null;return _&&_.evaluate?_.evaluate(n,a,void 0,c):_})}function lj(r,e){return e-r}jt(YP,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const QP=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=QP[15&a];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new gT(_,p,f,e)}constructor(e,n=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=QP.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return _T(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:_}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const I=x.pop()||0,C=x.pop()||0,P=x.pop()||0;if(C-P<=_){for(let H=P;H<=C;H++){const $=p[2*H],K=p[2*H+1];$>=e&&$<=a&&K>=n&&K<=c&&T.push(f[H])}continue}const D=P+C>>1,k=p[2*D],j=p[2*D+1];k>=e&&k<=a&&j>=n&&j<=c&&T.push(f[D]),(I===0?e<=k:n<=j)&&(x.push(P),x.push(D-1),x.push(1-I)),(I===0?a>=k:c>=j)&&(x.push(D+1),x.push(C),x.push(1-I))}return T}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:p}=this,_=[0,c.length-1,0],x=[],T=a*a;for(;_.length;){const I=_.pop()||0,C=_.pop()||0,P=_.pop()||0;if(C-P<=p){for(let H=P;H<=C;H++)eM(f[2*H],f[2*H+1],e,n)<=T&&x.push(c[H]);continue}const D=P+C>>1,k=f[2*D],j=f[2*D+1];eM(k,j,e,n)<=T&&x.push(c[D]),(I===0?e-a<=k:n-a<=j)&&(_.push(P),_.push(D-1),_.push(1-I)),(I===0?e+a>=k:n+a>=j)&&(_.push(D+1),_.push(C),_.push(1-I))}return x}}function _T(r,e,n,a,c,f){if(c-a<=n)return;const p=a+c>>1;JP(r,e,p,a,c,f),_T(r,e,n,a,p-1,1-f),_T(r,e,n,p+1,c,1-f)}function JP(r,e,n,a,c,f){for(;c>a;){if(c-a>600){const T=c-a+1,I=n-a+1,C=Math.log(T),P=.5*Math.exp(2*C/3),D=.5*Math.sqrt(C*P*(T-P)/T)*(I-T/2<0?-1:1);JP(r,e,n,Math.max(a,Math.floor(n-I*P/T+D)),Math.min(c,Math.floor(n+(T-I)*P/T+D)),f)}const p=e[2*n+f];let _=a,x=c;for($_(r,e,a,n),e[2*c+f]>p&&$_(r,e,a,c);_<x;){for($_(r,e,_,x),_++,x--;e[2*_+f]<p;)_++;for(;e[2*x+f]>p;)x--}e[2*a+f]===p?$_(r,e,a,x):(x++,$_(r,e,x,c)),x<=n&&(a=x+1),n<=x&&(c=x-1)}}function $_(r,e,n,a){yT(r,n,a),yT(e,2*n,2*a),yT(e,2*n+1,2*a+1)}function yT(r,e,n){const a=r[e];r[e]=r[n],r[n]=a}function eM(r,e,n,a){const c=r-n,f=e-a;return c*c+f*f}o.$=xf,o.A=Qa,o.B=ca,o.C=2,o.D=Cp,o.E=Ec,o.F=S_,o.G=IA,o.H=vf,o.I=Lo,o.J=qv,o.K=Qt,o.L=fu,o.M=Gf,o.N=Yd,o.O=kv,o.P=at,o.Q=Kd,o.R=Pd,o.S=ep,o.T=Ib,o.U=Zl,o.V=q0,o.W=Rg,o.X=yu,o.Y=_u,o.Z=Gd,o._=jo,o.a=function(r){return $n.API_CDN_URL_REGEX.test(r)},o.a$=O,o.a0=yn,o.a1=Fs,o.a2=ka,o.a3=class extends q0{},o.a4=Hf,o.a5=Lv,o.a6=Fe,o.a7=function(r){const e=r.value;return e?yn(e)?iT(e,!0)?[]:[new q0(r.key,e,`invalid url "${e}"`)]:[new q0(r.key,e,`string expected, "${Qt(e)}" found`)]:[]},o.a8=$v,o.a9=dr,o.aA=W,o.aB=oe,o.aC=oo,o.aD=Eo,o.aE=Pi,o.aF=b,o.aG=re,o.aH=function(r,e){const n={};for(let a=0;a<e.length;a++){const c=e[a];c in r&&(n[c]=r[c])}return n},o.aI=d,o.aJ=E,o.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,n,a){const c=this.entries[r]=this.entries[r]||{callbacks:[]};if(c.result){const[f,p]=c.result;return this.scheduler?this.scheduler.add(()=>{a(f,p)},e):a(f,p),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=n((f,p)=>{c.result=[f,p];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(f,p)},e):_(f,p);setTimeout(()=>delete this.entries[r],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(f=>f!==a),c.callbacks.length||(c.cancel(),delete this.entries[r]))}}},o.aL=function(r,e,n){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},c=>{const f=Ka(r.request,(p,_,x)=>{p?c(p):_&&c(null,{rawData:_,vectorTile:n?void 0:new Ue(new R0(_)),responseHeaders:new Map(x.entries())})});return()=>{f.cancel(),c()}},e)},o.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=os,o.aO=function(r){Os++,Os>cf&&(r.getActor().send("enforceCacheSizeLimit",lf),Os=0)},o.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},o.aQ=lr,o.aR=tP,o.aS=aP,o.aT=s,o.aU=eP,o.aV=function(r,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<r.length;a++){const c=document.createElement("source");xw(r[a])||(n.crossOrigin="Anonymous"),c.src=r[a],n.appendChild(c)}return{cancel:()=>{}}},o.aW=v_,o.aX=wh,o.aY=Oe,o.aZ=A_,o.a_=M,o.aa=bt,o.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return In(r.expression.evaluate(e))}interpolate(r,e,n){return{x:fn(r.x,e.x,n),y:fn(r.y,e.y,n),z:fn(r.z,e.z,n),azimuthal:fn(r.azimuthal,e.azimuthal,n),polar:fn(r.polar,e.polar,n)}}},o.ac=Bi,o.ad=Rc,o.ae=ne,o.af=li,o.ag=Tt,o.ah=Q,o.ai=kc,o.aj=Fu,o.ak=fn,o.al=Et,o.am=eg,o.an=Bn,o.ao=vi,o.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([n,a]){const c=In([1,n,a]);return{x:c.x,y:c.y,z:c.z}}(r.expression.evaluate(e))}interpolate(r,e,n){return{x:fn(r.x,e.x,n),y:fn(r.y,e.y,n),z:fn(r.z,e.z,n)}}},o.aq=function(r,e,n=0,a=!0){const c=new at(n,n),f=r.sub(c),p=e.add(c),_=[f,new at(p.x,f.y),p,new at(f.x,p.y)];return a&&_.push(f.clone()),_},o.ar=function(r,e){const n=[];for(let a=0;a<r.length;a++){const c=de(a-1,-1,r.length-1),f=de(a+1,-1,r.length-1),p=r[a],_=r[f],x=r[c].sub(p).unit(),T=_.sub(p).unit(),I=T.angleWithSep(x.x,x.y),C=x.add(T).unit().mult(-1*e/Math.sin(I/2));n.push(p.add(C))}return n},o.as=BA,o.at=$o,o.au=function(r,e,n=0){return xt(((e.x-n)*r.scale-r.x)*Et,(e.y*r.scale-r.y)*Et,z(e.z,e.y))},o.av=Di,o.aw=_n,o.ax=Ut,o.ay=eA,o.az=function(r){let e=1/0,n=1/0,a=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return{min:new at(e,n),max:new at(a,c)}},o.b=function(r){return $n.API_FONTS_REGEX.test(r)},o.b$=eC,o.b0=kr,o.b1=Pu,o.b2=De,o.b3=n0,o.b4=$0,o.b5=function(){ol.isLoading()||ol.isLoaded()||th()!=="deferred"||Vv()},o.b6=tp,o.b7=Le,o.b8=xh,o.b9=ur,o.bA=le,o.bB=Te,o.bC=be,o.bD=function(r,e){const{x:n,y:a}=r.point,c=vI(n,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return oe(c,c,tb(ha(e)))},o.bE=q,o.bF=xr,o.bG=Yn,o.bH=mn,o.bI=An,o.bJ=En,o.bK=zp,o.bL=bs,o.bM=Gb,o.bN=function(r,e,n,a,c){const f=5*e+2;r.float32[f+0]=n,r.float32[f+1]=a,r.float32[f+2]=c},o.bO=Bp,o.bP=wo,o.bQ=zs,o.bR=Sa,o.bS=fi,o.bT=de,o.bU=function(r,e,n,a){var c=new B(4);return c[0]=r,c[1]=e,c[2]=n,c[3]=a,c},o.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const n=e.getSource().maxzoom,a=1<<n,c=Math.floor(r.x),f=Math.floor((r.x-c)*a),p=Math.floor(r.y*a),_=this.findDEMTileFor(new lr(n,c,n,f,p));return!(!_||!_.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const c=a.getSource().maxzoom,f=1<<c,p=Math.floor(r.x),_=r.x-p,x=new lr(c,p,c,Math.floor(_*f),Math.floor(r.y*f)),T=this.findDEMTileFor(x);if(!T||!T.dem)return e;const I=T.dem,C=1<<T.tileID.canonical.z,P=(_*C-T.tileID.canonical.x)*I.dim,D=(r.y*C-T.tileID.canonical.y)*I.dim,k=Math.floor(P),j=Math.floor(D);return(n?this.exaggeration():1)*fn(fn(I.get(k,j),I.get(k,j+1),D-j),fn(I.get(k+1,j),I.get(k+1,j+1),D-j),P-k)}static getAtTileOffset(r,e,n,a){const c=1<<r.canonical.z;return a?a.pointElevation(e):n?n.getAtPointOrZero(new ne(r.wrap+(r.canonical.x+e.x/Et)/c,(r.canonical.y+e.y/Et)/c)):0}static getAtTileOffsetFunc(r,e,n,a){return(c,f,p)=>{const _=this.getAtTileOffset(r,c,f,p),x=a.upVector(r.canonical,c.x,c.y);return Kt(x,x,_*a.upVectorScale(r.canonical,e,n).metersToTile),x}}getForTilePoints(r,e,n,a){if(this.isUsingMockSource())return!1;const c=jp.create(this,r,a);return!!c&&(e.forEach(f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const n=e.dem.tree,a=e.tileID,c=1<<r.canonical.z-a.canonical.z;let f=r.canonical.x/c-a.canonical.x,p=r.canonical.y/c-a.canonical.y,_=0;for(let x=0;x<r.canonical.z-a.canonical.z&&!n.leaves[_];x++){f*=2,p*=2;const T=2*Math.floor(p)+Math.floor(f);_=n.childOffsets[_]+T,f%=1,p%=1}return{min:this.exaggeration()*n.minimums[_],max:this.exaggeration()*n.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of r){const f=this.getMinMaxForTile(c.tileID);f&&(n=Math.min(n,f.min),a=Math.max(a,f.max),e=!0)}return e?{min:n,max:a}:null}},o.bW=x0,o.bX=ri,o.bY=Xr,o.bZ=YI,o.b_=lP,o.ba=zb,o.bb=db,o.bc=Se,o.bd=Yl,o.be=Ql,o.bf=zu,o.bg=er,o.bh=Ep,o.bi=tT,o.bj=function(r,e){const n=Fu(e.zoom);if(n===0)return ha(r);const a=c0(r),c=eb(a),f=b(a.getWest())*e.worldSize,p=b(a.getEast())*e.worldSize,_=E(a.getNorth())*e.worldSize,x=E(a.getSouth())*e.worldSize,T=[f,_,0],I=[p,_,0],C=[f,x,0],P=[p,x,0],D=ce([],e.globeMatrix);return li(T,T,D),li(I,I,D),li(C,C,D),li(P,P,D),c[0]=fl(c[0],C,n),c[1]=fl(c[1],P,n),c[2]=fl(c[2],I,n),c[3]=fl(c[3],T,n),Yt.fromPoints(c)},o.bk=d0,o.bl=ce,o.bm=i_,o.bn=fl,o.bo=Au,o.bp=hh,o.bq=Ve,o.br=ue,o.bs=tx,o.bt=R0,o.bu=Ka,o.bv=function(r,e){const n=[];for(const a in r)a in e||n.push(a);return n},o.bw=Ce,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=bo,o.bz=te,o.c=mo,o.c$=function(r,e,n){let a=0;for(let c=0;c<2;++c)r[c]>0&&(a+=(r[c]-0)*(r[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},o.c0=tC,o.c1=Ub,o.c2=LA,o.c3=Xb,o.c4=gT,o.c5=Kt,o.c6=Rs,o.c7=fo,o.c8=function(r,e,n){n*=.5;var a=e[0],c=e[1],f=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return r[0]=a*x+c*_,r[1]=c*x-a*_,r[2]=f*x+p*_,r[3]=p*x-f*_,r},o.c9=vo,o.cA=Ht,o.cB=ci,o.cC=BC,o.cD=Mi,o.cE=gI,o.cF=function(r,e,n,a,c,f,p,_,x){if(x.name==="globe")return gI(r,e,new Mi(n,a,c),!1);const T=A_({z:n,x:a,y:c},x);return new Yt([(f+T.x/T.scale)*e,e*(T.y/T.scale),p],[(f+T.x2/T.scale)*e,e*(T.y2/T.scale),_])},o.cG=function(r,e,n){return r[0]=Math.min(e[0],n[0]),r[1]=Math.min(e[1],n[1]),r[2]=Math.min(e[2],n[2]),r[3]=Math.min(e[3],n[3]),r},o.cH=function(r,e,n){return r[0]=Math.max(e[0],n[0]),r[1]=Math.max(e[1],n[1]),r[2]=Math.max(e[2],n[2]),r[3]=Math.max(e[3],n[3]),r},o.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return Ym[e]},o.cJ=F,o.cK=ps,o.cL=Sp,o.cM=function(r){const e=le(new Float64Array(16));oe(e,r.pixelMatrix,r.globeMatrix);const n=[0,$s,0],a=[0,Gs,0];return li(n,n,e),li(a,a,e),[n[0]>0&&n[0]<=r.width&&n[1]>0&&n[1]<=r.height&&!ib(r,new s(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!ib(r,new s(r.center.lat,-90))]},o.cN=function(r,e){const{scale:n}=r.tileTransform,a=n*Et/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(c,f,p){var _=f[1],x=f[2],T=f[3],I=p[0],C=p[1];return c[0]=f[0]*I,c[1]=_*I,c[2]=x*C,c[3]=T*C,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},o.cO=E0,o.cP=qt,o.cQ=NC,o.cR=function(r){const e=NC(r,!0);return q([],[e[0],e[1],e[4],e[5]])},o.cS=Me,o.cT=Dt,o.cU=Ne,o.cV=function(r){const{x:e,y:n}=r.point,{lng:a,lat:c}=r._center;return vI(e,n,r.worldSize,a,c)},o.cW=mt,o.cX=Ro,o.cY=nr,o.cZ=go,o.c_=Vs,o.ca=pr,o.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},o.cc=cn,o.cd=function(r,e,n,a,c){var f=1/Math.tan(e/2);if(r[0]=f/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=f,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0){var p=1/(a-c);r[10]=(c+a)*p,r[14]=2*c*a*p}else r[10]=-1,r[14]=-2*a;return r},o.ce=function(r,e,n,a,c,f,p){var _=1/(e-n),x=1/(a-c),T=1/(f-p);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(e+n)*_,r[13]=(c+a)*x,r[14]=(p+f)*T,r[15]=1,r},o.cf=A,o.cg=function(r,e,n){r[4*e+0]=n[0],r[4*e+1]=n[1],r[4*e+2]=n[2],r[4*e+3]=n[3]},o.ch=xp,o.ci=sh,o.cj=zr,o.ck=Fa,o.cl=lh,o.cm=GA,o.cn=function(){var r=new B(4);return B!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},o.co=function(r,e,n){var a=e[0],c=e[1],f=e[2],p=e[3],_=Math.sin(n),x=Math.cos(n);return r[0]=a*x+f*_,r[1]=c*x+p*_,r[2]=a*-_+f*x,r[3]=c*-_+p*x,r},o.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},o.cq=Sr,o.cr=function(r){var e=r[0],n=r[1],a=r[2],c=r[3];return Math.sqrt(e*e+n*n+a*a+c*c)},o.cs=ba,o.ct=Qr,o.cu=Ir,o.cv=3,o.cw=2,o.cx=7,o.cy=6,o.cz=Kn,o.d=function(r){return $n.API_TILEJSON_REGEX.test(r)},o.d$=class{constructor(r,e,n,a){this.context=r,this.format=a,this.size=n,this.texture=r.gl.createTexture();const[c,f,p]=this.size,{gl:_}=r;_.bindTexture(_.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&_.texImage3D(_.TEXTURE_3D,0,this.format,c,f,p,0,Sb(this.format),Eb(this.format),e.data)}bind(r,e){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),r!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},o.d0=function(r){return r*r*r*r*r},o.d1=v,o.d2=45,o.d3=wp,o.d4=function(r,e,n){const a=Math.sqrt(r*r+e*e+n*n),c=a>0?Math.acos(n/a)*po:0;let f=r!==0||e!==0?Math.atan2(-e,-r)*po+90:0;return f<0&&(f+=360),[a,f,c]},o.d5=xt,o.d6=In,o.d7=Z,o.d8=ze,o.d9=Yt,o.dA=function(r){return r({pluginStatus:Uo,pluginURL:rl}),Qf.on("pluginStateChange",r),r},o.dB=ah,o.dC=class extends al{constructor(r){super(r),this.current=bp}set(r,e,n){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.dD=vc,o.dE=function(r,e,n){const a=Fu(n.zoom),c=r.style.map._antialias,f=r.terrain&&r.terrain.exaggeration()>0;return a===0&&!c&&!f},o.dF=function(r){const e=r.pixelsPerMeter,n=e/A(1,r.center.lat),a=le(new Float64Array(16));return ue(a,a,[r.point.x,r.point.y,0]),Me(a,a,[n,n,e]),Float32Array.from(a)},o.dG=c0,o.dH=function(r){const e=F-5;r=W(r,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Bn(r))),3);return Math.round(n*(n_.length-1))},o.dI=function(r,e,n,a){const c=e.getNorth(),f=e.getSouth(),p=e.getWest(),_=e.getEast(),x=1<<r.z,T=_-p,I=c-f,C=T/Lu,P=-I/n_[n],D=[0,C,0,P,0,0,c,p,0];if(r.z>0){const k=180/a;ie(D,D,[k/T+1,0,0,0,k/I+1,0,-.5*k/C,.5*k/P,1])}return D[2]=x,D[5]=r.x,D[8]=r.y,D},o.dJ=ha,o.dK=function(r,e,n){const a=le(new Float64Array(16)),c=(e/(1<<r)-.5)*Math.PI*2;return je(a,n.globeMatrix,c),Float32Array.from(a)},o.dL=DI,o.dM=Na,o.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},o.dO=Y,o.dP=function(r,e){var n=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=n,r[2]=0,r[3]=-n,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},o.dQ=Ar,o.dR=yI,o.dS=ni,o.dT=sr,o.dU=256,o.dV=function(r,e){const n=[0,0,0];return li(n,n,d0(ha(e.canonical))),li(n,n,r),n},o.dW=r=>({u_matrix:new lh(r),u_texsize:new Fa(r),u_pixels_to_tile_units:new Tp(r),u_device_pixel_ratio:new zr(r),u_width_scale:new zr(r),u_floor_width_scale:new zr(r),u_image:new xp(r),u_units_to_pixels:new Fa(r),u_tile_units_to_pixels:new zr(r),u_alpha_discard_threshold:new zr(r),u_trim_offset:new Fa(r),u_trim_fade_range:new Fa(r),u_trim_color:new wp(r),u_zbias_factor:new zr(r),u_tile_to_meter:new zr(r),u_ground_shadow_factor:new sh(r),u_pattern_transition:new zr(r)}),o.dX=r=>({u_matrix:new lh(r),u_pixels_to_tile_units:new Tp(r),u_device_pixel_ratio:new zr(r),u_width_scale:new zr(r),u_floor_width_scale:new zr(r),u_units_to_pixels:new Fa(r),u_dash_image:new xp(r),u_gradient_image:new xp(r),u_image_height:new zr(r),u_texsize:new Fa(r),u_tile_units_to_pixels:new zr(r),u_alpha_discard_threshold:new zr(r),u_trim_offset:new Fa(r),u_trim_fade_range:new Fa(r),u_trim_color:new wp(r),u_zbias_factor:new zr(r),u_tile_to_meter:new zr(r),u_ground_shadow_factor:new sh(r)}),o.dY=r=>({u_camera_to_center_distance:new zr(r),u_extrude_scale:new Tp(r),u_device_pixel_ratio:new zr(r),u_matrix:new lh(r),u_inv_rot_matrix:new lh(r),u_merc_center:new Fa(r),u_tile_id:new sh(r),u_zoom_transition:new zr(r),u_up_dir:new sh(r),u_emissive_strength:new zr(r)}),o.dZ=dp,o.d_=v5,o.da=He,o.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},o.dc=FC,o.dd=Db,o.de=VC,o.df=iT,o.dg=function(r,e){return r.readFields(y4,{icons:[]},e)},o.dh=w0,o.di=Op,o.dj=Wb,o.dk=hf,o.dl=eh,o.dm=uu,o.dn=pf,o.dp=it,o.dq=function(r){const e=r.indexOf(Fc);return e>=0?r.slice(0,e):r},o.dr=function(r){return r.indexOf(Fc)>=0},o.ds=function(r){const e=r.lastIndexOf(Fc);return e>=0?r.slice(e+1):""},o.dt=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.du=function(r,e,n,a){return r.type==="custom"?new d4(r,e):new g4[r.type](r,e,n,a)},o.dv=gt,o.dw=function(r){const e=r.indexOf(Fc);return e>=0?r.slice(e+1):""},o.dx=class extends xh{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},o.dy=Qf,o.dz=Sc,o.e=$n,o.e$=kt,o.e0=bI,o.e1=(r,e,n,a,c,f)=>{const p=r.transform,_=p.projection.name==="globe";let x;if(f.paint.get("circle-pitch-alignment")==="map")if(_){const I=yI(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;x=Float32Array.from([I,0,0,I])}else x=p.calculatePixelsToTileUnitsMatrix(n);else x=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(p.projection),u_matrix:r.translatePosMatrix(e.projMatrix,n,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:qr.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:zN,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(_){T.u_inv_rot_matrix=a,T.u_merc_center=c,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=Fu(p.zoom);const I=c[0]*Et,C=c[1]*Et;T.u_up_dir=p.projection.upVector(new Mi(0,0,0),I,C)}return T},o.e2=rA,o.e3=Bo,o.e4=(r,e,n,a,c,f,p,_,x,T)=>{const I=r.transform,C=I.pitch<15?tA(.07,.7,W((14-I.zoom)/5,0,1)):.07,P=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:iA(r,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:f,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:nA(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:n.lut).toArray01(),u_zbias_factor:C,u_tile_to_meter:Z(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:T}},o.e5=(r,e,n,a,c,f,p,_,x,T)=>{const I=r.transform,C=I.calculatePixelsToTileUnitsMatrix(e),P=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=I.pitch<15?tA(.07,.7,W((14-I.zoom)/5,0,1)):.07;return{u_matrix:iA(r,e,n,a),u_pixels_to_tile_units:C,u_device_pixel_ratio:f,u_width_scale:p,u_floor_width_scale:_,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:oA(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:nA(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:n.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:Z(e.tileID.canonical,0),u_ground_shadow_factor:T}},o.e6=We,o.e7=r_,o.e8=z,o.e9=Ws,o.eA=function(r,e){var n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>N?(r[0]=e[0]/a,r[1]=e[1]/a,r[2]=e[2]/a):(r[0]=1,r[1]=0,r[2]=0),n},o.eB=sT,o.eC=A0,o.eD=C0,o.eE=[1,1,1],o.eF=jp,o.eG=qo,o.eH=function(r,e,n,a){var c=e[0],f=e[1],p=e[2],_=e[3];return r[0]=c+a*(n[0]-c),r[1]=f+a*(n[1]-f),r[2]=p+a*(n[2]-p),r[3]=_+a*(n[3]-_),r},o.eI=Rp,o.eJ=vs,o.eK=Oa,o.eL=function(r,e,n,a,c,f,p,_,x,T,I,C,P,D,k,j){var H=new B(16);return H[0]=r,H[1]=e,H[2]=n,H[3]=a,H[4]=c,H[5]=f,H[6]=p,H[7]=_,H[8]=x,H[9]=T,H[10]=I,H[11]=C,H[12]=P,H[13]=D,H[14]=k,H[15]=j,H},o.eM=u,o.eN=Ru,o.eO=Wg,o.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const n=QI(new at(0,0),new at(Et,Et),r),a=[];if(e&&!hb(n,this._globalClipBounds))return a;for(const c of this._activeRegions){if(c.hiddenByOverlap||!hb(n,c))continue;const f=uB(c.min,c.max,r);a.push({min:f.min,max:f.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return a}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const n=r.getOrder(),a=r.getClipMask(),c=r.getClipScope();for(const f of e){if(!f.footprint)continue;const p=QI(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:n,clipMask:a,clipScope:c})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||g0(e.min,n.min)||g0(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(a,c){const f=(p,_)=>p+_;return a.length-c.length||a.reduce(f,"").localeCompare(c.reduce(f,""))}(e.clipScope,n.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[e];r=n.priority!==a.priority||!KI(n,a)||n.order!==a.order||n.clipMask!==a.clipMask||!bo(n.clipScope,a.clipScope),this._activeRegions[e].hiddenByOverlap=a.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const n of this._activeRegions)n.order!==u_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const a=this._activeRegions;if(n>=a.length)return n;const c=a[n].priority;for(;n<a.length&&a[n].priority===c;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let c=n;const f=n;for(;c!==a;){const p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let _=0;_<f;_++){const x=this._activeRegions[_];if(!x.hiddenByOverlap&&p.order===u_&&hb(p,x)&&(p.hiddenByOverlap=JI(p.footprint,p.tileId,x.footprint,x.tileId),p.hiddenByOverlap))break}++c}n=a,a=e(n)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},o.eQ=u_,o.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const n=new Yl,a=new kr,c=[],f=r+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),x=(T,I,C)=>{let P=T===f-1?T-2:T===0?T:T-1;return P+=C?24575:0,[P,I]};for(let T=0;T<f;++T)n.emplaceBack(...x(T,0,!0));for(let T=0;T<p;++T)for(let I=0;I<f;++I)n.emplaceBack(...x(I,T,(I===0||I===f-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let C=0;C<f;++C)n.emplaceBack(...x(C,I,!0))}for(let T=0;T<e.length;++T){const I=a.length,C=e[T]+1+2,P=new kr;for(let j=0;j<C-1;j++){const H=j===C-2,$=H?f*(_-e.length+T-j):f;for(let K=0;K<f-1;K++){const ee=j*f+K;j===0||H||K===0||K===f-2?(P.emplaceBack(ee+1,ee,ee+$),P.emplaceBack(ee+$,ee+$+1,ee+1)):(a.emplaceBack(ee+1,ee,ee+$),a.emplaceBack(ee+$,ee+$+1,ee+1))}}const D=er.simpleSegment(0,I,n.length,a.length-I);for(let j=0;j<P.uint16.length;j+=3)a.emplaceBack(P.uint16[j],P.uint16[j+1],P.uint16[j+2]);const k=er.simpleSegment(0,I,n.length,a.length-I);c.push({withoutSkirts:D,withSkirts:k})}return{vertices:n,indices:a,segments:c}}_createGrid(r){const e=this._fillGridMeshWithLods(Lu,n_);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,zu.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new kr;for(let p=0;p<=Lu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const n=new Bc,a=new Bc,c=new Bc,f=new Bc;this._poleSegments=[];for(let p=0,_=0;p<Vs;p++){const x=360/(1<<p);n.emplaceBack(0,-Eo,0,.5,0),a.emplaceBack(0,-Eo,0,.5,1),c.emplaceBack(0,-Eo,0,.5,.5),f.emplaceBack(0,-Eo,0,.5,.5);for(let T=0;T<=Lu;T++){let I=T/Lu,C=0;const P=fn(0,x,I),[D,k,j]=jc(LN,kN,P,Eo);n.emplaceBack(D,k,j,I,C),a.emplaceBack(D,k,j,I,1-C);const H=Bn(P);I=.5+.5*Math.sin(H),C=.5+.5*Math.cos(H),c.emplaceBack(D,k,j,I,C),f.emplaceBack(D,k,j,I,1-C)}this._poleSegments.push(er.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(n,da,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,da,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(c,da,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(f,da,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},o.eS=XI,o.eT=Cd,o.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eV=Be,o.eW=X,o.eX=function(r,e,n){return r[0]=e[0]/n[0],r[1]=e[1]/n[1],r[2]=e[2]/n[2],r},o.eY=uo,o.eZ=ku,o.e_=nn,o.ea=v0,o.eb=mC,o.ec=Vc,o.ed=oC,o.ee=rC,o.ef=U,o.eg=function(r,e){if(r===e){var n=e[1],a=e[2],c=e[3],f=e[6],p=e[7],_=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=n,r[6]=e[9],r[7]=e[13],r[8]=a,r[9]=f,r[11]=e[14],r[12]=c,r[13]=p,r[14]=_}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},o.eh=u4,o.ei=jn,o.ej=Zg,o.ek=256,o.el=tb,o.em=ys,o.en=je,o.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},o.ep=Bc,o.eq=Mv,o.er=Hg,o.es=function(r,e,n,a,c){return W((r-e)/(n-e)*(c-a)+a,a,c)},o.et=ea,o.eu=function(r,e){var n=e[0],a=e[1],c=e[2],f=e[3],p=e[4],_=e[5],x=e[6],T=e[7],I=e[8],C=I*p-_*T,P=-I*f+_*x,D=T*f-p*x,k=n*C+a*P+c*D;return k?(r[0]=C*(k=1/k),r[1]=(-I*a+c*T)*k,r[2]=(_*a-c*p)*k,r[3]=P*k,r[4]=(I*n-c*x)*k,r[5]=(-_*n+c*f)*k,r[6]=D*k,r[7]=(-T*n+a*x)*k,r[8]=(p*n-a*f)*k,r):null},o.ev=2,o.ew=Zn,o.ex=Js,o.ey=At,o.ez=function(r,e){var n=new B(3);At(n,e);var a=1/n[0],c=1/n[1],f=1/n[2],p=e[0]*a,_=e[1]*c,x=e[2]*f,T=e[4]*a,I=e[5]*c,C=e[6]*f,P=e[8]*a,D=e[9]*c,k=e[10]*f,j=p+I+k,H=0;return j>0?(H=2*Math.sqrt(j+1),r[3]=.25*H,r[0]=(C-D)/H,r[1]=(P-x)/H,r[2]=(_-T)/H):p>I&&p>k?(H=2*Math.sqrt(1+p-I-k),r[3]=(C-D)/H,r[0]=.25*H,r[1]=(_+T)/H,r[2]=(P+x)/H):I>k?(H=2*Math.sqrt(1+I-p-k),r[3]=(P-x)/H,r[0]=(_+T)/H,r[1]=.25*H,r[2]=(C+D)/H):(H=2*Math.sqrt(1+k-p-I),r[3]=(_-T)/H,r[0]=(P+x)/H,r[1]=(C+D)/H,r[2]=.25*H),r},o.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},o.f0=function([r,e,n]){const a=Math.hypot(r,e,n),c=Math.atan2(r,n),f=.5*Math.PI-Math.acos(-e/a);return new s(Ro(c),Ro(f))},o.f1=ho,o.f2=Cb,o.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(n){if(Pr==null){const a=n.navigator?n.navigator.userAgent:null;Pr=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Pr}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f4=function(r,e){lf=r,cf=e},o.f5=ib,o.f6=xI,o.f7=function(r){const e=[0,0,0],n=le(new Float64Array(16));return oe(n,r.pixelMatrix,r.globeMatrix),li(e,e,n),new at(e[0],e[1])},o.f8=function(){const r=g_;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(yb),g_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f9=function(){w0().acquire(yb)},o.fA=ex,o.fB=Re,o.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==DC){const n=new Uint32Array(r,0,7),[,,a,c,f,p]=n;e=n.byteLength+c+f+p+f,(a!==r.byteLength||e>=r.byteLength)&&Ot("Invalid b3dm header information.")}return OC(r,e)},o.fD=function(r,e){const n=Db(r);for(const a of n){for(const c of a.meshes)UB(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(VB(a.lights,e)))}return n},o.fE=Z0,o.fF=Qn,o.fG=CC,o.fH=ol,o.fI=ss,o.fJ=function(r){ra(),Ia!=null&&Ia.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-r;a++)e.delete(n[a]).catch(c=>Ot(c.message))}).catch(n=>Ot(n.message))}).catch(e=>Ot(e.message))},o.fa=th,o.fb=function(r,e,n=!1){if(Uo===ss.deferred||Uo===ss.loading||Uo===ss.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");rl=qr.resolveURL(r),Uo=ss.deferred,zg=e,Kf(),n||Vv()},o.fc=function(r){Ap=qr.resolveURL(r),Pp||(Pp=new Cp(w0(),new Ec)),Pp.broadcast("setMeshoptUrl",Ap)},o.fd=MC,o.fe=function(r){wb=qr.resolveURL(r),Pp||(Pp=new Cp(w0(),new Ec)),Pp.broadcast("setDracoUrl",wb)},o.ff=PC,o.fg=m_,o.fh=function(r){const e=ia();if(!e)return;const n=e.delete(af);r&&n.then(()=>r()).catch(r)},o.fi=mh,o.fj=jt,o.fk=Nu,o.fl=gl,o.fm=XP,o.fn=YP,o.fo=KC,o.fp=Ke,o.fq="hd_road_elevation",o.fr=pi,o.fs=Ge,o.ft=Uc,o.fu=Hb,o.fv=yh,o.fw=function(r,e,n,a,c,f,p,_=1,x,T,I){r.createArrays(),r.tilePixelRatio=Et/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const C=r.layers[0].layout,P=r.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=_,D.textSizeScaleRange=C.get("text-size-scale-range"),D.iconSizeScaleRange=C.get("icon-size-scale-range");const[k,j]=D.textSizeScaleRange,[H,$]=D.iconSizeScaleRange;D.textScaleFactor=W(D.scaleFactor,k,j),D.iconScaleFactor=W(D.scaleFactor,H,$);const K=P["text-size"],ee=P["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Pe,maxZoom:Xe}=r.textSizeData;D.compositeTextSizes=[K.possiblyEvaluate(new Bi(Pe,{worldview:I}),f),K.possiblyEvaluate(new Bi(Xe,{worldview:I}),f)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Pe,maxZoom:Xe}=r.iconSizeData;D.compositeIconSizes=[ee.possiblyEvaluate(new Bi(Pe,{worldview:I}),f),ee.possiblyEvaluate(new Bi(Xe,{worldview:I}),f)]}D.layoutTextSize=K.possiblyEvaluate(new Bi(p+1,{worldview:I}),f),D.layoutIconSize=ee.possiblyEvaluate(new Bi(p+1,{worldview:I}),f),D.textMaxSize=K.possiblyEvaluate(new Bi(18,{worldview:I}),f);const se=C.get("symbol-placement"),_e=C.get("text-rotation-alignment")==="map"&&se!=="point",fe=C.get("text-size");let xe=!1;const Ie=[];for(const Pe of r.features){const Xe=C.get("text-font").evaluate(Pe,{},f).join(","),ke=fe.evaluate(Pe,{},f)*D.textScaleFactor,Je=D.layoutTextSize.evaluate(Pe,{},f)*D.textScaleFactor,rt=D.layoutIconSize.evaluate(Pe,{},f)*D.iconScaleFactor,ot={horizontal:{},vertical:void 0},ht=Pe.text;let pt,ct=[0,0];if(ht){const Cn=ht.toString(),Ei=C.get("text-letter-spacing").evaluate(Pe,{},f)*Xr,pe=C.get("text-line-height").evaluate(Pe,{},f)*Xr,ye=Lg(Cn)?Ei:0,et=C.get("text-anchor").evaluate(Pe,{},f),ft=C.get("text-variable-anchor");if(!ft){const Sn=C.get("text-radial-offset").evaluate(Pe,{},f);if(Sn)ct=LA(et,[Sn*Xr,Zb]);else{const kn=C.get("text-offset").evaluate(Pe,{},f);ct=[kn[0]*Xr,kn[1]*Xr]}}let Mt=_e?"center":C.get("text-justify").evaluate(Pe,{},f);const Rt=se==="point",en=Rt?C.get("text-max-width").evaluate(Pe,{},f)*Xr:1/0,rn=Sn=>{r.allowVerticalPlacement&&Jd(Cn)&&(ot.vertical=jb(ht,e,n,c,Xe,en,pe,et,Sn,ye,ct,bs.vertical,!0,Je,ke,x))};if(!_e&&ft){const Sn=Mt==="auto"?ft.map(On=>Xb(On)):[Mt];let kn=!1;for(let On=0;On<Sn.length;On++){const Un=Sn[On];if(!ot.horizontal[Un])if(kn)ot.horizontal[Un]=ot.horizontal[0];else{const hn=jb(ht,e,n,c,Xe,en,pe,"center",Un,ye,ct,bs.horizontal,!1,Je,ke,x);hn&&(ot.horizontal[Un]=hn,kn=hn.positionedLines.length===1)}}rn("left")}else{if(Mt==="auto"&&(Mt=Xb(et)),Rt||C.get("text-writing-mode").indexOf("horizontal")>=0||!Jd(Cn)){const Sn=jb(ht,e,n,c,Xe,en,pe,et,Mt,ye,ct,bs.horizontal,!1,Je,ke,x);Sn&&(ot.horizontal[Mt]=Sn)}rn(Rt?"left":Mt)}}let ut,Qe,Ye,dt,It,vt,Jt=!1;const Lt=C.get("icon-text-fit").evaluate(Pe,{},f);if(Pe.icon&&Pe.icon.hasPrimary()){const Cn=I_(Pe.icon,r.iconSizeData,P["icon-size"],f,r.zoom,Pe,x,D.iconScaleFactor,I);ut=Cn.iconPrimary,Ye=Cn.iconSecondary;const Ei=ut.toString();if(Qe=a.get(Ei),Qe&&(It=C.get("icon-offset").evaluate(Pe,{},f),vt=C.get("icon-anchor").evaluate(Pe,{},f),pt=L0(c.get(Ei),Ye?c.get(Ye.toString()):void 0,It,vt),Jt=Qe.sdf,r.sdfIcons===void 0?r.sdfIcons=Qe.sdf:r.sdfIcons!==Qe.sdf&&Ot("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==r.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ye){const pe=Ye.toString();dt=a.get(pe)}}xe=xe||!(!Pe.icon||!Pe.icon.hasSecondary());const Nt=N0(ot.horizontal)||ot.vertical;r.iconsInText||(r.iconsInText=!!Nt&&Nt.iconsInText);const Wt=Je*D.textScaleFactor/Xr,{defaultShapedIcon:Fn,verticallyShapedIcon:wt}=Y5(r,pt,C,Pe,f,ot,Wt,It,Lt);Lt!=="none"&&pt&&(yA(pt)||vA(pt))&&(F0(0,Qe,ut,pt,Fn,Lt,T,a,c),F0(0,dt,Ye,pt,Fn,Lt,T,a,c),wt&&(F0(0,Qe,ut,pt,wt,Lt,T,a,c),F0(0,dt,Ye,pt,wt,Lt,T,a,c))),pt=Fn;const{iconBBox:Zt,iconVerticalBBox:xn,textBBox:Hn,textVerticalBBox:qn}=H5(r,pt,wt,C,Pe,f,rt,It,D,c,vt,ot,Je,ct);Ie.push({feature:Pe,shapedTextOrientations:ot,shapedText:Nt,shapedIcon:pt,iconPrimary:ut,iconSecondary:Ye,iconOffset:It,iconAnchor:vt,verticallyShapedIcon:wt,layoutTextSize:Je,layoutIconSize:rt,textOffset:ct,isSDFIcon:Jt,iconTextFit:Lt,iconCollisionBounds:Zt,iconVerticalCollisionBounds:xn,textCollisionBounds:Hn,textVerticalCollisionBounds:qn})}return{featureData:Ie,sizes:D,hasAnySecondaryIcon:xe,textAlongLine:_e,symbolPlacement:se}},o.fx=CA,o.fy=function(r,e,n,a,c,f,p,_,x,T){r.iconAtlasPositions=T.iconPositions;const{featureData:I,hasAnySecondaryIcon:C,sizes:P,textAlongLine:D,symbolPlacement:k}=e;for(const j of I){const{shapedIcon:H,verticallyShapedIcon:$,feature:K,shapedTextOrientations:ee,shapedText:se,layoutTextSize:_e,textOffset:fe,isSDFIcon:xe,iconPrimary:Ie,iconSecondary:Pe,iconTextFit:Xe,iconOffset:ke,iconCollisionBounds:Je,iconVerticalCollisionBounds:rt,textCollisionBounds:ot}=j;zA(H,T.iconPositions,Ie,Pe),zA($,T.iconPositions,Ie,Pe),X5(ee,T.iconPositions),Z5(Ie,Pe,T.iconPositions),(se||H)&&K5(r,K,ee,H,$,x,P,_e,0,fe,xe,a,c,p,_,C,Xe,ke,D,k,Je,rt,ot)}n&&r.generateCollisionDebugBuffers(f,r.collisionBoxArray,P.textScaleFactor)},o.fz=Ue,o.g=function(r,e){return Sc(Object.assign(r,{method:"GET"}),e)},o.h=function(r){return r.indexOf("mapbox:")===0},o.i=function(r){return $n.API_STYLE_REGEX.test(r)&&!mo(r)},o.j=mr,o.k=Ca,o.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(r,e){return Sc(Object.assign(r,{type:"json"}),e)},o.n=ff,o.o=qr,o.p=function(r,e){return Sc(Object.assign(r,{method:"POST"}),e)},o.q=Ao,o.r=Ea,o.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return vb||(vb=new mh("ImageRasterizer")),vb},o.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},o.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},o.w=Ot,o.x=hT,o.y=Ld,o.z=Aa}),S(["./shared"],function(o){function N(Be){const W=Be?Be.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function B(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let Q="[";for(const de of Be)Q+=`${B(de)},`;return`${Q}]`}let W="{";for(const Q of Object.keys(Be).sort())W+=`${Q}:${B(Be[Q])},`;return`${W}}`}function q(Be){let W="";for(const Q of o.bx)W+=`/${B(Be[Q])}`;return W}class Y{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,Q){this._layerConfigs={},this._layers={},this.update(W,[],Q)}update(W,Q,de){this._options=de;for(const Ee of W)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=o.du(Ee,this.scope,null,this._options)).compileFilter(de),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of Q)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Ce=function(Ee,De){const We={};for(let Ge=0;Ge<Ee.length;Ge++){const gt=Ee[Ge];let it=De&&De[gt.id];it||(gt.type==="symbol"?it=gt.id:(it=q(gt),gt.type==="line"&&gt.paint&&function on(Ot){return typeof Ot=="string"&&Ot==="line-progress"||(Array.isArray(Ot)?Ot.some(on):!(!Ot||typeof Ot!="object")&&Object.values(Ot).some(on))}(gt.paint["line-width"])&&(it+=`/${B(gt.paint["line-width"])}`))),De&&(De[gt.id]=it);let Bt=We[it];Bt||(Bt=We[it]=[]),Bt.push(gt)}const Oe=[];for(const Ge in We)Oe.push(We[Ge]);return Oe}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Ce){const De=Ee.map(Bt=>this._layers[Bt.id]),We=De[0];if(We.visibility==="none")continue;const Oe=We.source||"";let Ge=this.familiesBySource[Oe];Ge||(Ge=this.familiesBySource[Oe]={});const gt=We.sourceLayer||"_geojsonTileLayer";let it=Ge[gt];it||(it=Ge[gt]=[]),it.push(De)}}}const J=1*o.fl;class ie{constructor(W){const Q={},de=[];for(const We in W){const Oe=W[We],Ge=Q[We]={};for(const gt in Oe.glyphs){const it=Oe.glyphs[+gt];if(!it||it.bitmap.width===0||it.bitmap.height===0)continue;const Bt=it.metrics.localGlyph?J:1,on={x:0,y:0,w:it.bitmap.width+2*Bt,h:it.bitmap.height+2*Bt};de.push(on),Ge[gt]=on}}const{w:Ce,h:Ee}=o.G(de),De=new o.fk({width:Ce||1,height:Ee||1});for(const We in W){const Oe=W[We];for(const Ge in Oe.glyphs){const gt=Oe.glyphs[+Ge];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const it=Q[We][Ge],Bt=gt.metrics.localGlyph?J:1;o.fk.copy(gt.bitmap,De,{x:0,y:0},{x:it.x+Bt,y:it.y+Bt},gt.bitmap)}}this.image=De,this.positions=Q}}function be(Be,W,Q){Be[W]?Q&&(Be[W].center=Q):Be[W]={floorIds:new Set,center:Q||[0,0],floors:{}}}function te(Be,W,Q,de){for(const Ce of W)be(Be,Ce),Be[Ce].floors[Q]=de,Be[Ce].floorIds.add(Q)}function le(Be){return{id:Be.properties.id.toString(),center:Be.properties.center.toString().split(";").map(Number)}}function ce(Be){return{id:Be.properties.id.toString(),isDefault:!!Be.properties.is_default&&Be.properties.is_default,connections:Be.properties.connected_floor_ids?new Set(Be.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Be.properties.conflicted_floor_ids?new Set(Be.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Be.properties.building_ids?new Set(Be.properties.building_ids.toString().split(";")):new Set,name:Be.properties.name.toString(),zIndex:Be.properties.z_index}}function oe(Be,W){return W.every(Q=>Be.properties&&Be.properties[Q]!=null)}function ue(Be){return oe(Be,["type","id","name"])&&Be.properties.type==="building"}function Me(Be){return oe(Be,["type","id","name","z_index"])&&Be.properties.type==="floor"}o.fj(ie,"GlyphAtlas");class Ne{constructor(W){this.tileID=new o.aQ(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.request&&W.request.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=o.aZ(W.tileID.canonical,W.projection),this.projection=W.projection,this.worldview=W.worldview,this.localizableLayerIds=W.localizableLayerIds,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep,this.scaleFactor=W.scaleFactor,this.worldview=W.worldview,this.indoor=W.indoor}parse(W,Q,de,Ce,Ee,De){this.status="parsing",this.data=W,this.collisionBoxArray=new o.b3;const We=new o.fm(Object.keys(W.layers).sort()),Oe=new o.fn(this.tileID,this.promoteId);Oe.bucketLayerIDs=[];const Ge={},gt=new o.fo(256,256),it={featureIndex:Oe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gt,availableImages:de,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Rn=this.indoor.indoorState.activeFloorsVisible,Pn=function(In,Qn,ur){const Pr=function(or,ni){if(!or)return o.w("No source layers defined in indoor specification"),ni;if(or.size===0)return ni;const sr=or.difference(ni);for(const Li of sr)o.w(`Missing source layer required in indoor specification: ${Li}`);return ni.intersection(ni)}(Qn.sourceLayers,new Set(Object.keys(In.layers))),pr=Qn.indoorState,Lr=function(or,ni,sr,Li){const $n=new Set,mr=new Set,mo=new Set,To=new Map,Zo={},xc=Jr=>{const ms=To.get(Jr)||new Set;for(const Do of $n)if((To.get(Do)||new Set).has(Jr)||ms.has(Do))return!0;return!1};for(const Jr of ni){const ms=or.layers[Jr];if(ms)for(let Do=0;Do<ms.length;Do++){const Ea=ms.feature(Do);if(ue(Ea)){const{id:qr,center:wc}=le(Ea);be(Zo,qr,wc),$n.add(qr)}else if(Me(Ea)){const{id:qr,isDefault:wc,connections:uu,conflicts:af,buildings:lf,name:cf,zIndex:Ad}=ce(Ea);te(Zo,lf,qr,{name:cf,zIndex:Ad}),To.set(qr,af),(qr===Li||uu.has(Li))&&$n.add(qr),mr.add(qr),wc&&mo.add(qr)}}else o.w(`indoor source layer not found: ${Jr}`)}if(sr)for(const Jr of sr)mr.has(Jr)&&(xc(Jr)||$n.add(Jr));for(const Jr of mo)$n.has(Jr)||xc(Jr)||$n.add(Jr);return{buildings:Zo,activeFloors:$n}}(In,Pr,pr.lastActiveFloors,pr.selectedFloorId);return ur.send("setIndoorData",Lr),Lr}(W,this.indoor,Ee);it.activeFloors=Rn?Pn.activeFloors:void 0}const Bt=[],on=Q.familiesBySource[this.source];for(const Rn in on){const Pn=W.layers[Rn];if(!Pn)continue;let In=!1,Qn=!1,ur=!1;for(const ni of on[Rn])ni[0].type==="symbol"?In=!0:Qn=!0,ni[0].is3D()&&ni[0].type!=="model"&&(ur=!0);if(this.extraShadowCaster&&!ur||this.isSymbolTile===!0&&!In||this.isSymbolTile===!1&&!Qn)continue;Pn.version===1&&o.w(`Vector tile source "${this.source}" layer "${Rn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pr=We.encode(Rn),pr=[],Lr=this.localizableLayerIds&&this.localizableLayerIds.has(Rn);let or=!1;for(let ni=0,sr=0;ni<Pn.length;ni++){const Li=Pn.feature(ni),$n=Oe.getId(Li,Rn),mr=Li.properties?Li.properties.worldview:null;if(Lr&&this.worldview&&typeof mr=="string")if(mr==="all")Li.properties.$localized=!0;else{if(!mr.split(",").includes(this.worldview))continue;Li.properties.$localized=!0,Li.properties.worldview=this.worldview}!or&&Li.properties&&Li.properties.hasOwnProperty(o.fp)&&(or=!0),pr.push({feature:Li,id:$n,index:sr,sourceLayerIndex:Pr}),sr++}or&&!it.elevationFeatures&&W.layers.hasOwnProperty(o.fq)&&(it.elevationFeatures=o.fr.parseFrom(W.layers[o.fq],this.canonical));for(const ni of on[Rn]){const sr=ni[0];if(this.extraShadowCaster&&(!sr.is3D()||sr.type==="model")||this.isSymbolTile!==void 0&&sr.type==="symbol"!==this.isSymbolTile||sr.minzoom&&this.zoom<Math.floor(sr.minzoom)||sr.maxzoom&&this.zoom>=sr.maxzoom||sr.visibility==="none")continue;je(ni,this.zoom,it.brightness,de,this.worldview);const Li=Ge[sr.id]=sr.createBucket({index:Oe.bucketLayerIDs.length,layers:ni,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce,worldview:this.worldview,localizable:Lr});Oe.bucketLayerIDs.push(ni.map(mr=>o.B(mr.id,mr.scope)));let $n=Li.prepare?Li.prepare():null;$n!=null?($n=$n.then(()=>Li.populate(pr,it,this.tileID.canonical,this.tileTransform)),Bt.push($n)):Li.populate(pr,it,this.tileID.canonical,this.tileTransform)}}const Ot=()=>{let Rn,Pn,In,Qn,ur,Pr;gt.trim();const pr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Lr=()=>{if(Rn)return this.status="done",De(Rn);if(this.extraShadowCaster)this.status="done",De(null,{buckets:Object.values(Ge).filter(ni=>!ni.isEmpty()),featureIndex:Oe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:it.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Pn&&In&&Qn){const ni=new ie(Pn),sr=new Map;for(const[mr,mo]of In.entries()){const{imagePosition:To}=o.fu(mr,mo,o.fv);sr.set(mr,To)}const Li={};for(const mr in Ge){const mo=Ge[mr];mo instanceof o.b4&&(je(mo.layers,this.zoom,it.brightness,de,this.worldview),Li[mr]=o.fw(mo,Pn,ni.positions,In,sr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ur,this.worldview))}const $n={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,In,ur,()=>{$n.iconsPending=!1,or(Li,ni,$n)}),this.rasterizeIfNeeded(Ee,Qn,Pr,()=>{$n.patternsPending=!1,or(Li,ni,$n)})}},or=(ni,sr,Li,$n)=>{if(Li.iconsPending||Li.patternsPending)return;const mr=new o.fx(In,Qn,this.lut);for(const mo in Ge){const To=Ge[mo];if(mo in ni)o.fy(To,ni[mo],this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,In,mr);else if(To.hasPattern&&(To instanceof o.ba||To instanceof o.bb||To instanceof o.ea)){je(To.layers,this.zoom,it.brightness,de,this.worldview);const Zo=Object.fromEntries(mr.patternPositions);To.addFeatures(it,this.tileID.canonical,Zo,de,this.tileTransform,this.brightness)}}this.status="done",De(null,{buckets:Object.values(Ge).filter(mo=>!mo.isEmpty()),featureIndex:Oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sr.image,lineAtlas:gt,imageAtlas:mr,brightness:it.brightness})};if(!this.extraShadowCaster){const ni=o.fs(it.glyphDependencies,$n=>Object.keys($n).map(Number));Object.keys(ni).length?Ee.send("getGlyphs",{uid:this.uid,stacks:ni},($n,mr)=>{Rn||(Rn=$n,Pn=mr,Lr())},void 0,!1,pr):Pn={};const sr=Array.from(it.iconDependencies.keys()).map($n=>o.I.parse($n));sr.length?Ee.send("getImages",{images:sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},($n,mr)=>{Rn||(Rn=$n,In=new Map,ur=this.updateImageMapAndGetImageTaskQueue(In,mr,it.iconDependencies),Lr())},void 0,!1,pr):(In=new Map,ur=new Map);const Li=Array.from(it.patternDependencies.keys()).map($n=>o.I.parse($n));Li.length?Ee.send("getImages",{images:Li,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},($n,mr)=>{Rn||(Rn=$n,Qn=new Map,Pr=this.updateImageMapAndGetImageTaskQueue(Qn,mr,it.patternDependencies),Lr())},void 0,!1,pr):(Qn=new Map,Pr=new Map)}if(it.elevationFeatures&&it.elevationFeatures.length>0){const ni=[];for(const Li of Object.values(Ge))if(Li instanceof o.bb){const $n=Li.getUnevaluatedPortalGraph();$n&&ni.push($n)}const sr=o.ft.evaluate(ni);for(const Li of Object.values(Ge))if(Li instanceof o.bb){const $n=W.layers[We.decode(Li.sourceLayerIndex)];Li.setEvaluatedPortalGraph(sr,$n,this.tileID.canonical,it.availableImages,it.brightness)}}Lr()};Bt.length>0?Promise.allSettled(Bt).then(Ot).catch(De):Ot()}updateParameters(W){this.scaleFactor=W.scaleFactor,this.showCollisionBoxes=W.showCollisionBoxes,this.projection=W.projection,this.brightness=W.brightness,this.tileTransform=o.aZ(W.tileID.canonical,W.projection),this.extraShadowCaster=W.extraShadowCaster,this.lut=W.lut,this.worldview=W.worldview,this.indoor=W.indoor}rasterizeIfNeeded(W,Q,de,Ce){Array.from(Q.values()).some(Ee=>Ee.usvg)?this.rasterize(W,Q,de,Ce):Ce()}updateImageMapAndGetImageTaskQueue(W,Q,de){const Ce=new Map;for(const Ee of Q.keys()){const De=de.get(Ee)||[];for(const We of De){const Oe=We.toString(),Ge=Q.get(We.id.toString());Ge.usvg?Ce.has(Oe)||(Ce.set(Oe,We),W.set(Oe,Object.assign({},Ge))):W.set(Oe,Ge)}}return Ce}rasterize(W,Q,de,Ce){this.rasterizeTask=W.send("rasterizeImages",{scope:this.scope,tasks:de},(Ee,De)=>{if(!Ee)for(const[We,Oe]of De.entries()){const Ge=Object.assign(Q.get(We),{data:Oe});Q.set(We,Ge)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function je(Be,W,Q,de,Ce){const Ee=new o.ac(W,{brightness:Q,worldview:Ce});for(const De of Be)De.recalculate(Ee,de)}class Te extends o.E{constructor(W,Q,de,Ce,Ee,De,We){super(),this.actor=W,this.layerIndex=Q,this.availableImages=de,this.availableModels=Ce,this.loadVectorData=De||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(W.scheduler),this.isSpriteLoaded=Ee,this.scheduler=W.scheduler,this.brightness=We}loadTile(W,Q){const de=W.uid,Ce=W&&W.request,Ee=Ce&&Ce.collectResourceTiming,De=this.loading[de]=new Ne(W);De.abort=this.loadVectorData(W,(We,Oe)=>{const Ge=!this.loading[de];if(delete this.loading[de],De.cancelRasterize(),Ge||We||!Oe)return De.status="done",Ge||(this.loaded[de]=De),Q(We);const gt=Oe.rawData,it={},Bt=o.aM(Oe.responseHeaders);Bt&&Bt.expires&&(it.expires=Bt.expires),Bt&&Bt.cacheControl&&(it.cacheControl=Bt.cacheControl),De.vectorTile=Oe.vectorTile||new o.fz(new o.bt(gt));const on=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ot,Rn)=>{if(Ot||!Rn)return Q(Ot);const Pn={};if(Ee){const In=N(Ce);In.length>0&&(Pn.resourceTiming=JSON.parse(JSON.stringify(In)))}Q(null,Object.assign({rawTileData:gt.slice(0),responseHeaders:Oe.responseHeaders},Rn,it,Pn))})};this.isSpriteLoaded?on():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(on,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):on()}),this.loaded=this.loaded||{},this.loaded[de]=De})}reloadTile(W,Q){const de=this.loaded,Ce=W.uid;if(de&&de[Ce]){const Ee=de[Ce];Ee.updateParameters(W);const De=(We,Oe)=>{const Ge=Ee.reloadCallback;Ge&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ge)),Q(We,Oe)};Ee.status==="parsing"?Ee.reloadCallback=De:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,De):De())}else Q(null,void 0)}abortTile(W,Q){const de=W.uid,Ce=this.loading[de];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[de]),Q()}removeTile(W,Q){const de=this.loaded,Ce=W.uid;de&&de[Ce]&&delete de[Ce],Q()}}class Ve{loadTile(W,Q){const{uid:de,encoding:Ce,rawImageData:Ee,padding:De}=W,We=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,De):Ee;Q(null,new o.fA(de,We,Ce,De<1))}reloadTile(W,Q){Q(null,null)}abortTile(W,Q){Q()}removeTile(W,Q){Q()}getImageData(W,Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const de=this.offscreenCanvasContext.getImageData(-Q,-Q,W.width+2*Q,W.height+2*Q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}o.bs.setPbf(o.bt);class nt{constructor(W){this._mrt=new o.bs(W.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=W.uid,this.tileID=W.tileID,this.source=W.source}parse(W,Q){const de=this._mrt;this.status="parsing",this._entireBuffer=W;try{de.parseHeader(W),this._isHeaderLoaded=!0;const Ce=[];for(const Ee in de.layers){const De=de.getLayer(Ee),We=De.getDataRange(De.getBandList()),Oe=de.createDecodingTask(We),Ge=W.slice(We.firstByte,We.lastByte+1),gt=o.bs.performDecoding(Ge,Oe).then(it=>Oe.complete(null,it)).catch(it=>Oe.complete(it,null));Ce.push(gt)}Promise.allSettled(Ce).then(()=>Q(null,de)).catch(Ee=>Q(Ee))}catch(Ce){Q(Ce)}}}class At{constructor(W){this.actor=W,this.loading={},this.loaded={}}loadTile(W,Q){const de=W.uid,Ce=W.request,Ee=this.loading[de]=new nt(W),{cancel:De}=o.bu(Ce,(We,Oe,Ge)=>{const gt=!this.loading[de];if(delete this.loading[de],gt||We||!Oe)return Ee.status="done",gt||(this.loaded[de]=Ee),Q(We);Ee.parse(Oe,(it,Bt)=>{if(it||!Bt)return Q(it);Q(null,Bt,Ge)}),this.loaded[de]=Ee});Ee.abort=De}reloadTile(W,Q){Q(null,void 0)}abortTile(W,Q){const de=W.uid,Ce=this.loading[de];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[de]),Q()}removeTile(W,Q){const de=W.uid;this.loaded[de]&&delete this.loaded[de],Q()}decodeRasterArray(W,Q){o.bs.performDecoding(W.buffer,W.task).then(de=>Q(null,de)).catch(de=>Q(de))}}const cn=o.fB.prototype.toGeoJSON;class qt{constructor(W){this._feature=W,this.extent=o.al,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const Q of this._feature.geometry)W.push([new o.P(Q[0],Q[1])]);return W}{const W=[];for(const Q of this._feature.geometry){const de=[];for(const Ce of Q)de.push(new o.P(Ce[0],Ce[1]));W.push(de)}return W}}toGeoJSON(W,Q,de){return cn.call(this,W,Q,de)}}class Ht{constructor(W,Q){this.name=W,this.extent=o.al,this.length=Q.length,this._jsonFeatures=Q}feature(W){return new qt(this._jsonFeatures[W])}}class st{constructor(W){this.layers={},this.extent=o.al;for(const Q of Object.keys(W))this.layers[Q]=new Ht(Q,W[Q])}}const Tt=64/4096,xt=128;class kt{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],Q){for(const de of W){const Ce=de.id;if(Ce==null)continue;let Ee=this.features.get(Ce);Ee&&this.updateCache(Ee,Q),de.geometry?(Ee=He(de),this.updateCache(Ee,Q),this.features.set(Ce,Ee)):this.features.delete(Ce),this.updateCache(Ee,Q)}}updateCache(W,Q){for(const{canonical:de,uid:Ce}of Object.values(Q)){const{z:Ee,x:De,y:We}=de;ze(W,Math.pow(2,Ee),De,We)&&delete Q[Ce]}}getTile(W,Q,de){const Ce=Math.pow(2,W),Ee=[];for(const De of this.features.values())ze(De,Ce,Q,de)&&Ee.push(Kt(De,Ce,Q,de));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function ze({minX:Be,minY:W,maxX:Q,maxY:de},Ce,Ee,De){return Be<(Ee+1+Tt)/Ce&&W<(De+1+Tt)/Ce&&Q>(Ee-Tt)/Ce&&de>(De-Tt)/Ce}function He(Be){const{id:W,geometry:Q,properties:de}=Be;if(!Q)return;if(Q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:Ee}=Q,De={id:W,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},We=De.geometry;if(Ce==="Point")mt(Ee,We,De);else if(Ce==="MultiPoint")for(const Oe of Ee)mt(Oe,We,De);else if(Ce==="LineString")De.type=2,$t(Ee,We,De);else if(Ce==="MultiLineString")De.type=2,Gt(Ee,We,De);else if(Ce==="Polygon")De.type=3,Gt(Ee,We,De,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Oe of Ee)Gt(Oe,We,De,!0)}return De}function mt([Be,W],Q,de){const Ce=o.aF(Be);let Ee=o.aJ(W);Ee=Ee<0?0:Ee>1?1:Ee,Q.push(Ce,Ee),de.minX=Math.min(de.minX,Ce),de.minY=Math.min(de.minY,Ee),de.maxX=Math.max(de.maxX,Ce),de.maxY=Math.max(de.maxY,Ee)}function $t(Be,W,Q,de=!1,Ce=!1){const Ee=[];for(const De of Be)mt(De,Ee,Q);W.push(Ee),de&&function(De,We){let Oe=0;for(let Ge=0,gt=De.length,it=gt-2;Ge<gt;it=Ge,Ge+=2)Oe+=(De[Ge]-De[it])*(De[Ge+1]+De[it+1]);if(Oe>0===We)for(let Ge=0,gt=De.length;Ge<gt/2;Ge+=2){const it=De[Ge],Bt=De[Ge+1];De[Ge]=De[gt-2-Ge],De[Ge+1]=De[gt-1-Ge],De[gt-2-Ge]=it,De[gt-1-Ge]=Bt}}(Ee,Ce)}function Gt(Be,W,Q,de=!1){for(let Ce=0;Ce<Be.length;Ce++)$t(Be[Ce],W,Q,de,Ce===0)}function Kt(Be,W,Q,de){const{id:Ce,type:Ee,geometry:De,tags:We}=Be,Oe=[];if(Ee===1)(function(Ge,gt,it,Bt,on){for(let Ot=0;Ot<Ge.length;Ot+=2){const Rn=Math.round(o.al*(Ge[Ot+0]*gt-it)),Pn=Math.round(o.al*(Ge[Ot+1]*gt-Bt));on.push([Rn,Pn])}})(De,W,Q,de,Oe);else if(Ee===2)for(const Ge of De)mn(Ge,W,Q,de,Oe);else if(Ee===3)for(const Ge of De)Yn(Ge,W,Q,de,Oe);return{id:Ce,type:Ee,geometry:Oe,tags:We}}function mn(Be,W,Q,de,Ce){const Ee=-xt,De=o.al+xt;let We;for(let Oe=0;Oe<Be.length-2;Oe+=2){let Ge=Math.round(o.al*(Be[Oe+0]*W-Q)),gt=Math.round(o.al*(Be[Oe+1]*W-de)),it=Math.round(o.al*(Be[Oe+2]*W-Q)),Bt=Math.round(o.al*(Be[Oe+3]*W-de));const on=it-Ge,Ot=Bt-gt;Ge<Ee&&it<Ee||(Ge<Ee?(gt+=Math.round(Ot*((Ee-Ge)/on)),Ge=Ee):it<Ee&&(Bt=gt+Math.round(Ot*((Ee-Ge)/on)),it=Ee),gt<Ee&&Bt<Ee||(gt<Ee?(Ge+=Math.round(on*((Ee-gt)/Ot)),gt=Ee):Bt<Ee&&(it=Ge+Math.round(on*((Ee-gt)/Ot)),Bt=Ee),Ge>=De&&it>=De||(Ge>=De?(gt+=Math.round(Ot*((De-Ge)/on)),Ge=De):it>=De&&(Bt=gt+Math.round(Ot*((De-Ge)/on)),it=De),gt>=De&&Bt>=De||(gt>=De?(Ge+=Math.round(on*((De-gt)/Ot)),gt=De):Bt>=De&&(it=Ge+Math.round(on*((De-gt)/Ot)),Bt=De),We&&Ge===We[We.length-1][0]&&gt===We[We.length-1][1]||(We=[[Ge,gt]],Ce.push(We)),We.push([it,Bt])))))}}function Yn(Be,W,Q,de,Ce){const Ee=(Q-Tt)/W,De=(de-Tt)/W,We=(Q+1+Tt)/W,Oe=(de+1+Tt)/W;function Ge(Bt,on){let Ot=0;return Bt<Ee?Ot|=1:Bt>We&&(Ot|=2),on<De?Ot|=4:on>Oe&&(Ot|=8),Ot}let gt=[];for(let Bt=1;Bt<=8;Bt*=2){let on=Be[Be.length-2],Ot=Be[Be.length-1],Rn=!(Ge(on,Ot)&Bt);for(let Pn=0;Pn<Be.length;Pn+=2){const In=Be[Pn],Qn=Be[Pn+1],ur=!(Ge(In,Qn)&Bt);ur!==Rn&&(8&Bt?gt.push(on+(In-on)*(Oe-Ot)/(Qn-Ot),Oe):4&Bt?gt.push(on+(In-on)*(De-Ot)/(Qn-Ot),De):2&Bt?gt.push(We,Ot+(Qn-Ot)*(We-on)/(In-on)):1&Bt&&gt.push(Ee,Ot+(Qn-Ot)*(Ee-on)/(In-on))),ur&&gt.push(In,Qn),on=In,Ot=Qn,Rn=ur}if(!(Be=gt).length||Bt===8)break;gt=[]}const it=[];for(let Bt=0;Bt<gt.length;Bt+=2)it.push([Math.round(o.al*(gt[Bt]*W-Q)),Math.round(o.al*(gt[Bt+1]*W-de))]);Ce.push(it)}function hi({name:Be,features:W},Q){Q.writeStringField(1,Be),Q.writeVarintField(5,o.al);const de=new Map,Ce=new Map,Ee={keys:de,values:Ce,feature:null};for(const De of W)Ee.feature=De,Q.writeMessage(2,nn,Ee);for(const De of de.keys())Q.writeStringField(3,De);for(const De of Ce.keys())Q.writeMessage(4,Kn,De)}function nn(Be,W){const Q=Be.feature;Q.id!==void 0&&Number.isSafeInteger(+Q.id)&&W.writeVarintField(1,+Q.id),Q.tags&&W.writeMessage(2,Zn,Be),W.writeVarintField(3,Q.type),W.writeMessage(4,An,Q)}function Zn({keys:Be,values:W,feature:Q},de){for(const Ce of Object.keys(Q.tags)){let Ee=Q.tags[Ce];if(Ee===null)continue;let De=Be.get(Ce);De===void 0&&(De=Be.size,Be.set(Ce,De)),de.writeVarint(De);const We=typeof Ee;We!=="string"&&We!=="boolean"&&We!=="number"&&(Ee=JSON.stringify(Ee));let Oe=W.get(Ee);Oe===void 0&&(Oe=W.size,W.set(Ee,Oe)),de.writeVarint(Oe)}}function _n(Be,W){return(W<<3)+(7&Be)}function En(Be){return Be<<1^Be>>31}function An(Be,W){const{geometry:Q,type:de}=Be;let Ce=0,Ee=0;if(de===1){W.writeVarint(_n(1,Q.length));for(const De of Q){const We=De[0]-Ce,Oe=De[1]-Ee;W.writeVarint(En(We)),W.writeVarint(En(Oe)),Ce+=We,Ee+=Oe}}else for(const De of Q){W.writeVarint(_n(1,1));const We=De.length-(de===3?1:0);for(let Oe=0;Oe<We;Oe++){Oe===1&&W.writeVarint(_n(2,We-1));const Ge=De[Oe][0]-Ce,gt=De[Oe][1]-Ee;W.writeVarint(En(Ge)),W.writeVarint(En(gt)),Ce+=Ge,Ee+=gt}de===3&&W.writeVarint(_n(7,1))}}function Kn(Be,W){const Q=typeof Be;Q==="string"?W.writeStringField(1,Be):Q==="boolean"?W.writeBooleanField(7,Be):Q==="number"&&(Be%1!=0?W.writeDoubleField(3,Be):Be<0?W.writeSVarintField(6,Be):W.writeVarintField(5,Be))}const li={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},Ar=Math.fround||(Qr=new Float32Array(1),Be=>(Qr[0]=+Be,Qr[0]));var Qr;const xr=3,Sr=5,Di=6;class uo{constructor(W){this.options=Object.assign(Object.create(li),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Q,minZoom:de,maxZoom:Ce}=this.options;Q&&console.time("total time");const Ee=`prepare ${W.length} points`;Q&&console.time(Ee),this.points=W;const De=[];for(let Oe=0;Oe<W.length;Oe++){const Ge=W[Oe];if(!Ge.geometry)continue;const[gt,it]=Ge.geometry.coordinates,Bt=Ar(ps(gt)),on=Ar(ho(it));De.push(Bt,on,1/0,Oe,-1,1),this.options.reduce&&De.push(0)}let We=this.trees[Ce+1]=this._createTree(De);Q&&console.timeEnd(Ee);for(let Oe=Ce;Oe>=de;Oe--){const Ge=+Date.now();We=this.trees[Oe]=this._createTree(this._cluster(We,Oe)),Q&&console.log("z%d: %d clusters in %dms",Oe,We.numItems,+Date.now()-Ge)}return Q&&console.timeEnd("total time"),this}getClusters(W,Q){let de=((W[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,W[1]));let Ee=W[2]===180?180:((W[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)de=-180,Ee=180;else if(de>Ee){const it=this.getClusters([de,Ce,180,De],Q),Bt=this.getClusters([-180,Ce,Ee,De],Q);return it.concat(Bt)}const We=this.trees[this._limitZoom(Q)],Oe=We.range(ps(de),ho(De),ps(Ee),ho(Ce)),Ge=We.data,gt=[];for(const it of Oe){const Bt=this.stride*it;gt.push(Ge[Bt+Sr]>1?Rs(Ge,Bt,this.clusterProps):this.points[Ge[Bt+xr]])}return gt}getChildren(W){const Q=this._getOriginId(W),de=this._getOriginZoom(W),Ce="No cluster with the specified id.",Ee=this.trees[de];if(!Ee)throw new Error(Ce);const De=Ee.data;if(Q*this.stride>=De.length)throw new Error(Ce);const We=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Oe=Ee.within(De[Q*this.stride],De[Q*this.stride+1],We),Ge=[];for(const gt of Oe){const it=gt*this.stride;De[it+4]===W&&Ge.push(De[it+Sr]>1?Rs(De,it,this.clusterProps):this.points[De[it+xr]])}if(Ge.length===0)throw new Error(Ce);return Ge}getLeaves(W,Q,de){const Ce=[];return this._appendLeaves(Ce,W,Q=Q||10,de=de||0,0),Ce}getTile(W,Q,de){const Ce=this.trees[this._limitZoom(W)],Ee=Math.pow(2,W),{extent:De,radius:We}=this.options,Oe=We/De,Ge=(de-Oe)/Ee,gt=(de+1+Oe)/Ee,it={features:[]};return this._addTileFeatures(Ce.range((Q-Oe)/Ee,Ge,(Q+1+Oe)/Ee,gt),Ce.data,Q,de,Ee,it),Q===0&&this._addTileFeatures(Ce.range(1-Oe/Ee,Ge,1,gt),Ce.data,Ee,de,Ee,it),Q===Ee-1&&this._addTileFeatures(Ce.range(0,Ge,Oe/Ee,gt),Ce.data,-1,de,Ee,it),it.features.length?it:null}getClusterExpansionZoom(W){let Q=this._getOriginZoom(W)-1;for(;Q<=this.options.maxZoom;){const de=this.getChildren(W);if(Q++,de.length!==1)break;W=de[0].properties.cluster_id}return Q}_appendLeaves(W,Q,de,Ce,Ee){const De=this.getChildren(Q);for(const We of De){const Oe=We.properties;if(Oe&&Oe.cluster?Ee+Oe.point_count<=Ce?Ee+=Oe.point_count:Ee=this._appendLeaves(W,Oe.cluster_id,de,Ce,Ee):Ee<Ce?Ee++:W.push(We),W.length===de)break}return Ee}_createTree(W){const Q=new o.c4(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<W.length;de+=this.stride)Q.add(W[de],W[de+1]);return Q.finish(),Q.data=W,Q}_addTileFeatures(W,Q,de,Ce,Ee,De){for(const We of W){const Oe=We*this.stride,Ge=Q[Oe+Sr]>1;let gt,it,Bt;if(Ge)gt=qo(Q,Oe,this.clusterProps),it=Q[Oe],Bt=Q[Oe+1];else{const Rn=this.points[Q[Oe+xr]];gt=Rn.properties;const[Pn,In]=Rn.geometry.coordinates;it=ps(Pn),Bt=ho(In)}const on={type:1,geometry:[[Math.round(this.options.extent*(it*Ee-de)),Math.round(this.options.extent*(Bt*Ee-Ce))]],tags:gt};let Ot;Ot=Ge||this.options.generateId?Q[Oe+xr]:this.points[Q[Oe+xr]].id,Ot!==void 0&&(on.id=Ot),De.features.push(on)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Q){const{radius:de,extent:Ce,reduce:Ee,minPoints:De}=this.options,We=de/(Ce*Math.pow(2,Q)),Oe=W.data,Ge=[],gt=this.stride;for(let it=0;it<Oe.length;it+=gt){if(Oe[it+2]<=Q)continue;Oe[it+2]=Q;const Bt=Oe[it],on=Oe[it+1],Ot=W.within(Oe[it],Oe[it+1],We),Rn=Oe[it+Sr];let Pn=Rn;for(const In of Ot){const Qn=In*gt;Oe[Qn+2]>Q&&(Pn+=Oe[Qn+Sr])}if(Pn>Rn&&Pn>=De){let In,Qn=Bt*Rn,ur=on*Rn,Pr=-1;const pr=(it/gt<<5)+(Q+1)+this.points.length;for(const Lr of Ot){const or=Lr*gt;if(Oe[or+2]<=Q)continue;Oe[or+2]=Q;const ni=Oe[or+Sr];Qn+=Oe[or]*ni,ur+=Oe[or+1]*ni,Oe[or+4]=pr,Ee&&(In||(In=this._map(Oe,it,!0),Pr=this.clusterProps.length,this.clusterProps.push(In)),Ee(In,this._map(Oe,or)))}Oe[it+4]=pr,Ge.push(Qn/Pn,ur/Pn,1/0,pr,-1,Pn),Ee&&Ge.push(Pr)}else{for(let In=0;In<gt;In++)Ge.push(Oe[it+In]);if(Pn>1)for(const In of Ot){const Qn=In*gt;if(!(Oe[Qn+2]<=Q)){Oe[Qn+2]=Q;for(let ur=0;ur<gt;ur++)Ge.push(Oe[Qn+ur])}}}}return Ge}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Q,de){if(W[Q+Sr]>1){const De=this.clusterProps[W[Q+Di]];return de?Object.assign({},De):De}const Ce=this.points[W[Q+xr]].properties,Ee=this.options.map(Ce);return de&&Ee===Ce?Object.assign({},Ee):Ee}}function Rs(Be,W,Q){return{type:"Feature",id:Be[W+xr],properties:qo(Be,W,Q),geometry:{type:"Point",coordinates:[(de=Be[W],360*(de-.5)),oo(Be[W+1])]}};var de}function qo(Be,W,Q){const de=Be[W+Sr],Ce=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ee=Be[W+Di],De=Ee===-1?{}:Object.assign({},Q[Ee]);return Object.assign(De,{cluster:!0,cluster_id:Be[W+xr],point_count:de,point_count_abbreviated:Ce})}function ps(Be){return Be/360+.5}function ho(Be){const W=Math.sin(Be*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function oo(Be){const W=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Js(Be,W,Q,de){let Ce=de;const Ee=W+(Q-W>>1);let De,We=Q-W;const Oe=Be[W],Ge=Be[W+1],gt=Be[Q],it=Be[Q+1];for(let Bt=W+3;Bt<Q;Bt+=3){const on=fo(Be[Bt],Be[Bt+1],Oe,Ge,gt,it);if(on>Ce)De=Bt,Ce=on;else if(on===Ce){const Ot=Math.abs(Bt-Ee);Ot<We&&(De=Bt,We=Ot)}}Ce>de&&(De-W>3&&Js(Be,W,De,de),Be[De+2]=Ce,Q-De>3&&Js(Be,De,Q,de))}function fo(Be,W,Q,de,Ce,Ee){let De=Ce-Q,We=Ee-de;if(De!==0||We!==0){const Oe=((Be-Q)*De+(W-de)*We)/(De*De+We*We);Oe>1?(Q=Ce,de=Ee):Oe>0&&(Q+=De*Oe,de+=We*Oe)}return De=Be-Q,We=W-de,De*De+We*We}function vo(Be,W,Q,de){const Ce={id:Be??null,type:W,geometry:Q,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")ea(Ce,Q);else if(W==="Polygon")ea(Ce,Q[0]);else if(W==="MultiLineString")for(const Ee of Q)ea(Ce,Ee);else if(W==="MultiPolygon")for(const Ee of Q)ea(Ce,Ee[0]);return Ce}function ea(Be,W){for(let Q=0;Q<W.length;Q+=3)Be.minX=Math.min(Be.minX,W[Q]),Be.minY=Math.min(Be.minY,W[Q+1]),Be.maxX=Math.max(Be.maxX,W[Q]),Be.maxY=Math.max(Be.maxY,W[Q+1])}function xo(Be,W,Q,de){if(!W.geometry)return;const Ce=W.geometry.coordinates;if(Ce&&Ce.length===0)return;const Ee=W.geometry.type,De=Math.pow(Q.tolerance/((1<<Q.maxZoom)*Q.extent),2);let We=[],Oe=W.id;if(Q.promoteId?Oe=W.properties[Q.promoteId]:Q.generateId&&(Oe=de||0),Ee==="Point")Ds(Ce,We);else if(Ee==="MultiPoint")for(const Ge of Ce)Ds(Ge,We);else if(Ee==="LineString")Ya(Ce,We,De,!1);else if(Ee==="MultiLineString"){if(Q.lineMetrics){for(const Ge of Ce)We=[],Ya(Ge,We,De,!1),Be.push(vo(Oe,"LineString",We,W.properties));return}ba(Ce,We,De,!1)}else if(Ee==="Polygon")ba(Ce,We,De,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ge of W.geometry.geometries)xo(Be,{id:Oe,geometry:Ge,properties:W.properties},Q,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ge of Ce){const gt=[];ba(Ge,gt,De,!0),We.push(gt)}}Be.push(vo(Oe,Ee,We,W.properties))}function Ds(Be,W){W.push(Ta(Be[0]),Er(Be[1]),0)}function Ya(Be,W,Q,de){let Ce,Ee,De=0;for(let Oe=0;Oe<Be.length;Oe++){const Ge=Ta(Be[Oe][0]),gt=Er(Be[Oe][1]);W.push(Ge,gt,0),Oe>0&&(De+=de?(Ce*gt-Ge*Ee)/2:Math.sqrt(Math.pow(Ge-Ce,2)+Math.pow(gt-Ee,2))),Ce=Ge,Ee=gt}const We=W.length-3;W[2]=1,Js(W,0,We,Q),W[We+2]=1,W.size=Math.abs(De),W.start=0,W.end=W.size}function ba(Be,W,Q,de){for(let Ce=0;Ce<Be.length;Ce++){const Ee=[];Ya(Be[Ce],Ee,Q,de),W.push(Ee)}}function Ta(Be){return Be/360+.5}function Er(Be){const W=Math.sin(Be*Math.PI/180),Q=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Q<0?0:Q>1?1:Q}function wo(Be,W,Q,de,Ce,Ee,De,We){if(de/=W,Ee>=(Q/=W)&&De<de)return Be;if(De<Q||Ee>=de)return null;const Oe=[];for(const Ge of Be){const gt=Ge.geometry;let it=Ge.type;const Bt=Ce===0?Ge.minX:Ge.minY,on=Ce===0?Ge.maxX:Ge.maxY;if(Bt>=Q&&on<de){Oe.push(Ge);continue}if(on<Q||Bt>=de)continue;let Ot=[];if(it==="Point"||it==="MultiPoint")Ls(gt,Ot,Q,de,Ce);else if(it==="LineString")Sa(gt,Ot,Q,de,Ce,!1,We.lineMetrics);else if(it==="MultiLineString")zs(gt,Ot,Q,de,Ce,!1);else if(it==="Polygon")zs(gt,Ot,Q,de,Ce,!0);else if(it==="MultiPolygon")for(const Rn of gt){const Pn=[];zs(Rn,Pn,Q,de,Ce,!0),Pn.length&&Ot.push(Pn)}if(Ot.length){if(We.lineMetrics&&it==="LineString"){for(const Rn of Ot)Oe.push(vo(Ge.id,it,Rn,Ge.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(Ot.length===1?(it="LineString",Ot=Ot[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=Ot.length===3?"Point":"MultiPoint"),Oe.push(vo(Ge.id,it,Ot,Ge.tags))}}return Oe.length?Oe:null}function Ls(Be,W,Q,de,Ce){for(let Ee=0;Ee<Be.length;Ee+=3){const De=Be[Ee+Ce];De>=Q&&De<=de&&rs(W,Be[Ee],Be[Ee+1],Be[Ee+2])}}function Sa(Be,W,Q,de,Ce,Ee,De){let We=ks(Be);const Oe=Ce===0?yc:ta;let Ge,gt,it=Be.start;for(let Pn=0;Pn<Be.length-3;Pn+=3){const In=Be[Pn],Qn=Be[Pn+1],ur=Be[Pn+2],Pr=Be[Pn+3],pr=Be[Pn+4],Lr=Ce===0?In:Qn,or=Ce===0?Pr:pr;let ni=!1;De&&(Ge=Math.sqrt(Math.pow(In-Pr,2)+Math.pow(Qn-pr,2))),Lr<Q?or>Q&&(gt=Oe(We,In,Qn,Pr,pr,Q),De&&(We.start=it+Ge*gt)):Lr>de?or<de&&(gt=Oe(We,In,Qn,Pr,pr,de),De&&(We.start=it+Ge*gt)):rs(We,In,Qn,ur),or<Q&&Lr>=Q&&(gt=Oe(We,In,Qn,Pr,pr,Q),ni=!0),or>de&&Lr<=de&&(gt=Oe(We,In,Qn,Pr,pr,de),ni=!0),!Ee&&ni&&(De&&(We.end=it+Ge*gt),W.push(We),We=ks(Be)),De&&(it+=Ge)}let Bt=Be.length-3;const on=Be[Bt],Ot=Be[Bt+1],Rn=Ce===0?on:Ot;Rn>=Q&&Rn<=de&&rs(We,on,Ot,Be[Bt+2]),Bt=We.length-3,Ee&&Bt>=3&&(We[Bt]!==We[0]||We[Bt+1]!==We[1])&&rs(We,We[0],We[1],We[2]),We.length&&W.push(We)}function ks(Be){const W=[];return W.size=Be.size,W.start=Be.start,W.end=Be.end,W}function zs(Be,W,Q,de,Ce,Ee){for(const De of Be)Sa(De,W,Q,de,Ce,Ee,!1)}function rs(Be,W,Q,de){Be.push(W,Q,de)}function yc(Be,W,Q,de,Ce,Ee){const De=(Ee-W)/(de-W);return rs(Be,Ee,Q+(Ce-Q)*De,1),De}function ta(Be,W,Q,de,Ce,Ee){const De=(Ee-Q)/(Ce-Q);return rs(Be,W+(de-W)*De,Ee,1),De}function Ai(Be,W){const Q=[];for(let de=0;de<Be.length;de++){const Ce=Be[de],Ee=Ce.type;let De;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")De=Wr(Ce.geometry,W);else if(Ee==="MultiLineString"||Ee==="Polygon"){De=[];for(const We of Ce.geometry)De.push(Wr(We,W))}else if(Ee==="MultiPolygon"){De=[];for(const We of Ce.geometry){const Oe=[];for(const Ge of We)Oe.push(Wr(Ge,W));De.push(Oe)}}Q.push(vo(Ce.id,Ee,De,Ce.tags))}return Q}function Wr(Be,W){const Q=[];Q.size=Be.size,Be.start!==void 0&&(Q.start=Be.start,Q.end=Be.end);for(let de=0;de<Be.length;de+=3)Q.push(Be[de]+W,Be[de+1],Be[de+2]);return Q}function fi(Be,W){if(Be.transformed)return Be;const Q=1<<Be.z,de=Be.x,Ce=Be.y;for(const Ee of Be.features){const De=Ee.geometry,We=Ee.type;if(Ee.geometry=[],We===1)for(let Oe=0;Oe<De.length;Oe+=2)Ee.geometry.push(Hi(De[Oe],De[Oe+1],W,Q,de,Ce));else for(let Oe=0;Oe<De.length;Oe++){const Ge=[];for(let gt=0;gt<De[Oe].length;gt+=2)Ge.push(Hi(De[Oe][gt],De[Oe][gt+1],W,Q,de,Ce));Ee.geometry.push(Ge)}}return Be.transformed=!0,Be}function Hi(Be,W,Q,de,Ce,Ee){return[Math.round(Q*(Be*de-Ce)),Math.round(Q*(W*de-Ee))]}function Wi(Be,W,Q,de,Ce){const Ee=W===Ce.maxZoom?0:Ce.tolerance/((1<<W)*Ce.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:Q,y:de,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Be)Fo(De,We,Ee,Ce);return De}function Fo(Be,W,Q,de){const Ce=W.geometry,Ee=W.type,De=[];if(Be.minX=Math.min(Be.minX,W.minX),Be.minY=Math.min(Be.minY,W.minY),Be.maxX=Math.max(Be.maxX,W.maxX),Be.maxY=Math.max(Be.maxY,W.maxY),Ee==="Point"||Ee==="MultiPoint")for(let We=0;We<Ce.length;We+=3)De.push(Ce[We],Ce[We+1]),Be.numPoints++,Be.numSimplified++;else if(Ee==="LineString")at(De,Ce,Be,Q,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let We=0;We<Ce.length;We++)at(De,Ce[We],Be,Q,Ee==="Polygon",We===0);else if(Ee==="MultiPolygon")for(let We=0;We<Ce.length;We++){const Oe=Ce[We];for(let Ge=0;Ge<Oe.length;Ge++)at(De,Oe[Ge],Be,Q,!0,Ge===0)}if(De.length){let We=W.tags||null;if(Ee==="LineString"&&de.lineMetrics){We={};for(const Ge in W.tags)We[Ge]=W.tags[Ge];We.mapbox_clip_start=Ce.start/Ce.size,We.mapbox_clip_end=Ce.end/Ce.size}const Oe={geometry:De,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:We};W.id!==null&&(Oe.id=W.id),Be.features.push(Oe)}}function at(Be,W,Q,de,Ce,Ee){const De=de*de;if(de>0&&W.size<(Ce?De:de))return void(Q.numPoints+=W.length/3);const We=[];for(let Oe=0;Oe<W.length;Oe+=3)(de===0||W[Oe+2]>De)&&(Q.numSimplified++,We.push(W[Oe],W[Oe+1])),Q.numPoints++;Ce&&function(Oe,Ge){let gt=0;for(let it=0,Bt=Oe.length,on=Bt-2;it<Bt;on=it,it+=2)gt+=(Oe[it]-Oe[on])*(Oe[it+1]+Oe[on+1]);if(gt>0===Ge)for(let it=0,Bt=Oe.length;it<Bt/2;it+=2){const on=Oe[it],Ot=Oe[it+1];Oe[it]=Oe[Bt-2-it],Oe[it+1]=Oe[Bt-1-it],Oe[Bt-2-it]=on,Oe[Bt-1-it]=Ot}}(We,Ee),Be.push(We)}const bo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class na{constructor(W,Q){const de=(Q=this.options=function(Ee,De){for(const We in De)Ee[We]=De[We];return Ee}(Object.create(bo),Q)).debug;if(de&&console.time("preprocess data"),Q.maxZoom<0||Q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Q.promoteId&&Q.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(Ee,De){const We=[];if(Ee.type==="FeatureCollection")for(let Oe=0;Oe<Ee.features.length;Oe++)xo(We,Ee.features[Oe],De,Oe);else xo(We,Ee.type==="Feature"?Ee:{geometry:Ee},De);return We}(W,Q);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Q.indexMaxZoom,Q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(Ee,De){const We=De.buffer/De.extent;let Oe=Ee;const Ge=wo(Ee,1,-1-We,We,0,-1,2,De),gt=wo(Ee,1,1-We,2+We,0,-1,2,De);return(Ge||gt)&&(Oe=wo(Ee,1,-We,1+We,0,-1,2,De)||[],Ge&&(Oe=Ai(Ge,1).concat(Oe)),gt&&(Oe=Oe.concat(Ai(gt,-1)))),Oe}(Ce,Q),Ce.length&&this.splitTile(Ce,0,0,0),de&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Q,de,Ce,Ee,De,We){const Oe=[W,Q,de,Ce],Ge=this.options,gt=Ge.debug;for(;Oe.length;){Ce=Oe.pop(),de=Oe.pop(),Q=Oe.pop(),W=Oe.pop();const it=1<<Q,Bt=po(Q,de,Ce);let on=this.tiles[Bt];if(!on&&(gt>1&&console.time("creation"),on=this.tiles[Bt]=Wi(W,Q,de,Ce,Ge),this.tileCoords.push({z:Q,x:de,y:Ce}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Q,de,Ce,on.numFeatures,on.numPoints,on.numSimplified),console.timeEnd("creation"));const ni=`z${Q}`;this.stats[ni]=(this.stats[ni]||0)+1,this.total++}if(on.source=W,Ee==null){if(Q===Ge.indexMaxZoom||on.numPoints<=Ge.indexMaxPoints)continue}else{if(Q===Ge.maxZoom||Q===Ee)continue;if(Ee!=null){const ni=Ee-Q;if(de!==De>>ni||Ce!==We>>ni)continue}}if(on.source=null,W.length===0)continue;gt>1&&console.time("clipping");const Ot=.5*Ge.buffer/Ge.extent,Rn=.5-Ot,Pn=.5+Ot,In=1+Ot;let Qn=null,ur=null,Pr=null,pr=null,Lr=wo(W,it,de-Ot,de+Pn,0,on.minX,on.maxX,Ge),or=wo(W,it,de+Rn,de+In,0,on.minX,on.maxX,Ge);W=null,Lr&&(Qn=wo(Lr,it,Ce-Ot,Ce+Pn,1,on.minY,on.maxY,Ge),ur=wo(Lr,it,Ce+Rn,Ce+In,1,on.minY,on.maxY,Ge),Lr=null),or&&(Pr=wo(or,it,Ce-Ot,Ce+Pn,1,on.minY,on.maxY,Ge),pr=wo(or,it,Ce+Rn,Ce+In,1,on.minY,on.maxY,Ge),or=null),gt>1&&console.timeEnd("clipping"),Oe.push(Qn||[],Q+1,2*de,2*Ce),Oe.push(ur||[],Q+1,2*de,2*Ce+1),Oe.push(Pr||[],Q+1,2*de+1,2*Ce),Oe.push(pr||[],Q+1,2*de+1,2*Ce+1)}}getTile(W,Q,de){W=+W,Q=+Q,de=+de;const Ce=this.options,{extent:Ee,debug:De}=Ce;if(W<0||W>24)return null;const We=1<<W,Oe=po(W,Q=Q+We&We-1,de);if(this.tiles[Oe])return fi(this.tiles[Oe],Ee);De>1&&console.log("drilling down to z%d-%d-%d",W,Q,de);let Ge,gt=W,it=Q,Bt=de;for(;!Ge&&gt>0;)gt--,it>>=1,Bt>>=1,Ge=this.tiles[po(gt,it,Bt)];return Ge&&Ge.source?(De>1&&(console.log("found parent tile z%d-%d-%d",gt,it,Bt),console.time("drilling down")),this.splitTile(Ge.source,gt,it,Bt,W,Q,de),De>1&&console.timeEnd("drilling down"),this.tiles[Oe]?fi(this.tiles[Oe],Ee):null):null}}function po(Be,W,Q){return 32*((1<<Be)*Q+W)+Be}function Bn(Be,W){const Q=Be.tileID.canonical;if(!this._geoJSONIndex)return void W(null,null);const de=this._geoJSONIndex.getTile(Q.z,Q.x,Q.y);if(!de)return void W(null,null);const Ce=Ge=>Ge.tags&&"3d_elevation_id"in Ge.tags&&"source"in Ge.tags&&Ge.tags.source==="elevation",Ee=de.features.filter(Ge=>Ce(Ge));let De={_geojsonTileLayer:de.features};Ee.length>0&&(De={_geojsonTileLayer:de.features.filter(Ge=>!Ce(Ge)),hd_road_elevation:Ee});const We=new st(De),Oe=function(Ge){const gt=new o.bt;for(const it of Object.keys(Ge))gt.writeMessage(3,hi,{name:it,features:Ge[it]});return gt.finish()}(De).buffer;W(null,{vectorTile:We,rawData:Oe})}class Ro extends Te{constructor(W,Q,de,Ce,Ee,De,We){super(W,Q,de,Ce,Ee,Bn,We),De&&(this.loadGeoJSON=De),this._dynamicIndex=new kt}loadData(W,Q){const de=W&&W.request,Ce=de&&de.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(W,(Ee,De)=>{if(Ee||!De)return Q(Ee);if(typeof De!="object")return Q(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){const Oe=o.U(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));De.features=De.features.filter(Ge=>Oe.value.evaluate({zoom:0},Ge))}W.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),W.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new uo(function({superclusterOptions:Oe,clusterProperties:Ge}){if(!Ge||!Oe)return Oe;const gt={},it={},Bt={accumulated:null,zoom:0},on={properties:null},Ot=Object.keys(Ge);for(const Rn of Ot){const[Pn,In]=Ge[Rn],Qn=o.U(In),ur=o.U(typeof Pn=="string"?[Pn,["accumulated"],["get",Rn]]:Pn);gt[Rn]=Qn.value,it[Rn]=ur.value}return Oe.map=Rn=>{on.properties=Rn;const Pn={};for(const In of Ot)Pn[In]=gt[In].evaluate(Bt,on);return Pn},Oe.reduce=(Rn,Pn)=>{on.properties=Pn;for(const In of Ot)Bt.accumulated=Rn[In],Rn[In]=it[In].evaluate(Bt,on)},Oe}(W)).load(De.features):W.dynamic?this._dynamicIndex:function(Oe,Ge){return new na(Oe,Ge)}(De,W.geojsonVtOptions)}catch(Oe){return Q(Oe)}const We={};if(Ce){const Oe=N(de);Oe&&(We.resourceTiming={},We.resourceTiming[W.source]=JSON.parse(JSON.stringify(Oe)))}Q(null,We)}})}reloadTile(W,Q){const de=this.loaded;return de&&de[W.uid]?W.partial?Q(null,void 0):super.reloadTile(W,Q):this.loadTile(W,Q)}loadGeoJSON(W,Q){if(W.request)o.m(W.request,Q);else{if(typeof W.data!="string")return Q(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Q(null,JSON.parse(W.data))}catch{return Q(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(W,Q){try{Q(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(de){Q(de)}}getClusterChildren(W,Q){try{Q(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(de){Q(de)}}getClusterLeaves(W,Q){try{Q(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(de){Q(de)}}}class Ym{constructor(W,Q,de){this.tileID=new o.aQ(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=Q,this.worldview=de}parse(W,Q,de,Ce){this.status="parsing";const Ee=new o.aQ(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),De=[],We=Q.familiesBySource[de.source],Oe=new o.fn(Ee,de.promoteId);Oe.bucketLayerIDs=[],Oe.is3DTile=!0,o.fC(W).then(Ge=>{if(!Ge)return Ce(new Error("Could not parse tile"));const gt=Ge.json.extensionsUsed&&Ge.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ge.json.asset.extras&&Ge.json.asset.extras.MAPBOX_mesh_features,it=Ge.json.extensionsUsed&&Ge.json.extensionsUsed.includes("EXT_meshopt_compression"),Bt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const on in We)for(const Ot of We[on]){const Rn=Ot[0];Oe.bucketLayerIDs.push(Ot.map(Qn=>o.B(Qn.id,Qn.scope))),Rn.recalculate(Bt,[]);const Pn=o.fD(Ge,1/o.d7(de.tileID.canonical)),In=new o.fE(Ot,Pn,Ee,gt,it,this.brightness,Oe,this.worldview);gt||(In.needsUpload=!0),De.push(In),In.evaluate(Rn)}this.status="done",Ce(null,{buckets:De,featureIndex:Oe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ge=>Ce(new Error(Ge.message)))}}class vc{constructor(W,Q,de,Ce,Ee,De,We,Oe){this.actor=W,this.layerIndex=Q,this.availableImages=de,this.availableModels=Ce,this.brightness=We,this.loading={},this.loaded={},this.worldview=Oe}loadTile(W,Q){const de=W.uid,Ce=this.loading[de]=new Ym(W,this.brightness,this.worldview);o.bu(W.request,(Ee,De)=>{const We=!this.loading[de];return delete this.loading[de],We||Ee?(Ce.status="done",We||(this.loaded[de]=Ce),Q(Ee)):De&&De.byteLength!==0?void Ce.parse(De,this.layerIndex,W,(Oe,Ge)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[de]=Ce,Oe||!Ge?Q(Oe):Q(null,Ge)}):(Ce.status="done",this.loaded[de]=Ce,Q())})}reloadTile(W,Q){const de=this.loaded,Ce=W.uid;if(de&&de[Ce]){const Ee=de[Ce];Ee.projection=W.projection,Ee.brightness=W.brightness;const De=(We,Oe)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(W,Q)),Q(We,Oe)};Ee.status==="parsing"?Ee.reloadCallback=De:Ee.status==="done"&&this.loadTile(W,Q)}}abortTile(W,Q){const de=W.uid;this.loading[de]&&delete this.loading[de],Q()}removeTile(W,Q){const de=this.loaded,Ce=W.uid;de&&de[Ce]&&delete de[Ce],Q()}}class Cd{constructor(W){this.self=W,this.actor=new o.fG(W,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cm({name:"mercator"}),this.workerSourceTypes={vector:Te,geojson:Ro,"raster-dem":Ve,"raster-array":At,"batched-model":vc},this.workerSources={},this.self.registerWorkerSource=(Q,de)=>{if(this.workerSourceTypes[Q])throw new Error(`Worker source with name "${Q}" already registered.`);this.workerSourceTypes[Q]=de},this.self.registerRTLTextPlugin=Q=>{if(o.fH.isParsed())throw new Error("RTL text plugin already registered.");o.fH.setState({pluginStatus:o.fI.parsed,pluginURL:o.fH.getPluginURL()}),o.fH.applyArabicShaping=Q.applyArabicShaping,o.fH.processBidirectionalText=Q.processBidirectionalText,o.fH.processStyledBidirectionalText=Q.processStyledBidirectionalText;for(const de of this.rtlPluginParsingListeners)de(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(W,Q,de){delete this.layerIndexes[W],delete this.availableImages[W],delete this.availableModels[W],delete this.workerSources[W],de()}checkIfReady(W,Q,de){de()}setReferrer(W,Q){this.referrer=Q}spriteLoaded(W,Q){this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={});const{scope:de,isLoaded:Ce}=Q;if(this.isSpriteLoaded[W][de]=Ce,this.workerSources[W]&&this.workerSources[W][de])for(const Ee in this.workerSources[W][de]){const De=this.workerSources[W][de][Ee];for(const We in De){const Oe=De[We];Oe instanceof Te&&(Oe.isSpriteLoaded=Ce,Oe.fire(new o.z("isSpriteLoaded")))}}}setImages(W,Q,de){this.availableImages[W]||(this.availableImages[W]={});const{scope:Ce,images:Ee}=Q;if(this.availableImages[W][Ce]=Ee,this.workerSources[W]&&this.workerSources[W][Ce]){for(const De in this.workerSources[W][Ce]){const We=this.workerSources[W][Ce][De];for(const Oe in We)We[Oe].availableImages=Ee}de()}else de()}setModels(W,{scope:Q,models:de},Ce){if(this.availableModels[W]||(this.availableModels[W]={}),this.availableModels[W][Q]=de,this.workerSources[W]&&this.workerSources[W][Q]){for(const Ee in this.workerSources[W][Q]){const De=this.workerSources[W][Q][Ee];for(const We in De)De[We].availableModels=de}Ce()}else Ce()}setProjection(W,Q){this.projections[W]=o.cm(Q)}setBrightness(W,Q,de){this.brightness=Q,de()}setWorldview(W,Q,de){this.worldview=Q,de()}setLayers(W,Q,de){this.getLayerIndex(W,Q.scope).replace(Q.layers,Q.options),de()}updateLayers(W,Q,de){this.getLayerIndex(W,Q.scope).update(Q.layers,Q.removedIds,Q.options),de()}loadTile(W,Q,de){Q.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Q.type,Q.source,Q.scope).loadTile(Q,de)}decodeRasterArray(W,Q,de){this.getWorkerSource(W,Q.type,Q.source,Q.scope).decodeRasterArray(Q,de)}reloadTile(W,Q,de){Q.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Q.type,Q.source,Q.scope).reloadTile(Q,de)}abortTile(W,Q,de){this.getWorkerSource(W,Q.type,Q.source,Q.scope).abortTile(Q,de)}removeTile(W,Q,de){this.getWorkerSource(W,Q.type,Q.source,Q.scope).removeTile(Q,de)}removeSource(W,Q,de){if(!(this.workerSources[W]&&this.workerSources[W][Q.scope]&&this.workerSources[W][Q.scope][Q.type]&&this.workerSources[W][Q.scope][Q.type][Q.source]))return;const Ce=this.workerSources[W][Q.scope][Q.type][Q.source];delete this.workerSources[W][Q.scope][Q.type][Q.source],Ce.removeSource!==void 0?Ce.removeSource(Q,de):de()}loadWorkerSource(W,Q,de){try{this.self.importScripts(Q.url),de()}catch(Ce){de(Ce)}}syncRTLPluginState(W,Q,de){if(o.fH.isParsed())de(null,!0);else if(o.fH.isParsing())this.rtlPluginParsingListeners.push(de);else try{o.fH.setState(Q);const Ce=o.fH.getPluginURL();!o.fH.isLoaded()||o.fH.isParsed()||o.fH.isParsing()||Ce==null||(o.fH.setState({pluginStatus:o.fI.parsing,pluginURL:o.fH.getPluginURL()}),this.self.importScripts(Ce),o.fH.isParsed()?de(null,!0):this.rtlPluginParsingListeners.push(de))}catch(Ce){de(Ce)}}setDracoUrl(W,Q){this.dracoUrl=Q}getAvailableImages(W,Q){this.availableImages[W]||(this.availableImages[W]={});let de=this.availableImages[W][Q];return de||(de=[]),de}getAvailableModels(W,Q){this.availableModels[W]||(this.availableModels[W]={});let de=this.availableModels[W][Q];return de||(de={}),de}getLayerIndex(W,Q){this.layerIndexes[W]||(this.layerIndexes[W]={});let de=this.layerIndexes[W][Q];return de||(de=this.layerIndexes[W][Q]=new Y,de.scope=Q),de}getWorkerSource(W,Q,de,Ce){const Ee=this.workerSources;return Ee[W]||(Ee[W]={}),Ee[W][Ce]||(Ee[W][Ce]={}),Ee[W][Ce][Q]||(Ee[W][Ce][Q]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),Ee[W][Ce][Q][de]||(Ee[W][Ce][Q][de]=new this.workerSourceTypes[Q]({send:(De,We,Oe,Ge,gt,it)=>this.actor.send(De,We,Oe,W,gt,it),scheduler:this.actor.scheduler},this.getLayerIndex(W,Ce),this.getAvailableImages(W,Ce),this.getAvailableModels(W,Ce),this.isSpriteLoaded[W][Ce],void 0,this.brightness,this.worldview)),Ee[W][Ce][Q][de]}rasterizeImagesWorker(W,Q,de){const Ce=new Map;for(const[Ee,{image:De,imageVariant:We}]of Q.tasks.entries()){const Oe=this.imageRasterizer.rasterize(We,De,Q.scope,W);Ce.set(Ee,Oe)}de(void 0,Ce)}removeRasterizedImages(W,Q,de){this.imageRasterizer.removeImagesFromCacheByIds(Q.imageIds,Q.scope,W),de()}enforceCacheSizeLimit(W,Q){o.fJ(Q)}getWorkerPerformanceMetrics(W,Q,de){de(void 0,void 0)}}return o.fF(self)&&(self.worker=new Cd(self)),Cd}),S(["./shared"],function(o){var N="3.17.0";const B={create:"create",load:"load",fullLoad:"fullLoad"},q={mark(u){performance.mark(u)},measure(u,t,s){performance.measure(u,t,s)}};function Y(u){const t=u.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var J,ie={},be=function(){if(J)return ie;function u(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,v,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{v=new Worker(E),y=!0}catch{y=!1}return v&&v.terminate(),URL.revokeObjectURL(E),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var v=y.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===y.width}()?(s[m=d&&d.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(y){var v,b=function(E){var A=document.createElement("canvas"),M=Object.create(u.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=E,A.getContext("webgl2",M)}(y);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}J=1,ie.supported=u,ie.notSupportedReason=t;var s={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ie}();function te(u,t,s){const d=document.createElement(u);return t!=null&&(d.className=t),s&&s.appendChild(d),d}function le(u,t,s){const d=document.createElementNS("http://www.w3.org/2000/svg",u);for(const m of Object.keys(t))d.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(d),d}const ce=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=ce&&ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function Me(){ce&&oe&&(ue=ce[oe],ce[oe]="none")}function Ne(){ce&&oe&&(ce[oe]=ue)}function je(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",je,!0)}function Te(){window.addEventListener("click",je,!0),window.setTimeout(()=>{window.removeEventListener("click",je,!0)},0)}function Ve(u,t){const s=u.getBoundingClientRect();return cn(u,s,t)}function nt(u,t){const s=u.getBoundingClientRect(),d=[];for(let m=0;m<t.length;m++)d.push(cn(u,s,t[m]));return d}function At(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function cn(u,t,s){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new o.P((s.clientX-t.left)*d,(s.clientY-t.top)*d)}const qt="01",Ht="NO_ACCESS_TOKEN";class st{constructor(t,s,d){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let d=0;d<10;d++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",qt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!o.h(t))return t;const d=xt(t);return d.params.push(`sdk=js-${N}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!o.h(t))return t;const d=xt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeModelURL(t,s){if(!o.h(t))return t;const d=xt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeSourceURL(t,s,d,m){if(!o.h(t))return t;const y=xt(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),m&&y.params.push(`worldview=${m}`),this._makeAPIURL(y,this._customAccessToken||s)}normalizeIconsetURL(t,s){const d=xt(t);return o.h(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||s)):kt(d)}normalizeSpriteURL(t,s,d,m){const y=xt(t);return o.h(t)?(y.path=`/styles/v1${y.path}/sprite${s}${d}`,this._makeAPIURL(y,this._customAccessToken||m)):(y.path+=`${s}${d}`,kt(y))}normalizeTileURL(t,s,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.h(t))return t;const m=xt(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||d&&m.authority!=="raster"&&d===512?"@2x":""}${o.k.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${o.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${o.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${o.e.TILE_URL_VERSION}${m.path}`);const y=this._customAccessToken||function(v){for(const b of v){const E=b.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(m.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,y)}canonicalizeTileURL(t,s){const d=xt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let m="mapbox://";d.path.match(/^\/raster\/v1\//)?m+=`raster/${d.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${d.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${d.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return s&&(y=y.filter(v=>!v.match(/^access_token=/))),y.length&&(m+=`?${y.join("&")}`),m}canonicalizeTileset(t,s){const d=!!s&&o.h(s),m=[];for(const y of t.tiles||[])o.j(y)?m.push(this.canonicalizeTileURL(y,d)):m.push(y);return m}_makeAPIURL(t,s){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=xt(o.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return kt(t);if(s=s||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),kt(t)}}const Tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xt(u){const t=u.match(Tt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function kt(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const ze="mapbox.eventData";function He(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.l(t[1]))}catch{return null}}class mt{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=He(o.e.ACCESS_TOKEN);let d="";return d=s&&s.u?o.f(s.u):o.e.ACCESS_TOKEN||"",t?`${ze}.${t}:${d}`:`${ze}:${d}`}fetchEventData(){const t=o.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid"),m=this.getStorageKey("uuidTimestamp");if(t)try{const y=localStorage.getItem(s);y&&(this.eventData=JSON.parse(y));const v=localStorage.getItem(d);v&&(this.anonId=v);const b=localStorage.getItem(m);b&&(this.anonIdTimestamp=Number(b));const E=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<E)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=o.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid"),m=this.getStorageKey("uuidTimestamp"),y=this.anonId,v=this.anonIdTimestamp;if(t&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData)),v&&localStorage.setItem(m,v.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,d,m){if(!o.e.EVENTS_URL)return;const y=xt(o.e.EVENTS_URL);y.params.push(`access_token=${m||o.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},b=s?Object.assign(v,s):v,E={url:kt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=o.p(E,A=>{this.pendingRequest=null,d(A),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}class $t extends mt{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!o.e.EVENTS_URL||!t&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const s=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:s},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:d}=this.queue.shift();this.postEvent(s,d,()=>{},t)}}const Gt=new class extends mt{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(s=>o.h(s)||o.j(s))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=He(o.e.ACCESS_TOKEN),s=t?t.u:o.e.ACCESS_TOKEN;let d=s!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),d=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),v=new Date(m),b=(m-this.eventData.lastSuccess)/864e5;d=d||b>=1||b<-1||y.getDate()!==v.getDate()}else d=!0;d?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:qt,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},u):this.processRequests()}},Kt=Gt.postTurnstileEvent.bind(Gt),mn=new class extends mt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,s,d){this.skuToken=t,this.errorCb=d,o.e.EVENTS_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Ht)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:qt,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Yn=mn.postMapLoadEvent.bind(mn),hi=new class extends mt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=o.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:s,style:d,importedStyles:m}=t;if(!o.e.EVENTS_URL||!u&&!o.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(s),v={mapInstanceId:y,eventId:this.getEventId(y),style:d};m.length&&(v.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:v},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},u)}},nn=hi.postStyleLoadEvent.bind(hi),Zn=new $t({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),_n=Zn.postMetricsEvent.bind(Zn),En=new $t({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),An=En.postMetricsEvent.bind(En),Kn=new class extends mt{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){o.e.EVENTS_URL&&(u||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),d=function(m){const y=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),b=function(F){const V={};if(F){for(const U in F)if(U!=="other")for(const X of F[U]){const Z=`${U}ResolveRangeMin`,ne=`${U}ResolveRangeMax`,ae=`${U}RequestCount`,re=`${U}RequestCachedCount`;V[Z]=Math.min(V[Z]||1/0,X.startTime),V[ne]=Math.max(V[ne]||-1/0,X.responseEnd);const we=ge=>{V[ge]===void 0&&(V[ge]=0),++V[ge]};X.transferSize!==void 0&&X.transferSize===0&&we(re),we(ae)}}return V}(function(F,V){const U={};if(F)for(const X of F){const Z=V(X);U[Z]===void 0&&(U[Z]=[]),U[Z].push(X)}return U}(y,Y)),E=window.devicePixelRatio,A=navigator.connection||navigator.mozConnection||navigator.webkitConnection,M=A?A.effectiveType:void 0,O={counters:[],metadata:[],attributes:[]},z=(F,V,U)=>{U!=null&&F.push({name:V,value:U.toString()})};for(const F in b)z(O.counters,F,b[F]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(z(O.counters,"interactionRangeMin",m.interactionRange[0]),z(O.counters,"interactionRangeMax",m.interactionRange[1])),v)for(const F of Object.values(B)){const V=v.find(U=>U.name===F);V&&z(O.counters,F,V.startTime)}return z(O.counters,"visibilityHidden",m.visibilityHidden),z(O.attributes,"style",function(F){if(F)for(const V of F){const U=V.name.split("?")[0];if(o.i(U)){const X=U.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(y)),z(O.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),z(O.attributes,"fogEnabled",m.fogEnabled?"true":"false"),z(O.attributes,"projection",m.projection),z(O.attributes,"zoom",m.zoom),z(O.metadata,"devicePixelRatio",E),z(O.metadata,"connectionEffectiveType",M),z(O.metadata,"navigatorUserAgent",navigator.userAgent),z(O.metadata,"screenWidth",window.screen.width),z(O.metadata,"screenHeight",window.screen.height),z(O.metadata,"windowWidth",window.innerWidth),z(O.metadata,"windowHeight",window.innerHeight),z(O.metadata,"mapWidth",m.width/E),z(O.metadata,"mapHeight",m.height/E),z(O.metadata,"webglRenderer",m.renderer),z(O.metadata,"webglVendor",m.vendor),z(O.metadata,"sdkVersion",N),z(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(s);for(const m of d.metadata);for(const m of d.counters);for(const m of d.attributes);this.postEvent(t,d,()=>{},u)}},li=Kn.postPerformanceEvent.bind(Kn),Ar=new class extends mt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,s,d){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const m=xt(o.e.API_URL+o.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${d||o.e.ACCESS_TOKEN||""}`);const y={url:kt(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(y,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(d)})}getSessionAPI(u,t,s,d){this.skuToken=t,this.errorCb=d,o.e.SESSION_PATH&&o.e.API_URL&&(s||o.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},s):this.errorCb(new Error(Ht)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Qr=Ar.getSessionAPI.bind(Ar),xr=new Set;function Sr(u,t){t?xr.add(u):xr.delete(u)}class Di{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function uo(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Rs extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const d of s.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:d,callback:m}of this.requestors)this._notify(d,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,d){this._validate(t,d)&&this.images.get(s).set(t.toString(),d)}_validate(t,s){let d=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,s){if(!t)return!0;let d=0;for(const m of t){if(m[0]<d||m[1]<m[0]||s<m[1])return!1;d=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,d){const m=this.images.get(s).get(t.toString());d.version=m.version+1,this.images.get(s).set(t.toString(),d),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const d=this.images.get(s),m=d.get(t.toString());d.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(s=>o.I.from(s))}getImages(t,s,d){const m=[],y=[],v=this.imageProviders.get(s);for(const M of t){if(!M.iconsetId){m.push(M);continue}const O=v.get(M.iconsetId);O&&(this.getImage(M,s)?y.push(M):O.addPendingRequest(M))}if(m.length===0)return void this._notify(y,s,d);let b=!0;const E=!!this.loaded.get(s),A=this.images.get(s);if(!E)for(const M of m)A.has(M.toString())||(b=!1);E||b?this._notify(m,s,d):this.requestors.push({ids:m,scope:s,callback:d})}rasterizeImages(t,s){const d=new Map,{tasks:m,scope:y}=t;for(const[v,b]of m.entries()){const E=this.getImage(b.id,y);E&&d.set(v,{image:E,imageVariant:b})}this._rasterizeImages(y,d,s)}_rasterizeImages(t,s,d){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},d);else{const m=new Map;for(const[y,{image:v,imageVariant:b}]of s.entries())m.set(y,this.imageRasterizer.rasterize(b,v,t,0));d(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,d){const m=this.images.get(s),y=new Map;for(const v of t){if(!m.get(v.toString())){if(v.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:v.name}))}const b=m.get(v.toString());if(!b){o.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const E={data:b.usvg?null:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,usvg:b.usvg,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)};b.usvg&&Object.assign(E,{width:b.icon.usvg_tree.width,height:b.icon.usvg_tree.height}),y.set(o.I.toString(v),E)}d(null,y)}getPixelSize(t){const{width:s,height:d}=this.atlasImage.get(t);return{width:s,height:d}}getPattern(t,s,d){const m=t.toString(),y=this.patterns.get(s),v=y.get(m),b=this.getImage(t,s);if(!b)return null;if(v){if(v.position.version===b.version)return v.position;v.position.version=b.version}else{if(b.usvg&&!b.data){const E=this.getPatternInFlightId(m,s);if(this.patternsInFlight.has(E))return null;this.patternsInFlight.add(E);const A=new o.A(t).scaleSelf(o.o.devicePixelRatio),M=new Map([[A.toString(),{image:b,imageVariant:A}]]);return this._rasterizeImages(s,M,(O,z)=>this.storePatternImage(A,s,b,d,z)),null}this.storePattern(t,s,b)}return this._updatePatternAtlas(s,d),y.get(m).position}getPatternInFlightId(t,s){return o.B(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,d,m,y){const v=t.toString(),b=y?y.get(v):void 0;b&&(d.data=b,this.storePattern(t.id,s,d),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,d){const m={w:d.data.width+2*o.C,h:d.data.height+2*o.C,x:0,y:0},y=new o.F(m,d,o.C);this.patterns.get(s).set(t.toString(),{bin:m,position:y})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,s){const d=t.gl;let m=this.atlasTexture.get(s);m?this.dirty&&(m.update(this.atlasImage.get(s)),this.dirty=!1):(m=new o.T(t,this.atlasImage.get(s),d.RGBA8),this.atlasTexture.set(s,m)),m.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const d=this.patterns.get(t),m=Array.from(d.values()).map(({bin:A})=>A),{w:y,h:v}=o.G(m),b=this.atlasImage.get(t);b.resize({width:y||1,height:v||1});const E=this.images.get(t);for(const[A,{bin:M,position:O}]of d.entries()){let z=O.padding;const F=M.x+z,V=M.y+z,U=E.get(A).data,X=U.width,Z=U.height;z=z>1?z-1:z,o.q.copy(U,b,{x:0,y:0},{x:F,y:V},{width:X,height:Z},s),o.q.copy(U,b,{x:0,y:Z-z},{x:F,y:V-z},{width:X,height:z},s),o.q.copy(U,b,{x:0,y:0},{x:F,y:V+Z},{width:X,height:z},s),o.q.copy(U,b,{x:X-z,y:0},{x:F-z,y:V},{width:z,height:Z},s),o.q.copy(U,b,{x:0,y:0},{x:F+X,y:V},{width:z,height:Z},s),o.q.copy(U,b,{x:X-z,y:Z-z},{x:F-z,y:V-z},{width:z,height:z},s),o.q.copy(U,b,{x:0,y:Z-z},{x:F+X,y:V-z},{width:z,height:z},s),o.q.copy(U,b,{x:0,y:0},{x:F+X,y:V+Z},{width:z,height:z},s),o.q.copy(U,b,{x:X-z,y:0},{x:F-z,y:V+Z},{width:z,height:z},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const d=this.images.get(s);for(const m of t){if(this.callbackDispatchedThisFrame.get(s).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(m.toString());const y=d.get(m.toString());uo(y)&&this.updateImage(m,s,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function qo(u){const t=u.value,s=u.valueSpec,d=u.style,m=u.styleSpec,y=u.key,v=u.arrayElementValidator||Ai;if(!Array.isArray(t))return[new o.V(y,t,`array expected, ${o.K(t)} found`)];if(s.length&&t.length!==s.length)return[new o.V(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new o.V(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let b={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(b.function=s.function),o.H(s.value)&&(b=s.value);let E=[];for(let A=0;A<t.length;A++)E=E.concat(v({array:t,arrayIndex:A,value:t[A],valueSpec:b,style:d,styleSpec:m,key:`${y}[${A}]`},!0));return E}function ps(u){const t=u.key,s=u.value,d=u.valueSpec;if(!o.L(s))return[new o.V(t,s,`number expected, ${o.K(s)} found`)];if(s!=s)return[new o.V(t,s,"number expected, NaN found")];if("minimum"in d){let m=d.minimum;if(Array.isArray(d.minimum)&&(m=d.minimum[u.arrayIndex]),s<m)return[new o.V(t,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in d){let m=d.maximum;if(Array.isArray(d.maximum)&&(m=d.maximum[u.arrayIndex]),s>m)return[new o.V(t,s,`${s} is greater than the maximum value ${m}`)]}return[]}function ho(u){const t=u.key,s=u.value;if(!o.H(s))return[new o.V(t,s,`object expected, ${o.K(s)} found`)];const d=u.valueSpec,m=o.J(s.type);let y,v,b,E={};const A=m!=="categorical"&&s.property===void 0,M=!A,O=function(U){const X=U.stops;return Array.isArray(X)&&Array.isArray(X[0])&&o.H(X[0][0])}(s),z=Wr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(U){if(m==="identity")return[new o.V(U.key,U.value,'identity function may not have a "stops" property')];let X=[];const Z=U.value;return X=X.concat(qo({key:U.key,value:Z,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:F})),Array.isArray(Z)&&Z.length===0&&X.push(new o.V(U.key,Z,"array must have at least one stop")),X},default:function(U){return Ai({key:U.key,value:U.value,valueSpec:d,style:U.style,styleSpec:U.styleSpec})}}});return m==="identity"&&A&&z.push(new o.V(u.key,u.value,'missing required property "property"')),m==="identity"||s.stops||z.push(new o.V(u.key,u.value,'missing required property "stops"')),m==="exponential"&&d.expression&&!o.M(d)&&z.push(new o.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(M&&!o.N(d)?z.push(new o.V(u.key,u.value,"property functions not supported")):A&&!o.O(d)&&z.push(new o.V(u.key,u.value,"zoom functions not supported"))),m!=="categorical"&&!O||s.property!==void 0||z.push(new o.V(u.key,u.value,'"property" property is required')),z;function F(U){let X=[];const Z=U.value,ne=U.key;if(!Array.isArray(Z))return[new o.V(ne,Z,`array expected, ${o.K(Z)} found`)];if(Z.length!==2)return[new o.V(ne,Z,`array length 2 expected, length ${Z.length} found`)];if(O){if(!o.H(Z[0]))return[new o.V(ne,Z,`object expected, ${o.K(Z[0])} found`)];const ae=Z[0];if(ae.zoom===void 0)return[new o.V(ne,Z,"object stop key must have zoom")];if(ae.value===void 0)return[new o.V(ne,Z,"object stop key must have value")];const re=o.J(ae.zoom);if(typeof re!="number")return[new o.V(ne,ae.zoom,"stop zoom values must be numbers")];if(b&&b>re)return[new o.V(ne,ae.zoom,"stop zoom values must appear in ascending order")];re!==b&&(b=re,v=void 0,E={}),X=X.concat(Wr({key:`${ne}[0]`,value:Z[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:ps,value:V}}))}else X=X.concat(V({key:`${ne}[0]`,value:Z[0],style:U.style,styleSpec:U.styleSpec},Z));return o.Q(o.S(Z[1]))?X.concat([new o.V(`${ne}[1]`,Z[1],"expressions are not allowed in function stops.")]):X.concat(Ai({key:`${ne}[1]`,value:Z[1],valueSpec:d,style:U.style,styleSpec:U.styleSpec}))}function V(U,X){const Z=o.K(U.value),ne=o.J(U.value),ae=U.value!==null?U.value:X;if(y){if(Z!==y)return[new o.V(U.key,ae,`${Z} stop domain type must match previous stop domain type ${y}`)]}else y=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof ne!="number"&&typeof ne!="string"&&typeof ne!="boolean")return[new o.V(U.key,ae,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&m!=="categorical"){let re=`number expected, ${Z} found`;return o.N(d)&&m===void 0&&(re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(U.key,ae,re)]}return m!=="categorical"||Z!=="number"||typeof ne=="number"&&isFinite(ne)&&Math.floor(ne)===ne?m!=="categorical"&&Z==="number"&&typeof ne=="number"&&typeof v=="number"&&v!==void 0&&ne<v?[new o.V(U.key,ae,"stop domain values must appear in ascending order")]:(v=ne,m==="categorical"&&ne in E?[new o.V(U.key,ae,"stop domain values must be unique")]:(E[ne]=!0,[])):[new o.V(U.key,ae,`integer expected, found ${String(ne)}`)]}}function oo(u){const t=(u.expressionContext==="property"?o.W:o.U)(o.S(u.value),u.valueSpec);if(t.result==="error")return t.value.map(d=>new o.V(`${u.key}${d.key}`,u.value,d.message));const s=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!s.outputDefined())return[new o.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!o.Z(s))return[new o.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Js(s,u);if(u.expressionContext==="appearance")return fo(s,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!o.X(s,["zoom","feature-state"]))return[new o.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!o.Y(s))return[new o.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Js(u,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const d=[];return u instanceof o._&&s.has(u.name)?[new o.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(m=>{d.push(...Js(m,t))}),d)}function fo(u,t){const s=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.add(m);if(s.size===0)return[];const d=[];return u instanceof o._&&!s.has(u.name)?[new o.V(t.key,t.value,`["${u.name}"] is not an allowed parameter`)]:(u.eachChild(m=>{d.push(...fo(m,t))}),d)}function vo(u){const t=u.key,s=u.value,d=u.valueSpec,m=[];return Array.isArray(d.values)?d.values.indexOf(o.J(s))===-1&&m.push(new o.V(t,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(o.J(s))===-1&&m.push(new o.V(t,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function ea(u){return o.a2(o.S(u.value))?oo(Object.assign({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):xo(u)}function xo(u){const t=u.value,s=u.key;if(!Array.isArray(t))return[new o.V(s,t,`array expected, ${o.K(t)} found`)];if(t.length<1)return[new o.V(s,t,"filter array must have at least 1 element")];const d=u.styleSpec;let m=vo({key:`${s}[0]`,value:t[0],valueSpec:d.filter_operator});const y=()=>{t.length>=2&&(o.a0(t[1])||m.push(new o.V(`${s}[1]`,t[1],`string expected, ${o.K(t[1])} found`)));for(let v=2;v<t.length;v++)o.J(t[1])==="$type"?m=m.concat(vo({key:`${s}[${v}]`,value:t[v],valueSpec:d.geometry_type})):o.a0(t[v])||o.L(t[v])||o.$(t[v])||m.push(new o.V(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${o.K(t[v])} found.`))};switch(o.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.J(t[1])==="$type"&&m.push(new o.V(s,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&m.push(new o.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`)),y();break;case"==":case"!=":t.length!==3&&m.push(new o.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`)),y();break;case"in":case"!in":y();break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)m=m.concat(xo({key:`${s}[${v}]`,value:t[v],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":t.length!==2?m.push(new o.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):o.a0(t[1])||m.push(new o.V(`${s}[1]`,t[1],`string expected, ${o.K(t[1])} found`))}return m}function Ds(u,t){const s=u.key,d=u.style,m=u.layer,y=u.styleSpec,v=u.value,b=u.objectKey,E=y[`${t}_${u.layerType}`];if(!E)return[];const A=b.match(/^(.*)-use-theme$/);if(A&&E[A[1]])return o.Q(o.S(v))?[].concat(Ai({key:s,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:b})):Ai({key:s,value:v,valueSpec:{type:"string"},style:d,styleSpec:y});const M=b.match(/^(.*)-transition$/);if(t==="paint"&&M&&E[M[1]]&&E[M[1]].transition)return Ai({key:s,value:v,valueSpec:y.transition,style:d,styleSpec:y});const O=u.valueSpec||E[b];if(!O)return[new o.a3(s,v,`unknown property "${b}"`)];let z;if(o.a0(v)&&o.N(O)&&!O.tokens&&(z=/^{([^}]+)}$/.exec(v))){const V=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new o.V(s,v,`"${b}" does not support interpolation syntax
Use an identity property function instead: ${V}.`)]}const F=[];if(u.layerType==="symbol")b!=="text-field"||!d||d.glyphs||d.imports||F.push(new o.V(s,v,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&o.a4(o.S(v))&&o.J(v.type)==="identity"&&F.push(new o.V(s,v,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&o.N(O)&&(o.a5(O)||o.O(O))){const V=o.W(o.S(v),O).value,U="expression"in V&&V.expression||"_styleExpression"in V&&V._styleExpression&&V._styleExpression.expression;U&&!o.X(U,["measure-light"])&&(b==="model-emissive-strength"&&o.Y(U)&&o.Z(U)||F.push(new o.V(s,v,`${b} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(Ai({key:u.key,value:v,valueSpec:O,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:b}))}function Ya(u){return Ds(u,"paint")}function ba(u){return Ds(u,"layout")}function Ta(u){let t=[];const s=u.value,d=u.key,m=u.style,y=u.styleSpec;if(!o.H(s))return[new o.V(d,s,"object expected")];s.type||s.ref||t.push(new o.V(d,s,'either "type" or "ref" is required'));let v=o.J(s.type);const b=o.J(s.ref);if(s.id){const E=o.J(s.id);for(let A=0;A<u.arrayIndex;A++){const M=m.layers[A];o.J(M.id)===E&&t.push(new o.V(d,s.id,`duplicate layer id "${E}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let E;["type","source","source-layer","filter","layout"].forEach(A=>{A in s&&t.push(new o.V(d,s[A],`"${A}" is prohibited for ref layers`))}),m.layers.forEach(A=>{o.J(A.id)===b&&(E=A)}),E?E.ref?t.push(new o.V(d,s.ref,"ref cannot reference another ref layer")):v=o.J(E.type):typeof b=="string"&&t.push(new o.V(d,s.ref,`ref layer "${b}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(s.source)if(o.a0(s.source)){const E=m.sources&&m.sources[s.source],A=E&&o.J(E.type);E?A==="vector"&&v==="raster"?t.push(new o.V(d,s.source,`layer "${s.id}" requires a raster source`)):A==="raster"&&v!=="raster"?t.push(new o.V(d,s.source,`layer "${s.id}" requires a vector source`)):A!=="vector"||s["source-layer"]?A==="raster-dem"&&v!=="hillshade"?t.push(new o.V(d,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&A==="geojson"&&!E.lineMetrics?t.push(new o.V(d,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&A!=="raster-array"&&t.push(new o.V(d,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new o.V(d,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(d,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new o.V(d,s.source,`source "${s.source}" not found`))}else t.push(new o.V(`${d}.source`,s.source,'"source" must be a string'));else t.push(new o.V(d,s,'missing required property "source"'));return t=t.concat(Wr({key:d,value:s,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ai({key:`${d}.type`,value:s.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:s,objectKey:"type"}),filter:E=>ea(Object.assign({layerType:v},E)),layout:E=>Wr({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":A=>ba(Object.assign({layerType:v},A))}}),paint:E=>Wr({layer:s,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":A=>Ya(Object.assign({layerType:v,layer:s},A))}}),appearances(E){const A=qo({key:E.key,value:E.value,valueSpec:E.valueSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:z=>function(F){const{key:V,layer:U,layerType:X}=F,Z=o.J(F.value),ne=o.J(Z.name),ae=o.J(Z.condition),re=Wr({key:V,value:Z,valueSpec:F.styleSpec.appearance,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{condition:we=>function(ge){const ve=[];return ve.push(...oo({key:ge.key,value:ge.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ve}(Object.assign({layer:U,layerType:X},we)),properties:we=>function(ge){const ve=[],{styleSpec:me,layer:he,layerType:Se}=ge,Le=me[`paint_${Se}`],Re=me[`layout_${Se}`],qe=ge.object[ge.objectKey];for(const Ze in qe){const tt=Ze in Le?"paint":Ze in Re?"layout":void 0;if(!tt){ve.push(new o.V(ge.key,Ze,`unknown property "${Ze}" for layer type "${Se}"`));continue}const _t=Object.assign({},ge,{key:`${ge.key}.${Ze}`,object:qe,objectKey:Ze,layer:he,layerType:Se,value:qe[Ze],valueSpec:tt==="paint"?Le[Ze]:Re[Ze]});ve.push(...Ds(_t,tt))}return ve}(Object.assign({layer:U,layerType:X},we))}});return ne!=="hidden"&&ae===void 0&&re.push(new o.V(F.key,"name",'Appearance with name different than "hidden" must have a condition')),re}(Object.assign({layerType:v,layer:s},z))}),M=Array.isArray(E.value)?E.value:[],O=new Set;return M.forEach((z,F)=>{const V=o.J(z.name);if(V)if(O.has(V)){const U=o.J(s.id);A.push(new o.V(E.key,V,`Duplicated appearance name "${V}" for layer "${U}"`))}else O.add(V)}),A}}})),t}function Er({key:u,value:t}){return o.a0(t)?[]:[new o.V(u,t,`string expected, ${o.K(t)} found`)]}const wo={promoteId:function u({key:t,value:s}){if(o.a0(s))return Er({key:t,value:s});if(Array.isArray(s)){const m=[],y=o.S(s),v=o.U(y);return v.result==="error"&&v.value.forEach(b=>{m.push(new o.V(`${t}${b.key}`,null,`${b.message}`))}),o.X(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),m}if(!o.H(s))return[new o.V(t,s,`string, expression or object expected, "${o.K(s)}" found`)];const d=[];for(const m in s)d.push(...u({key:`${t}.${m}`,value:s[m]}));return d}};function Ls(u){const t=u.value,s=u.key,d=u.styleSpec,m=u.style;if(!o.H(t))return[new o.V(s,t,`object expected, ${o.K(t)} found`)];if(!("type"in t))return[new o.V(s,t,'"type" is required')];const y=o.J(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in t||"tiles"in t||v.push(new o.a3(s,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(Wr({key:s,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:wo})),v;case"geojson":if(v=Wr({key:s,value:t,valueSpec:d.source_geojson,style:m,styleSpec:d,objectElementValidators:wo}),"cluster"in t&&"clusterProperties"in t){if(!o.H(t.clusterProperties))return[new o.V(`${s}.clusterProperties`,t,`object expected, ${o.K(t)} found`)];for(const b in t.clusterProperties){const E=t.clusterProperties[b];if(!Array.isArray(E))return[new o.V(`${s}.clusterProperties.${b}`,E,"array expected")];const[A,M]=E,O=typeof A=="string"?[A,["accumulated"],["get",b]]:A;v.push(...oo({key:`${s}.${b}.map`,value:M,expressionContext:"cluster-map"})),v.push(...oo({key:`${s}.${b}.reduce`,value:O,expressionContext:"cluster-reduce"}))}}return v;case"video":return Wr({key:s,value:t,valueSpec:d.source_video,style:m,styleSpec:d});case"image":return Wr({key:s,value:t,valueSpec:d.source_image,style:m,styleSpec:d});case"canvas":return[new o.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vo({key:`${s}.type`,value:t.type,valueSpec:{values:Sa(d)}})}}function Sa(u){return u.source.reduce((t,s)=>{const d=u[s];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values||{}))),t},[])}function ks(u){const t=u.value,s=u.styleSpec,d=s.light,m=u.style;if(t===void 0)return[];if(!o.H(t))return[new o.V("light",t,`object expected, ${o.K(t)} found`)];let y=[];for(const v in t){const b=v.match(/^(.*)-transition$/),E=v.match(/^(.*)-use-theme$/);y=y.concat(E&&d[E[1]]?Ai({key:v,value:t[v],valueSpec:{type:"string"},style:m,styleSpec:s}):b&&d[b[1]]&&d[b[1]].transition?Ai({key:v,value:t[v],valueSpec:s.transition,style:m,styleSpec:s}):d[v]?Ai({key:v,value:t[v],valueSpec:d[v],style:m,styleSpec:s}):[new o.V(v,t[v],`unknown property "${v}"`)])}return y}function zs(u){const t=u.value;if(!t)return[];const s=u.key;if(!o.H(t))return[new o.V(s,t,`object expected, ${o.K(t)} found`)];let d=[];const m=u.styleSpec,y=m["light-3d"],v=u.style,b=u.style.lights;for(const M of["type","id"])if(!(M in t))return d=d.concat([new o.V(s,t,`missing property "${M}"`)]),d;if(!o.a0(t.type))return d=d.concat([new o.V(`${s}.type`,t.type,"string expected")]),d;if(b)for(let M=0;M<u.arrayIndex;M++){const O=o.J(t.type),z=b[M];o.J(z.type)===O&&d.push(new o.V(s,t.id,`duplicate light type "${t.type}", previously defined at line ${z.id.__line__}`))}const E=`properties_light_${t.type}`;if(!(E in m))return d=d.concat([new o.V(`${s}.type`,t,`Invalid light type ${t.type}`)]),d;const A=m[E];for(const M in t)if(M==="properties"){const O=t[M];if(!o.H(O))return d=d.concat([new o.V("properties",O,`object expected, ${o.K(O)} found`)]),d;for(const z in O){const F=z.match(/^(.*)-transition$/),V=z.match(/^(.*)-use-theme$/);d=d.concat(V&&A[V[1]]?Ai({key:M,value:O[z],valueSpec:{type:"string"},style:v,styleSpec:m}):F&&A[F[1]]&&A[F[1]].transition?Ai({key:M,value:t[M],valueSpec:m.transition,style:v,styleSpec:m}):A[z]?Ai({key:z,value:O[z],valueSpec:A[z],style:v,styleSpec:m}):[new o.a3(u.key,O[z],`unknown property "${z}"`)])}}else d=d.concat(y[M]?Ai({key:M,value:t[M],valueSpec:y[M],style:v,styleSpec:m}):[new o.a3(M,t[M],`unknown property "${M}"`)]);return d}function rs(u){const t=u.value,s=u.key,d=u.style,m=u.styleSpec,y=m.terrain;if(t==null)return[];if(!o.H(t))return[new o.V("terrain",t,`object expected, ${o.K(t)} found`)];let v=[];for(const b in t){const E=b.match(/^(.*)-transition$/),A=b.match(/^(.*)-use-theme$/);v=v.concat(A&&y[A[1]]?Ai({key:b,value:t[b],valueSpec:{type:"string"},style:d,styleSpec:m}):E&&y[E[1]]&&y[E[1]].transition?Ai({key:b,value:t[b],valueSpec:m.transition,style:d,styleSpec:m}):y[b]?Ai({key:b,value:t[b],valueSpec:y[b],style:d,styleSpec:m}):[new o.a3(b,t[b],`unknown property "${b}"`)])}if(t.source)if(o.a0(t.source)){const b=d.sources&&d.sources[t.source],E=b&&o.J(b.type);b?E!=="raster-dem"&&v.push(new o.V(`${s}.source`,t.source,`terrain cannot be used with a source of type ${E}, it only be used with a "raster-dem" source type`)):v.push(new o.V(`${s}.source`,t.source,`source "${t.source}" not found`))}else v.push(new o.V(`${s}.source`,t.source,"source must be a string"));else v.push(new o.V(s,t,'terrain is missing required property "source"'));return v}function yc(u){const t=u.value,s=u.style,d=u.styleSpec,m=d.fog;if(t===void 0)return[];if(!o.H(t))return[new o.V("fog",t,`object expected, ${o.K(t)} found`)];let y=[];for(const v in t){const b=v.match(/^(.*)-transition$/),E=v.match(/^(.*)-use-theme$/);y=y.concat(E&&m[E[1]]?Ai({key:v,value:t[v],valueSpec:{type:"string"},style:s,styleSpec:d}):b&&m[b[1]]&&m[b[1]].transition?Ai({key:v,value:t[v],valueSpec:d.transition,style:s,styleSpec:d}):m[v]?Ai({key:v,value:t[v],valueSpec:m[v],style:s,styleSpec:d}):[new o.a3(v,t[v],`unknown property "${v}"`)])}return y}const ta={"*":()=>[],array:qo,boolean:function(u){const t=u.value,s=u.key;return o.$(t)?[]:[new o.V(s,t,`boolean expected, ${o.K(t)} found`)]},number:ps,color:function({key:u,value:t}){return o.a0(t)?o.a1.parseCSSColor(t)===null?[new o.V(u,t,`color expected, "${t}" found`)]:[]:[new o.V(u,t,`color expected, ${o.K(t)} found`)]},enum:vo,filter:ea,function:ho,layer:Ta,object:Wr,source:Ls,model:o.a7,light:ks,"light-3d":zs,terrain:rs,fog:yc,string:Er,formatted:function(u){return Er(u).length===0?[]:oo(u)},resolvedImage:function(u){return Er(u).length===0?[]:oo(u)},projection:function(u){const t=u.value,s=u.styleSpec,d=s.projection,m=u.style;if(o.H(t)){let y=[];for(const v in t)y=y.concat(Ai({key:v,value:t[v],valueSpec:d[v],style:m,styleSpec:s}));return y}return o.a0(t)?[]:[new o.V("projection",t,`object or string expected, ${o.K(t)} found`)]},import:function(u){const t=u.key,{value:s,styleSpec:d}=u;if(!o.H(s))return[new o.V(t,s,"import must be an object")];const{data:m,...y}=s;Object.defineProperty(y,"__line__",{value:s.__line__,enumerable:!1});let v=Wr(Object.assign({},u,{value:y,valueSpec:d.import}));return o.J(y.id)===""&&v.push(new o.V(`${u.key}.id`,y,"import id can't be an empty string")),m&&(v=v.concat(Hi(m,d,{key:`${u.key}.data`}))),v},iconset:function(u){const t=u.value,s=u.key,d=u.styleSpec,m=u.style;if(!o.H(t))return[new o.V(s,t,"object expected")];if(!t.type)return[new o.V(s,t,'"type" is required')];const y=o.J(t.type);let v=[];if(v=v.concat(Wr({key:s,value:t,valueSpec:d[`iconset_${y}`],style:m,styleSpec:d})),function(b,E){return!(b!=="source"||!E.source)}(y,t)){const b=m.sources&&m.sources[t.source],E=b&&o.J(b.type);b?E!=="raster-array"&&v.push(new o.V(s,t.source,`iconset cannot be used with a source of type ${String(E)}, it only be used with a "raster-array" source type`)):v.push(new o.V(s,t.source,`source "${t.source}" not found`))}return v}};function Ai(u,t=!1){const s=u.value,d=u.valueSpec,m=u.styleSpec;if(d.expression){if(o.a4(o.J(s)))return ho(u);if(o.Q(o.S(s)))return oo(u)}if(d.type&&ta[d.type]){const y=ta[d.type](u);return t===!0&&y.length>0&&Array.isArray(u.value)?oo(u):y}return Wr(Object.assign({},u,{valueSpec:d.type?m[d.type]:d}))}function Wr(u){const t=u.key,s=u.value,d=u.valueSpec||{},m=u.objectElementValidators||{},y=u.style,v=u.styleSpec;if(!o.H(s))return[new o.V(t,s,`object expected, ${o.K(s)} found`)];let b=[];for(const E in s){const A=E.split(".")[0];let M;m[A]?M=m[A]:d[A]?M=Ai:m["*"]?M=m["*"]:d["*"]&&(M=Ai),M?b=b.concat(M({key:(t&&`${t}.`)+E,value:s[E],valueSpec:d[A]||d["*"],style:y,styleSpec:v,object:s,objectKey:E},s)):b.push(new o.a3(t,s[E],`unknown property "${E}"`))}for(const E in d){if(m[E])continue;const A=d[E];A.required&&A.default===void 0&&s[E]===void 0&&b.push(new o.V(t,s,`missing required property "${E}"`))}return b}function fi({key:u,value:t}){const s=Er({key:u,value:t});if(s.length)return s;const d=t;return d.indexOf("{fontstack}")===-1&&s.push(new o.V(u,t,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&s.push(new o.V(u,t,'"glyphs" url must include a "{range}" token')),s}function Hi(u,t=o.a6,s={}){return Wr({key:s.key||"",value:u,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:u,objectElementValidators:{glyphs:fi}})}function Wi(u,t=o.a6){return Q(Hi(u,t))}const Fo=u=>Q(Ls(u)),at=u=>Q(ks(u)),bo=u=>Q(zs(u)),na=u=>Q(rs(u)),po=u=>Q(yc(u)),Bn=u=>Q(function(t){const s=t.value,d=t.style,m=t.styleSpec,y=m.snow;if(s===void 0)return[];if(!o.H(s))return[new o.V("snow",s,`object expected, ${o.K(s)} found`)];let v=[];for(const b in s){const E=b.match(/^(.*)-transition$/);v=v.concat(E&&y[E[1]]&&y[E[1]].transition?Ai({key:b,value:s[b],valueSpec:m.transition,style:d,styleSpec:m}):y[b]?Ai({key:b,value:s[b],valueSpec:y[b],style:d,styleSpec:m}):[new o.a3(b,s[b],`unknown property "${b}"`)])}return v}(u)),Ro=u=>Q(function(t){const s=t.value,d=t.style,m=t.styleSpec,y=m.rain;if(s===void 0)return[];if(!o.H(s))return[new o.V("rain",s,`object expected, ${o.K(s)} found`)];let v=[];for(const b in s){const E=b.match(/^(.*)-transition$/);v=v.concat(E&&y[E[1]]&&y[E[1]].transition?Ai({key:b,value:s[b],valueSpec:m.transition,style:d,styleSpec:m}):y[b]?Ai({key:b,value:s[b],valueSpec:y[b],style:d,styleSpec:m}):[new o.a3(b,s[b],`unknown property "${b}"`)])}return v}(u)),Ym=u=>Q(Ta(u)),vc=u=>Q(ea(u)),Cd=u=>Q(Ya(u)),Be=u=>Q(ba(u)),W=u=>Q(o.a7(u));function Q(u){return u.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function de(u,t){let s=!1;if(t&&t.length)for(const d of t)d instanceof o.a3?o.w(d.message):(u.fire(new o.y(new Error(d.message))),s=!0);return s}const Ce=o.a6.light;let Ee;class De extends o.E{constructor(t,s="flat"){super(),this._transitionable=new o.a8(Ee||(Ee=new o.a9({anchor:new o.aa(Ce.anchor),position:new o.ab(Ce.position),color:new o.aa(Ce.color),intensity:new o.aa(Ce.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,d={}){this._validate(at,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&de(this,t.call(Wi,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const We=o.a6.terrain;let Oe=class extends o.E{constructor(u,t,s,d,m){super(),this.scope=s,this._transitionable=new o.a8(new o.a9({source:new o.aa(We.source),exaggeration:new o.aa(We.exaggeration)}),s,d),this._transitionable.setTransitionOrValue(u,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=m}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new o.ac(u,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let s=-1,d=-1,m=1;for(const y of t.zoomStops)m=t.evaluate(new o.ac(y,{worldview:this.worldview})),m>.01?(s=y,d=-1):d=y;return m<.01&&s>0&&d>s?[s,d]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof o.ad}};const Ge=45,gt=65,it=.05;function Bt(u,t,s,d){const m=o.ah(Ge,gt,s),[y,v]=on(u,d);let b=1-Math.min(1,Math.exp((t-y)/(v-y)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*m*u.alpha}function on(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}function Ot(u,t,s,d,m){const y=o.af([],[t,s,d],m.mercatorFogMatrix);return Bt(u,o.ag(y),m.pitch,m._fov)}function Rn(u,t,s,d,m,y,v){const b=[[s,d,0],[m,d,0],[m,y,0],[s,y,0]];let E=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(const M of b){const O=o.af([],M,t),z=o.ag(O);E=Math.min(E,z),A=Math.max(A,z)}return[Bt(u,E,v.pitch,v._fov),Bt(u,A,v.pitch,v._fov)]}const Pn=o.a6.fog;class In extends o.E{constructor(t,s,d,m){super();const y=new o.a9({range:new o.aa(Pn.range),color:new o.aa(Pn.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(Pn["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(Pn["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(Pn["horizon-blend"]),"star-intensity":new o.aa(Pn["star-intensity"]),"vertical-range":new o.aa(Pn["vertical-range"])});this._transitionable=new o.a8(y,d,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new o.ai(y),this.scope=d}get state(){const t=this._transform,s=t.projection.name==="globe",d=o.aj(t.zoom),m=this.properties.get("range"),y=[.5,3];return{range:s?[o.ak(y[0],m[0],d),o.ak(y[1],m[1],d)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,d={}){if(this._validate(po,t,d))return;const m=Object.assign({},t);for(const y of Object.keys(Pn))m[y]===void 0&&(m[y]=Pn[y].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Ge,gt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(d,m,y){const v=o.ae.fromLngLat(m),b=y.elevation?y.elevation.getAtPointOrZero(v):0;return Ot(d,v.x,v.y,b,y)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Rn(this.state,s,0,0,o.al,o.al,this._transform)}getOpacityForBounds(t,s,d,m,y){return this._transform.projection.supportsFog?Rn(this.state,t,s,d,m,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?on(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const d of s){const m=t.points[d];let y;if(m[2]>=0)y=m;else{const v=t.points[d-4];y=o.am(v,m,v[2]/(v[2]-m[2]))}if(Ot(this.state,y[0],y[1],0,this._transform)>=it)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&de(this,t.call(Wi,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Qn,ur,Pr,pr,Lr=class extends o.E{constructor(u,t,s,d){super();const m=Qn||(Qn=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(m,s,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(m),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=o.an(s[0]),m=-Math.max(o.an(s[1]),.01),y=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette"),b=this.properties.get("vignette-color");return b.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(Bn,u,s))return;const d=Object.assign({},u),m=o.a6.snow;for(const y of Object.keys(m))d[y]===void 0&&(d[y]=m[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&de(this,u.call(Wi,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},or=class extends o.E{constructor(u,t,s,d){super();const m=ur||(ur=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(m,s,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(m),this.scope=s}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=o.an(s[0]),m=-Math.max(o.an(s[1]),.01),y=[Math.cos(d)*Math.cos(m),Math.sin(d)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(u,t,s={}){if(this._validate(Ro,u,s))return;const d=Object.assign({},u),m=o.a6.rain;for(const y of Object.keys(m))d[y]===void 0&&(d[y]=m[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,s){return(!s||s.validate!==!1)&&de(this,u.call(Wi,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class ni extends o.E{constructor(t,s,d,m){super(),this.scope=d,this._options=t,this.properties=new o.ai(s),this._transitionable=new o.a8(s,d,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class sr{constructor(t,s,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,s){let d,m;if(t instanceof o.P||typeof t[0]=="number"){const y=o.P.convert(t);d=[y],m=s.isPointAboveHorizon(y)}else{const y=o.P.convert(t[0]),v=o.P.convert(t[1]),b=y.add(v)._div(2);d=[y,v],m=o.aq(y,v).every(E=>s.isPointAboveHorizon(E))&&s.isPointAboveHorizon(b)}return new sr(d,m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.aq(s,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.ar(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],m=o.aq(s,d,t),y=this.cameraPoint.clone();switch(3*((y.y>s.y)+(y.y>d.y))+((y.x>s.x)+(y.x>d.x))){case 0:m[0]=y,m[4]=y.clone();break;case 1:m.splice(1,0,y);break;case 2:m[1]=y;break;case 3:m.splice(4,0,y);break;case 5:m.splice(2,0,y);break;case 6:m[3]=y;break;case 7:m.splice(3,0,y);break;case 8:m[2]=y}return m}containsTile(t,s,d,m=0){const y=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/s._pixelsPerMercatorPixel+1,v=d?this._bufferedCameraMercator(y,s):this._bufferedScreenMercator(y,s);let b=t.tileID.wrap+(v.unwrapped?m:0);const E=v.polygon.map(X=>o.as(t.tileTransform,X,b));if(!o.at(E,0,0,o.al,o.al))return;b=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const A=this.screenGeometryMercator.polygon.map(X=>o.au(t.tileTransform,X,b)),M=A.map(X=>new o.P(X[0],X[1])),O=s.getFreeCameraOptions().position||new o.ae(0,0,0),z=o.au(t.tileTransform,O,b),F=A.map(X=>{const Z=o.av(X,X,z);return o.aw(Z,Z),new o.ax(z,Z)}),V=o.ay(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:F,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(U=o.az(E),U.min.x=o.aA(U.min.x,0,o.al),U.min.y=o.aA(U.min.y,0,o.al),U.max.x=o.aA(U.max.x,0,o.al),U.max.y=o.aA(U.max.y,0,o.al),U),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:V};var U}_bufferedScreenMercator(t,s){const d=mr(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(t,s){const d=mr(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(y=>s.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=m,m}}_projectAndResample(t,s){const d=function(y,v){const b=o.aB([],v.pixelMatrix,v.globeMatrix),E=[0,-o.aD,0,1],A=[0,o.aD,0,1],M=[0,0,0,1];o.aC(E,E,b),o.aC(A,A,b),o.aC(M,M,b);const O=new o.P(E[0]/E[3],E[1]/E[3]),z=new o.P(A[0]/A[3],A[1]/A[3]),F=o.aE(y,O)&&E[3]<M[3],V=o.aE(y,z)&&A[3]<M[3];if(!F&&!V)return null;const U=function(ve,me,he){for(let Se=1;Se<ve.length;Se++){const Le=$n(me.pointCoordinate3D(ve[Se-1]).x),Re=$n(me.pointCoordinate3D(ve[Se]).x);if(he<0){if(Le<Re)return{idx:Se,t:-Le/(Re-1-Le)}}else if(Re<Le)return{idx:Se,t:(1-Le)/(Re+1-Le)}}return null}(y,v,F?-1:1);if(!U)return null;const{idx:X,t:Z}=U;let ne=X>1?Li(y.slice(0,X),v):[],ae=X<y.length?Li(y.slice(X),v):[];ne=ne.map(ve=>new o.P($n(ve.x),ve.y)),ae=ae.map(ve=>new o.P($n(ve.x),ve.y));const re=[...ne];re.length===0&&re.push(ae[ae.length-1]);const we=o.ak(re[re.length-1].y,(ae.length===0?ne[0]:ae[0]).y,Z);let ge;return ge=F?[new o.P(0,we),new o.P(0,0),new o.P(1,0),new o.P(1,we)]:[new o.P(1,we),new o.P(1,1),new o.P(0,1),new o.P(0,we)],re.push(...ge),ae.length===0?re.push(ne[0]):re.push(...ae),{polygon:re.map(ve=>new o.ae(ve.x,ve.y)),unwrapped:!1}}(t,s);if(d)return d;const m=function(y,v){let b=!1,E=-1/0,A=0;for(let O=0;O<y.length-1;O++)y[O].x>E&&(E=y[O].x,A=O);for(let O=0;O<y.length-1;O++){const z=(A+O)%(y.length-1),F=y[z],V=y[z+1];Math.abs(F.x-V.x)>.5&&(F.x<V.x?(F.x+=1,z===0&&(y[y.length-1].x+=1)):(V.x+=1,z+1===y.length-1&&(y[0].x+=1)),b=!0)}const M=o.aF(v.center.lng);return b&&M<Math.abs(M-1)&&y.forEach(O=>{O.x-=1}),{polygon:y,unwrapped:b}}(Li(t,s).map(y=>new o.P($n(y.x),y.y)),s);return{polygon:m.polygon.map(y=>new o.ae(y.x,y.y)),unwrapped:m.unwrapped}}}function Li(u,t){return o.aG(u,s=>{const d=t.pointCoordinate3D(s);s.x=d.x,s.y=d.y},1/256)}function $n(u){return u<0?1+u%1:u%1}function mr(u){return 100*u|0}function mo(u,t,s,d,m){const y=function(b,E){if(b)return m(b);if(E){if(u.url&&E.tiles&&u.tiles&&delete u.tiles,E.variants){if(!Array.isArray(E.variants))return m(new Error("variants must be an array"));for(const M of E.variants){if(M==null||typeof M!="object"||M.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(M.capabilities))return m(new Error("capabilities must be an array"));if(M.capabilities.length===1&&M.capabilities[0]==="meshopt"){E=Object.assign(E,M);break}}}const A=o.aH(Object.assign({},E,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);A.tiles=t.canonicalizeTileset(A,u.url),m(null,A)}},v=function(b,E,A){if(!b)return null;if(!E&&!A)return b;A=A||b.worldview_default;const M=Object.values(b.language||{});if(M.length===0)return null;const O=Object.values(b.worldview||{});if(O.length===0)return null;const z=M.every(V=>V===E),F=O.every(V=>V===A);return z&&F?b:E in(b.language_options||{})||A in(b.worldview_options||{})?null:b.language_options&&b.worldview_options?b:null}(u.data,s,d);return v?o.o.frame(()=>y(null,v)):u.url?o.m(t.transformRequest(t.normalizeSourceURL(u.url,null,s,d),o.R.Source),y):o.o.frame(()=>{const{data:b,...E}=u;y(null,E)})}function To(u,t){const s=Math.pow(2,t.z),d=Math.floor(o.aF(u.getWest())*s),m=Math.floor(o.aJ(u.getNorth())*s),y=Math.ceil(o.aF(u.getEast())*s),v=Math.ceil(o.aJ(u.getSouth())*s);return t.x>=d&&t.x<y&&t.y>=m&&t.y<v}class Zo{constructor(t,s,d){this.bounds=t?o.aI.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(o.aI.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!To(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(To(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Zo(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class xc extends o.E{constructor(t,s,d,m){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(s,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new o.aK}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=mo(this._options,this.map._requestManager,s,d,(m,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new o.y(m));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of y.vector_layers)this.vectorLayerIds.push(v.id),y.worldview&&y.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=Zo.fromTileJSON(y),Kt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,s){const d=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(m,o.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,b=v?{image:v.image.clone()}:null,E={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:b,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(d)&&(E.localizableLayerIds=this.localizableLayerIds),E.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",E,A.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",E,A.bind(this),void 0,!0);else{const M=o.aL.call({deduped:this._deduped},E,(O,z)=>{if(O||!z)A.call(this,O);else{const F=o.aM(z.responseHeaders);E.data={rawData:z.rawData.slice(0),expires:F.expires,cacheControl:F.cacheControl},t.actor&&t.actor.send("loadTile",E,A.bind(this),void 0,!0)}},!0);t.request={cancel:M}}function A(M,O){return delete t.request,t.aborted?s(null):M&&M instanceof o.aN&&M.status!==404?s(M):(O&&O.resourceTiming&&(t.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&t.setExpiryData(O),t.loadVectorData(O,this.map.painter),o.aO(this.dispatcher),s(null,O),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Jr extends o.E{constructor(t,s,d,m){super(),this.id=t,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},s),Object.assign(this,o.aH(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=mo(this._options,this.map._requestManager,null,s,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.y(d)):m&&(Object.assign(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Zo.fromTileJSON(m),Kt(m.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const d=o.o.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=o.n(this.map._requestManager.transformRequest(m,o.R.Tile),(y,v,b)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(y)return t.state="errored",s(y);if(!v)return s(null);const E=o.aM(b);this.map._refreshExpiredTiles&&t.setExpiryData(E),t.setTexture(v,this.map.painter),t.state="loaded",o.aO(this.dispatcher),s(null)})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof o.T?(t.destroy(!1),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function ms([u,t],s,d,{scaled:m=!0}={}){const{tileSize:y,buffer:v}=d,{x:b,y:E,z:A}=s;if(!isFinite(b)||!isFinite(E)||!isFinite(A))throw new Error("Invalid MRT header");const M=2**A,O=M*o.aF(u),z=M*o.aJ(t);return function([F,V],U,{scaled:X=!0}={}){if(!U)throw new Error("bandView is undefined");const{data:Z,tileSize:ne,buffer:ae,offset:re,scale:we,dimension:ge}=U;if(F<-ae||F>ne+ae||V<-ae||V>ne+ae)throw new Error(`Point (${F}, ${V}) out of bounds for tileSize=${ne}, buffer=${ae}`);const ve=(V+ae)*(ne+2*ae)+(F+ae);if(new Uint32Array(Z.buffer)[ve]===4294967295)return null;let me=[];me=X?[]:new U.data.constructor(ge);for(let he=0;he<ge;he++)me[he]=Math.round(1e12*(Z[ge*ve+he]*we+re))/1e12;return me}([Math.min(Math.max(-v,Math.floor((O-b)*y)),y-1+v),Math.min(Math.max(-v,Math.floor((z-E)*y)),y-1+v)],d,{scaled:m})}class Do extends Jr{constructor(t,s,d,m){super(t,s,d,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);s&&s.enabled&&d&&s._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,o.R.Tile),y={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const v=(b,E,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(b)return b.name==="AbortError"?void 0:(t.state="errored",s(b));if(this.map._refreshExpiredTiles&&E){const M=o.aM(A);t.setExpiryData(M)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!E)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=E}s(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",y,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!1);for(const m of d.values())this.map.painter.saveTileTexture(m)}else t.destroy()}prepareTile(t,s,d,m){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(s,d,m,(y,v)=>{if(y)return t.state="errored",this.fire(new o.y(y)),void this.triggerRepaint(t);v&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,v,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:y})=>y===t),d=s&&s.fields,m=d&&d.bands&&d.bands;return m?m[0]:0}getTextureDescriptor(t,s,d){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let y=null;s instanceof o.aR?y=s.paint.get("raster-array-band"):s instanceof o.aS&&(y=s.paint.get("raster-particle-array-band"));const v=y||this.getInitialBand(m);if(v==null)return;if(!t.textureDescriptorPerLayer.get(s.id))return void this.prepareTile(t,m,s.id,v);if(t.updateNeeded(s.id,v)&&!d)return;const b=t.textureDescriptorPerLayer.get(s.id);return Object.assign({},b,{texture:t.texturePerLayer.get(s.id)})}getImages(t,s){const d=new Map;for(const m of t)for(const y of s){const[v,b]=y.split("/"),E=m.getLayer(v);if(!E||!E.hasBand(b)||!E.hasDataForBand(b))continue;const{bytes:A,tileSize:M,buffer:O}=E.getBandView(b),z=M+2*O,F={data:new o.q({width:z,height:z},A),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(y,F)}return d}queryRasterArrayValueByBandId(t,s,d){const m=s._mrt;return new Promise(y=>{const v={},b=new Set;for(const[E,A]of Object.entries(m.layers)){if(d.layerName&&E!==d.layerName)continue;const M={};v[E]=M;for(const{bands:O}of A.dataIndex)for(const z of O)d.bands&&!d.bands.includes(z)||(b.add(o.B(E,z)),s.fetchBand(E,null,z,F=>{o.o.frame(()=>{M[z]=F?null:ms([t.lng,t.lat],m,A.getBandView(z)),b.delete(o.B(E,z)),b.size===0&&y(v)})},!1))}b.size===0&&y(v)})}_loadTileForQuery(t,s){if(this._loadTileLoaded[t.uid])return void s(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(s);this._loadTilePending[t.uid]=[s];const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(d,o.R.Tile);t.actor.send("loadTile",{request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,v,b)=>{if(y)return this._loadTilePending[t.uid].forEach(E=>E(y,null)),void delete this._loadTilePending[t.uid];if(!v)return this._loadTilePending[t.uid].forEach(E=>E(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&v){const E=o.aM(b);t.setExpiryData(E)}t._mrt=v,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(E=>E(null,v)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,s,d){return new Promise((m,y)=>{this._loadTileForQuery(s,(v,b)=>{v?y(v):m(b?this.queryRasterArrayValueByBandId(t,s,d):null)})})}queryRasterArrayValue(t,s){const d=o.aT.convert(t),m=this.findLoadedParent(d);return m&&m._mrt?s.bands||!this.partial?this.queryRasterArrayValueByBandId(d,m,s):this.queryRasterArrayValueByAllBands(d,m,s):Promise.resolve(null)}findLoadedParent(t){const s=o.ae.fromLngLat(t,this.map.transform.tileSize),d=this.maxzoom+1,m=1<<d,y=Math.floor(s.x),v=Math.floor((s.x-y)*m),b=Math.floor(s.y*m),E=this.map.style.getSourceCache(this.id),A=new o.aQ(d,y,d,v,b);return E.findLoadedParent(A,this.minzoom)}}const Ea={vector:xc,raster:Jr,"raster-dem":class extends Jr{constructor(u,t,s,d){super(u,t,s,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,y){m&&(u.state="errored",t(m)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=o.n(this.map._requestManager.transformRequest(s,o.R.Tile),(function(m,y,v){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(y){const b=o.aM(v);this.map._refreshExpiredTiles&&u.setExpiryData(b);const E=ImageBitmap&&y instanceof ImageBitmap&&o.r(),A=1-(y.width-o.aP(y.width))/2;A<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const M=E?y:o.o.getImageData(y,A),O={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:M,encoding:this.encoding,padding:A};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",O,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),d=(t.x-1+s)%s,m=t.x===0?u.wrap-1:u.wrap,y=(t.x+1+s)%s,v=t.x+1===s?u.wrap+1:u.wrap,b={};return b[new o.aQ(u.overscaledZ,m,t.z,d,t.y).key]={backfilled:!1},b[new o.aQ(u.overscaledZ,v,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(b[new o.aQ(u.overscaledZ,m,t.z,d,t.y-1).key]={backfilled:!1},b[new o.aQ(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new o.aQ(u.overscaledZ,v,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<s&&(b[new o.aQ(u.overscaledZ,m,t.z,d,t.y+1).key]={backfilled:!1},b[new o.aQ(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new o.aQ(u.overscaledZ,v,t.z,y,t.y+1).key]={backfilled:!1}),b}},"raster-array":Do,geojson:class extends o.E{constructor(u,t,s,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(d),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:o.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of u.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,s,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:s},d),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:u},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(o.o.resolveURL(s),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,m)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new o.y(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new o.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=o.B(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,m=d?{image:d.image.clone()}:null,y=this._partialReload,v={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};u.request=this.actor.send(s,v,(b,E)=>y&&!E?(u.state="loaded",t(null)):(delete u.request,u.destroy(!1),u.aborted?t(null):b?t(b):(u.loadVectorData(E,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aU{constructor(u,t,s,d){super(u,t,s,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aV(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new o.y(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aU,model:o.aX,"batched-model":class extends o.E{constructor(u,t,s,d){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=mo(this._options,this.map._requestManager,t,s,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.y(d))):m&&(Object.assign(this,m),m.bounds&&(this.tileBounds=new Zo(m.bounds,this.minzoom,this.maxzoom)),Kt(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(s,o.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const y=Object.values(u.buckets);for(const v of y)v.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",d,m.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",d,m.bind(this),void 0,!0);function m(y,v){return u.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&v&&u.setExpiryData(v),u.loadModelData(v,this.map.painter),u.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aU{constructor(u,t,s,d){super(u,t,s,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.y(new o.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof o.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends o.E{constructor(u,t,s,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Zo(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:s,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:s,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:s,y:d,z:m}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:s,y:d,z:m},{signal:y.signal})).then((function(v){return delete u.request,u.aborted?(u.state="unloaded",t(null)):v===void 0?(u.state="errored",t(null)):v===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(b){return b instanceof ImageData||b instanceof HTMLCanvasElement||b instanceof ImageBitmap||b instanceof HTMLImageElement}(v)?(this.loadTileData(u,v),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(u.state="errored",t(v))}),u.request.cancel=()=>y.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof o.T?(u.destroy(!1),u.texture&&u.texture instanceof o.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:s,y:d,z:m}=u.tileID.canonical;this._implementation.unloadTile({x:s,y:d,z:m})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=o.B(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},qr=function(u,t,s,d){const m=new Ea[t.type](u,t,s,d);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return o.aY(["load","abort","unload","serialize","prepare"],m),m};function wc(u,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:m,importId:y}=d;return`featureset:${m}${y?`:import:${y}`:""}`}}(u.target)}`}function uu(u,t,s,d=""){if(u.uniqueFeatureID){const m=wc(u,t,d);if(s.has(m))return!0;s.add(m)}return!1}function af(u,t,s,d,m=!1){const y=t.sourceCache.transform,v=t.sourceCache.tilesIn(u,t.has3DLayers,m);v.sort(Ad);const b=[];for(const E of v){const A=E.tile.queryRenderedFeatures(t,E,s,d,y,m);Object.keys(A).length&&b.push({wrappedTileID:E.tile.tileID.wrapped().key,queryResults:A})}for(const E in t.layers){const A=t.layers[E];if(A.styleLayer){const M=A.styleLayer.queryRenderedFeatures(u,t.sourceCache,d);Object.keys(M).length&&b.push({wrappedTileID:0,queryResults:M})}}return b.length===0?{}:function(E){const A={},M={};for(const O of E){const z=O.queryResults,F=O.wrappedTileID,V=M[F]=M[F]||{};for(const U in z){const X=z[U],Z=V[U]=V[U]||{},ne=A[U]=A[U]||[];for(const ae of X)Z[ae.featureIndex]||(Z[ae.featureIndex]=!0,ne.push(ae))}}return A}(b)}function lf(u,t,s,d,m,y){const v={},b=d.queryRenderedSymbols(u),E=[];for(const A of Object.keys(b).map(Number))E.push(m[A]);E.sort(Ad);for(const A of E){const M=A.featureIndex.lookupSymbolFeatures(b[A.bucketInstanceId],A.bucketIndex,A.sourceLayerIndex,t,s,y);for(const O in M){const z=v[O]=v[O]||[],F=M[O];F.sort((V,U)=>{const X=A.featureSortOrder;if(X){const Z=X.indexOf(V.featureIndex);return X.indexOf(U.featureIndex)-Z}return U.featureIndex-V.featureIndex});for(const V of F)z.push(V)}}return v}function cf(u,t){const s=u.getRenderableIds().map(y=>u.getTileByID(y)),d=[],m={};for(let y=0;y<s.length;y++){const v=s[y],b=v.tileID.canonical.key;m[b]||(m[b]=!0,v.querySourceFeatures(d,t))}return d}function Ad(u,t){const s=u.tileID,d=t.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function Ia(u,t){const s={};if(!t)return s;for(const d of u){const m=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(m.length!==0){d.layers=m,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>m.filter(v=>v.id===y)[0]));for(const y of m)s[y.fqid]=d}}return s}const Xo=32,ia=33,ra=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,s=0,d=0,m=0,y=0,v=0,b=0;for(1&t?m=y=v=Xo:s=d=b=Xo;(t>>=1)>1;){const A=s+m>>1,M=d+y>>1;1&t?(m=s,y=d,s=v,d=b):(s=m,d=y,m=v,y=b),v=A,b=M}const E=4*u;ra[E+0]=s,ra[E+1]=d,ra[E+2]=m,ra[E+3]=y}const Os=new Uint16Array(2178),Ca=new Uint8Array(1089),Ol=new Uint16Array(1089);function bc(u){return u===0?-.03125:u===32?.03125:0}const uf={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class Tc{constructor(t,s,d,m,y,v){this.tileID=t,this.uid=o.b2(),this.uses=0,this.tileSize=s,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=v,this._hasAppearances=null}registerFadeDuration(t){const s=t+this.timeAdded;s<o.o.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ia(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof o.b4){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof o.b4&&y.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m],v=s.style.getOwnLayer(m);if(!v)continue;const b=v.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,b)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Ia(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,s){for(const y in this.buckets){const v=this.buckets[y];if(v.uploadPending()){let b={},E=[],A={zoom:0,pitch:0,brightness:0,worldview:""};if(s){if(s.style){E=s.style.listImages();const M=v.layers[0],O=M.sourceLayer||"_geojsonTileLayer",z=s.style.getLayerSourceCache(M);z&&(b=z._state.getState(O,void 0))}A={zoom:s.transform.zoom||0,pitch:s.transform.pitch||0,brightness:s.style.getBrightness()||0,worldview:s.worldview||""}}v.upload(t,this.tileID.canonical,b,E,A)}}const d=t.gl,m=this.imageAtlas;m&&!m.uploaded&&(this.imageAtlasTexture=new o.T(t,m.image,d.RGBA8,{useMipmap:!!m.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,d.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,d.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(s)),(this._lastUpdatedBrightness||m||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const s in this.buckets){const d=this.buckets[s];d.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,d.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,s,d,m,y,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const b=this.evaluateQueryRenderedFeaturePadding(),E=function(A,M){const O=o.bq([],[.5*A.width,.5*-A.height,1]);return o.br(O,O,[1,-1,0]),o.aB(O,O,A.calculateProjMatrix(M.toUnwrapped())),Float32Array.from(O)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:E,transform:m,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:b})}querySourceFeatures(t,s){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),y=s?s.sourceLayer:"",v=m._geojsonTileLayer||m[y];if(!v)return;const b=o.b6(s&&s.filter),{z:E,x:A,y:M}=this.tileID.canonical,O={z:E,x:A,y:M};for(let z=0;z<v.length;z++){const F=v.feature(z);if(b.needGeometry){const X=o.b7(F,!0);if(!b.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!b.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),F))continue;const V=d.getId(F,y),U=new o.b8(F,E,A,M,V);U.tile=O,t.push(U)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const d=o.b9(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const y=this.expirationTime-s;y?this.expirationTime=d+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const s in this.buckets)if(t.style.hasLayer(s)&&this.buckets[s].layers.some(d=>d.appearances&&d.appearances.length>0))return!0;return!1}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const d=t.style.listImages(),m=t.style.getBrightness();for(const y in this.buckets){if(!t.style.hasLayer(y))continue;const v=this.buckets[y],b=v.layers[0],E=b.sourceLayer||"_geojsonTileLayer",A=t.style.getLayerSourceCache(b);let M={};A&&(M=A._state.getState(E,void 0));const O=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},z=Object.keys(M).length>0&&!s;v.hasAppearances=v.layers.some(U=>U.appearances&&U.appearances.length>0);const F=z?v.stateDependentLayers:v.layers;if(z&&v.stateDependentLayers.length!==0||s){const U=this.latestFeatureIndex.loadVTLayers();v.update(M,U[E],d,O,F,s,m)}if(z&&v.stateDependentLayers.length!==0||s||v.hasAppearances){const U={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};v.updateAppearances(this.tileID.canonical,M,d,U)}(v instanceof o.ba||v instanceof o.bb)&&t._terrain&&t._terrain.enabled&&A&&v.uploadPending()&&t._terrain._clearRenderCacheForTile(A.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.o.now()+t}setTexture(t,s){const d=s.context,m=d.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(d,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const d={};for(const m of s)d[m]=!0;this.dependencies[t]=d}hasDependency(t,s){for(const d of t){const m=this.dependencies[d];if(m){for(const y of s)if(m[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const d=o.bc(uf,this.tileID.canonical,this.tileTransform)[0],m=new o.bd,y=new o.be;for(let v=0;v<d.length;v++){const{x:b,y:E}=d[v];m.emplaceBack(b,E),y.emplaceBack(v)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(m,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,m.length,y.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const d=o.bc(uf,this.tileID.canonical,this.tileTransform)[0];let m,y;if(this.isRaster){const v=function(b,E){const A=o.aZ(b,E),M=Math.pow(2,b.z);for(let X=0;X<ia;X++)for(let Z=0;Z<ia;Z++){const ne=o.a_((b.x+(Z+bc(Z))/Xo)/M),ae=o.a$((b.y+(X+bc(X))/Xo)/M),re=E.project(ne,ae),we=X*ia+Z;Os[2*we+0]=Math.round((re.x*A.scale-A.x)*o.al),Os[2*we+1]=Math.round((re.y*A.scale-A.y)*o.al)}Ca.fill(0),Ol.fill(0);for(let X=2045;X>=0;X--){const Z=4*X,ne=ra[Z+0],ae=ra[Z+1],re=ra[Z+2],we=ra[Z+3],ge=ne+re>>1,ve=ae+we>>1,me=ge+ve-ae,he=ve+ne-ge,Se=ae*ia+ne,Le=we*ia+re,Re=ve*ia+ge,qe=Math.hypot((Os[2*Se+0]+Os[2*Le+0])/2-Os[2*Re+0],(Os[2*Se+1]+Os[2*Le+1])/2-Os[2*Re+1])>=16;Ca[Re]=Ca[Re]||(qe?1:0),X<1022&&(Ca[Re]=Ca[Re]||Ca[(ae+he>>1)*ia+(ne+me>>1)]||Ca[(we+he>>1)*ia+(re+me>>1)])}const O=new o.b1,z=new o.b0;let F=0;function V(X,Z){const ne=Z*ia+X;return Ol[ne]===0&&(O.emplaceBack(Os[2*ne+0],Os[2*ne+1],X*o.al/Xo,Z*o.al/Xo),Ol[ne]=++F),Ol[ne]-1}function U(X,Z,ne,ae,re,we){const ge=X+ne>>1,ve=Z+ae>>1;if(Math.abs(X-re)+Math.abs(Z-we)>1&&Ca[ve*ia+ge])U(re,we,X,Z,ge,ve),U(ne,ae,re,we,ge,ve);else{const me=V(X,Z),he=V(ne,ae),Se=V(re,we);z.emplaceBack(me,he,Se)}}return U(0,0,Xo,Xo,Xo,0),U(Xo,Xo,0,0,0,Xo),{vertices:O,indices:z}}(this.tileID.canonical,s);m=v.vertices,y=v.indices}else{m=new o.b1,y=new o.b0;for(const{x:b,y:E}of d)m.emplaceBack(b,E,0,0);const v=o.bh(m.int16.subarray(0,4*m.length),void 0,4);for(let b=0;b<v.length;b+=3)y.emplaceBack(v[b],v[b+1],v[b+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,o.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=o.bg.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugBuffers(t,s){const d=s.projection;if(!d||d.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,y=o.bj(m,s),v=o.bk(y),b=o.aj(s.zoom);let E;b>0&&(E=o.bl(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,v,E,b),this._makeGlobeTileDebugTextBuffer(t,m,s,v,E,b)}_globePoint(t,s,d,m,y,v,b){let E=o.bm(t,s,d);if(v){const A=1<<d.z,M=o.aF(m.center.lng),O=o.aJ(m.center.lat),z=(d.x+.5)/A-M;let F=0;z>.5?F=-1:z<-.5&&(F=1);let V=(t/o.al+d.x)/A+F,U=(s/o.al+d.y)/A;V=(V-M)*m._pixelsPerMercatorPixel+M,U=(U-O)*m._pixelsPerMercatorPixel+O;const X=[V*m.worldSize,U*m.worldSize,0];o.af(X,X,v),E=o.bn(E,X,b)}return o.af(E,E,y)}_makeGlobeTileDebugBorderBuffer(t,s,d,m,y,v){const b=new o.bd,E=new o.be,A=new o.bo,M=(z,F,V,U,X)=>{const Z=(V-z)/(X-1),ne=(U-F)/(X-1),ae=b.length;for(let re=0;re<X;re++){const we=z+re*Z,ge=F+re*ne;b.emplaceBack(we,ge);const ve=this._globePoint(we,ge,s,d,m,y,v);A.emplaceBack(ve[0],ve[1],ve[2]),E.emplaceBack(ae+re)}},O=o.al;M(0,0,O,0,16),M(O,0,O,O,16),M(O,O,0,O,16),M(0,O,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(b,o.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(A,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,b.length,E.length)}_makeGlobeTileDebugTextBuffer(t,s,d,m,y,v){const b=o.al/4,E=new o.bd,A=new o.b0,M=new o.bo,O=25;A.reserve(32),E.reserve(O),M.reserve(O);const z=(F,V)=>O*F+V;for(let F=0;F<O;F++){const V=F*b;for(let U=0;U<O;U++){const X=U*b;E.emplaceBack(X,V);const Z=this._globePoint(X,V,s,d,m,y,v);M.emplaceBack(Z[0],Z[1],Z[2])}}for(let F=0;F<4;F++)for(let V=0;V<4;V++){const U=z(F,V),X=z(F,V+1),Z=z(F+1,V),ne=z(F+1,V+1);A.emplaceBack(U,X,Z),A.emplaceBack(Z,X,ne)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(A),this._tileDebugTextBuffer=t.createVertexBuffer(E,o.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(M,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,O,32)}destroy(t=!0){for(const s in this.buckets)this.buckets[s].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof o.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class df extends Tc{constructor(t,s,d,m,y){super(t,s,d,m,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,s,d){const m=d.context,y=m.gl;let v=this.texturePerLayer.get(t)||d.getTileTexture(s.width);v&&v instanceof o.T?v.update(s,{premultiply:!1}):v=new o.T(m,s,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,v)}flushQueues(t){const s=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const s=this._workQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const s=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}}fetchHeader(t=16384,s){const d=this._mrt=new o.bs(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bu(m,(y,v,b)=>{if(y)s(y);else try{const E=d.getHeaderLength(v);if(E>t)return void(this.request=this.fetchHeader(E,s));d.parseHeader(v),this._isHeaderLoaded=!0;let A=0;for(const M of Object.values(d.layers))A=Math.max(A,M.dataIndex[M.dataIndex.length-1].lastByte);v.byteLength>=A&&(this.entireBuffer=v),s(null,this.entireBuffer||v,b)}catch(E){s(E)}}),this.request}fetchBandForRender(t,s,d,m){this.fetchBand(t,s,d,y=>{if(y)return void m(y);this.updateTextureDescriptor(t,s,d);const v=this.textureDescriptorPerLayer.get(s);m(null,v?v.img:null)})}fetchBand(t,s,d,m,y=!0){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void m(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void m(new Error("Can't fetch tile band without an actor"));let E;const A=o.B(String(d),o.B(this.tileID.key,t));let M=this._taskQueue.get(A);M?M.add(m):(M=new Set,M.add(m),this._taskQueue.set(A,M));const O=(U,X)=>{E.complete(U,X),U?m(U):(M.forEach(Z=>Z(null,X)),this._taskQueue.delete(A))},z=(U,X)=>{if(U)return m(U);const Z=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:X,task:E},O,void 0,!0);if(s!==null){const ne=this._workQueuePerLayer.get(s)||[];ne.push(()=>{Z&&Z.cancel(),E.cancel()}),this._workQueuePerLayer.has(s)||this._workQueuePerLayer.set(s,ne)}};let F;try{F=v.getLayer(t)}catch(U){if(this.state==="reloading")return;throw U}if(!F)return void m(new Error(`Unknown sourceLayer "${t}"`));if(F.hasDataForBand(d))return M.forEach(U=>U(null,null)),void this._taskQueue.delete(A);const V=F.getDataRange([d]);if(E=v.createDecodingTask(V),!E||E.tasks.length)if(s!==null&&this.flushQueues(s),this.entireBuffer)z(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),X=o.bu(U,z);if(s!==null){const Z=this._fetchQueuePerLayer.get(s)||[];Z.push(()=>{X.cancel(),E.cancel()}),this._fetchQueuePerLayer.has(s)||this._fetchQueuePerLayer.set(s,Z)}}}updateNeeded(t,s){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==s||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,s,d){if(!this._mrt)return;const m=this._mrt.getLayer(t);if(!m||!m.hasBand(d)||!m.hasDataForBand(d))return;const{bytes:y,tileSize:v,buffer:b,offset:E,scale:A}=m.getBandView(d),M=v+2*b,O=new o.q({width:M,height:M},y),z=this.texturePerLayer.get(s);z&&z instanceof o.T&&z.update(O,{premultiply:!1}),this.textureDescriptorPerLayer.set(s,{layer:t,band:d,img:O,buffer:b,offset:E,tileSize:v,format:m.pixelFormat,mix:[A,256*A,65536*A,16777216*A]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const s of this.texturePerLayer.values())s&&s instanceof o.T&&s.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class ov{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,d){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:s,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const d=t.wrapped().key,m=s===void 0?0:this.data[d].indexOf(s),y=this.data[d][m];return this.data[d].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const d in this.data)for(const m of this.data[d])t(m.value)||s.push(m);for(const d of s)this.remove(d.value.tileID,d)}}class Pd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,d){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},Object.assign(this.stateChanges[t][m],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==m&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const y in this.state[t][m])d[y]||(this.deletedStates[t][m][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][y]===null&&delete this.deletedStates[t][m][y]}removeFeatureState(t,s,d){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][d]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(d in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][d]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const d=this.state[t]||{},m=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(s!==void 0){const b=String(s),E=Object.assign({},d[b],m[b]);if(y){const A=y[s];if(A===null)return{};for(const M in A)delete E[M]}return E}const v=Object.assign({},d,m);if(y)for(const b in y)delete v[b];return v}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),Object.assign(this.state[m][v],this.stateChanges[m][v]),y[v]=this.state[m][v];d[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const v in this.state[m])y[v]={},this.state[m][v]={};else for(const v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else if(this.state[m][v])for(const b of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][b];y[v]=this.state[m][v]}d[m]=d[m]||{},Object.assign(d[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class os extends o.E{constructor(t,s,d){super(),this.id=t,this._onlySymbols=d,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new ov(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const d=this._tiles[s];d.upload(t,this.map?this.map.painter:void 0),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(hf).map(t=>t.key)}getRenderableIds(t,s){const d=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&d.push(this._tiles[m]);return t?d.sort((m,y)=>{const v=m.tileID,b=y.tileID,E=new o.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),A=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-b.overscaledZ||A.y-E.y||A.x-E.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(hf).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=s),this._loadTile(d,this._tileLoaded.bind(this,d,t,s)))}_tileLoaded(t,s,d,m,y){if(m){if(t.state="errored",m.status!==404)this._source.fire(new o.y(m,{tile:t}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=o.o.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let v=new Map;y&&y.responseHeaders&&(v=y.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:v}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const y=s[m];if(t.neighboringTiles&&t.neighboringTiles[y]){const v=this.getTileByID(y);d(t,v),d(v,t)}}function d(m,y){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let v=y.tileID.canonical.x-m.tileID.canonical.x;const b=y.tileID.canonical.y-m.tileID.canonical.y,E=Math.pow(2,m.tileID.canonical.z),A=y.tileID.key;v===0&&b===0||Math.abs(b)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,v,b),m.neighboringTiles&&m.neighboringTiles[A]&&(m.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,d,m){for(const y in this._tiles){let v=this._tiles[y];if(m[y]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>d)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const A=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[A.key],v&&v.hasData()&&(b=A)}let E=b;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){m[b.key]=b;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=s?d:null}for(let d=t.overscaledZ-1;d>=s;d--){const m=t.scaledTo(d),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const d=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,y=Math.floor(d*m*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(b)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const d={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),d[y.tileID.key]=y}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,d,m,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let b,E=this._source.maxzoom;const A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){const z=A.attenuationRange()[0],F=Math.floor(z)-Math.log2(A.getDemUpscale());E>F&&(E=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)b=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new o.aQ(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=t.clone();z.tileCoverLift=this.tileCoverLift,b=z.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(b.push(new o.aQ(1,0,1,0,0)),b.push(new o.aQ(1,0,1,1,0)),b.push(new o.aQ(1,0,1,0,1)),b.push(new o.aQ(1,0,1,1,1)))}else if(b=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);b=b.filter(F=>z(F))}}else b=[];if(b.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Sc(this._source.type)){const z=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),F=Math.min(z,this._source.maxzoom);if(v){const V=t.extendTileCover(b,F);for(const U of V)b.push(U)}else if(y){const V=t.extendTileCoverToNearPlane(b,this.transform.getFrustum(F),F);for(const U of V)b.push(U)}else if(this.castsShadows&&m){const V=t.extendTileCover(b,F,m,16);for(const U of V)this._shadowCasterTiles[U.key]=!0,b.push(U)}}const M=this._updateRetainedTiles(b);if(Sc(this._source.type)&&b.length!==0){const z={},F={},V=Object.keys(M);for(const X of V){const Z=M[X],ne=this._tiles[X];if(!ne||ne.fadeEndTime&&ne.fadeEndTime<=o.o.now())continue;const ae=this.findLoadedParent(Z,Math.max(Z.overscaledZ-os.maxOverzooming,this._source.minzoom));ae&&(this._addTile(ae.tileID),z[ae.tileID.key]=ae.tileID),F[X]=Z}const U=b[b.length-1].overscaledZ;for(const X in this._tiles){const Z=this._tiles[X];if(M[X]||!Z.hasData())continue;let ne=Z.tileID;for(;ne.overscaledZ>U;){ne=ne.scaledTo(ne.overscaledZ-1);const ae=this._tiles[ne.key];if(ae&&ae.hasData()&&F[ne.key]){M[X]=Z.tileID;break}}}for(const X in z)M[X]||(this._coveredTiles[X]=!0,M[X]=z[X])}for(const z in M)this._tiles[z].clearFadeHold();const O=o.bv(this._tiles,M);for(const z of O){const F=this._tiles[z];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const d={},m=t.reduce((A,M)=>Math.min(A,M.overscaledZ),1/0),y=t[0].overscaledZ,v=Math.max(y-os.maxOverzooming,this._source.minzoom),b=Math.max(y+os.maxUnderzooming,this._source.minzoom),E={};for(const A of t){const M=this._addTile(A);s[A.key]=A,M.hasData()||m<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,m,b,s);for(const A of t){let M=this._tiles[A.key];if(M.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const z=A.children(this._source.maxzoom)[0],F=this.getTile(z);if(F&&F.hasData()){s[z.key]=z;continue}}else{const z=A.children(this._source.maxzoom);if(s[z[0].key]&&s[z[1].key]&&s[z[2].key]&&s[z[3].key])continue}let O=M.wasRequested();for(let z=A.overscaledZ-1;z>=v;--z){const F=A.scaledTo(z);if(d[F.key]||(d[F.key]=!0,M=this.getTile(F),!M&&O&&(M=this._addTile(F)),M&&(s[F.key]=F,O=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let d,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}s.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;m=y}for(const y of s)this._loadedParentTiles[y]=d}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const d=!!s;if(!d){const m=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new df(t,y,this.transform.tileZoom,m,this._isRaster):new Tc(t,y,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,d||this._source.fire(new o.z("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=s.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,d){const m=[],y=this.transform;if(!y)return m;const v=y.projection.name==="globe",b=o.aF(y.center.lng);for(const E in this._tiles){const A=this._tiles[E];if(d&&A.clearQueryDebugViz(),A.holdingForFade())continue;let M;if(v){const O=A.tileID.canonical;if(O.z===0){const z=[Math.abs(o.aA(b,...Ka(O,-1))-b),Math.abs(o.aA(b,...Ka(O,1))-b)];M=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(o.aA(b,...Ka(O,-1))-b),Math.abs(o.aA(b,...Ka(O,0))-b),Math.abs(o.aA(b,...Ka(O,1))-b)];M=[z.indexOf(Math.min(...z))-1]}}else M=[0];for(const O of M){const z=t.containsTile(A,y,s,O);z&&m.push(z)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const d=this.getRenderableIds(t,s).map(y=>this._tiles[y].tileID),m=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=m?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){const s=t.slice(),d=this.transform._camera.position,m=this.transform._camera.forward(),y={};for(const v of s){const b=1/(1<<v.canonical.z);y[v.key]=((v.canonical.x+.5)*b+v.wrap-d[0])*m[0]+((v.canonical.y+.5)*b-d[1])*m[1]-d[2]*m[2]}return s.sort((v,b)=>y[v.key]-y[b.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Sc(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(t,s,d){this._state.updateState(t=t||"_geojsonTileLayer",s,d)}removeFeatureState(t,s,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,d)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,d){const m=this._tiles[t];m&&m.setDependencies(s,d)}reloadTilesForDependencies(t,s){for(const d in this._tiles)this._tiles[d].hasDependency(t,s)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(t,s))};return void this._source.on("data",E)}const d=new Map,m=Array.isArray(t)?t:[t],y=this.map.painter.terrain,v=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const E of m){const A=E.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of A)d.set(M.key,M);this.usedForTerrain&&E.updateElevation(!1)}const b=Array.from(d.values());o.bw(b,(E,A)=>{const M=new Tc(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(M,O=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),A(O,M)})},s)}}function hf(u,t){const s=Math.abs(2*u.wrap)-+(u.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||d-s||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Sc(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Ka(u,t){const s=1<<u.z;return[u.x/s+t,(u.x+1)/s+t]}os.maxOverzooming=10,os.maxUnderzooming=3;class xw{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const d in this.style._mergedLayers){const m=this.style._mergedLayers[d];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const y=this.style.getLayerSource(m);y&&y.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const d=s.layer;let m=!1;d.type==="fill-extrusion"?m=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?m=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(m=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const y=m.layer,v=this.style.getLayerSourceCache(y);let b=1;y.type==="fill-extrusion"?b=m.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(b=m.visible?y.paint.get("building-vertical-scale"):0);let E=v?v.getTile(s):null;if(!E&&v)for(const A in v._tiles){const M=v._tiles[A];if(s.canonical.isChildOf(M.tileID.canonical)){E=M;break}}this.currentBuildingBuckets.push({bucket:E?E.getBucket(y):null,tileID:E?E.tileID:s,verticalScale:b})}t.hasAnyZOffset=!1;let d=!1;for(let m=0;m<t.symbolInstances.length;m++){const y=t.symbolInstances.get(m),v=y.zOffset,b=this._getHeightAtTileOffset(s,y.tileAnchorX,y.tileAnchorY);y.zOffset=b!==Number.NEGATIVE_INFINITY?b:v,d||v===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,d,m){let y=s,v=d;if(t.canonical.z!==m.canonical.z){const b=m.canonical,E=1/(1<<t.canonical.z-b.z);y=(s+t.canonical.x*o.al)*E-b.x*o.al|0,v=(d+t.canonical.y*o.al)*E-b.y*o.al|0}return{tileX:y,tileY:v}}_getHeightAtTileOffset(t,s,d){let m,y;for(let v=0;v<this.layers.length;++v){const b=this.layers[v].layer;if(b.type!=="fill-extrusion"&&b.type!=="building")continue;const{bucket:E,tileID:A,verticalScale:M}=this.currentBuildingBuckets[v];if(!E)continue;const{tileX:O,tileY:z}=this._mapCoordToOverlappingTile(t,s,d,A),F=E.getHeightAtTileCoord(O,z);F&&F.height!==void 0&&(F.hidden?m=F.height:y=Math.max(F.height*M,y||0))}if(y!==void 0)return y;for(let v=0;v<this.layers.length;++v){const b=this.layers[v];if(b.layer.type!=="model"||!b.visible)continue;const{bucket:E,tileID:A}=this.currentBuildingBuckets[v];if(!E)continue;const{tileX:M,tileY:O}=this._mapCoordToOverlappingTile(t,s,d,A),z=E.getHeightAtTileCoord(M,O);if(z&&!z.hidden)return z.height===void 0&&m!==void 0?Math.min(z.maxHeight,m)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function sv(u,t){const s={};for(const d in u)d!=="ref"&&(s[d]=u[d]);return o.bx.forEach(d=>{d in t&&(s[d]=t[d])}),s}function Md(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=sv(u[s],t[u[s].ref]));return u}const ii={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ff(u,t,s){s.push({command:ii.addSource,args:[u,t[u]]})}function Km(u,t,s){t.push({command:ii.removeSource,args:[u]}),s[u]=!0}function av(u,t,s,d){Km(u,s,d),ff(u,t,s)}function lv(u,t,s){let d;for(d in u[s])if(u[s].hasOwnProperty(d)&&d!=="data"&&!o.by(u[s][d],t[s][d]))return!1;for(d in t[s])if(t[s].hasOwnProperty(d)&&d!=="data"&&!o.by(u[s][d],t[s][d]))return!1;return!0}function Fl(u,t,s,d,m,y){let v;for(v in t=t||{},u=u||{})u.hasOwnProperty(v)&&(o.by(u[v],t[v])||s.push({command:y,args:[d,v,t[v],m]}));for(v in t)t.hasOwnProperty(v)&&!u.hasOwnProperty(v)&&(o.by(u[v],t[v])||s.push({command:y,args:[d,v,t[v],m]}))}function Rd(u){return u.id}function Dd(u,t){return u[t.id]=t,u}function Qm(u,t,s){const d=t.createTileMatrix(u,u.worldSize,s.toUnwrapped());return o.aB(new Float32Array(16),u.projMatrix,d)}function pf(u,t,s){if(t.projection.name===s.projection.name)return u.projMatrix;const d=s.clone();return d.setProjection(t.projection),Qm(d,t.getProjection(),u)}function Aa(u,t,s){return t.name===s.projection.name?u.projMatrix:Qm(s,t,u)}class Ld{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aA(t,0,1);let s=1,d=this._distances[s];const m=t*this.paddedLength+this.padding;for(;d<m&&s<this._distances.length;)d=this._distances[++s];const y=s-1,v=this._distances[y],b=d-v,E=b>0?(m-v)/b:0;return this.points[y].mult(1-E).add(this.points[s].mult(E))}}class Jm{constructor(t,s,d){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(s/d);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,d,m,y){this._forEachCell(s,d,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,s,d,m){this._forEachCell(s-m,d-m,s+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(d),this.circles.push(m)}_insertBoxCell(t,s,d,m,y,v){this.boxCells[y].push(v)}_insertCircleCell(t,s,d,m,y,v){this.circleCells[y].push(v)}_query(t,s,d,m,y,v){if(d<0||t>this.width||m<0||s>this.height)return!y&&[];const b=[];if(t<=0&&s<=0&&this.width<=d&&this.height<=m){if(y)return!0;for(let E=0;E<this.boxKeys.length;E++)b.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const A=this.circles[3*E],M=this.circles[3*E+1],O=this.circles[3*E+2];b.push({key:this.circleKeys[E],x1:A-O,y1:M-O,x2:A+O,y2:M+O})}return v?b.filter(v):b}return this._forEachCell(t,s,d,m,this._queryCell,b,{hitTest:y,seenUids:{box:{},circle:{}}},v),y?b.length>0:b}_queryCircle(t,s,d,m,y){const v=t-d,b=t+d,E=s-d,A=s+d;if(b<0||v>this.width||A<0||E>this.height)return!m&&[];const M=[];return this._forEachCell(v,E,b,A,this._queryCellCircle,M,{hitTest:m,circle:{x:t,y:s,radius:d},seenUids:{box:{},circle:{}}},y),m?M.length>0:M}query(t,s,d,m,y){return this._query(t,s,d,m,!1,y)}hitTest(t,s,d,m,y){return this._query(t,s,d,m,!0,y)}hitTestCircle(t,s,d,m){return this._queryCircle(t,s,d,!0,m)}_queryCell(t,s,d,m,y,v,b,E){const A=b.seenUids,M=this.boxCells[y];if(M!==null){const z=this.bboxes;for(const F of M)if(!A.box[F]){A.box[F]=!0;const V=4*F;if(t<=z[V+2]&&s<=z[V+3]&&d>=z[V+0]&&m>=z[V+1]&&(!E||E(this.boxKeys[F]))){if(b.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[F],x1:z[V],y1:z[V+1],x2:z[V+2],y2:z[V+3]})}}}const O=this.circleCells[y];if(O!==null){const z=this.circles;for(const F of O)if(!A.circle[F]){A.circle[F]=!0;const V=3*F;if(this._circleAndRectCollide(z[V],z[V+1],z[V+2],t,s,d,m)&&(!E||E(this.circleKeys[F]))){if(b.hitTest)return v.push(!0),!0;{const U=z[V],X=z[V+1],Z=z[V+2];v.push({key:this.circleKeys[F],x1:U-Z,y1:X-Z,x2:U+Z,y2:X+Z})}}}}}_queryCellCircle(t,s,d,m,y,v,b,E){const A=b.circle,M=b.seenUids,O=this.boxCells[y];if(O!==null){const F=this.bboxes;for(const V of O)if(!M.box[V]){M.box[V]=!0;const U=4*V;if(this._circleAndRectCollide(A.x,A.y,A.radius,F[U+0],F[U+1],F[U+2],F[U+3])&&(!E||E(this.boxKeys[V])))return v.push(!0),!0}}const z=this.circleCells[y];if(z!==null){const F=this.circles;for(const V of z)if(!M.circle[V]){M.circle[V]=!0;const U=3*V;if(this._circlesCollide(F[U],F[U+1],F[U+2],A.x,A.y,A.radius)&&(!E||E(this.circleKeys[V])))return v.push(!0),!0}}}_forEachCell(t,s,d,m,y,v,b,E){const A=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),O=this._convertToXCellCoord(d),z=this._convertToYCellCoord(m);for(let F=A;F<=O;F++)for(let V=M;V<=z;V++)if(y.call(this,t,s,d,m,this.xCellCount*V+F,v,b,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,d,m,y,v){const b=m-t,E=y-s,A=d+v;return A*A>b*b+E*E}_circleAndRectCollide(t,s,d,m,y,v,b){const E=(v-m)/2,A=Math.abs(t-(m+E));if(A>E+d)return!1;const M=(b-y)/2,O=Math.abs(s-(y+M));if(O>M+d)return!1;if(A<=E||O<=M)return!0;const z=A-E,F=O-M;return z*z+F*F<=d*d}}const Nl={unknown:0,flipRequired:1,flipNotRequired:2},Ec=Math.tan(85*Math.PI/180);function Lo(u,t,s,d,m,y,v){const b=o.bC();if(s)if(y.name==="globe"){const E=o.bD(m,t);o.aB(b,b,E)}else{const E=o.bE([],v);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3],d||o.bB(b,b,m.angle)}else o.aB(b,m.labelPlaneMatrix,u);return b}function mf(u,t,s,d,m,y,v){const b=Lo(u,t,s,d,m,y,v);return y.name==="globe"&&s||(b[2]=b[6]=b[10]=b[14]=0),b}function kd(u,t,s,d,m,y,v){if(s){if(y.name==="globe"){const b=Lo(u,t,s,d,m,y,v);return o.bl(b,b),o.aB(b,u,b),b}{const b=o.bz(u),E=o.bA([]);return E[0]=v[0],E[1]=v[1],E[4]=v[2],E[5]=v[3],o.aB(b,b,E),d||o.bB(b,b,-m.angle),b}}return m.glCoordMatrix}function Fs(u,t,s,d){const m=[u,t,s,1];s?o.aC(m,m,d):tn(m,m,d);const y=m[3];return m[0]/=y,m[1]/=y,m[2]/=y,m}function vi(u,t){return Math.min(.5+u/t*.5,1.5)}function cv(u,t){const s=u[0]/u[3],d=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&d>=-t[1]&&d<=t[1]}function uv(u,t,s,d,m,y,v,b,E,A,M=1){const O=s.transform,z=d?u.textSizeData:u.iconSizeData,F=o.bK(z,s.transform.zoom,M),V=O.projection.name==="globe",U=[256/s.width*2+1,256/s.height*2+1],X=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;X.clear();let Z=null;V&&(Z=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const ne=u.lineVertexArray,ae=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,re=s.transform.width/s.transform.height;let we,ge=!1;for(let ve=0;ve<ae.length;ve++){const me=ae.get(ve),{numGlyphs:he,writingMode:Se}=me;if(Se!==o.bL.vertical||ge||we===o.bL.horizontal||(ge=!0),we=Se,(me.hidden||Se===o.bL.vertical)&&!ge){oa(he,X);continue}ge=!1;const Le=new o.P(me.tileAnchorX,me.tileAnchorY),Re=u.elevationType==="road",qe=!!O.elevation||Re;let{x:Ze,y:tt,z:_t}=O.projection.projectTilePoint(Le.x,Le.y,A.canonical),Ue=null;if(qe){const Ft=Re?u.getElevationFeatureForText(ve):null;Ue={getElevation:E,elevation:O.elevation,elevationFeature:Ft};const[sn,Tn,Gn]=E(Le,O.elevation,Ft);Ze+=sn,tt+=Tn,_t+=Gn}const Ae=[Ze,tt,_t,1];if(o.aC(Ae,Ae,t),!cv(Ae,U)){oa(he,X);continue}const Ke=Ae[3],$e=vi(s.transform.getCameraToCenterDistance(O.projection),Ke),lt=o.bM(z,F,me),Ct=v?lt/$e:lt*$e,zt=Fs(Ze,tt,_t,m);if(zt[3]<=0){oa(he,X);continue}let St={};const yt=o.an(u.layers[0].layout.get("text-max-angle")),Xt=Math.cos(yt),Ut=v?null:Ue,Dt=eg(me,Ct,!1,b,t,m,y,u.glyphOffsetArray,ne,X,Z,zt,Le,St,re,Ut,O.projection,A,v,Xt);ge=Dt.useVertical,Ut&&Dt.needsFlipping&&(St={}),(Dt.notEnoughRoom||ge||Dt.needsFlipping&&eg(me,Ct,!0,b,t,m,y,u.glyphOffsetArray,ne,X,Z,zt,Le,St,re,Ut,O.projection,A,v,Xt).notEnoughRoom)&&oa(he,X)}d?(u.text.dynamicLayoutVertexBuffer.updateData(X),Z&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(Z)):(u.icon.dynamicLayoutVertexBuffer.updateData(X),Z&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(Z))}function dv(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X){const{lineStartIndex:Z,glyphStartIndex:ne,segment:ae}=b,re=ne+b.numGlyphs,we=Z+b.lineLength,ge=t.getoffsetX(ne),ve=t.getoffsetX(re-1),me=du(u*ge,s,d,m,y,v,ae,Z,we,E,A,M,O,z,!0,F,V,U,X);if(!me)return null;const he=du(u*ve,s,d,m,y,v,ae,Z,we,E,A,M,O,z,!0,F,V,U,X);return he?{first:me,last:he}:null}function fn(u,t,s,d){return u===o.bL.horizontal&&Math.abs(d)>Math.abs(s)?{useVertical:!0}:u===o.bL.vertical?d>0?{needsFlipping:!0}:null:t!==Nl.unknown&&function(m,y){return m===0||Math.abs(y/m)>Ec}(s,d)?t===Nl.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function eg(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne,ae){const re=t/24,we=u.lineOffsetX*re,ge=u.lineOffsetY*re,{lineStartIndex:ve,glyphStartIndex:me,numGlyphs:he,segment:Se,writingMode:Le,flipState:Re}=u,qe=ve+u.lineLength,Ze=tt=>{if(M){const[Ke,$e,lt]=tt.up,Ct=A.length;o.bN(M,Ct+0,Ke,$e,lt),o.bN(M,Ct+1,Ke,$e,lt),o.bN(M,Ct+2,Ke,$e,lt),o.bN(M,Ct+3,Ke,$e,lt)}const[_t,Ue,Ae]=tt.point;o.bO(A,_t,Ue,Ae,tt.angle)};if(he>1){const tt=dv(re,b,we,ge,s,O,z,u,E,y,F,U,!1,X,Z,ne,ae);if(!tt)return{notEnoughRoom:!0};if(d&&!s){let[_t,Ue,Ae]=tt.first.point,[Ke,$e,lt]=tt.last.point;[_t,Ue]=Fs(_t,Ue,Ae,v),[Ke,$e]=Fs(Ke,$e,lt,v);const Ct=fn(Le,Re,(Ke-_t)*V,$e-Ue);if(u.flipState=Ct&&Ct.needsFlipping?Nl.flipRequired:Nl.flipNotRequired,Ct)return Ct}Ze(tt.first);for(let _t=me+1;_t<me+he-1;_t++){const Ue=du(re*b.getoffsetX(_t),we,ge,s,O,z,Se,ve,qe,E,y,F,U,!1,!1,X,Z,ne,ae);if(!Ue)return A.length-=4*(_t-me),{notEnoughRoom:!0};Ze(Ue)}Ze(tt.last)}else{if(d&&!s){const _t=Fs(z.x,z.y,0,m),Ue=ve+Se+1,Ae=new o.P(E.getx(Ue),E.gety(Ue)),Ke=Fs(Ae.x,Ae.y,0,m),$e=Ke[3]>0?Ke:Ns(z,Ae,_t,1,m,void 0,X,Z.canonical),lt=fn(Le,Re,($e[0]-_t[0])*V,$e[1]-_t[1]);if(u.flipState=lt&&lt.needsFlipping?Nl.flipRequired:Nl.flipNotRequired,lt)return lt}const tt=du(re*b.getoffsetX(me),we,ge,s,O,z,Se,ve,qe,E,y,F,U,!1,!1,X,Z,ne,ae);if(!tt)return{notEnoughRoom:!0};Ze(tt)}return{}}function zd(u,t,s,d,m){const{x:y,y:v,z:b}=d.projectTilePoint(u.x,u.y,t);if(!m)return Fs(y,v,b,s);const[E,A,M]=m.getElevation(u,m.elevation,m.elevationFeature);return Fs(y+E,v+A,b+M,s)}function Ns(u,t,s,d,m,y,v,b){const E=zd(u.sub(t)._unit()._add(u),b,m,v,y);return o.av(E,s,E),o.aw(E,E),o.bH(E,s,E,d)}function du(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne){const ae=d?u-t:u+t;let re=ae>0?1:-1,we=0;d&&(re*=-1,we=Math.PI),re<0&&(we+=Math.PI);let ge=b+v+(re>0?0:1)|0,ve=m,me=m,he=0,Se=0;const Le=Math.abs(ae),Re=[],qe=[];let Ze=y,tt=Ze,_t=o.bF([]);const Ue=()=>Ns(tt,Ze,me,Le-he+1,M,z,U,X.canonical);for(;he+Se<=Le;){if(ge+=re,ge<b||ge>=E)return null;if(me=ve,tt=Ze,Re.push(me),F&&qe.push(tt),Ze=new o.P(A.getx(ge),A.gety(ge)),ve=O[ge],!ve){const Ut=zd(Ze,X.canonical,M,U,z);ve=Ut[3]>0?O[ge]=Ut:Ue()}he+=Se;const yt=o.av([],ve,me),Xt=o.bG(me,ve);if(s&&Xt>0&&Se>0&&o.bJ(_t,yt)/(Se*Xt)<ne)return null;Se=Xt,_t=yt}V&&z&&(O[ge]&&(ve=Ue(),Se=o.bG(me,ve),_t=o.av([],ve,me)),O[ge]=ve);const Ae=(Le-he)/Se,Ke=Ze.sub(tt)._mult(Ae)._add(tt),$e=o.bH([],me,_t,Ae);let lt=[0,0,1],Ct=_t[0],zt=_t[1];if(Z&&(lt=U.upVector(X.canonical,Ke.x,Ke.y),lt[0]!==0||lt[1]!==0||lt[2]!==1)){const yt=[lt[2],0,-lt[0]],Xt=o.bI([],lt,yt);o.aw(yt,yt),o.aw(Xt,Xt),Ct=o.bJ(_t,yt),zt=o.bJ(_t,Xt)}if(s){const yt=o.bI([],lt,_t);o.aw(yt,yt),o.bH($e,$e,yt,s*re)}const St=we+Math.atan2(zt,Ct);return Re.push($e),F&&qe.push(Ke),{point:$e,angle:St,path:Re,tilePath:qe,up:lt}}function oa(u,t){const s=t.length,d=s+4*u;t.resize(d),t.float32.fill(-1/0,4*s,4*d)}function tn(u,t,s){const d=t[0],m=t[1];return u[0]=s[0]*d+s[4]*m+s[12],u[1]=s[1]*d+s[5]*m+s[13],u[3]=s[3]*d+s[7]*m+s[15],u}const Xn=100;class Ti{constructor(t,s,d=new Jm(t.width+200,t.height+200,25),m=new Jm(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Xn,this.screenBottomBoundary=t.height+Xn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,d,m,y,v,b,E,A,M,O){let z=d.projectedAnchorX,F=d.projectedAnchorY,V=d.projectedAnchorZ;const U=d.tileAnchorX,X=d.tileAnchorY,Z=d.elevation,ne=d.tileID,ae=t.getProjection();if(Z&&ne){const[qe,Ze,tt]=ae.upVector(ne.canonical,d.tileAnchorX,d.tileAnchorY),_t=ae.upVectorScale(ne.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=qe*Z*_t,F+=Ze*Z*_t,V+=tt*Z*_t}const re=t.projection.name==="globe",we=t.projection.name==="globe"?o.aj(this.transform.zoom):0;if(ne&&re&&we<1&&!v){const qe=1<<ne.canonical.z,Ze=o.bP(U,X);o.bQ(Ze,Ze,1/o.al),o.bR(Ze,Ze,o.bP(ne.canonical.x,ne.canonical.y)),o.bQ(Ze,Ze,1/qe),o.bS(Ze,Ze,o.bP(m[0],m[1])),Ze[0]=o.bT(Ze[0],-.5,.5),o.bQ(Ze,Ze,o.al);const tt=o.bU(Ze[0],Ze[1],o.al/(2*Math.PI),1);o.aC(tt,tt,y),z=o.ak(z,tt[0],we),F=o.ak(F,tt[1],we),V=o.ak(V,tt[2],we)}const ge=this.projectAndGetPerspectiveRatio(M,z,F,V,d.tileID,ae.name==="globe"||!!Z||this.transform.pitch>0,ae),ve=A*ge.perspectiveRatio,me=(d.x1*s+b.x-d.padding)*ve+ge.point.x,he=(d.y1*s+b.y-d.padding)*ve+ge.point.y,Se=(d.x2*s+b.x+d.padding)*ve+ge.point.x,Le=(d.y2*s+b.y+d.padding)*ve+ge.point.y,Re=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(me,he,Se,Le)||!E&&this.grid.hitTest(me,he,Se,Le,O)||Re?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[me,he,Se,Le],offscreen:this.isOffscreen(me,he,Se,Le),occluded:!1}}placeCollisionCircles(t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X){const Z=[],ne=this.transform.elevation,ae=t.getProjection(),re=t.elevationType==="road",we=!!ne||re,ge=o.bV.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,ae),ve=new o.P(d.tileAnchorX,d.tileAnchorY),me=new o.P(d.tileAnchorX,d.tileAnchorY);let{x:he,y:Se,z:Le}=ae.projectTilePoint(me.x,me.y,X.canonical),Re=null;if(we){const Xt=re?t.getElevationFeatureForText(m):null;Re={getElevation:ge,elevation:ne,elevationFeature:Xt};const[Ut,Dt,Ft]=ge(ve,ne,Xt);he+=Ut,Se+=Dt,Le+=Ft}const qe=ae.name==="globe",Ze=this.projectAndGetPerspectiveRatio(E,he,Se,Le,X,qe||!!ne||this.transform.pitch>0,ae),{perspectiveRatio:tt}=Ze,_t=(z?b/tt:b*tt)/o.bY,Ue=Fs(he,Se,Le,A),Ae=d.lineOffsetX*_t,Ke=d.lineOffsetY*_t,$e=o.an(t.layers[0].layout.get("text-max-angle")),lt=Math.cos($e),Ct=Ze.signedDistanceFromCamera>0?dv(_t,v,Ae,Ke,re&&d.flipState===1,Ue,me,d,y,A,{},we&&!z?Re:null,z&&we,ae,X,z,lt):null;let zt=!1,St=!1,yt=!0;if(Ct&&!Ze.occluded){const Xt=.5*V*tt+U,Ut=new o.P(-100,-100),Dt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ft=new Ld,{first:sn,last:Tn}=Ct,Gn=sn.path.length;let ci=[];for(let wn=Gn-1;wn>=1;wn--)ci.push(sn.path[wn]);for(let wn=1;wn<Tn.path.length;wn++)ci.push(Tn.path[wn]);const Yt=2.5*Xt;M&&(ci=ci.map(([wn,pi,Si],xi)=>(we&&!qe&&(Si=ge(xi<Gn-1?sn.tilePath[Gn-1-xi]:Tn.tilePath[xi-Gn+2],ne,Re.elevationFeature)[2]),Fs(wn,pi,Si,M))),ci.some(wn=>wn[3]<=0)&&(ci=[]));let oi=[];if(ci.length>0){let wn=1/0,pi=-1/0,Si=1/0,xi=-1/0;for(const ri of ci)wn=Math.min(wn,ri[0]),Si=Math.min(Si,ri[1]),pi=Math.max(pi,ri[0]),xi=Math.max(xi,ri[1]);pi>=Ut.x&&wn<=Dt.x&&xi>=Ut.y&&Si<=Dt.y&&(oi=[ci.map(ri=>new o.P(ri[0],ri[1]))],(wn<Ut.x||pi>Dt.x||Si<Ut.y||xi>Dt.y)&&(oi=o.bW(oi,Ut.x,Ut.y,Dt.x,Dt.y)))}for(const wn of oi){Ft.reset(wn,.25*Xt);let pi=0;pi=Ft.length<=.5*Xt?1:Math.ceil(Ft.paddedLength/Yt)+1;for(let Si=0;Si<pi;Si++){const xi=Si/Math.max(pi-1,1),ri=Ft.lerp(xi),Dn=ri.x+Xn,di=ri.y+Xn;Z.push(Dn,di,Xt,0);const ar=Dn-Xt,Zi=di-Xt,mi=Dn+Xt,ei=di+Xt;if(yt=yt&&this.isOffscreen(ar,Zi,mi,ei),St=St||this.isInsideGrid(ar,Zi,mi,ei),!s&&this.grid.hitTestCircle(Dn,di,Xt,F)&&(zt=!0,!O))return{circles:[],offscreen:!1,collisionDetected:zt,occluded:!1}}}}return{circles:!O&&zt||!St?[]:Z,offscreen:yt,collisionDetected:zt,occluded:Ze.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let d=1/0,m=1/0,y=-1/0,v=-1/0;for(const M of t){const O=new o.P(M.x+Xn,M.y+Xn);d=Math.min(d,O.x),m=Math.min(m,O.y),y=Math.max(y,O.x),v=Math.max(v,O.y),s.push(O)}const b=this.grid.query(d,m,y,v).concat(this.ignoredGrid.query(d,m,y,v)),E={},A={};for(const M of b){const O=M.key;if(E[O.bucketInstanceId]===void 0&&(E[O.bucketInstanceId]={}),E[O.bucketInstanceId][O.featureIndex])continue;const z=[new o.P(M.x1,M.y1),new o.P(M.x2,M.y1),new o.P(M.x2,M.y2),new o.P(M.x1,M.y2)];o.bX(s,z)&&(E[O.bucketInstanceId][O.featureIndex]=!0,A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]=[]),A[O.bucketInstanceId].push(O.featureIndex))}return A}insertCollisionBox(t,s,d,m,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,d,m,y){const v=s?this.ignoredGrid:this.grid,b={bucketInstanceId:d,featureIndex:m,collisionGroupID:y};for(let E=0;E<t.length;E+=4)v.insertCircle(b,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,s,d,m,y,v,b){const E=[s,d,m,1];let A=!1;m||this.transform.pitch>0?(o.aC(E,E,t),this.fogState&&y&&b.name!=="globe"&&(A=function(z,F,V,U,X,Z){const ne=Z.calculateFogTileMatrix(X),ae=[F,V,U];return o.af(ae,ae,ne),Bt(z,o.ag(ae),Z.pitch,Z._fov)}(this.fogState,s,d,m,y.toUnwrapped(),this.transform)>.9)):tn(E,E,t);const M=E[3];return{point:new o.P((E[0]/M+1)/2*this.transform.width+Xn,(-E[1]/M+1)/2*this.transform.height+Xn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/M*.5,1.5),signedDistanceFromCamera:M,occluded:v&&E[2]>M||A}}isOffscreen(t,s,d,m){return d<Xn||t>=this.screenRightBoundary||m<Xn||s>this.screenBottomBoundary}isInsideGrid(t,s,d,m){return d>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.bA([]);return o.br(t,t,[-100,-100,0]),t}}class Yo{constructor(t,s,d,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Pa{constructor(t,s,d,m,y,v=!1){this.text=new Yo(t?t.text:null,s,d,y),this.icon=new Yo(t?t.icon:null,s,m,y),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yi{constructor(t,s,d,m=!1){this.text=t,this.icon=s,this.skipFade=d,this.clipped=m}}class gf{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class Od{constructor(t,s,d,m,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=y}}class Fd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[t]}}function So(u,t,s,d,m){const{horizontalAlign:y,verticalAlign:v}=o.c1(u),b=-(y-.5)*t,E=-(v-.5)*s,A=o.c2(u,d);return new o.P(b+A[0]*m,E+A[1]*m)}function Mr(u,t,s,d,m){const y=new o.P(u,t);return s&&y._rotate(d?m:-m),y}class ww{constructor(t,s,d,m,y,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Ti(this.transform,y),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Fd(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,s,d,m,y=1){const v=d.getBucket(s),b=d.latestFeatureIndex;if(!v||!b||s.fqid!==v.layerIds[0])return;const E=v.layers[0].layout,A=v.layers[0].paint,M=d.collisionBoxArray,O=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/o.al,F=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const V=(U=d.tileID,X=v.getProjection(),Z=this.transform,X.name===this.projection?Z.calculateProjMatrix(U.toUnwrapped()):Qm(Z,X,U));var U,X,Z;const ne=E.get("text-pitch-alignment")==="map",ae=E.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const re=s.dynamicFilter(),we=s.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(d),ve=mf(V,d.tileID.canonical,ne,ae,this.transform,v.getProjection(),ge);let me=null;const he=v.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(ne){const Ae=kd(V,d.tileID.canonical,ne,ae,this.transform,v.getProjection(),ge);me=o.aB([],this.transform.labelPlaneMatrix,Ae)}let Se=null;re&&d.latestFeatureIndex&&(Se={unwrappedTileID:F,dynamicFilter:re,dynamicFilterNeedsFeature:we}),this.retainedQueryData[v.bucketInstanceId]=new Od(v.bucketInstanceId,b,v.sourceLayerIndex,v.index,d.tileID);const[Le,Re]=v.layers[0].layout.get("text-size-scale-range"),qe=o.aA(y,Le,Re),[Ze,tt]=E.get("icon-size-scale-range"),_t=o.aA(y,Ze,tt),Ue={bucket:v,layout:E,paint:A,posMatrix:V,invMatrix:he,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:me,clippingData:Se,scale:O,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.bK(v.textSizeData,this.transform.zoom,qe),partiallyEvaluatedIconSize:o.bK(v.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(m)for(const Ae of v.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:$e,symbolInstanceEnd:lt}=Ae;t.push({sortKey:Ke,symbolInstanceStart:$e,symbolInstanceEnd:lt,parameters:Ue})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne,ae,re,we){const{textOffset0:ge,textOffset1:ve,crossTileID:me}=U,he=[ge,ve],Se=So(t,v,b,he,E),Le=this.collisionIndex.placeCollisionBox(Z,E,s,d,m,y,Mr(Se.x,Se.y,A,M,this.transform.angle),V,O,z,F.predicate);if(ae){const Re=Z.getSymbolInstanceIconSize(we,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,Re,ae,d,m,y,Mr(Se.x,Se.y,A,M,this.transform.angle),V,O,z,F.predicate).box.length===0)return}if(Le.box.length>0){let Re;return this.prevPlacement&&this.prevPlacement.variableOffsets[me]&&this.prevPlacement.placements[me]&&this.prevPlacement.placements[me].text&&(Re=this.prevPlacement.variableOffsets[me].anchor),this.variableOffsets[me]={textOffset:he,width:v,height:b,anchor:t,textScale:E,prevAnchor:Re},this.markUsedJustification(Z,t,U,ne),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ne,U),this.placedOrientations[me]=ne),{shift:Se,placedGlyphBoxes:Le}}}placeLayerBucketPart(t,s,d,m,y=1){const{bucket:v,layout:b,paint:E,posMatrix:A,textLabelPlaneMatrix:M,labelToScreenMatrix:O,clippingData:z,textPixelRatio:F,mercatorCenter:V,invMatrix:U,holdingForFade:X,collisionBoxArray:Z,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:ae,collisionGroup:re,latestFeatureIndex:we}=t.parameters,ge=b.get("text-optional"),ve=b.get("icon-optional"),me=b.get("text-allow-overlap"),he=b.get("icon-allow-overlap"),Se=b.get("text-rotation-alignment")==="map",Le=b.get("icon-rotation-alignment")==="map",Re=b.get("text-pitch-alignment")==="map",qe=E.get("symbol-z-offset"),Ze=b.get("symbol-elevation-reference")==="sea",tt=b.get("symbol-placement"),[_t,Ue]=b.get("text-size-scale-range"),[Ae,Ke]=b.get("icon-size-scale-range"),$e=o.aA(y,_t,Ue),lt=o.aA(y,Ae,Ke),Ct=b.get("text-variable-anchor"),zt=Se&&tt!=="point",St=Le&&tt!=="point",yt=Ct&&v.hasTextData(),Xt=v.hasIconTextFit()&&yt&&v.hasIconData();this.transform.setProjection(v.projection);const Ut=yt||zt,Dt=St||Xt;let Ft=me&&(he||!v.hasIconData()||ve),sn=he&&(me||!v.hasTextData()||ge);const Tn=!qe.isConstant();!v.collisionArrays&&Z&&v.deserializeCollisionBoxes(Z),d&&m&&v.updateCollisionDebugBuffers(this.transform.zoom,Z,$e,lt);const Gn=(Yt,oi,wn)=>{const{crossTileID:pi,numVerticalGlyphVertices:Si}=Yt;let xi=null;if(z&&z.dynamicFilterNeedsFeature||Tn){const hr=this.retainedQueryData[v.bucketInstanceId];xi=we.loadFeature({featureIndex:Yt.featureIndex,bucketIndex:hr.bucketIndex,sourceLayerIndex:hr.sourceLayerIndex,layoutVertexArrayOffset:0});const wr=xi.properties?xi.properties.worldview:null;if(v.localizable&&v.worldview&&typeof wr=="string")if(wr==="all")xi.properties.$localized=!0;else{if(!wr.split(",").includes(v.worldview))return;xi.properties.$localized=!0,xi.properties.worldview=v.worldview}}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:v.worldview},xi,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.P(Yt.tileAnchorX,Yt.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[pi]=new yi(!1,!1,!1,!0),void s.add(pi);const ri=qe.evaluate(xi,{});if(s.has(pi))return;if(X)return void(this.placements[pi]=new yi(!1,!1,!1));let Dn=!1,di=!1,ar=!0,Zi=!1,mi=!1,ei=null,Ln={box:null,offscreen:null,occluded:null},Vi={box:null},gr=null,tr=null,Pi=null,$o=0,go=0,Or=0;wn.textFeatureIndex?$o=wn.textFeatureIndex:Yt.useRuntimeCollisionCircles&&($o=Yt.featureIndex),wn.verticalTextFeatureIndex&&(go=wn.verticalTextFeatureIndex);const Io=v.elevationFeatures?v.elevationFeatures[Yt.elevationFeatureIndex]:void 0,Co=hr=>{hr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const wr=this.transform.elevation;hr.elevation=Ze?ri:ri+o.bV.getAtTileOffset(hr.tileID,new o.P(hr.tileAnchorX,hr.tileAnchorY),wr,Io),hr.elevation+=Yt.zOffset},so=wn.textBox;if(so){Co(so);const hr=Mi=>{let Ir=o.bL.horizontal;if(v.allowVerticalPlacement&&!Mi&&this.prevPlacement){const lr=this.prevPlacement.placedOrientations[pi];lr&&(this.placedOrientations[pi]=lr,Ir=lr,this.markUsedOrientation(v,Ir,Yt))}return Ir},wr=(Mi,Ir)=>{if(v.allowVerticalPlacement&&Si>0&&wn.verticalTextBox){for(const lr of v.writingModes)if(lr===o.bL.vertical?(Ln=Ir(),Vi=Ln):Ln=Mi(),Ln&&Ln.box&&Ln.box.length)break}else Ln=Mi()};if(Ct){let Mi=Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[pi]){const nr=this.prevPlacement.variableOffsets[pi];Mi.indexOf(nr.anchor)>0&&(Mi=Mi.filter(Ws=>Ws!==nr.anchor),Mi.unshift(nr.anchor))}const Ir=(nr,Ws,dh)=>{const da=v.getSymbolInstanceTextSize(ne,Yt,this.transform.zoom,oi),hh=(nr.x2-nr.x1)*da+2*nr.padding,zu=(nr.y2-nr.y1)*da+2*nr.padding,Na=Yt.hasIconTextFit&&!he?Ws:null;Na&&Co(Na);let dl={box:[],offscreen:!1,occluded:!1};const Ou=me?2*Mi.length:Mi.length;for(let ec=0;ec<Ou;++ec){const hl=this.attemptAnchorPlacement(Mi[ec%Mi.length],nr,V,U,Ut,hh,zu,da,Se,Re,F,A,re,ec>=Mi.length,Yt,oi,v,dh,Na,ne,ae);if(hl&&(dl=hl.placedGlyphBoxes,dl&&dl.box&&dl.box.length)){Dn=!0,ei=hl.shift;break}}return dl};wr(()=>Ir(so,wn.iconBox,o.bL.horizontal),()=>{const nr=wn.verticalTextBox;return nr&&Co(nr),v.allowVerticalPlacement&&!(Ln&&Ln.box&&Ln.box.length)&&Si>0&&nr?Ir(nr,wn.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),Ln&&(Dn=Ln.box,ar=Ln.offscreen,Zi=Ln.occluded);const lr=hr(!(!Ln||!Ln.box));if(!Dn&&this.prevPlacement){const nr=this.prevPlacement.variableOffsets[pi];nr&&(this.variableOffsets[pi]=nr,this.markUsedJustification(v,nr.anchor,Yt,lr))}}else{const Mi=(Ir,lr)=>{const nr=v.getSymbolInstanceTextSize(ne,Yt,this.transform.zoom,oi),Ws=this.collisionIndex.placeCollisionBox(v,nr,Ir,V,U,Ut,new o.P(0,0),me,F,A,re.predicate);return Ws&&Ws.box&&Ws.box.length&&(this.markUsedOrientation(v,lr,Yt),this.placedOrientations[pi]=lr),Ws};wr(()=>Mi(so,o.bL.horizontal),()=>{const Ir=wn.verticalTextBox;return v.allowVerticalPlacement&&Si>0&&Ir?(Co(Ir),Mi(Ir,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),hr(!!(Ln&&Ln.box&&Ln.box.length))}}if(gr=Ln,Dn=gr&&gr.box&&gr.box.length>0,ar=gr&&gr.offscreen,Zi=gr&&gr.occluded,Yt.useRuntimeCollisionCircles){const hr=Yt.centerJustifiedTextSymbolIndex>=0?Yt.centerJustifiedTextSymbolIndex:Yt.verticalPlacedTextSymbolIndex,wr=v.text.placedSymbolArray.get(hr),Mi=o.bM(v.textSizeData,ne,wr),Ir=b.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(v,me,wr,hr,v.lineVertexArray,v.glyphOffsetArray,Mi,A,M,O,d,Re,re.predicate,Yt.collisionCircleDiameter*Mi/o.bY,Ir,this.retainedQueryData[v.bucketInstanceId].tileID),Dn=me||tr.circles.length>0&&!tr.collisionDetected,ar=ar&&tr.offscreen,Zi=tr.occluded}if(wn.iconFeatureIndex&&(Or=wn.iconFeatureIndex),wn.iconBox){const hr=wr=>{Co(wr);const Mi=Yt.hasIconTextFit&&ei?Mr(ei.x,ei.y,Se,Re,this.transform.angle):new o.P(0,0),Ir=v.getSymbolInstanceIconSize(ae,this.transform.zoom,Yt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Ir,wr,V,U,Dt,Mi,he,F,A,re.predicate)};Vi&&Vi.box&&Vi.box.length&&wn.verticalIconBox?(Pi=hr(wn.verticalIconBox),di=Pi.box.length>0):(Pi=hr(wn.iconBox),di=Pi.box.length>0),ar=ar&&Pi.offscreen,mi=Pi.occluded}const xs=ge||Yt.numHorizontalGlyphVertices===0&&Si===0,Hs=ve||Yt.numIconVertices===0;if(xs||Hs?Hs?xs||(di=di&&Dn):Dn=di&&Dn:di=Dn=di&&Dn,Dn&&gr&&gr.box&&this.collisionIndex.insertCollisionBox(gr.box,b.get("text-ignore-placement"),v.bucketInstanceId,Vi&&Vi.box&&go?go:$o,re.ID),di&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,b.get("icon-ignore-placement"),v.bucketInstanceId,Or,re.ID),tr&&(Dn&&this.collisionIndex.insertCollisionCircles(tr.circles,b.get("text-ignore-placement"),v.bucketInstanceId,$o,re.ID),d)){const hr=v.bucketInstanceId;let wr=this.collisionCircleArrays[hr];wr===void 0&&(wr=this.collisionCircleArrays[hr]=new gf);for(let Mi=0;Mi<tr.circles.length;Mi+=4)wr.circles.push(tr.circles[Mi+0]),wr.circles.push(tr.circles[Mi+1]),wr.circles.push(tr.circles[Mi+2]),wr.circles.push(tr.collisionDetected?1:0)}const Jo=v.projection.name!=="globe";Ft=Ft&&(Jo||!Zi),sn=sn&&(Jo||!mi),this.placements[pi]=new yi(Dn||Ft,di||sn,ar||v.justReloaded),s.add(pi)},ci=this.retainedQueryData[v.bucketInstanceId].tileID;if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,ci),v.elevationType==="road"&&v.updateRoadElevation(ci.canonical),v.updateZOffset(),v.sortFeaturesByY){const Yt=v.getSortedSymbolIndexes(this.transform.angle);for(let oi=Yt.length-1;oi>=0;--oi){const wn=Yt[oi];Gn(v.symbolInstances.get(wn),wn,v.collisionArrays[wn])}v.hasAnyZOffset&&o.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Yt=v.getSortedIndexesByZOffset();for(let oi=0;oi<Yt.length;++oi){const wn=Yt[oi];Gn(v.symbolInstances.get(wn),wn,v.collisionArrays[wn])}}else for(let Yt=t.symbolInstanceStart;Yt<t.symbolInstanceEnd;Yt++)Gn(v.symbolInstances.get(Yt),Yt,v.collisionArrays[Yt]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const Yt=this.collisionCircleArrays[v.bucketInstanceId];o.bl(Yt.invProjMatrix,A),Yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,s,d,m){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E,crossTileID:A}=d,M=o.c3(s),O=m===o.bL.vertical?E:M==="left"?y:M==="center"?v:M==="right"?b:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=O>=0&&y!==O?0:A),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=O>=0&&v!==O?0:A),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=O>=0&&b!==O?0:A),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=O>=0&&E!==O?0:A)}markUsedOrientation(t,s,d){const m=s===o.bL.horizontal||s===o.bL.horizontalOnly?s:0,y=s===o.bL.vertical?s:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:A}=d,M=t.text.placedSymbolArray;v>=0&&(M.get(v).placedOrientation=m),b>=0&&(M.get(b).placedOrientation=m),E>=0&&(M.get(E).placedOrientation=m),A>=0&&(M.get(A).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],M=y[E];M?(this.opacities[E]=new Pa(M,m,A.text,A.icon,null,A.clipped),d=d||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[E]=new Pa(null,m,A.text,A.icon,A.skipFade,A.clipped),d=d||A.text||A.icon)}for(const E in y){const A=y[E];if(!this.opacities[E]){const M=new Pa(A,m,!1,!1);M.isHidden()||(this.opacities[E]=M,d=d||A.text.placed||A.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in b)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=b[E]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,d,m){m&&(this.lastReplacementSourceUpdateTime=m.updateTime);const y=new Set;for(const v of s){const b=v.getBucket(t);b&&v.latestFeatureIndex&&t.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,y,v,v.collisionBoxArray,d,m,v.tileID,t.scope),b.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,v.tileID),b.elevationType==="road"&&b.updateRoadElevation(v.tileID.canonical),b.updateZOffset())}}updateBucketOpacities(t,s,d,m,y,v,b,E){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const A=t.layers[0].layout,M=t.layers[0].paint,O=!!t.layers[0].dynamicFilter(),z=new Pa(null,0,!1,!1,!0),F=A.get("text-allow-overlap"),V=A.get("icon-allow-overlap"),U=A.get("text-variable-anchor"),X=A.get("text-rotation-alignment")==="map",Z=A.get("text-pitch-alignment")==="map",ne=M.get("symbol-z-offset"),ae=A.get("symbol-elevation-reference")==="sea",re=!ne.isConstant(),we=new Pa(null,0,F&&(V||!t.hasIconData()||A.get("icon-optional")),V&&(F||!t.hasTextData()||A.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const ge=(me,he,Se)=>{for(let Le=0;Le<he/4;Le++)me.opacityVertexArray.emplaceBack(Se)};let ve=0;v&&t.updateReplacement(b,v);for(let me=0;me<t.symbolInstances.length;me++){const he=t.symbolInstances.get(me),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Le,crossTileID:Re,numIconVertices:qe,tileAnchorX:Ze,tileAnchorY:tt}=he;let _t=null;const Ue=this.retainedQueryData[t.bucketInstanceId];re&&he&&Ue&&(_t=d.latestFeatureIndex.loadFeature({featureIndex:he.featureIndex,bucketIndex:Ue.bucketIndex,sourceLayerIndex:Ue.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ae=ne.evaluate(_t,{}),Ke=s.has(Re);let $e=this.opacities[Re];Ke?$e=z:$e||($e=we,this.opacities[Re]=$e),s.add(Re);const lt=Se>0||Le>0,Ct=qe>0,zt=this.placedOrientations[Re],St=zt===o.bL.vertical,yt=zt===o.bL.horizontal||zt===o.bL.horizontalOnly;!lt&&!Ct||$e.isHidden()||ve++;let Xt=!1;if((lt||Ct)&&v)for(const Ut of t.activeReplacements){if(o.bZ(Ut,y,o.b_.Symbol,E)||Ut.min.x>Ze||Ze>Ut.max.x||Ut.min.y>tt||tt>Ut.max.y)continue;const Dt=o.b$(Ze,tt,b.canonical,Ut.footprintTileId.canonical);if(Xt=o.c0(Dt,Ut.footprint),Xt)break}if(lt){const Ut=Xt?Ic:Bo($e.text);ge(t.text,Se,St?Ic:Ut),ge(t.text,Le,yt?Ic:Ut);const Dt=$e.text.isHidden(),{leftJustifiedTextSymbolIndex:Ft,centerJustifiedTextSymbolIndex:sn,rightJustifiedTextSymbolIndex:Tn,verticalPlacedTextSymbolIndex:Gn}=he,ci=t.text.placedSymbolArray,Yt=Dt||St?1:0;Ft>=0&&(ci.get(Ft).hidden=Yt),sn>=0&&(ci.get(sn).hidden=Yt),Tn>=0&&(ci.get(Tn).hidden=Yt),Gn>=0&&(ci.get(Gn).hidden=Dt||yt?1:0);const oi=this.variableOffsets[Re];oi&&this.markUsedJustification(t,oi.anchor,he,zt);const wn=this.placedOrientations[Re];wn&&(this.markUsedJustification(t,"left",he,wn),this.markUsedOrientation(t,wn,he))}if(Ct){const Ut=Xt?Ic:Bo($e.icon),{placedIconSymbolIndex:Dt,verticalPlacedIconSymbolIndex:Ft}=he,sn=t.icon.placedSymbolArray,Tn=$e.icon.isHidden()?1:0;Dt>=0&&(ge(t.icon,qe,St?Ic:Ut),sn.get(Dt).hidden=Tn),Ft>=0&&(ge(t.icon,he.numVerticalIconVertices,yt?Ic:Ut),sn.get(Ft).hidden=Tn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ut=t.collisionArrays[me];if(Ut){let Dt=new o.P(0,0),Ft=!0;if(Ut.textBox||Ut.verticalTextBox){if(U){const Tn=this.variableOffsets[Re];Tn?(Dt=So(Tn.anchor,Tn.width,Tn.height,Tn.textOffset,Tn.textScale),X&&Dt._rotate(Z?this.transform.angle:-this.transform.angle)):Ft=!1}O&&(Ft=!$e.clipped),Ut.textBox&&Bl(t.textCollisionBox.collisionVertexArray,$e.text.placed,!Ft||St,Ae,ae,Dt.x,Dt.y),Ut.verticalTextBox&&Bl(t.textCollisionBox.collisionVertexArray,$e.text.placed,!Ft||yt,Ae,ae,Dt.x,Dt.y)}const sn=Ft&&!!(!yt&&Ut.verticalIconBox);Ut.iconBox&&Bl(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,sn,Ae,ae,he.hasIconTextFit?Dt.x:0,he.hasIconTextFit?Dt.y:0),Ut.verticalIconBox&&Bl(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,!sn,Ae,ae,he.hasIconTextFit?Dt.x:0,he.hasIconTextFit?Dt.y:0)}}}if(t.fullyClipped=ve===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=me.invProjMatrix,t.placementViewportMatrix=me.viewportMatrix,t.collisionCircleArray=me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>t}isStale(){return this.stale}setStale(){this.stale=!0}}function Bl(u,t,s,d,m,y,v){u.emplaceBack(t?1:0,s?1:0,y||0,v||0,d,m?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,v||0,d,m?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,v||0,d,m?1:0),u.emplaceBack(t?1:0,s?1:0,y||0,v||0,d,m?1:0)}const tg=Math.pow(2,25),Nd=Math.pow(2,24),_f=Math.pow(2,17),ng=Math.pow(2,16),yf=Math.pow(2,9),No=Math.pow(2,8),Qa=Math.pow(2,1);function Bo(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*tg+t*Nd+s*_f+t*ng+s*yf+t*No+s*Qa+t}const Ic=0;class hu{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,d,m,y,v){const b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,m,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0,v),this._currentPartIndex++,y())return!0}return!1}}class Zr{constructor(t,s,d,m,y,v,b,E,A){this.placement=new ww(t,y,v,b,E,A),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,d,m,y){const v=o.o.now(),b=()=>{const E=o.o.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=s[t[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&E.visibility!=="none"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){const M=E,O=M.layout.get("symbol-z-elevate"),z=M.layout.get("symbol-sort-key").constantOr(1)!==void 0,F=M.layout.get("symbol-z-order"),V=F==="viewport-y"||F==="auto"&&!(F!=="viewport-y"&&z),U=M.layout.get("text-allow-overlap")||M.layout.get("icon-allow-overlap")||M.layout.get("text-ignore-placement")||M.layout.get("icon-ignore-placement"),X=V&&U,Z=this._inProgressLayer=this._inProgressLayer||new hu(M),ne=o.B(E.source,E.scope);if(Z.continuePlacement(O||X?m[ne]:d[ne],this.placement,this._showCollisionBoxes,E,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Bs=512/o.al/2;class Ja{constructor(t,s,d){this.tileID=t,this.bucketInstanceId=d,this.index=new o.c4(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*o.al,y=t.canonical.y*o.al;for(let v=0;v<s.length;v++){const{key:b,crossTileID:E,tileAnchorX:A,tileAnchorY:M}=s.get(v),O=Math.floor((m+A)*Bs),z=Math.floor((y+M)*Bs);this.index.add(O,z),this.keys.push(b),this.crossTileIDs.push(E)}this.index.finish()}findMatches(t,s,d){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),y=Bs/Math.pow(2,s.canonical.z-this.tileID.canonical.z),v=s.canonical.x*o.al,b=s.canonical.y*o.al;for(let E=0;E<t.length;E++){const A=t.get(E);if(A.crossTileID)continue;const{key:M,tileAnchorX:O,tileAnchorY:z}=A,F=Math.floor((v+O)*y),V=Math.floor((b+z)*y),U=this.index.range(F-m,V-m,F+m,V+m).sort((X,Z)=>X-Z);for(const X of U){const Z=this.crossTileIDs[X];if(this.keys[X]===M&&!d.has(Z)){d.add(Z),A.crossTileID=Z;break}}}}}class jr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ig{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const d in this.indexes){const m=this.indexes[d],y={};for(const v in m){const b=m[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),y[b.tileID.key]=b}this.indexes[d]=y}this.lng=t}addBucket(t,s,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const v=this.indexes[y];if(Number(y)>t.overscaledZ)for(const b in v){const E=v[b];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,m)}else{const b=v[t.scaledTo(Number(y)).key];b&&b.findMatches(s.symbolInstances,t,m)}}for(let y=0;y<s.symbolInstances.length;y++){const v=s.symbolInstances.get(y);v.crossTileID||(v.crossTileID=d.generate(),m.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ja(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const d of s.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let s=!1;for(const d in this.indexes){const m=this.indexes[d];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[y]),delete m[y],s=!0)}return s}}class sa{constructor(){this.layerIndexes={},this.crossTileIDs=new jr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,d,m){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new ig);let v=!1;const b={};m.name!=="globe"&&y.handleWrapJump(d);for(const E of s){const A=E.getBucket(t);A&&t.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(E.tileID,A,this.crossTileIDs)&&(v=!0),b[A.bucketInstanceId]=!0)}return y.removeStaleBuckets(b)&&(v=!0),v}pruneUnusedLayers(t){const s={};t.forEach(d=>{s[d]=!0});for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}const Ma=771;class Mn{constructor(t,s,d,m){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=m}}Mn.Replace=[1,0,1,0],Mn.disabled=new Mn(Mn.Replace,o.ao.transparent,[!1,!1,!1,!1]),Mn.unblended=new Mn(Mn.Replace,o.ao.transparent,[!0,!0,!0,!0]),Mn.alphaBlended=new Mn([1,Ma,1,Ma],o.ao.transparent,[!0,!0,!0,!0]),Mn.alphaBlendedNonPremultiplied=new Mn([770,Ma,770,Ma],o.ao.transparent,[!0,!0,!0,!0]),Mn.multiply=new Mn([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Mn.additive=new Mn([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Qt{constructor(t,s,d){this.func=t,this.mask=s,this.range=d}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const vf=7680;class yn{constructor(t,s,d,m,y,v){this.test=t,this.ref=s,this.mask=d,this.fail=m,this.depthFail=y,this.pass=v}}yn.disabled=new yn({func:519,mask:0},0,0,vf,vf,vf);const fu=1029,xf=2305;class gn{constructor(t,s,d){this.enable=t,this.mode=s,this.frontFace=d}}function Ra(u,t){const s=o.ca(u,3);o.cc(u,t),o.cg(u,3,s)}function rg(u,t){const s=o.c7([]);return o.c8(s,s,-t),o.c9(s,s,-u),s}function wf(u,t){const s=[u[0],u[1],0],d=[t[0],t[1],0];if(o.ag(s)>=1e-15){const v=o.aw([],s);o.c5(d,v,o.bJ(d,v)),t[0]=d[0],t[1]=d[1]}const m=o.bI([],t,u);if(o.c6(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return rg(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}gn.disabled=new gn(!1,fu,xf),gn.backCCW=new gn(!0,fu,xf),gn.backCW=new gn(!0,fu,2304),gn.frontCW=new gn(!0,1028,2304),gn.frontCCW=new gn(!0,1028,xf);class jo{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof o.ae?t:new o.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=o.bT(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s,d){if(this.orientation=null,!this.position)return;const m=this.position,y=d||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(t)):0),v=o.ae.fromLngLat(t,y),b=[v.x-m.x,v.y-m.y,v.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=wf(b,s)}setPitchBearing(t,s){this.orientation=rg(o.an(t),o.an(-s))}}class bf{constructor(t,s){this._transform=o.bA([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new o.ae(t[0],t[1],t[2])}get position(){const t=o.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&o.cg(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.c7([]),t&&Ra(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=rg(t,s),Ra(this._transform,this._orientation)}forward(){const t=o.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const d=new Float64Array(16);return o.bl(d,this.getWorldToCamera(t,s)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,d){const m=this.position;o.c5(m,m,-t);const y=new Float64Array(16);return o.bq(y,[d,d,d]),o.br(y,y,m),y[10]*=s,y}getWorldToCamera(t,s){const d=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.cb(m,this._orientation),o.c5(y,y,-t),o.cc(d,m),o.br(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=s,d[9]*=s,d[10]*=s,d[11]*=s,d}getCameraToClipPerspective(t,s,d,m){const y=new Float64Array(16);return o.cd(y,t,s,d,m),y}getCameraToClipOrthographic(t,s,d,m,y,v){const b=new Float64Array(16);return o.ce(b,t,s,d,m,y,v),b}getDistanceToElevation(t,s=!1){const d=t===0?0:o.cf(t,s?o.a$(this.position[1]):this.position[1]),m=this.forward();return(d-this.position[2])/m[2]}clone(){return new bf([...this.position],[...this.orientation])}}const eo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Tf{constructor(t=0,s=0,d=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=d,this.right=m}interpolate(t,s,d){return s.top!=null&&t.top!=null&&(this.top=o.ak(t.top,s.top,d)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.ak(t.bottom,s.bottom,d)),s.left!=null&&t.left!=null&&(this.left=o.ak(t.left,s.left,d)),s.right!=null&&t.right!=null&&(this.right=o.ak(t.right,s.right,d)),this}getCenter(t,s){const d=o.aA((this.left+t-this.right)/2,0,t),m=o.aA((this.top+s-this.bottom)/2,0,s);return new o.P(d,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Tf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const aa=15;class og{constructor(t,s,d,m,y,v,b){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=d??0,this._maxPitch=m??60,this.setProjection(v),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new o.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Tf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new bf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new og(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<aa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.cm(this.projectionOptions);const d=this.getProjection(),m=!o.by(s,d);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cm({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.cn(),o.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,y=0;for(let v=0;v<s.length;v++){const b=new o.P(s[v][0]*this.width,d+s[v][1]*(this.height-d)),E=t.pointCoordinate(b);if(!E)continue;const A=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);m+=E[3]*A,y+=A}return y===0?NaN:m/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),v=Math.max(m-d,y);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const s=this.elevation,d=t.elevation,m=s!=null!=(d!=null)||s&&d&&s.exaggeration()!==d.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!m}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=o.ag(o.av([],this._camera.position,d));return o.aA(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!o.cp(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];o.cq(d,this._camera.position)||(this._setCameraPosition(d),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new jo;return s.position=new o.ae(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!o.cr(t))return!1;o.cs(t,t);const s=o.ct([],[0,0,-1],t),d=o.ct([],[0,-1,0],t);if(d[2]<0)return!1;const m=wf(s,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=o.aA(t[2],m/d,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,d){this._unmodified=!1,this._edgeInsets.interpolate(t,s,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.cu(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.P(0,0)),m=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),v=this.pointCoordinate(new o.P(0,this.height)),b=Math.floor(Math.min(d.x,m.x,y.x,v.x)),E=Math.floor(Math.max(d.x,m.x,y.x,v.x)),A=1;for(let M=b-A;M<=E+A;M++)M!==0&&s.push(new o.cu(M,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,d,m){let y=[];const v=d!=null,b=!v;if(b&&this.zoom<s||v&&d[0]===0&&d[1]===0)return y;const E=new Set,A=(O,z,F,V,U)=>{const X=o.cY(z,O,F,V,U);E.has(X)||(y.push(new o.aQ(O,z,F,V,U)),E.add(X))};for(let O=0;O<t.length;O++){const z=t[O];if(b&&z.canonical.z!==s||v&&m!==void 0&&m>z.canonical.z)continue;const F=z.canonical,V=z.overscaledZ,U=z.wrap,X=1<<F.z,Z=F.x+1<X,ne=F.x>0,ae=F.y+1<X,re=F.y>0,we=z.wrap-(ne?0:1),ge=z.wrap+(Z?0:1),ve=ne?F.x-1:X-1,me=Z?F.x+1:0;if(v)d[0]<0?(A(V,ge,F.z,me,F.y),d[1]<0&&ae&&(A(V,U,F.z,F.x,F.y+1),A(V,ge,F.z,me,F.y+1)),d[1]>0&&re&&(A(V,U,F.z,F.x,F.y-1),A(V,ge,F.z,me,F.y-1))):d[0]>0?(A(V,we,F.z,ve,F.y),d[1]<0&&ae&&(A(V,U,F.z,F.x,F.y+1),A(V,we,F.z,ve,F.y+1)),d[1]>0&&re&&(A(V,U,F.z,F.x,F.y-1),A(V,we,F.z,ve,F.y-1))):d[1]<0&&ae?A(V,U,F.z,F.x,F.y+1):re&&A(V,U,F.z,F.x,F.y-1);else{const he=z.visibleQuadrants;1&he&&(A(V,we,F.z,ve,F.y),re&&(A(V,U,F.z,F.x,F.y-1),A(V,we,F.z,ve,F.y-1))),2&he&&(A(V,ge,F.z,me,F.y),re&&(A(V,U,F.z,F.x,F.y-1),A(V,ge,F.z,me,F.y-1))),4&he&&(A(V,we,F.z,ve,F.y),ae&&(A(V,U,F.z,F.x,F.y+1),A(V,we,F.z,ve,F.y+1))),8&he&&(A(V,ge,F.z,me,F.y),ae&&(A(V,U,F.z,F.x,F.y+1),A(V,ge,F.z,me,F.y+1)))}}const M=[];for(const O of y)y.some(z=>O.isChildOf(z))||M.push(O);if(y=M.filter(O=>!t.some(z=>!!(O.overscaledZ<s&&z.isChildOf(O))||O.equals(z)||O.isChildOf(z))),b){const O=1<<s,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[O*z.x,O*z.y],V=4,U=V*V;y=y.filter(X=>{const Z=X.canonical.x+.5-F[0],ne=X.canonical.y+.5-F[1];return Z*Z+ne*ne<U})}return y}extendTileCoverToNearPlane(t,s,d){const m=[],y=new Set;for(const ne of t)y.add(ne.key);const v=(ne,ae,re,we,ge)=>{const ve=o.cY(ae,ne,re,we,ge);y.has(ve)||(m.push(new o.aQ(ne,ae,re,we,ge)),y.add(ve))},b=t.reduce((ne,ae)=>Math.max(ne,ae.overscaledZ),d),E=1<<d,A=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],M=new o.P(0,0),O=new o.P(0,0),z=(ne,ae)=>{const re=Math.floor(ne[0]),we=Math.floor(ne[1]),ge=(ne[0]-re)*o.al,ve=(ne[1]-we)*o.al,me=Math.floor(ae[0]),he=Math.floor(ae[1]),Se=(ae[0]-me)*o.al,Le=(ae[1]-he)*o.al;for(let Re=-1;Re<=1;Re++){const qe=re+Re;if(!(qe<0||qe>=E)){M.x=ge-Re*o.al,O.x=Se-(qe-me)*o.al;for(let Ze=-1;Ze<=1;Ze++){const tt=we+Ze;M.y=ve-Ze*o.al,O.y=Le-(tt-he)*o.al,o.cZ(M,O,A)&&v(b,0,d,qe,tt)}}}},F=s.points,V=F[o.cv],U=F[o.cw],X=this._projectToGround(V,F[o.cx]),Z=this._projectToGround(U,F[o.cy]);return z(V,X),z(U,Z),m}_projectToGround(t,s){return o.cz(o.cA(),t,s,t[2]/(t[2]-s[2]))}coveringTiles(t){let s=this.coveringZoomLevel(t);const d=s,m=this.elevation&&this.elevation.exaggeration(),y=m&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const b=this.locationCoordinate(this.center),E=this.center.lat,A=1<<s,M=[A*b.x,A*b.y,0],O=this.projection.name==="globe",z=!O,F=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,z),V=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=A*o.cf(1,this.center.lat),X=this._camera.position[2]/o.cf(1,this.center.lat),Z=[A*V.x,A*V.y,X*(z?1:U)],ne=O||m,ae=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),re=this.isLODDisabled(!0)?s:0;let we;if(this._elevation&&t.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ae=this._elevation.getMinMaxForVisibleTiles();we=Ae?Ae.max:this._centerAltitude}else we=this._centerAltitude;const ge=t.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?o.cC(this):1,me=Ae=>{const $e=new o.ae(Ae.x+25e-6,Ae.y,Ae.z),lt=new o.ae(Ae.x,Ae.y+25e-6,Ae.z),Ct=Ae.toLngLat(),zt=$e.toLngLat(),St=lt.toLngLat(),yt=this.locationCoordinate(Ct),Xt=this.locationCoordinate(zt),Ut=this.locationCoordinate(St),Dt=Math.hypot(Xt.x-yt.x,Xt.y-yt.y),Ft=Math.hypot(Ut.x-yt.x,Ut.y-yt.y);return Math.sqrt(Dt*Ft)*ve/25e-6},he=Ae=>{const Ke=we,$e=ge;return{aabb:o.cF(this,A,0,0,0,Ae,$e,Ke,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:Ke,wrap:Ae,fullyVisible:!1}},Se=[];let Le=[];const Re=s,qe=t.reparseOverscaled?d:s,Ze=(X-this._centerAltitude)*U,tt=Ae=>{if(!this._elevation||!Ae.tileID||!v)return;const Ke=this._elevation.getMinMaxForTile(Ae.tileID),$e=Ae.aabb;Ke?($e.min[2]=Ke.min,$e.max[2]=Ke.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Ae.shouldSplit=Ue(Ae),Ae.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},_t=(Ae,Ke)=>{if(.707*Ke<Ae)return 1;const $e=Ke/Ae;return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)},Ue=Ae=>{if(Ae.zoom<re)return!0;if(Ae.zoom===Re)return!1;if(Ae.shouldSplit!=null)return Ae.shouldSplit;const Ke=Ae.aabb.distanceX(Z),$e=Ae.aabb.distanceY(Z);let lt=Ze,Ct=1;if(O){lt=Ae.aabb.distanceZ(Z);const Ft=Math.pow(2,Ae.zoom),sn=o.a$((Ae.y+1)/Ft),Tn=o.a$(Ae.y/Ft),Gn=Math.min(Math.max(E,sn),Tn),ci=o.d1(Gn)/o.d1(E);if(Ct=Gn===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ci/this._mercatorScaleRatio),this.zoom<=o.c_&&Ae.zoom===Re-1&&ci>=.9)return!0}else if(y&&(lt=Ae.aabb.distanceZ(Z)*U),this.projection.isReprojectedInTileSpace&&d<=5){const Ft=Math.pow(2,Ae.zoom),sn=me(new o.ae((Ae.x+.5)/Ft,(Ae.y+.5)/Ft));Ct=sn>.85?1:sn}if(!v&&!O){const Ft=Math.sqrt(Ke*Ke+$e*$e+lt*lt);let sn=(1<<Re-Ae.zoom)*ae*Ct;return sn*=_t(Math.max(lt,Ze),Ft),Ft<sn}let zt=Number.MAX_VALUE,St=0;const yt=Ae.aabb.getCorners(),Xt=[];for(const Ft of yt){o.av(Xt,Ft,Z),O||(y?Xt[2]*=U:Xt[2]=Ze);const sn=o.bJ(Xt,this._camera.forward());sn<zt&&(zt=sn,St=Math.abs(Xt[2]))}let Ut=(1<<Re-Ae.zoom)*ae*Ct;if(Ut*=_t(Math.max(St,Ze),zt),zt<Ut)return!0;const Dt=Ae.aabb.closestPoint(M);return Dt[0]===M[0]&&Dt[1]===M[1]};if(this.renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)Se.push(he(-Ae)),Se.push(he(Ae));for(Se.push(he(0));Se.length>0;){const Ae=Se.pop(),Ke=Ae.x,$e=Ae.y;let lt=Ae.fullyVisible;const Ct=()=>this.projection.name==="globe"&&(Ae.y===0||Ae.y===(1<<Ae.zoom)-1);if(!lt){let zt=ne?Ae.aabb.intersects(F):Ae.aabb.intersectsFlat(F);if(zt===0&&Ct()){const St=new o.cD(Ae.zoom,Ke,$e);zt=o.cE(this,A,St,!0).intersects(F)}if(zt===0)continue;lt=zt===2}if(Ae.zoom!==Re&&Ue(Ae))for(let zt=0;zt<4;zt++){const St=(Ke<<1)+zt%2,yt=($e<<1)+(zt>>1),Xt={aabb:v?Ae.aabb.quadrant(zt):o.cF(this,A,Ae.zoom+1,St,yt,Ae.wrap,Ae.minZ,Ae.maxZ,this.projection),zoom:Ae.zoom+1,x:St,y:yt,wrap:Ae.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0,minZ:Ae.minZ,maxZ:Ae.maxZ};y&&!O&&(Xt.tileID=new o.aQ(Ae.zoom+1===Re?qe:Ae.zoom+1,Ae.wrap,Ae.zoom+1,St,yt),tt(Xt)),Se.push(Xt)}else{const zt=Ae.zoom===Re?qe:Ae.zoom;if(t.minzoom&&t.minzoom>zt)continue;let St=0;if(!lt){let Dt=ne?Ae.aabb.intersectsPrecise(F):Ae.aabb.intersectsPreciseFlat(F);if(Dt===0&&Ct()){const Ft=new o.cD(Ae.zoom,Ke,$e);Dt=o.cE(this,A,Ft,!0).intersectsPrecise(F)}if(Dt===0)continue;if(t.calculateQuadrantVisibility)if(F.containsPoint(Ae.aabb.center))St=15;else for(let Ft=0;Ft<4;Ft++)Ae.aabb.quadrant(Ft).intersects(F)!==0&&(St|=1<<Ft)}const yt=M[0]-(.5+Ke+(Ae.wrap<<Ae.zoom))*(1<<s-Ae.zoom),Xt=M[1]-.5-$e,Ut=Ae.tileID?Ae.tileID:new o.aQ(zt,Ae.wrap,Ae.zoom,Ke,$e);t.calculateQuadrantVisibility&&(Ut.visibleQuadrants=St),Le.push({tileID:Ut,distanceSq:yt*yt+Xt*Xt})}}if(this.fogCullDistSq){const Ae=this.fogCullDistSq,Ke=this.horizonLineFromTop();Le=Le.filter($e=>{const lt=[0,0,0,1],Ct=[o.al,o.al,0,1],zt=this.calculateFogTileMatrix($e.tileID.toUnwrapped());o.aC(lt,lt,zt),o.aC(Ct,Ct,zt);const St=o.cG([],lt,Ct),yt=o.cH([],lt,Ct),Xt=o.c$(St,yt);if(Xt===0)return!0;let Ut=!1;const Dt=this._elevation;if(Dt&&Xt>Ae&&Ke!==0){const Ft=this.calculateProjMatrix($e.tileID.toUnwrapped());let sn;t.isTerrainDEM||(sn=Dt.getMinMaxForTile($e.tileID)),sn||(sn={min:ge,max:we});const Tn=o.cI(this.rotation),Gn=[Tn[0]*o.al,Tn[1]*o.al,sn.max];o.af(Gn,Gn,Ft),Ut=(1-Gn[1])*this.height*.5<Ke}return Xt<Ae||Ut})}return Le.sort((Ae,Ke)=>Ae.distanceSq-Ke.distanceSq).map(Ae=>Ae.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const s=o.aA(t.lat,-o.cJ,o.cJ),d=this.projection.project(t.lng,s);return new o.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let d,m;const y=this.centerPoint;if(this.projection.name==="globe"){const b=this.worldSize;d=(s.x-y.x)/b,m=(s.y-y.y)/b}else{const b=this.pointCoordinate(s),E=this.pointCoordinate(y);d=b.x-E.x,m=b.y-E.y}const v=this.locationCoordinate(t);this.setLocation(new o.ae(v.x-d,v.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const d=s?o.cf(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new o.ae(m.x,m.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const d=s??this._centerAltitude,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];o.aC(m,m,this.pixelMatrixInverse),o.aC(y,y,this.pixelMatrixInverse);const v=y[3];o.cK(m,m,1/m[3]),o.cK(y,y,1/v);const b=m[2],E=y[2];return{p0:m,p1:y,t:b===E?0:(d-b)/(E-b)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return o.aC(s,s,this.pixelMatrixInverse),o.aC(d,d,this.pixelMatrixInverse),o.cK(s,s,1/s[3]),o.cK(d,d,1/d[3]),s[2]=o.cf(s[2],this._center.lat)*this.worldSize,d[2]=o.cf(d[2],this._center.lat)*this.worldSize,o.cK(s,s,1/this.worldSize),o.cK(d,d,1/this.worldSize),new o.ax([s[0],s[1],s[2]],o.aw([],o.av([],d,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:d,t:m}=t,y=o.cf(s[2],this._center.lat),v=o.cf(d[2],this._center.lat);return new o.ae(o.ak(s[0],d[0],m)/this.worldSize,o.ak(s[1],d[1],m)/this.worldSize,o.ak(y,v,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new o.ae(d[0],d[1],d[2]);let m=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,s);const v=.02*y,b=t.clone();for(let E=0;E<10&&y-m>v;E++){b.y=o.ak(m,y,.66);const A=this.projection.pointCoordinate3D(this,b.x,b.y);A?(y=b.y,d=A):m=b.y}return d?new o.ae(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cL)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const d=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return o.aC(m,m,this.pixelMatrix),m[3]>0?new o.P(m[0]/m[3],m[1]/m[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,y=this.pointLocation3D(new o.P(s,t)),v=this.pointLocation3D(new o.P(m,t)),b=this.pointLocation3D(new o.P(m,d)),E=this.pointLocation3D(new o.P(s,d));let A=Math.min(y.lng,v.lng,b.lng,E.lng),M=Math.max(y.lng,v.lng,b.lng,E.lng),O=Math.min(y.lat,v.lat,b.lat,E.lat),z=Math.max(y.lat,v.lat,b.lat,E.lat);const F=Math.pow(2,-this.zoom)/16*270,V=this.projection.name==="globe"?1:4,U=(X,Z,ne,ae,re)=>{const we=(X+ne)/2,ge=(Z+ae)/2,ve=new o.P(we,ge),{lng:me,lat:he}=this.pointLocation3D(ve),Se=Math.max(0,A-me,O-he,me-M,he-z);A=Math.min(A,me),M=Math.max(M,me),O=Math.min(O,he),z=Math.max(z,he),(re<V||Se>F)&&(U(X,Z,we,ge,re+1),U(we,ge,ne,ae,re+1))};if(U(s,t,m,t,1),U(m,t,m,d,1),U(m,d,s,d,1),U(s,d,s,t,1),this.projection.name==="globe"){const[X,Z]=o.cM(this);X?(z=90,M=180,A=-180):Z&&(O=-90,M=180,A=-180)}return new o.aI(new o.aT(A,O),new o.aT(M,z))}_getBoundsRectangular(t,s){const{top:d,left:m}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=new o.P(m,d),E=new o.P(v,d),A=new o.P(v,y),M=new o.P(m,y);let O=this.pointCoordinate(b,t),z=this.pointCoordinate(E,t);const F=this.pointCoordinate(A,s),V=this.pointCoordinate(M,s),U=(X,Z)=>(Z.y-X.y)/(Z.x-X.x);return O.y>1&&z.y>=0?O=new o.ae((1-V.y)/U(V,O)+V.x,1):O.y<0&&z.y<=1&&(O=new o.ae(-V.y/U(V,O)+V.x,0)),z.y>1&&O.y>=0?z=new o.ae((1-F.y)/U(F,z)+F.x,1):z.y<0&&O.y<=1&&(z=new o.ae(-F.y/U(F,z)+F.x,0)),new o.aI().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((d,m)=>{if(m.dem){const y=m.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cJ,this.maxLat=o.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,d=this._distanceTileDataCache;if(d[s])return d[s];const m=t.canonical,y=1/this.height,v=this.cameraWorldSize,b=v/this.zoomScale(m.z),E=(m.x+Math.pow(2,m.z)*t.wrap)*b,A=m.y*b,M=this.point;M.x*=v/this.worldSize,M.y*=v/this.worldSize;const O=this.angle,z=Math.sin(-O),F=-Math.cos(-O);return d[s]={bearing:[z,F],center:[(M.x-E)*y,(M.y-A)*y],scale:b/o.al*y},d[s]}calculateFogTileMatrix(t){const s=t.key,d=this._fogTileMatrixCache;if(d[s])return d[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.aB(m,this.worldToFogMatrix,m),d[s]=new Float32Array(m),d[s]}calculateProjMatrix(t,s=!1,d=!1){const m=t.key;let y;if(y=d?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,y[m])return y[m];const v=this.calculatePosMatrix(t,this.worldSize);let b;return b=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,o.aB(v,b,v),y[m]=new Float32Array(v),y[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[s])return d[s];const m=o.cN(t,this);return d[s]=m,d[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=o.bq([],[t,t,t]);return o.aB(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=o.cf(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(s),m=this._camera.forward(),y=o.cf(1,this._center.lat);d[2]/=y,m[2]/=y,o.aw(m,m);const v=t.raycast(d,m,t.exaggeration());if(v){const b=o.bH([],d,m,v),E=new o.ae(b[0],b[1],o.cf(b[2],o.a$(b[1]))),A=(E.z+o.ag([E.x-d[0],E.y-d[1],E.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,d=o.cf(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(d),y=s.getAtPointOrZero(new o.ae(...m)),v=this.pixelsPerMeter/this.worldSize*y,b=this._minimumHeightOverTerrain(),E=m[2]-v;if(E<=b)if(E<0||t){const A=this.locationCoordinate(this._center,this._centerAltitude),M=[m[0],m[1],A.z-m[2]],O=o.ag(M);M[2]-=(b-E)/this._pixelsPerMercatorPixel;const z=o.ag(M);if(z===0)return;o.c5(M,M,O/z*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],A.z*this._pixelsPerMercatorPixel-M[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const z=this.center;return z.lat=o.aA(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=o.aA(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const s=this._unmodified,{x:d,y:m}=this.point;let y=0,v=d,b=m;const E=this.width/2,A=this.height/2,M=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(m-A<M&&(b=M+A),m+A>O&&(b=O-A),O-M<this.height&&(y=Math.max(y,this.height/(O-M)),b=(O+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,V=this.worldSize/2-(z+F)/2;v=(d+V+this.worldSize)%this.worldSize-V,v-E<z&&(v=z+E),v+E>F&&(v=F-E),F-z<this.width&&(y=Math.max(y,this.width/(F-z)),v=(F+z)/2)}v===d&&b===m||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(v,b))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cf(1,this.center.lat)/o.cf(1,o.d2));const m=o.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,v=this._camera.getWorldToCamera(this.worldSize,y);let b;const E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(E[8]=2*-t.x/this.width,E[9]=2*t.y/this.height,this.isOrthographic){let he=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=he*this.aspect,Le=-Se,Re=-he;Se-=t.x,Le-=t.x,he+=t.y,Re+=t.y,b=this._camera.getCameraToClipOrthographic(Le,Se,Re,he,this._nearZ,this._farZ),((qe,Ze,tt,_t)=>{for(let Ue=0;Ue<16;Ue++)qe[Ue]=o.ak(Ze[Ue],tt[Ue],_t)})(b,b,E,o.d0(this.pitch>=aa?1:this.pitch/aa))}else b=E;const A=o.cP([],E,v);let M=o.cP([],b,v);if(this.projection.isReprojectedInTileSpace){const he=this.locationCoordinate(this.center),Se=o.bA([]);o.br(Se,Se,[he.x*this.worldSize,he.y*this.worldSize,0]),o.aB(Se,Se,o.cQ(this)),o.br(Se,Se,[-he.x*this.worldSize,-he.y*this.worldSize,0]),o.aB(M,M,Se),o.aB(A,A,Se),this.inverseAdjustmentMatrix=o.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cS([],M,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=M,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),s){const he=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);he[8]=2*-t.x/this.width,he[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cP([],he,v)}else this.expandedFarZProjMatrix=this.projMatrix;const O=o.bl([],b);this.frustumCorners=o.cT.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const z=new Float32Array(16);o.bA(z),o.cS(z,z,[1,-1,1]),o.cU(z,z,this._pitch),o.bB(z,z,this.angle);const F=o.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(F);const V=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-t.x/this.width,F[9]=2*(t.y+V)/this.height,this.skyboxMatrix=o.aB(z,F,z);const U=this.point,X=U.x,Z=U.y,ne=this.width%2/2,ae=this.height%2/2,re=Math.cos(this.angle),we=Math.sin(this.angle),ge=X-Math.round(X)+re*ne+we*ae,ve=Z-Math.round(Z)+re*ae+we*ne,me=new Float64Array(M);if(o.br(me,me,[ge>.5?ge-1:ge,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=me,M=o.bC(),o.cS(M,M,[this.width/2,-this.height/2,1]),o.br(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=o.bC(),o.cS(M,M,[1,-1,1]),o.br(M,M,[-1,-1,0]),o.cS(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},M=o.bl(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cV(this);const he=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(he,he,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,s];o.c5(y,y,m),o.c5(d,d,-1),o.cW(d,d,y);const v=o.bC();o.br(v,v,d),o.cS(v,v,y),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*y,m.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],m=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(y=Math.min((s-d)/m,1)),this._camera.position=o.bH([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),y=o.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),b=Math.max((t[2]-y)/Math.cos(d),v),E=this._zoomFromMercatorZ(b);o.bH(t,t,s,b),this._pitch=o.aA(d,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(m,-Math.PI,Math.PI),this._setZoom(o.aA(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,d=o.cL,m=0,y=1/0;for(;d-s>1e-6&&d>s;){const v=s+.5*(d-s),b=this.tileSize*Math.pow(2,v),E=this.getCameraToCenterDistance(this.projection,v,b),A=this.scaleZoom(E/(Math.max(0,t)*this.tileSize)),M=Math.abs(v-A);M<y&&(y=M,m=v),v<A?s=v:d=v}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const d=Math.min(t.x,s.x),m=Math.max(t.x,s.x),y=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const b=[new o.P(d,y),new o.P(m,v),new o.P(d,v),new o.P(m,y)],E=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const M of b){const O=this.pointRayIntersection(M);if(O.t<0)return!0;const z=this.rayIntersectionCoordinate(O);if(z.x<E||z.y<0||z.x>A||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,s){const d=o.ag(o.av([],this._camera.position,t)),m=this._zoomFromMercatorZ(d)+s;return d-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,d,m],y){const v=[s,d,m,1];o.aC(v,v,y);const b=v[3]=Math.max(v[3],1e-6);return v[0]/=b,v[1]/=b,v[2]/=b,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,d=this.worldSize){const m=o.cO(t,s,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,m);let v=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(v=o.ak(1,v,o.d0(this.pitch>=aa?1:this.pitch/aa))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(t,t,this.globeMatrix),t}getFrustum(t){return o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const jl=(u,t)=>{if(t>0&&u.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=u.transform,d=Math.max(Math.abs(s._zoom-(u.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?o.ah(60,45,s.pitch):o.ah(30,15,s.pitch),y=s._farZ-s._nearZ,v=t*s.height,b=((1-(E=m))*s.cameraToCenterDistance+E*(s._farZ+v))*d;var E;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(b-s._nearZ)/y,(b-v-s._nearZ)/y]}}},js=2048;class Bd{constructor(t,s){this.aabb=t,this.lastCascade=s}}class bw{add(t,s){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],s.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],s.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],s.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],s.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],s.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],s.max[2])):this.receivers[t.key]=new Bd(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,d){const m=o.d9.fromPoints(t.points);let y=0;for(const v in this.receivers){const b=this.receivers[v];if(!b||!m.intersectsAabb(b.aabb))continue;b.aabb.min=m.closestPoint(b.aabb.min),b.aabb.max=m.closestPoint(b.aabb.max);const E=b.aabb.getCorners();for(let A=0;A<d.length;A++){let M=!0;for(const O of E){const z=[O[0]*s,O[1]*s,O[2]];if(o.af(z,z,d[A].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){M=!1;break}}if(b.lastCascade=A,y=Math.max(y,A),M)break}}return y+1}}class pu{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bw,this._depthMode=new Qt(t.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=d.style.order.reduce((V,U)=>{const X=d.style._mergedLayers[U];return V+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=d.context,v=js,b=js;if(this._cascades.length===0||js!==this._cascades[0].texture.size[0]){this._cascades=[];for(let V=0;V<2;++V){const U=d._shadowMapDebug,X=y.gl,Z=y.createFramebuffer(v,b,U?1:0,"texture"),ne=new o.T(y,{width:v,height:b,data:null},X.DEPTH_COMPONENT16);if(Z.depthAttachment.set(ne.texture),U){const ae=new o.T(y,{width:v,height:b,data:null},X.RGBA8);Z.colorAttachment0.set(ae.texture)}this._cascades.push({framebuffer:Z,texture:ne,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cB,scale:0})}}this.shadowDirection=Ud(s);let E=0;if(t.elevation){const V=t.elevation,U=[1e4,-1e4];V.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const Z=X.dem.tree;U[0]=Math.min(U[0],Z.minimums[0]),U[1]=Math.max(U[1],Z.maximums[0])}),U[0]!==1e4&&(E=(U[1]-U[0])*V.exaggeration())}const A=1.5*t.cameraToCenterDistance,M=3*A,O=new Float64Array(16);for(let V=0;V<this._cascades.length;++V){const U=this._cascades[V];let X=t.height/50,Z=1;V===0?Z=A:(X=A,Z=M);const[ne,ae]=Ul(t,this.shadowDirection,X,Z,js,E);U.scale=t.scale,U.matrix=ne,U.boundingSphereRadius=ae,o.bl(O,U.matrix),U.frustum=o.cB.fromInvProjectionMatrix(O,1,0,!0),U.far=Z}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=js,this._uniformValues.u_shadowmap_0=eo.ShadowMap0,this._uniformValues.u_shadowmap_1=eo.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const F=d.transform.elevation;for(const V of this._groundShadowTiles){let U={min:0,max:0};if(F){const X=F.getMinMaxForTile(V);X&&(U=X)}this.addShadowReceiver(V.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const d=this.painter,m=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),m.viewport.set([0,0,js,js]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,m.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),m.clear({color:o.ao.white,depth:1});for(const v of t.order){const b=t._mergedLayers[v];if(!b.hasShadowPass()||b.isHidden(d.transform.zoom))continue;const E=t.getLayerSourceCache(b),A=E?s[E.id]:void 0;(b.type==="model"||A&&A.length)&&d.renderLayer(d,E,b,A)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,d=t.context,m=d.gl,y=s.directionalLight,v=s.ambientLight;if(!y||!v)return;const b=[],E=jl(t,t.longestCutoffRange);E.shouldRenderCutoff&&b.push("RENDER_CUTOFF"),b.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&b.push("NORMAL_OFFSET");const A=el(s,y,v),M=new Qt(m.LEQUAL,Qt.ReadOnly,t.depthRangeFor3D),O=new yn({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const z of this._groundShadowTiles){const F=z.toUnwrapped(),V=t.isTileAffectedByFog(z),U=t.getOrCreateProgram("groundShadow",{defines:b,overrideFog:V});this.setupShadows(F,U),t.uploadCommonUniforms(d,U,F,null,E);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:A};U.draw(t,m.TRIANGLES,M,O,Mn.multiply,gn.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Mn.unblended:Mn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,d=s.calculatePosMatrix(t,s.worldSize);return o.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){const s=o.bz(t);return o.aB(s,this._cascades[this.painter.currentShadowCascade].matrix,t),s}setupShadows(t,s,d){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,v=y.gl,b=this._uniformValues,E=new Float64Array(16),A=m.calculatePosMatrix(t,m.worldSize);for(let M=0;M<this._cascades.length;M++)o.aB(E,this._cascades[M].matrix,A),b[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),y.activeTexture.set(v.TEXTURE0+eo.ShadowMap0+M),this._cascades[M].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const M=o.d7(t.canonical),O=2/m.tileSize*o.al/js,z=O*this._cascades[0].boundingSphereRadius,F=O*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(d==="vector-tile"?1:3)*function(U,X,Z,ne,ae){const re=o.aA((U-22)/-22,0,1);return .125*(1-re)+4*re}(m.zoom);b.u_shadow_normal_offset=[M,z*V,F*V],b.u_shadow_bias=[1e-4,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(y,b)}setupShadowsFromMatrix(t,s,d=!1){if(!this.enabled)return;const m=this.painter.context,y=m.gl,v=this._uniformValues,b=new Float64Array(16);for(let E=0;E<2;E++)o.aB(b,this._cascades[E].matrix,t),v[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),m.activeTexture.set(y.TEXTURE0+eo.ShadowMap0+E),this._cascades[E].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);this.useNormalOffset=d,d?(v.u_shadow_normal_offset=[1,3,3],v.u_shadow_bias=[6e-5,.0012,.012]):v.u_shadow_bias=[36e-5,.0012,.012],s.setShadowUniformValues(m,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,d,m){if(m[2]>=0)return{};const y=function(E,A,M){const O=M/(1<<E.canonical.z);return new o.d9([E.canonical.x*O+E.wrap*M,E.canonical.y*O+E.wrap*M,0],[(E.canonical.x+1)*O+E.wrap*M,(E.canonical.y+1)*O+E.wrap*M,A])}(t,s,d).getCorners(),v=s/-m[2];m[0]<0?(o.d8(y[0],y[0],[m[0]*v,0,0]),o.d8(y[3],y[3],[m[0]*v,0,0])):m[0]>0&&(o.d8(y[1],y[1],[m[0]*v,0,0]),o.d8(y[2],y[2],[m[0]*v,0,0])),m[1]<0?(o.d8(y[0],y[0],[0,m[1]*v,0]),o.d8(y[1],y[1],[0,m[1]*v,0])):m[1]>0&&(o.d8(y[2],y[2],[0,m[1]*v,0]),o.d8(y[3],y[3],[0,m[1]*v,0]));const b={};return b.vertices=y,b.planes=[jd(y[1],y[0],y[4]),jd(y[2],y[1],y[5]),jd(y[3],y[2],y[6]),jd(y[0],y[3],y[7])],b}addShadowReceiver(t,s,d){this._receivers.add(t,o.d9.fromTileIdAndHeight(t,s,d))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function jd(u,t,s){const d=o.av([],s,t),m=o.av([],u,t),y=o.bI([],d,m),v=o.ag(y);return v===0?[0,0,1,0]:(o.c5(y,y,1/v),[y[0],y[1],y[2],-o.bJ(y,t)])}function Ud(u){const t=u.properties.get("direction"),s=o.d4(t.x,t.y,t.z);s[2]=o.aA(s[2],0,75);const d=o.d6([s[0],s[1],s[2]]);return o.d5(d.x,d.y,d.z)}function el(u,t,s){const d=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),y=t.properties.get("intensity"),v=t.properties.get("direction"),b=[v.x,v.y,v.z],E=s.properties.get("color-use-theme")==="none",A=s.properties.get("color"),M=s.properties.get("intensity"),O=Math.max(o.bJ([0,0,1],b),0),z=[0,0,0];o.c5(z,A.toPremultipliedRenderColor(E?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),M);const F=[0,0,0];return o.c5(F,m.toPremultipliedRenderColor(d?null:u.getLut(s.scope)).toArray01Linear().slice(0,3),O*y),o.db([z[0]>0?z[0]/(z[0]+F[0]):0,z[1]>0?z[1]/(z[1]+F[1]):0,z[2]>0?z[2]/(z[2]+F[2]):0])}function Ul(u,t,s,d,m,y){const v=u.zoom,b=u.scale,E=u.worldSize,A=1/E,M=u.aspect,O=Math.sqrt(1+M*M)*Math.tan(.5*u.fovX),z=O*O,F=d-s,V=d+s;let U,X;z>F/V?(U=d,X=d*O):(U=.5*V*(1+z),X=.5*Math.sqrt(F*F+2*(d*d+s*s)*z+V*V*z*z));const Z=u.projection.pixelsPerMeter(u.center.lat,E),ne=u._camera.getCameraToWorldMercator(),ae=[0,0,-U*A];o.af(ae,ae,ne);let re=X*A;const we=u._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const lt=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?Z:1),Ct=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,s,d);Ct[8]=2*-u.centerOffset.x/u.width,Ct[9]=2*u.centerOffset.y/u.height;const zt=new Float64Array(16);o.cP(zt,Ct,lt);const St=new Float64Array(16);o.bl(St,zt);const yt=o.cB.fromInvProjectionMatrix(St,E,v,!0);for(const Xt of yt.points){const Ut=((ge=Xt)[0]/=b,ge[1]/=b,ge[2]=o.cf(ge[2],u._center.lat),ge);re=Math.max(re,o.c6(o.da([],ae,Ut)))}}var ge;re*=m/(m-1);const ve=Math.acos(t[2]),me=Math.atan2(-t[0],-t[1]),he=new bf;he.position=ae,he.setPitchBearing(ve,me);const Se=he.getWorldToCamera(E,Z),Le=re*E,Re=Math.min(u._mercatorZfromZoom(17)*E*-2,-2*Le),qe=he.getCameraToClipOrthographic(-Le,Le,-Le,Le,Re,(Le+y*Z)/t[2]),Ze=new Float64Array(16);o.aB(Ze,qe,Se);const tt=o.d5(Math.floor(1e6*ae[0])/1e6*E,Math.floor(1e6*ae[1])/1e6*E,0),_t=.5*m,Ue=[0,0,0];o.af(Ue,tt,Ze),o.c5(Ue,Ue,_t);const Ae=[Math.floor(Ue[0]),Math.floor(Ue[1]),Math.floor(Ue[2])],Ke=[0,0,0];o.av(Ke,Ue,Ae),o.c5(Ke,Ke,-1/_t);const $e=new Float64Array(16);return o.bA($e),o.br($e,$e,Ke),o.aB(Ze,$e,Ze),[Ze,Le]}class Tw extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return o.dc(this.requestManager.transformRequest(s,o.R.Model).url).then(d=>{if(!d)return;const m=o.dd(d),y=new o.de(t,s,void 0,void 0,m);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${t} from ${s}: ${d.message}`)))})}load(t,s,d={forceReload:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t),y=[],v=[];for(const b of m){const E=t[b];this.hasURLBeenRequested(E)&&!d.forceReload||(this.modelByURL[E]={modelId:b,scope:s},y.push(this.loadModel(b,E)),v.push(b)),this.models[s][b]||(this.models[s][b]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+v.length,Promise.allSettled(y).then(b=>{for(let E=0;E<b.length;E++){const{status:A}=b[E];if(A==="rejected")continue;const{value:M}=b[E];this.models[s][v[E]]||(this.models[s][v[E]]={model:null,numReferences:1}),this.models[s][v[E]].model=M}this.numModelsLoading[s]-=v.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(b=>{this.fire(new o.y(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const m=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===m)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:y,modelId:v}=this.modelByURL[m];this.models[y][v].numReferences++}else this.modelUris[d][t]=m,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const d=this.modelUris[s];for(const m in t)d[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const d={};for(const m of t)this.hasModel(m,s,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[s][m].numReferences++:this.modelUris[s][m]&&!this.hasURLBeenRequested(m)?d[m]=this.modelUris[s][m]:!this.hasURLBeenRequested(m)&&o.df(m,!1)&&(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),d[m]=this.modelUris[s][m]);this.load(d,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,d=!1,m=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0||m)){const y=this.modelUris[s][t];d||delete this.modelUris[s][t],delete this.modelByURL[y];const v=this.models[s][t].model;if(!v)return;delete this.models[s][t],v.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const d=this.models[t][s].model;delete this.models[t][s],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const d in this.models[s])this.models[s][d].model&&this.models[s][d].model.upload(t.context)}}const sg=o.a6.colorTheme,Sw=new o.a9({data:new o.aa(sg.data)});function hv(u){if(!u.metadata||!u.metadata.content_area)return;const t=o.o.devicePixelRatio,{left:s,top:d,width:m,height:y}=u.metadata.content_area,v=s*t,b=d*t;return[v,b,v+m*t,b+y*t]}function fv(u){if(u)return u.map(([t,s])=>[t*o.o.devicePixelRatio,s*o.o.devicePixelRatio])}class ag{constructor(t,s,d){this.id=t,this.scope=s,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof Do))return t;const m=s.map(v=>this.sourceCache.getTile(v)),y=d.getImages(m,Array.from(this.pendingRequests));for(const[v,b]of y)t.set(o.I.from({name:v,iconsetId:this.id}),b),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const Vl=(u,t)=>de(u,t&&t.filter(s=>s.identifier!=="source.canvas")),pv=o.aH(ii,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),mv=o.aH(ii,["setCenter","setZoom","setBearing","setPitch"]),Sf=new Set(["background","sky","slot","custom"]),$l={version:8,layers:[],sources:{}},Vd={duration:300,delay:0};class Us extends o.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=Object.assign({},Vd),this._buildingIndex=new xw(this),this.crossTileSymbolIndex=new sa,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=s.styleChanges||new Di,this._hasDataDrivenEmissive=!1,this.dispatcher=s.dispatcher?s.dispatcher:new o.D(o.dh(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Rs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new o.di(t._requestManager,s.localFontFamily?o.dj.all:s.localIdeographFontFamily?o.dj.ideographs:o.dj.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Tw(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._indoorDependentLayers=s.indoorDependentLayers?s.indoorDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",o.dk());const d=this;this._rtlTextPluginCallback=Us.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,v)=>{if(o.dl(y),v&&v.every(b=>b))for(const b in d._sourceCaches){const E=d._sourceCaches[b],A=E.getSource().type;A!=="vector"&&A!=="geojson"||E.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getOwnSource(m.sourceId);if(y&&y.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===y.id&&this._validateLayer(b)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.h(t))return t;const s=o.dm(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${o.dn(JSON.stringify(t))}`}_diffStyle(t,s,d){this.globalId=this._getGlobalId(t);const m=(y,v)=>{try{v(null,this.setState(y,d))}catch(b){v(b,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(y,o.R.Style);o.m(v,(b,E)=>{b?this.fire(new o.y(b)):E&&m(E,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new o.z("dataloading",{dataType:"style"}));const d=typeof s.validate=="boolean"?s.validate:!o.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,d);const y=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.m(y,(v,b)=>{if(this._request=null,v)this.fire(new o.y(v));else if(b)return this.importsCache.set(t,b),this._load(b,d)})}loadJSON(t,s={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.o.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load($l,!1)}_loadImports(t,s,d){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const y of t){const v=this._createFragmentStyle(y),b=new Promise(M=>{v.once("style.import.load",M),v.once("error",M)}).then(()=>this.mergeAll());if(m.push(b),this.resolvedImports.has(y.url)){v.loadEmpty();continue}const E=y.data||this.importsCache.get(y.url);E?(v.loadJSON(E,{validate:s}),this._isInternalStyle(E)&&(v.globalId=null)):y.url?v.loadURL(y.url,{validate:s}):v.loadEmpty();const A={style:v,id:y.id,config:y.config};if(d){const M=this.fragments.findIndex(({id:O})=>O===d);this.fragments=this.fragments.slice(0,M).concat(A).concat(this.fragments.slice(M))}else this.fragments.push(A)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const d of t.fragments)d.style.globalId&&s.add(d.style.globalId),this.getImportGlobalIds(d.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?o.B(t.id,this.scope):t.id;let d;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(d=Object.assign({},t.config,m));const y=new Us(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){if(this._isInternalStyle(t)){const y=Object.assign({},$l,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(y,s)}if(this.updateConfig(this._config,t.schema),s&&Vl(this,Wi(t)))return;this._loaded=!0,this.stylesheet=o.dp(t);const d=()=>{for(const E in t.sources)this.addSource(E,t.sources[E],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const E in t.iconsets)this.addIconset(E,t.iconsets[E]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const y=Md(this.stylesheet.layers);if(this._order=y.map(E=>E.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const E=this.stylesheet.lights[0];this.light=new De(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new De(this.stylesheet.light)),this._layers={};for(const E of y){const A=o.du(E,this.scope,this._styleColorTheme.lut,this.options);A.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),A.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(A.fqid),this._hasAppearances=this._hasAppearances||A.getAppearances().length!==0,A.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=A;const M=this.getOwnLayerSourceCache(A),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&A.canCastShadows()&&O&&(M.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const v=this.stylesheet.terrain;v&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const b=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new o.z(b?"style.load":"style.import.load"))}).catch(E=>{this.fire(new o.y(new Error("Failed to load imports",E))),this.fire(new o.z(b?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(b?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{d()}).catch(v=>{o.w(`Couldn't load color theme from the stylesheet: ${v}`),d()})}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(t=>t.style.hasAppearances())}mergeAll(){let t,s,d,m,y,v,b,E,A,M;const O={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(t=z.light),z.stylesheet.lights)for(const F of z.stylesheet.lights)F.type==="ambient"&&z.ambientLight!=null&&(s=z.ambientLight),F.type==="directional"&&z.directionalLight!=null&&(d=z.directionalLight);m=this._prioritizeTerrain(m,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(y=z.fog),z.stylesheet.snow&&z.snow!=null&&(v=z.snow),z.stylesheet.rain&&z.rain!=null&&(b=z.rain),z.stylesheet.camera!=null&&(M=z.stylesheet.camera),z.stylesheet.projection!=null&&(E=z.stylesheet.projection),z.stylesheet.transition!=null&&(A=z.stylesheet.transition),O[z.scope]=z._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=d,this.fog=y,this.snow=v,this.rain=b,this._styleColorThemeForScope=O,m===null?delete this.terrain:this.terrain=m,this.camera=M||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=Object.assign({},Vd,A),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const s=d=>{for(const m of d.fragments)s(m.style);t(d)};s(this)}_prioritizeTerrain(t,s,d){const m=t&&t.drapeRenderMode===0;return d===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},d={};this.forEachFragmentStyle(m=>{for(const y in m._sourceCaches){const v=o.B(y,m.scope);t[v]=m._sourceCaches[y]}for(const y in m._otherSourceCaches){const v=o.B(y,m.scope);s[v]=m._otherSourceCaches[y]}for(const y in m._symbolSourceCaches){const v=o.B(y,m.scope);d[v]=m._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=d}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const s of Object.values(t.stylesheet.indoor)){const d=s,m=o.B(d.sourceId,t.scope);this._mergedIndoor[m]=new Set(d.sourceLayers||[])}})}mergeLayers(){const t={},s=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const b of v._order){const E=v._layers[b];if(E.type==="slot"){const A=o.dq(b);if(t[A])continue;t[A]=[]}E.slot&&t[E.slot]?t[E.slot].push(E):s.push(E)}}),this._mergedOrder=[];let m=-1;const y=(v=[])=>{for(const b of v)if(b.type==="slot"){const E=o.dq(b.id);t[E]&&y(t[E]),this._mergedSlots.push(E)}else{const E=o.B(b.id,b.scope);this._mergedOrder.push(E),d[E]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0,m=this._mergedOrder.length-1),b.type==="circle"&&(this._hasCircleLayers=!0),b.type==="symbol"&&(this._hasSymbolLayers=!0),b.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(s),this._has3DLayers){const v={};for(let b=0;b<this._mergedOrder.length;++b){const E=this._mergedOrder[b];v[E]=b===m?1:b<m?d[E].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((b,E)=>v[b]-v[E])}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,d,m,y){const v=Object.assign({},d);for(const E of Object.keys(sg))v[E]===void 0&&(v[E]=sg[E].default);const b=new o.a8(Sw,s,new Map(m));return b.setTransitionOrValue(v,m),b.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,m)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let v=t;v.startsWith(y)||(v=y+v);const b=o.I.from("mapbox-reserved-lut"),E=new Image;E.src=v,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},E.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void d();this._styleColorTheme.lutLoading=!1;const{width:A,height:M,data:O}=o.o.getImageData(E);if(M>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(A!==M*M)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(b)&&this.removeImage(b),this.addImage(b,{data:new o.q({width:A,height:M},O),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(b,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},d()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,d,m){let y,v,b;const E=o.o.devicePixelRatio>1?"@2x":"";let A=o.m(d.transformRequest(d.normalizeSpriteURL(s,E,".json"),o.R.SpriteJSON),(z,F)=>{A=null,b||(b=z,y=F,O())}),M=o.n(d.transformRequest(d.normalizeSpriteURL(s,E,".png"),o.R.SpriteImage),(z,F)=>{M=null,b||(b=z,v=F,O())});function O(){if(b)m(b);else if(y&&v){const z=o.o.getImageData(v),F={};for(const V in y){const{width:U,height:X,x:Z,y:ne,sdf:ae,pixelRatio:re,stretchX:we,stretchY:ge,content:ve}=y[V],me=new o.q({width:U,height:X});o.q.copy(z,me,{x:Z,y:ne},{x:0,y:0},{width:U,height:X},null),F[V]={data:me,pixelRatio:re!==void 0?re:1,sdf:ae!==void 0&&ae,stretchX:we,stretchY:ge,content:ve,usvg:!1,version:0}}m(null,F)}}return{cancel(){A&&(A.cancel(),A=null),M&&(M.cancel(),M=null)}}}(t,this.map._requestManager,(s,d)=>{if(this._spriteRequest=null,s)this.fire(new o.y(s));else if(d){const m=new Map;for(const y in d)m.set(o.I.from(y),d[y]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const d=this.getOwnSourceCache(s.source);if(!d)return void this.fire(new o.y(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=d.getSource();if(m.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const y=new ag(t,this.scope,d);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var d,m;this._spriteRequest=(m=(y,v)=>{if(this._spriteRequest=null,y)s?this._loadSprite(t):this.fire(new o.y(y));else if(v){const b=new Map;for(const E in v)b.set(o.I.from(E),v[E]);this.addImages(b)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),o.R.Iconset),(y,v)=>{if(y)return void m(y);const b={},E=o.dg(new o.bt(v));for(const A of E.icons){const M={version:1,pixelRatio:o.o.devicePixelRatio,content:hv(A),stretchX:A.metadata?fv(A.metadata.stretch_x_areas):void 0,stretchY:A.metadata?fv(A.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:A};b[A.name]=M}m(null,b)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const d=t.sourceLayer;d&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.y(new Error(`Source layer "${d}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const d=this.fragments[s];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const d=this._sourceCaches[s].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const s=[];for(const d of t){const m=this._layers[d];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];if(s._transitionablePaint&&s._transitionablePaint._values){const d=s._transitionablePaint._values["line-emissive-strength"];if(d&&d.value&&d.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new o.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new o.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const d=this.map.painter;if(d)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const y=t.getProgramIds();if(y)for(const v of y){const b=t.getDefaultProgramParams(v,s.zoom,this._styleColorTheme.lut);b&&(d.style=this,this.fog&&(d._fogVisible=!0,b.overrideFog=!0,d.getOrCreateProgram(v,b)),d._fogVisible=!1,b.overrideFog=!1,d.getOrCreateProgram(v,b),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(b.overrideRtt=!0,d.getOrCreateProgram(v,b)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const b=this._changes.getLayerUpdatesByScope();for(const E in b){const{updatedIds:A,removedIds:M}=b[E];(A||M)&&(this._updateWorkerLayers(E,A,M),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const b in this._mergedSourceCaches){const E=this._mergedSourceCaches[b];y[b]=E.used,E.used=!1,E.tileCoverLift=0}for(const b of this._mergedOrder){const E=this._mergedLayers[b];if(E.visibility!=="none"&&E.recalculate(t,this._availableImages),!E.isHidden(t.zoom)){const A=this.getLayerSourceCache(E);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,E.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(E,t)}):this.precompilePrograms(E,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const b of v)b.sourceCache.used=!0;for(const b in y){const E=this._mergedSourceCaches[b];y[b]!==E.used&&E.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const d=s.resolvePendingRequests(),m=this.getFragmentStyle(s.scope);m&&m.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const d=this._mergedSourceCaches[s].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,d){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:d||[],options:m.options})}setState(t,s){if(this._checkLoaded(),Vl(this,Wi(t)))return!1;(t=o.dp(t)).layers=Md(t.layers);const d=function(v,b){if(!v)return[{command:ii.setStyle,args:[b]}];let E=[];try{if(!o.by(v.version,b.version))return[{command:ii.setStyle,args:[b]}];if(o.by(v.center,b.center)||E.push({command:ii.setCenter,args:[b.center]}),o.by(v.zoom,b.zoom)||E.push({command:ii.setZoom,args:[b.zoom]}),o.by(v.bearing,b.bearing)||E.push({command:ii.setBearing,args:[b.bearing]}),o.by(v.pitch,b.pitch)||E.push({command:ii.setPitch,args:[b.pitch]}),o.by(v.sprite,b.sprite)||E.push({command:ii.setSprite,args:[b.sprite]}),o.by(v.glyphs,b.glyphs)||E.push({command:ii.setGlyphs,args:[b.glyphs]}),o.by(v.imports,b.imports)||function(F=[],V=[],U){V=V||[];const X=(F=F||[]).map(Rd),Z=V.map(Rd),ne=F.reduce(Dd,{}),ae=V.reduce(Dd,{}),re=X.slice();let we,ge,ve,me;for(we=0,ge=0;we<X.length;we++)ve=X[we],ae.hasOwnProperty(ve)?ge++:(U.push({command:ii.removeImport,args:[ve]}),re.splice(re.indexOf(ve,ge),1));for(we=0,ge=0;we<Z.length;we++)ve=Z[Z.length-1-we],re[re.length-1-we]!==ve&&(ne.hasOwnProperty(ve)?(U.push({command:ii.removeImport,args:[ve]}),re.splice(re.lastIndexOf(ve,re.length-ge),1)):ge++,me=re[re.length-we],U.push({command:ii.addImport,args:[ae[ve],me]}),re.splice(re.length-we,0,ve));for(const he of V){const Se=ne[he.id];Se&&(delete Se.data,o.by(Se,he)||U.push({command:ii.updateImport,args:[he.id,he]}))}}(v.imports,b.imports,E),o.by(v.transition,b.transition)||E.push({command:ii.setTransition,args:[b.transition]}),o.by(v.light,b.light)||E.push({command:ii.setLight,args:[b.light]}),o.by(v.fog,b.fog)||E.push({command:ii.setFog,args:[b.fog]}),o.by(v.snow,b.snow)||E.push({command:ii.setSnow,args:[b.snow]}),o.by(v.rain,b.rain)||E.push({command:ii.setRain,args:[b.rain]}),o.by(v.projection,b.projection)||E.push({command:ii.setProjection,args:[b.projection]}),o.by(v.lights,b.lights)||E.push({command:ii.setLights,args:[b.lights]}),o.by(v.camera,b.camera)||E.push({command:ii.setCamera,args:[b.camera]}),o.by(v.iconsets,b.iconsets)||function(F,V,U){let X;for(X in V=V||{},F=F||{})F.hasOwnProperty(X)&&(V.hasOwnProperty(X)||U.push({command:ii.removeIconset,args:[X]}));for(X in V){if(!V.hasOwnProperty(X))continue;const Z=V[X];F.hasOwnProperty(X)?o.by(F[X],Z)||(U.push({command:ii.removeIconset,args:[X]}),U.push({command:ii.addIconset,args:[X,Z]})):U.push({command:ii.addIconset,args:[X,Z]})}}(v.iconsets,b.iconsets,E),!o.by(v["color-theme"],b["color-theme"]))return[{command:ii.setStyle,args:[b]}];const A={},M=[];(function(F,V,U,X){let Z;for(Z in V=V||{},F=F||{})F.hasOwnProperty(Z)&&(V.hasOwnProperty(Z)||Km(Z,U,X));for(Z in V){if(!V.hasOwnProperty(Z))continue;const ne=V[Z];F.hasOwnProperty(Z)?o.by(F[Z],ne)||(F[Z].type==="geojson"&&ne.type==="geojson"&&lv(F,V,Z)?U.push({command:ii.setGeoJSONSourceData,args:[Z,ne.data]}):av(Z,V,U,X)):ff(Z,V,U)}})(v.sources,b.sources,M,A);const O=[];v.layers&&v.layers.forEach(F=>{F.source&&A[F.source]?E.push({command:ii.removeLayer,args:[F.id]}):O.push(F)});let z=v.terrain;z&&A[z.source]&&(E.push({command:ii.setTerrain,args:[void 0]}),z=void 0),E=E.concat(M),o.by(z,b.terrain)||E.push({command:ii.setTerrain,args:[b.terrain]}),function(F,V,U){V=V||[];const X=(F=F||[]).map(Rd),Z=V.map(Rd),ne=F.reduce(Dd,{}),ae=V.reduce(Dd,{}),re=X.slice(),we=Object.create(null);let ge,ve,me,he,Se,Le,Re;for(ge=0,ve=0;ge<X.length;ge++)me=X[ge],ae.hasOwnProperty(me)?ve++:(U.push({command:ii.removeLayer,args:[me]}),re.splice(re.indexOf(me,ve),1));for(ge=0,ve=0;ge<Z.length;ge++)me=Z[Z.length-1-ge],re[re.length-1-ge]!==me&&(ne.hasOwnProperty(me)?(U.push({command:ii.removeLayer,args:[me]}),re.splice(re.lastIndexOf(me,re.length-ve),1)):ve++,Le=re[re.length-ge],U.push({command:ii.addLayer,args:[ae[me],Le]}),re.splice(re.length-ge,0,me),we[me]=!0);for(ge=0;ge<Z.length;ge++)if(me=Z[ge],he=ne[me],Se=ae[me],!we[me]&&!o.by(he,Se))if(o.by(he.source,Se.source)&&o.by(he["source-layer"],Se["source-layer"])&&o.by(he.type,Se.type)){for(Re in Fl(he.layout,Se.layout,U,me,null,ii.setLayoutProperty),Fl(he.paint,Se.paint,U,me,null,ii.setPaintProperty),o.by(he.slot,Se.slot)||U.push({command:ii.setSlot,args:[me,Se.slot]}),o.by(he.filter,Se.filter)||U.push({command:ii.setFilter,args:[me,Se.filter]}),o.by(he.minzoom,Se.minzoom)&&o.by(he.maxzoom,Se.maxzoom)||U.push({command:ii.setLayerZoomRange,args:[me,Se.minzoom,Se.maxzoom]}),he)he.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?Fl(he[Re],Se[Re],U,me,Re.slice(6),ii.setPaintProperty):o.by(he[Re],Se[Re])||U.push({command:ii.setLayerProperty,args:[me,Re,Se[Re]]}));for(Re in Se)Se.hasOwnProperty(Re)&&!he.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?Fl(he[Re],Se[Re],U,me,Re.slice(6),ii.setPaintProperty):o.by(he[Re],Se[Re])||U.push({command:ii.setLayerProperty,args:[me,Re,Se[Re]]}))}else U.push({command:ii.removeLayer,args:[me]}),Le=re[re.lastIndexOf(me)+1],U.push({command:ii.addLayer,args:[Se,Le]})}(O,b.layers,E)}catch(A){console.warn("Unable to compute style diff:",A),E=[{command:ii.setStyle,args:[b]}]}return E}(this.serialize(),t).filter(v=>!(v.command in mv));if(d.length===0)return!1;const m=d.filter(v=>!(v.command in pv));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);const y=[];return d.forEach(v=>{y.push(this[v.command](...v.args))}),s&&Promise.all(y).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[s,d]of t.entries()){if(this.getImage(s))return this.fire(new o.y(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,d),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new o.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(t,s,d=!1){this.imageManager.updateImage(t,this.scope,s),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(t,s,d={}){return this._checkLoaded(),this._validate(W,`models.${t}`,s,null,d)||(this.modelManager.addModel(t,s,this.getActualScope()),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,s,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Fo,`sources.${t}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=qr(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const y=v=>{const b=(v?"symbol:":"other:")+m.id,E=o.B(b,this.scope),A=this._sourceCaches[b]=new os(E,m,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=A,A.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([y,v])=>v.type==="source"&&v.source===t);if(m)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const m of d){const y=o.dq(m.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(m.id),m.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const d=this.getOwnSourceCache(s);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const d=t[s]._tiles;for(const m in d){const y=d[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const y of t){if(this._validate(bo,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(y),v.updateTransitions(s)}else this.ambientLight=new ni(y,Pr||(Pr=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(y),v.updateTransitions(s)}else this.directionalLight=new ni(y,pr||(pr=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(s,{worldview:this.map.getWorldview()}),m=new o.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const d=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),m=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),v=t.properties.get("direction"),b=1-o.d4(v.x,v.y,v.z)[2]/90,E=d(m)*y*b,A=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),M=s.properties.get("intensity"),O=d(A)*M;return Number(((E+O)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.dr(t)){const s=o.ds(t),d=this.fragments.find(({id:y})=>y===s);if(!d)return;const m=o.dq(t);return d.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:d})=>d===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},d=(m,y="")=>`${m}::${y}`;this._featuresetSelectors={};for(const m in t){const y=this._featuresetSelectors[m]=[];for(const v of t[m].selectors){if(v.featureNamespace){const E=this.getOwnLayer(v.layer);if(!E){o.w(`Layer is undefined for selector: ${v.layer}`);continue}const A=d(E.source,E.sourceLayer);if(A in s&&s[A]!==v.featureNamespace){o.w(`"featureNamespace ${v.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[A]=v.featureNamespace}let b;if(v.properties)for(const E in v.properties){const A=o.U(v.properties[E]);A.result==="success"&&(b=b||{},b[E]=A.value)}y.push({layerId:v.layer,namespace:v.featureNamespace,properties:b,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const d=[];for(const m in s.stylesheet.featuresets)d.push({featuresetId:m,importId:s.scope?s.scope:void 0});return d}getFeaturesetLayers(t,s){const d=this.getFragmentStyle(s),m=d.stylesheet.featuresets;if(!m||!m[t])return this.fire(new o.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const v of m[t].selectors){const b=d.getOwnLayer(v.layer);b&&y.push(b)}return y}getConfigProperty(t,s){const d=this.getFragmentStyle(t);if(!d)return null;const m=o.B(s,d.scope),y=d.options.get(m),v=y?y.value||y.default:null;return v?v.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,s){const d=o.B(t,s);return this._mergedIndoor[d]}setIndoorData(t,s){this.map.indoor.setIndoorData(s)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,s,d){const m=this.getFragmentStyle(t);if(!m)return;const y=m.stylesheet.schema;if(!y||!y[s])return;const v=o.U(d);if(v.result!=="success")return void Vl(this,v.value);const b=v.value.expression,E=o.B(s,m.scope),A=m.options.get(E);if(!A)return;let M;const{minValue:O,maxValue:z,stepValue:F,type:V,values:U}=y[s],X=o.U(y[s].default);X.result==="success"&&(M=X.value.expression),M?(this.options.set(E,Object.assign({},A,{value:b,default:M,minValue:O,maxValue:z,stepValue:F,type:V,values:U})),this.updateConfigDependencies(s)):this.fire(new o.y(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const d=s.stylesheet.schema;if(!d)return null;const m={};for(const y in d){const v=o.B(y,s.scope),b=s.options.get(v),E=b?b.value||b.default:null;m[y]=E?E.serialize():null}return m}setConfig(t,s){const d=this.getFragmentStyle(t);d&&(d.updateConfig(s,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=s,d.updateConfig(d._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const d in s){let m,y;const v=o.U(s[d].default);if(v.result==="success"&&(m=v.value.expression),t&&t[d]!==void 0){const z=o.U(t[d]);z.result==="success"&&(y=z.value.expression)}const{minValue:b,maxValue:E,stepValue:A,type:M,values:O}=s[d];if(m){const z=o.B(d,this.scope);this.options.set(z,{default:m,value:y,minValue:b,maxValue:E,stepValue:A,type:M,values:O})}else this.fire(new o.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,s=()=>!0){for(const d of t){const m=this.getLayer(d);m&&s(m)&&(m.possiblyEvaluateVisibility(),this._updateLayer(m),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,s=>!t||s.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const d=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(d){const m=s._evaluateColorThemeData(d);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,s,d={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new o.y(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(t.type==="custom"){if(Vl(this,o.dt(t)))return;y=o.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=o.dp(t),t=Object.assign(t,{source:m})),this._validate(Ym,`layers.${m}`,t,{arrayIndex:-1},d))return;y=o.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const v=o.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(v),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(v);let b=this._order.length;if(s){const O=this._order.indexOf(s);if(O===-1)return void this.fire(new o.y(new Error(`Layer with id "${s}" does not exist on this map.`)));y.slot===this._layers[s].slot?b=O:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&y.canCastShadows()&&A&&(E.castsShadows=!0);const M=this._changes.getRemovedLayer(y);if(M&&y.source&&E&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const O=o.B(y.source,y.scope);M.type!==y.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let y=this._order.length;if(s){const v=this._order.indexOf(s);if(v===-1)return void this.fire(new o.y(new Error(`Layer with id "${s}" does not exist on this map.`)));d.slot===this._layers[s].slot?y=v:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._indoorDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let y=!1;for(const v in this._layers)if(this._layers[v].source===s.source&&this._layers[v].canCastShadows()){y=!0;break}m.castsShadows=y}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,d){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===d||(s!=null&&(m.minzoom=s),d!=null&&(m.maxzoom=d),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==s&&(d.slot=s,this._updateLayer(d))}setFilter(t,s,d={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!o.by(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(vc,`layers.${m.id}.filter`,s,{layerType:m.type},d)||(m.filter=o.dp(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return o.dp(s.filter)}setLayoutProperty(t,s,d,m={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!o.by(y.getLayoutProperty(s),d)){if(d!=null&&(!m||m.validate!==!1)&&Vl(y,Be.call(Wi,{key:`layers.${t}.layout.${s}`,layerType:y.type,objectKey:s,value:d,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(s,d),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(t,s,d,m={}){this._checkLoaded();const y=this._checkLayer(t);y&&(s==="appearances"?(y.setAppearances(d),this._changes.setDirty()):y.isPaintProperty(s)?this.setPaintProperty(t,s,d,m):this.setLayoutProperty(t,s,d,m))}getLayoutProperty(t,s){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(s)}setPaintProperty(t,s,d,m={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||o.by(y.getPaintProperty(s),d)||d!=null&&(!m||m.validate!==!1)&&Vl(y,Cd.call(Wi,{key:`layers.${t}.paint.${s}`,layerType:y.type,objectKey:s,value:d,styleSpec:o.a6})))return;const v=y.setPaintProperty(s,d);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),v&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,s){const d=this._checkLayer(t);if(d)return d.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:A}=t.target,M=this.getFragmentStyle(A),O=M.getFeaturesetLayers(E);for(const{source:z,sourceLayer:F}of O)M.setFeatureState({id:t.id,source:z,sourceLayer:F},s)}else if("layerId"in t.target){const{layerId:E}=t.target,A=this.getLayer(E);this.setFeatureState({id:t.id,source:A.source,sourceLayer:A.sourceLayer},s)}return}const d=t.source,m=t.sourceLayer,y=this._checkSource(d);if(!y)return;const v=y.type;if(v==="geojson"&&m)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!m)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const b=this.getOwnSourceCaches(d);for(const E of b)E.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:A}=t.target,M=this.getFragmentStyle(A),O=M.getFeaturesetLayers(E);for(const{source:z,sourceLayer:F}of O)M.removeFeatureState({id:t.id,source:z,sourceLayer:F},s)}else if("layerId"in t.target){const{layerId:E}=t.target,A=this.getLayer(E);this.removeFeatureState({id:t.id,source:A.source,sourceLayer:A.sourceLayer},s)}return}const d=t.source,m=this._checkSource(d);if(!m)return;const y=m.type,v=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!v)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const b=this.getOwnSourceCaches(d);for(const E of b)E.removeFeatureState(v,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:v,importId:b}=t.target,E=this.getFragmentStyle(b),A=E.getFeaturesetLayers(v);for(const{source:M,sourceLayer:O}of A){const z=E.getFeatureState({id:t.id,source:M,sourceLayer:O});if(z&&!y)y=z;else if(!o.by(y,z))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,b=this.getLayer(v);y=this.getFeatureState({id:t.id,source:b.source,sourceLayer:b.sourceLayer})}return y}const s=t.source,d=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||d)return t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(d,t.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),d=o.B(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[d]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=b=>this._mergedLayers[b].is3D(!!this.terrain),d=this.order,m={},y=[];for(let b=d.length-1;b>=0;b--){const E=d[b];if(s(E)){m[E]=b;for(const A of t){const M=A[E];if(M)for(const O of M)y.push(O)}}}y.sort((b,E)=>E.intersectionZ-b.intersectionZ);const v=[];for(let b=d.length-1;b>=0;b--){const E=d[b];if(s(E))for(let A=y.length-1;A>=0;A--){const M=y[A].feature;if(M.layer&&m[M.layer.id]<b)break;v.push(M),y.pop()}else for(const A of t){const M=A[E];if(M)for(const O of M)v.push(O.feature)}}return v}queryRasterValue(t,s,d){const m=this.getOwnSource(t);return m?m.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):m.queryRasterArrayValue(s,d):(this.fire(new o.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,s,d){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(vc,"queryRenderedFeatures.filter",s.filter,null,s),m=o.b6(s.filter));const y={},v=M=>{if(Sf.has(M.type))return;const O=this.getOwnLayerSourceCache(M),z=y[O.id]=y[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};M.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[M.fqid]=z.layers[M.fqid]||{styleLayer:M,targets:[]},z.layers[M.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const M of s.layers){const O=this._layers[M];if(!O)return this.fire(new o.y(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];v(O)}}else for(const M in this._layers)v(this._layers[M]);const b=this._queryRenderedFeatures(t,y,d),E=this._flattenAndSortRenderedFeatures(b),A=[];for(const M of E)o.dw(M.layer.id)===this.scope&&A.push(M);return A}queryRenderedFeatureset(t,s,d){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(vc,"queryRenderedFeatures.filter",s.filter,null,s),m=o.b6(s.filter));const y="mock",v=[];if(s&&s.target)v.push(Object.assign({},s,{targetId:y,filter:m}));else{const M=this.getFeaturesetDescriptors();for(const O of M)v.push({targetId:y,filter:m,target:O});for(const{style:O}of this.fragments){const z=O.getFeaturesetDescriptors();for(const F of z)v.push({targetId:y,filter:m,target:F})}}const b=this.queryRenderedTargets(t,v,d),E=[],A=new Set;for(const M of b)for(const O of M.variants[y])uu(O,M,A)||E.push(new o.dx(M,O));return E}queryRenderedTargets(t,s,d){const m={},y=(b,E,A,M)=>{const O=m[E.id]=m[E.id]||{sourceCache:E,layers:{},has3DLayers:!1};if(O.layers[b.fqid]=O.layers[b.fqid]||{styleLayer:b,targets:[]},b.is3D(!!this.terrain)&&(O.has3DLayers=!0),!M)return A.uniqueFeatureID=!1,void O.layers[b.fqid].targets.push(A);O.layers[b.fqid].targets.push(Object.assign({},A,{namespace:M.namespace,properties:M.properties,uniqueFeatureID:M.uniqueFeatureID}))};for(const b of s)if("featuresetId"in b.target){const{featuresetId:E,importId:A}=b.target,M=this.getFragmentStyle(A);if(!M||!M._featuresetSelectors)continue;const O=M._featuresetSelectors[E];if(!O){this.fire(new o.y(new Error(`The featureset '${E}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of O){const F=M.getOwnLayer(z.layerId);F&&!Sf.has(F.type)&&y(F,M.getOwnLayerSourceCache(F),b,z)}}else if("layerId"in b.target){const{layerId:E}=b.target,A=this.getLayer(E);if(!A||Sf.has(A.type))continue;y(A,this.getLayerSourceCache(A),b)}const v=this._queryRenderedFeatures(t,m,d);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,s,d){const m=[],y=!!this.map._showQueryGeometry,v=sr.createFromScreenPoints(t,d);for(const b in s){const E=af(v,s[b],this._availableImages,d,y);Object.keys(E).length&&m.push(E)}if(this.placement)for(const b in s){if(!s[b].sourceCache._onlySymbols)continue;const E=lf(v.screenGeometry,s[b],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(E).length&&m.push(E)}return m}querySourceFeatures(t,s){const d=s&&s.filter;d&&this._validate(vc,"querySourceFeatures.filter",d,null,s);let m=[];const y=this.getOwnSourceCaches(t);for(const v of y)m=m.concat(cf(v,s));return m}addSourceType(t,s,d){return Us.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Us.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,d={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const b in t)if(!o.by(t[b],m[b])){y=!0;break}if(!y)return;const v=this._getTransitionParameters();this.light.setLight(t,s,d),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const m=!("source"in t)||t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if("source"in d&&typeof d.source=="object"){const b="terrain-dem-src";this.addSource(b,d.source),d=o.dp(d),d=Object.assign(d,{source:b})}const y=Object.assign({},d),v={};if(this.terrain&&m){y.source=this.terrain.get().source;const b=this.terrain?this.getFragmentStyle(this.terrain.scope):null;b&&(v.style=b.serialize())}if(this._validate(na,"terrain",y,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,s),this.fire(new o.z("data",{dataType:"style"}))}else{const y=this.terrain,v=y.get();for(const b of Object.keys(o.a6.terrain))!d.hasOwnProperty(b)&&o.a6.terrain[b].default&&(d[b]=o.a6.terrain[b].default);for(const b in t)if(!o.by(t[b],v[b])){y.set(t,this.options),this.stylesheet.terrain=t;const E=this._getTransitionParameters({duration:0});y.updateTransitions(E),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new In(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createSnow(t){const s=this.snow=new Lr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createRain(t){const s=this.rain=new or(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!o.by(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!o.by(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!o.by(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(s);this._loadColorTheme(d).then(()=>{this.fire(new o.z("colorthemeset")),t()}).catch(m=>{o.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=s,d._reloadColorTheme())}_getTransitionParameters(t){return{now:o.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):s.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const d=this.terrain=new Oe(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});d.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,d,m,y={}){if(y&&y.validate===!1)return!1;const v=Object.assign({},this.serialize());return Vl(this,t.call(Wi,Object.assign({key:s,style:v,value:d,styleSpec:o.a6},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const d of s)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];s._clear&&s._clear()}}reloadSource(t){const s=this.getSourceCaches(t);for(const d of s)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=Ud(this.directionalLight));const d=new Set,m=new Set;for(const y in this._mergedLayers){const v=this._mergedLayers[y];v.type==="building"&&d.add(v.source),v.hasElevation()&&!m.has(v.source)&&m.add(v.source)}for(const y in this._mergedSourceCaches){const v=this._mergedSourceCaches[y],b=m.has(v._source.id);d.has(v._source.id)&&(v._source.reparseOverscaled=!1),v.update(t,void 0,void 0,s,b)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,d,m,y,v,b=!1){let E=!1,A=!1;const M={},O={};for(const U of this._mergedOrder){const X=this._mergedLayers[U];if(X.type!=="symbol")continue;const Z=o.B(X.source,X.scope);let ne=M[Z];if(!ne){const re=this.getLayerSourceCache(X);if(!re)continue;const we=re.getRenderableIds(!0).map(ge=>re.getTileByID(ge));O[Z]=we.slice(),ne=M[Z]=we.sort((ge,ve)=>ve.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ve.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(X,ne,s.center.lng,s.projection);E=E||ae}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new o.z("neworder"));const z=!!(this.placement&&!s.equals(this.placement.transform)),F=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!v||this.placement.lastReplacementSourceUpdateTime!==v.updateTime)),V=(z||F||E||this.placement&&this.placement.isStale())&&m===0;if((b||!this.pauseablePlacement||V||m!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),s.zoom))&&(this.pauseablePlacement=new Zr(s,this._mergedOrder,b||m===0,d,m,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,O,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E){this._buildingIndex.onNewFrame(s.zoom);for(let U=0;U<this._mergedOrder.length;U++){const X=this._mergedLayers[this._mergedOrder[U]];if(X.type!=="symbol"||X.visibility==="none")continue;const Z=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,M[o.B(X.source,X.scope)],U,Z?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return d.push(t),this._loadImports([t],!0);const m=d.findIndex(({id:y})=>y===s);return m===-1&&this.fire(new o.y(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,m).concat(t).concat(d.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==d[m].url&&this.setImportUrl(t,s.url),o.by(s.config,d[m].config)||this.setImportConfig(t,s.config,s.data.schema),o.by(s.data,d[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let d=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const y=this.getImportIndex(s);if(y===-1)return this;const v=d[m],b=this.fragments[m];return d=d.filter(({id:E})=>E!==t),this.fragments=this.fragments.filter(({id:E})=>E!==t),this.stylesheet.imports=d.slice(0,y).concat(v).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(b).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;d[m].url=s;const y=this.fragments[m];return y.style=this._createFragmentStyle(d[m]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const d=this.getImportIndex(t),m=this.stylesheet.imports||[];return d===-1?this:s?(this.fragments[d].style.setState(s),this._reloadImports(),this):(delete m[d].data,this.setImportUrl(t,m[d].url))}setImportConfig(t,s,d){this._checkLoaded();const m=this.getImportIndex(t),y=this.stylesheet.imports||[];if(m===-1)return this;s?y[m].config=s:delete y[m].config;const v=this.fragments[m];d&&v.style.stylesheet&&(v.style.stylesheet.schema=d);const b=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=s,v.style.updateConfig(s,b),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(s.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return s===-1&&this.fire(new o.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[s];d&&t.push(d.getSource())}return t}getSource(t,s){const d=this.getSourceCache(t,s);return d&&d.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const d=o.B(t,s);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const s=o.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const d=t[s];d==="reload"?this.reloadSource(s):d==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const d of s){const m=this.getLayer(d);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,s,d){this.imageManager.getImages(s.images,s.scope,d),this._updateTilesForChangedImages();const m=v=>{if(v){const b=s.images.map(E=>o.I.toString(E));v.setDependencies(s.tileID.key,s.type,b)}},y=o.B(s.source,s.scope);m(this._mergedOtherSourceCaches[y]),m(this._mergedSymbolSourceCaches[y]),s.images.some(v=>v.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(t,s,d){this.imageManager.rasterizeImages(s,d)}getGlyphs(t,s,d){this.glyphManager.getGlyphs(s.stacks,d)}getResource(t,s,d){return o.dz(s,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${t}'`))),!1):s.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),m=t.type==="building";if(t.is3D(!!this.terrain)){if(d||m||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Us.getSourceType=function(u){return Ea[u]},Us.setSourceType=function(u,t){Ea[u]=t},Us.registerForPluginStateChange=o.dA;class gv extends o.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[s,d]of Object.entries(t.buildings))if(this._buildings[s])for(const m of d.floorIds)this._buildings[s].floors[m]||(this._buildings[s].floors[m]=d.floors[m]);else this._buildings[s]=d;for(const s of t.activeFloors)this._activeFloors.add(s);this._updateIndoorSelector()}getIndoorTileOptions(t,s){const d=this._style.getIndoorSourceLayers(t,s);return d&&this._indoorState?{sourceLayers:d,indoorState:this._indoorState}:null}_updateUI(t,s,d){const m=function(y,v,b,E){let A=null,M=Number.MAX_SAFE_INTEGER;if(E<16)return null;for(const[O,z]of Object.entries(y)){const F=z.center;if(F){const V=v.distanceTo(o.aT.convert(F));V<M&&b.contains(F)&&(M=V,A=O)}}return A}(this._buildings,s,d,t);m!==this._closestBuildingId&&(this._closestBuildingId=m,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,s=this._closestBuildingId,d=s&&t?t[s]:void 0;if(!d)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let m=null;for(const v of d.floorIds)if(this._activeFloors&&this._activeFloors.has(v)){m=v;break}const y=Array.from(d.floorIds).map(v=>({id:v,name:d.floors[v].name,zIndex:d.floors[v].zIndex})).sort((v,b)=>b.zIndex-v.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:m,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var mu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,gu=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lg=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ef="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",gs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,If=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Et=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,cg=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Cf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Af=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,ug=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const $d=/#include\s+"([^"]+)"/g,Da=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,dg=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Cc=new Set(["ifdef","ifndef","elif","if","defined"]),Ac=new Set;Hl(mu,Ac),Hl(lg,Ac),Hl(gu,Ac);const Gl={"_prelude_fog.vertex.glsl":If,"_prelude_terrain.vertex.glsl":gs,"_prelude_shadow.vertex.glsl":Af,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Et,"_prelude_shadow.fragment.glsl":ug,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":cg,"_prelude_raster_particle.glsl":Cf},Pf={};Jn("",gs),Jn(Et,If),Jn(ug,Af),Jn(cg,""),Jn(Cf,"");const _v=Jn(gu,lg),Mf=mu,Ew=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Mf,_v.fragmentSource].join(`
`),yv=["precision highp float;",Mf,_v.vertexSource].join(`
`);var hg={background:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Jn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Jn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Jn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Jn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Jn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Jn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Jn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Jn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Jn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Jn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Jn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Jn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Jn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Jn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Jn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Jn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Jn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Jn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ef),skyboxGradient:Jn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ef),skyboxCapture:Jn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Jn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Jn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Jn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Jn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Jn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Jn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Jn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Jn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Hl(u,t){const s=u.split(`
`);for(let d of s){if(d=d.trimStart(),d[0]!=="#"||!d.includes("if")||d.startsWith("#endif"))continue;const m=d.match(dg);if(m)for(const y of m)Cc.has(y)||t.add(y)}}function Jn(u,t){const s=new Set,d=[],m=[];u=u.replace($d,(v,b)=>(m.push(b),"")),t=t.replace($d,(v,b)=>(d.push(b),""));let y=new Set(Ac);Hl(u,y),Hl(t,y);for(const v of[...d,...m])Pf[v]||(Pf[v]=new Set,Hl(Gl[v],Pf[v])),y=new Set([...y,...Pf[v]]);return{fragmentSource:u=u.replace(Da,(v,b,E,A,M)=>(s.add(M),b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
in ${E} ${A} ${M};
#else
uniform ${E} ${A} u_${M};
#endif
`:b==="initialize"?`
#ifdef HAS_UNIFORM_u_${M}
    ${E} ${A} ${M} = u_${M};
#endif
`:b==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    in ${E} ${A} ${M};
#endif
`:b==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(Da,(v,b,E,A,M)=>{const O=`MATERIAL_ATTRIBUTE_OFFSET_${M}`,z=A==="float"?"vec2":A,F=`GET_ATTRIBUTE_${z}(a_${M}, materialInfo, ${O})`,V=M.match(/color/)?"color":z;return b==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${M}
in ${E} ${A} a_${M};
#endif
`:s.has(M)?b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
    #if !defined(${O})
        in ${E} ${z} a_${M};
    #endif
out ${E} ${A} ${M};
#else
uniform ${E} ${A} u_${M};
#endif
`:b==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = a_${M};
#else
    ${E} ${A} ${M} = u_${M};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${M})
    #ifdef ${O}
        ${M} = unpack_mix_${V}(${F}, u_${M}_t);
    #else
        ${M} = unpack_mix_${V}(a_${M}, u_${M}_t);
    #endif
#else
    ${E} ${A} ${M} = u_${M};
#endif
`:b==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    in ${E} ${A} a_${M};
    out ${E} ${A} ${M};
#endif
`:b==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    ${M} = a_${M};
#endif
`:void 0:b==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
    #if !defined(${O})
        in ${E} ${z} a_${M};
    #endif
#else
uniform ${E} ${A} u_${M};
#endif
`:b==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${M}0;
in vec4 a_${M}1;
in vec4 a_${M}2;
in vec4 a_${M}3;
#else
uniform ${E} ${A} u_${M};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${E} ${z} a_${M};
#else
uniform ${E} ${A} u_${M};
#endif
`:b==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    ${E} ${A} ${M} = a_${M};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    #ifdef ${O}
        ${E} ${A} ${M} = ${F};
    #else
        ${E} ${A} ${M} = a_${M};
    #endif
#else
    ${E} ${A} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    #ifdef ${O}
        ${E} ${A} ${M} = unpack_mix_${V}(${F}, u_${M}_t);
    #else
        ${E} ${A} ${M} = unpack_mix_${V}(a_${M}, u_${M}_t);
    #endif
#else
    ${E} ${A} ${M} = u_${M};
#endif
`}),usedDefines:y,vertexIncludes:d,fragmentIncludes:m}}class Iw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,d,m,y,v,b,E){this.context=t;let A=this.boundPaintVertexBuffers.length!==m.length;for(let O=0;!A&&O<m.length;O++)this.boundPaintVertexBuffers[O]!==m[O]&&(A=!0);let M=this.boundDynamicVertexBuffers.length!==b.length;for(let O=0;!M&&O<b.length;O++)this.boundDynamicVertexBuffers[O]!==b[O]&&(M=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==d||A||M||this.boundIndexBuffer!==y||this.boundVertexOffset!==v)this.freshBind(s,d,m,y,v,b,E);else{t.bindVertexArrayOES.set(this.vao);for(const O of b)O&&(O.bind(),E&&O.instanceCount&&O.setVertexAttribDivisor(t.gl,s,E));y&&y.dynamicDraw&&y.bind()}}freshBind(t,s,d,m,y,v,b){const E=this.context,A=E.gl;this.vao&&this.destroy(),this.vao=E.gl.createVertexArray(),E.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=v,s.enableAttributes(A,t),s.bind(),s.setVertexAttribPointers(A,t,y);for(const M of d)M.enableAttributes(A,t),M.bind(),M.setVertexAttribPointers(A,t,y);for(const M of v)M&&(M.enableAttributes(A,t),M.bind(),M.setVertexAttribPointers(A,t,y),b&&M.instanceCount&&M.setVertexAttribDivisor(A,t,b));m&&m.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Cw(u,t){const s=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new o.ae(0,d/s).toLngLat().lat,new o.ae(0,(d+1)/s).toLngLat().lat]}function Aw(u,t,s,d,m,y,v){const b=u.context,E=b.gl,A=s.hillshadeFBO;if(!A)return;u.prepareDrawTile();const M=u.isTileAffectedByFog(t),O=[];u.terrain&&u.terrain.renderingToTexture&&u.emissiveMode==="mrt-fallback"&&O.push("USE_MRT1");const z=u.getOrCreateProgram("hillshade",{overrideFog:M,defines:O});b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment0.get());const F=((Z,ne,ae,re)=>{const we=ae.paint.get("hillshade-shadow-color"),ge=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ve=ae.paint.get("hillshade-highlight-color"),me=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=ae.paint.get("hillshade-accent-color"),Se=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Le=ae.paint.get("hillshade-emissive-strength");let Re=o.an(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")Re-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){const Ze=Z.style.directionalLight.properties.get("direction"),tt=o.d4(Ze.x,Ze.y,Ze.z);Re=o.an(tt[1])}const qe=!Z.options.moving;return{u_matrix:re||Z.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),qe),u_image:0,u_latrange:Cw(0,ne.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Re],u_shadow:we.toPremultipliedRenderColor(ge?null:ae.lut),u_highlight:ve.toPremultipliedRenderColor(me?null:ae.lut),u_emissive_strength:Le,u_accent:he.toPremultipliedRenderColor(Se?null:ae.lut)}})(u,s,d,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(b,z,t.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:U,tileBoundsSegments:X}=u.getTileBoundsBuffers(s);z.draw(u,E.TRIANGLES,m,y,v,gn.disabled,F,d.id,V,U,X)}function fg(u,t,s){if(!t.needsDEMTextureUpload)return;const d=u.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const y=s.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new o.T(d,y,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Pw(u,t,s){const d=u.context,m=d.gl;if(!t.dem)return;const y=t.dem;if(d.activeTexture.set(m.TEXTURE1),fg(u,t,y),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const v=y.dim;d.activeTexture.set(m.TEXTURE0);let b=t.hillshadeFBO;if(!b){const z=new o.T(d,{width:v,height:v,data:null},m.RGBA8);z.bind(m.LINEAR,m.CLAMP_TO_EDGE),b=t.hillshadeFBO=d.createFramebuffer(v,v,1,"renderbuffer"),b.colorAttachment0.set(z.texture)}d.bindFramebuffer.set(b.framebuffer),d.viewport.set([0,0,v,v]);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:A,tileBoundsSegments:M}=u.getMercatorTileBoundsBuffers(),O=[];u.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),u.terrain&&u.terrain.renderingToTexture&&u.emissiveMode==="mrt-fallback"&&O.push("USE_MRT1"),u.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(u,m.TRIANGLES,Qt.disabled,yn.disabled,Mn.unblended,gn.disabled,((z,F)=>{const V=F.stride,U=o.bC();return o.ce(U,0,o.al,-o.al,0,0,1),o.br(U,U,[0,-o.al,0]),{u_matrix:U,u_image:1,u_dimension:[V,V],u_zoom:z.overscaledZ}})(t.tileID,y),s.id,E,A,M),t.needsHillshadePrepare=!1}class Yi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mw extends Yi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vv extends Yi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class pg extends Yi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Rf extends Yi{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mg extends Yi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Pc extends Yi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class _u extends Yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Gd extends Yi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class yu extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class xv extends Yi{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class gg extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class wv extends Yi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vu extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Df extends Yi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Lf extends Yi{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _g extends Yi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class kf extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Hd extends Yi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class bv extends Yi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Tv=class extends Yi{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Sv extends Yi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class xu extends Yi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ev extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Rw extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Dw extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Lw extends Yi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class yg extends Yi{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class vg extends Yi{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class xg extends Yi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class wg extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Iv extends Yi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class zf extends Yi{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Of extends zf{constructor(t,s,d=0){super(t,s),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+d}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachmentPoint,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class wu extends zf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wd extends zf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Cv extends wu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const _s=(u,t,s,d)=>({u_matrix:u,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:s,u_emissive_texture_available:d}),Ff=(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:y,u_image0:0,u_image1:1,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:E,u_frustum_bl:A,u_globe_pos:M,u_globe_radius:O,u_viewport:z,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:V,u_emissive_texture_available:U});function qd(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const tl=new class{constructor(){this.operations={}}newMorphing(u,t,s,d,m){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[u]={startTime:d,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Nf={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bf(u,t,s){if(t===0)return 0;const d=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*d}function bg(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}function bu(u,t){if(!u.style||!u.style.enable3dLights())return;const s=u.context,d=s.gl;s.activeTexture.set(d.TEXTURE1),t?t.bind(d.LINEAR,d.CLAMP_TO_EDGE):u.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}const Zd=u=>({u_matrix:u});function Xd(u,t,s,d,m){if(m>0){const y=o.o.now(),v=(y-u.timeAdded)/m,b=t?(y-t.timeAdded)/m:-1,E=s.getSource(),A=d.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(u.tileID.overscaledZ-A),O=M&&u.refreshedUponExpiration?1:o.aA(M?v:1-b,0,1);return t?{opacity:1,mix:1-O,isFading:v<1}:{opacity:O,mix:0,isFading:v<1}}return{opacity:1,mix:0,isFading:!1}}class jf extends os{constructor(t){const s=qr("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class Tg extends os{constructor(t){const s=qr("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,d){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,v)=>{if(y[v.key]="",!this._tiles[v.key]){const b=new Tc(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);b.state="loaded",this._tiles[v.key]=b}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const d=Object.values(s);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Sg extends o.aQ{constructor(t,s,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=d}}class Eg extends o.bV{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,y]=function(E){const A=new o.bd,M=new o.b0,O=131;A.reserve(17161),M.reserve(33800);const z=o.al/128,F=o.al+z/2,V=F+z;for(let X=-z;X<V;X+=z)for(let Z=-z;Z<V;Z+=z){const ne=Z<0||Z>F||X<0||X>F?24575:0,ae=o.aA(Math.round(Z),0,o.al),re=o.aA(Math.round(X),0,o.al);A.emplaceBack(ae+ne,re)}const U=(X,Z)=>{const ne=Z*O+X;M.emplaceBack(ne+1,ne,ne+O),M.emplaceBack(ne+O,ne+O+1,ne+1)};for(let X=1;X<129;X++)for(let Z=1;Z<129;Z++)U(Z,X);return[0,129].forEach(X=>{for(let Z=0;Z<130;Z++)U(Z,X),U(X,Z)}),[A,M,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(d,o.bf.members),this.gridIndexBuffer=v.createIndexBuffer(m),this.gridSegments=o.bg.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Tg(s.map),this.orthoMatrix=o.bC(),o.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const b=v.gl;this._overlapStencilMode=new yn({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jf(s.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,y=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const b=t.terrain&&t.terrain.scope,E=m.get("source"),A=y?this._mockSourceCache:t.getSourceCache(E,b);if(!A)return void o.w(`Couldn't find terrain source "${E}".`);if(this.sourceCache=A,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const M=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(s,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),s.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const m=s!=null?d-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const y=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(y);let b=y-this._previousZoom;const E=this._previousUpdateTimestamp;let A=y;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(y-A)>.5&&(b=.5*(y-A+b)),b*m<0&&(A+=b)),this._evaluationZoom=A;const M=v.getExaggeration(A),O=M===v.getExaggeration(Math.max(0,A-.1));if(O&&Math.abs(M-this._exaggeration)<.01)return M;let z=Math.min(.1,.00375*(this._updateTimestamp-E));return(O||M<.1||Math.abs(b)<1e-4)&&(z=Math.min(.2,4*z)),o.ak(this._exaggeration,M,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(E=>{const A=s.getTileByID(E).tileID;return A.projMatrix=d.calculateProjMatrix(A.toUnwrapped()),A});(function(E,A){const M=A.transform.pointCoordinate(A.transform.getCameraPoint()),O=new o.P(M.x,M.y);E.sort((z,F)=>{if(F.overscaledZ-z.overscaledZ)return F.overscaledZ-z.overscaledZ;const V=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),U=new o.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),X=O.mult(1<<z.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(V)-X.distSqr(U)})})(m,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const E in v){const A=v[E];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,t[E],y),A.usedForTerrain))continue;const M=t[E];A.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[s.id]=m.map(E=>new Sg(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const b={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const A=this.terrainTileForTile[E.key];if(!A)continue;const M=A.tileID.key;M in b||(this._visibleDemTiles.push(A),b[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const d=this._findTileCoveringTileID(s,this.sourceCache);d&&(this.terrainTileForTile[s.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),fg(this.painter,m,y))}}_prepareDemTileUniforms(t,s,d,m){if(!s||s.demTexture==null)return!1;const y=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-y.z),b=m||"";return d[`u_dem_tl${b}`]=[y.x*v%1,y.y*v%1],d[`u_dem_scale${b}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const y=m.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const d=this._getLoadedAreaMinimum(),m=new o.dL({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.T(t,m,s.R32F,{premultiply:!1}),y}setupElevationDraw(t,s,d){const m=this.painter.context,y=m.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let b=null,E=null,A=1;if(d&&d.morphing&&this._useVertexMorphing){const F=d.morphing.srcDemTile,V=d.morphing.dstDemTile;A=d.morphing.phase,F&&V&&(this._prepareDemTileUniforms(t,F,v,"_prev")&&(E=F),this._prepareDemTileUniforms(t,V,v)&&(b=V))}const M=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let O=null;var z;if(this.enabled?E&&b?(O=b.demTexture,m.activeTexture.set(y.TEXTURE4),E.demTexture.bind(M(E),y.CLAMP_TO_EDGE),v.u_dem_lerp=A):(b=this.terrainTileForTile[t.tileID.key],O=this._prepareDemTileUniforms(t,b,v)?b.demTexture:this.emptyDEMTexture):O=this.emptyDEMTexture,m.activeTexture.set(y.TEXTURE2),O&&(v.u_dem_size=(z=O).size[0]===1?1:z.size[0]-2,O.bind(M(b),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,s,v),d&&d.useMeterToDem&&b){const F=(1<<b.tileID.canonical.z)*o.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=F}if(d&&d.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),s.setTerrainUniformValues(m,v),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,F)}}globeUniformValues(t,s,d){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,o.al,0),u_tile_br_up:m.upVector(s,o.al,o.al),u_tile_bl_up:m.upVector(s,0,o.al),u_tile_up_scale:d?o.dM(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,y,v,b,E){if(m.transform.projection.name==="globe")(function(A,M,O,z,F){const V=A.context,U=V.gl;let X,Z;const ne=A.transform,ae=o.dE(A,V,ne),re=(qe,Ze)=>{if(Z===Ze)return;const tt=[Nf[Ze],"PROJECTION_GLOBE_VIEW"];ae&&tt.push("CUSTOM_ANTIALIASING");const _t=A.isTileAffectedByFog(qe);X=A.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:_t}),Z=Ze},we=A.colorModeForRenderPass(),ge=new Qt(U.LEQUAL,Qt.ReadWrite,A.depthRangeFor3D);tl.update(F);const ve=o.dF(ne),me=[o.aF(ne.center.lng),o.aJ(ne.center.lat)],he=A.globeSharedBuffers,Se=[ne.width*o.o.devicePixelRatio,ne.height*o.o.devicePixelRatio],Le=Float32Array.from(ne.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const qe=A.transform,Ze=Bf(qe.zoom,M.exaggeration(),M.sourceCache._source.tileSize);Z=-1;const tt=U.TRIANGLES;for(const _t of z){const Ue=O.getTile(_t),Ae=yn.disabled,Ke=M.prevTerrainTileForTile[_t.key],$e=M.terrainTileForTile[_t.key];qd(Ke,$e)&&tl.newMorphing(_t.key,Ke,$e,F,250),bu(A,Ue.emissiveTexture),V.activeTexture.set(U.TEXTURE0),Ue.texture&&Ue.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const lt=tl.getMorphValuesForProxy(_t.key),Ct=lt?1:0;lt&&Object.assign(Re,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:o.dD(lt.phase)}});const zt=o.dG(_t.canonical),St=o.dH(zt.getCenter().lat),yt=o.dI(_t.canonical,zt,St,qe.worldSize/qe._pixelsPerMercatorPixel),Xt=o.bk(o.dJ(_t.canonical)),Ut=A.emissiveMode==="mrt-fallback"?1:0,Dt=Ff(qe.expandedFarZProjMatrix,Le,ve,Xt,o.aj(qe.zoom),me,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,Se,Ze,qe._farZ,Ut,yt);if(re(_t,Ct),X&&(M.setupElevationDraw(Ue,X,Re),A.uploadCommonUniforms(V,X,_t.toUnwrapped()),he)){const[Ft,sn,Tn]=he.getGridBuffers(St,Ze!==0);X.draw(A,tt,ge,Ae,we,gn.backCCW,Dt,"globe_raster",Ft,sn,Tn)}}}if(he&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&qe.push("CUSTOM_ANTIALIASING"),X=A.getOrCreateProgram("globeRaster",{defines:qe});for(const Ze of z){const{x:tt,y:_t,z:Ue}=Ze.canonical,Ae=_t===0,Ke=_t===(1<<Ue)-1,[$e,lt,Ct,zt]=he.getPoleBuffers(Ue,!1);if(zt&&(Ae||Ke)){const St=O.getTile(Ze);bu(A,St.emissiveTexture),V.activeTexture.set(U.TEXTURE0),St.texture&&St.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let yt=o.dK(Ue,tt,ne);const Xt=o.bk(o.dJ(Ze.canonical)),Ut=A.emissiveMode==="mrt-fallback"?1:0,Dt=(Ft,sn)=>Ft.draw(A,U.TRIANGLES,ge,yn.disabled,we,gn.disabled,Ff(ne.expandedFarZProjMatrix,yt,yt,Xt,0,me,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Se,0,ne._farZ,Ut),"globe_pole_raster",sn,Ct,zt);M.setupElevationDraw(St,X,Re),A.uploadCommonUniforms(V,X,Ze.toUnwrapped()),Ae&&A.renderDefaultNorthPole&&Dt(X,$e),Ke&&A.renderDefaultSouthPole&&(yt=o.cS(o.bC(),yt,[1,-1,1]),Dt(X,lt))}}}})(m,y,v,b,E);else{const A=m.context,M=A.gl;let O,z;const F=m.shadowRenderer,V=jl(m,m.longestCutoffRange),U=we=>{if(z===we)return;const ge=[];ge.push(Nf[we]),V.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),F&&(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&ge.push("NORMAL_OFFSET")),O=m.getOrCreateProgram("terrainRaster",{defines:ge}),z=we},X=m.colorModeForRenderPass(),Z=new Qt(M.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D);tl.update(E);const ne=m.transform,ae=Bf(ne.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let re=[0,0,0];if(F){const we=m.style.directionalLight,ge=m.style.ambientLight;we&&ge&&(re=el(m.style,we,ge))}{z=-1;const we=M.TRIANGLES,[ge,ve]=[y.gridIndexBuffer,y.gridSegments];for(const me of b){const he=v.getTile(me),Se=yn.disabled,Le=y.prevTerrainTileForTile[me.key],Re=y.terrainTileForTile[me.key];qd(Le,Re)&&tl.newMorphing(me.key,Le,Re,E,250),bu(m,he.emissiveTexture),A.activeTexture.set(M.TEXTURE0),he.texture&&he.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const qe=tl.getMorphValuesForProxy(me.key),Ze=qe?1:0;let tt;qe&&(tt={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:o.dD(qe.phase)}});const _t=m.emissiveMode==="mrt-fallback"?1:0,Ue=_s(me.projMatrix,bg(me.canonical,ne.renderWorldCopies)?ae/10:ae,re,_t);if(U(Ze),!O)continue;y.setupElevationDraw(he,O,tt);const Ae=me.toUnwrapped();F&&F.setupShadows(Ae,O),m.uploadCommonUniforms(A,O,Ae,null,V),O.draw(m,we,Z,Se,X,gn.backCCW,Ue,"terrain_raster",y.gridBuffer,ge,ve)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,d=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],v=this._drapedRenderBatches.shift(),b=s.style.order,E=[];this._updateFBOs(s.emissiveMode==="mrt-fallback");let A=0;for(const M of y){const O=m.getTileByID(M.proxyTileKey),z=m.proxyCachedFBO[M.key]?m.proxyCachedFBO[M.key][t]:void 0,F=z!==void 0?m.renderCache[z]:this.pool[A++],V=z!==void 0;if(O.texture=F.tex,O.emissiveTexture=F.emissiveTex,V&&!F.dirty){E.push(O.tileID);continue}d.bindFramebuffer.set(F.fb.framebuffer);const U=d.gl;let X;U.drawBuffers(s.emissiveMode==="mrt-fallback"?[U.COLOR_ATTACHMENT0,U.COLOR_ATTACHMENT1]:[U.COLOR_ATTACHMENT0]),this.renderedToTile=!1,F.dirty&&(d.clear({color:o.ao.transparent,stencil:0}),F.dirty=!1);for(let Z=v.start;Z<=v.end;++Z){const ne=s.style._mergedLayers[b[Z]];if(ne.isHidden(s.transform.zoom))continue;const ae=s.style.getLayerSourceCache(ne),re=ae?this.proxyToSource[M.key][ae.id]:[M];if(!re)continue;const we=re;d.viewport.set([0,0,F.fb.width,F.fb.height]),X!==(ae?ae.id:null)&&(this._setupStencil(F,re,ne,ae),X=ae?ae.id:null),s.renderLayer(s,ae,ne,we)}if(U.drawBuffers([U.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const Z of this._pendingGroundEffectLayers){const ne=s.style._mergedLayers[b[Z]];if(ne.isHidden(s.transform.zoom))continue;const ae=s.style.getLayerSourceCache(ne),re=ae?this.proxyToSource[M.key][ae.id]:[M];if(!re)continue;const we=re;d.viewport.set([0,0,F.fb.width,F.fb.height]),X!==(ae?ae.id:null)&&(this._setupStencil(F,re,ne,ae),X=ae?ae.id:null),s.renderLayer(s,ae,ne,we)}this.renderedToTile?(F.dirty=!0,E.push(O.tileID)):V||--A,A===5&&(A=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let d=-1,m=s;for(let y=0;y<s;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):m=Math.min(m,y);return m>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const v=y.tileID,b=1<<v.overscaledZ,{x:E,y:A}=v.canonical,M=E/b,O=(E+1)/b,z=A/b,F=(A+1)/b;return{minx:M,miny:z,maxx:O,maxy:F,t:y.dem.tree.raycastRoot(M,z,O,F,t,s,d),tile:y}});m.sort((y,v)=>(y.t!==null?y.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const v=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,s,d);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,d=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new o.T(t,{width:d[0],height:d[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=t.createFramebuffer(d[0],d[1],1,null);let v;return y.colorAttachment0.set(m.texture),this._emissiveTexture&&(v=new o.T(t,{width:d[0],height:d[1],data:null},s.R8),v.bind(s.LINEAR,s.CLAMP_TO_EDGE),y.createColorAttachment(t,1),y.colorAttachment1.set(v.texture)),y.depthAttachment=new Cv(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:m,emissiveTex:v,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const s of this.pool)this._updateFBO(s,t);for(const s of this.proxySourceCache.renderCache)this._updateFBO(s,t);this._emissiveTexture=t}}_updateFBO(t,s){const d=t.fb,m=this.painter.context,y=m.gl,v=this.drapeBufferSize;if(s){const b=new o.T(m,{width:v[0],height:v[1],data:null},y.R8);b.bind(y.LINEAR,y.CLAMP_TO_EDGE),t.emissiveTex=b,d.createColorAttachment(m,1),d.colorAttachment1.set(b.texture)}else t.emissiveTex=void 0,d.removeColorAttachment(m,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],d=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!d&&s.shouldRedrape():!d&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof xc){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(m);if(!y||s[y.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="line")continue;const v=m.widthExpression(),b=m.emissiveStrengthExpression();if(v instanceof o.ad||b instanceof o.ad){s[y.id]=!0;for(const E of this.proxyCoords){const A=this.proxyToSource[E.key][y.id];if(A)for(const M of A)this._clearRenderCacheForTile(y.id,M)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Jr){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const m=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(m);if(!y||s[y.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const v=m.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][y.id];if(E)for(const A of E){const M=Xd(y.getTile(A),y.findLoadedParent(A,0),y,this.painter.transform,v);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(y.id,A)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const d=[];this._pendingGroundEffectLayers=[];let m,y=0,v=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++y<s;)v=this._style._mergedLayers[t[y]];for(;y<s;++y){const b=this._style._mergedLayers[t[y]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?m===void 0&&(m=y):(b.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),m!==void 0&&(d.push({start:m,end:y-1}),m=void 0)))}if(m!==void 0&&d.push({start:m,end:y-1}),d.length!==0){const b=d[d.length-1];this._pendingGroundEffectLayers.every(E=>E>b.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<v.length;++b){const E=Object.values(v[b]);s.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let v=d.length-1;v>=0;v--){const b=d[v];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const E=t[b.key],A=this.proxyToSource[b.key];let M=0;for(const O in A){const z=A[O],F=E[O];if(!F||F.length!==z.length||z.some((V,U)=>V!==F[U]||m[O]&&m[O].hasOwnProperty(V.key))){M=-1;break}++M}for(const O in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][O]].dirty=M<0||M!==Object.values(E).length}}const y=[...this._drapedRenderBatches];y.sort((v,b)=>b.end-b.start-(v.end-v.start));for(const v of y)for(const b of d){if(s.proxyCachedFBO[b.key])continue;let E=s.renderCachePool.pop();E===void 0&&s.renderCache.length<50&&(E=s.renderCache.length,s.renderCache.push(this._createFBO())),E!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][v.start]=E,s.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,v=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(d.isTileClipped())b=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):yn.disabled}_renderTileClippingMasks(t,s){const d=this.painter,m=this.painter.context,y=m.gl;d._tileClippingMaskIDs={},m.setColorMode(Mn.disabled),m.setDepthMode(Qt.disabled);const v=d.getOrCreateProgram("clippingMask");for(const b of t){const E=d._tileClippingMaskIDs[b.key]=--s;v.draw(d,y.TRIANGLES,Qt.disabled,new yn({func:y.ALWAYS,mask:0},E,255,y.KEEP,y.KEEP,y.REPLACE),Mn.disabled,gn.disabled,Zd(b.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const d=[t.x,t.y,1,1];o.aC(d,d,s.pixelMatrixInverse),o.cK(d,d,1/d[3]),d[0]/=s.worldSize,d[1]/=s.worldSize;const m=s._camera.position,y=o.cf(1,s.center.lat),v=[m[0],m[1],m[2]/y,0],b=o.da([],d.slice(0,3),v);o.aw(b,b);const E=this.raycast(v,b,this._exaggeration);return E!==null&&E?(o.bH(v,v,b,E),v[3]=v[2],v[2]*=y,v):null}_setupProxiedCoordsForOrtho(t,s,d){if(t.getSource()instanceof o.aU)return this._setupProxiedCoordsForImageSource(t,s,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const A=y[E],M=this._findTileCoveringTileID(A,t);if(M){const O=this._createProxiedId(A,M,d[A.key]&&d[A.key][t.id]);m.push(O),this.proxyToSource[A.key][t.id]=[O]}}let v=!1;const b=new Set;for(let E=0;E<s.length;E++){const A=t.getTile(s[E]);if(!A||!A.hasData())continue;const M=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(M&&M.tileID.canonical.z!==A.tileID.canonical.z){const O=this.proxyToSource[M.tileID.key][t.id],z=this._createProxiedId(M.tileID,A,d[M.tileID.key]&&d[M.tileID.key][t.id]);O?O.splice(O.length-1,0,z):this.proxyToSource[M.tileID.key][t.id]=[z];const F=this.proxyToSource[M.tileID.key][t.id];b.has(F)||b.add(F),m.push(z),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const E of b)E.sort((A,M)=>M.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,d){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords,v=t.getSource(),b=v.tileID;if(!b)return;const E=new o.P(b.x,b.y)._div(1<<b.z),A=v.coordinates.map(o.ae.fromLngLat).reduce((O,z)=>(O.min.x=Math.min(O.min.x,z.x-E.x),O.min.y=Math.min(O.min.y,z.y-E.y),O.max.x=Math.max(O.max.x,z.x-E.x),O.max.y=Math.max(O.max.y,z.y-E.y),O),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),M=(O,z)=>{const F=O.wrap+O.canonical.x/(1<<O.canonical.z),V=O.canonical.y/(1<<O.canonical.z),U=o.al/(1<<O.canonical.z),X=z.wrap+z.canonical.x/(1<<z.canonical.z),Z=z.canonical.y/(1<<z.canonical.z);return F+U<X+A.min.x||F>X+A.max.x||V+U<Z+A.min.y||V>Z+A.max.y};for(let O=0;O<y.length;O++){const z=y[O];for(let F=0;F<s.length;F++){const V=t.getTile(s[F]);if(!V||!V.hasData()||M(z,V.tileID))continue;const U=this._createProxiedId(z,V,d[z.key]&&d[z.key][t.id]),X=this.proxyToSource[z.key][t.id];X?X.push(U):this.proxyToSource[z.key][t.id]=[U],m.push(U)}}}_createProxiedId(t,s,d){let m=this.orthoMatrix;if(d){const y=d.find(v=>v.key===s.tileID.key);if(y)return y}if(s.tileID.key!==t.key){const y=t.canonical.z-s.tileID.canonical.z;let v,b,E;m=o.bC();const A=s.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(v=o.al>>y,b=v*((s.tileID.canonical.x<<y)-t.canonical.x+A),E=v*((s.tileID.canonical.y<<y)-t.canonical.y)):(v=o.al<<-y,b=o.al*(s.tileID.canonical.x-(t.canonical.x+A<<-y)),E=o.al*(s.tileID.canonical.y-(t.canonical.y<<-y))),o.ce(m,0,v,0,v,0,1),o.br(m,m,[b,E,0])}return new Sg(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let d=s.getTile(t);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[s.id],y=m[t.key];if(d=y?s.getTileByID(y):null,d&&d.hasData()||y===null)return d;let v=d?d.tileID:t,b=v.overscaledZ;const E=s.getSource().minzoom,A=[];if(!y){const O=s.getSource().maxzoom;if(t.canonical.z>=O){const z=t.canonical.z-O;s.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new o.aQ(b,t.wrap,O,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(b=O,v=new o.aQ(b,t.wrap,O,t.canonical.x>>z,t.canonical.y>>z))}v.key!==t.key&&(A.push(v.key),d=s.getTile(v))}const M=O=>{A.forEach(z=>{m[z]=O}),A.length=0};for(b-=1;b>=E&&(!d||!d.hasData());b--){d&&M(d.tileID.key);const O=v.calculateScaledKey(b);if(d=s.getTileByID(O),d&&d.hasData())break;const z=m[O];if(z===null)break;z===void 0?A.push(O):d=s.getTileByID(z)}return M(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[s.key]=!0}}function Tu(u,t,s){const d=function(b,E,A){const M=o.bJ(E,b),O=o.bJ(A,[.2126,.7152,.0722]),z=(V,U,X)=>(1-X)*V+X*U,F=z(1-.3*Math.min(O,1),1,Math.min(M+1,1));return z(.92,1,Math.asin(o.aA(E[2],-1,1))/Math.PI+.5)*F}(u,[0,0,1],t),m=[0,0,0];o.c5(m,s.slice(0,3),d);const y=[0,0,0];o.c5(y,t.slice(0,3),u[2]);const v=[0,0,0];return o.d8(v,m,y),o.db(v)}const kw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],zw=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Av{static cacheKey(t,s,d,m){const y=[s];m&&y.push(m.cacheKey);for(const v of d)t.usedDefines.has(v)&&y.push(v);return y.join("/")}constructor(t,s,d,m,y,v){const b=t.gl;this.program=b.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...v];const E=`#version 300 es
${(m?m.defines():[]).concat(v.map(U=>`#define ${U}`)).join(`
`)}`,A=[E,Ew];for(const U of d.fragmentIncludes)A.push(Gl[U]);A.push(d.fragmentSource);const M=A.join(`
`),O=[E,yv];for(const U of d.vertexIncludes)O.push(Gl[U]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&O.push("uniform int u_instanceID;"),O.push(d.vertexSource);let z=O.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(z=z.replaceAll("gl_InstanceID","u_instanceID"));const F=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(F,M),b.compileShader(F),b.attachShader(this.program,F);const V=b.createShader(b.VERTEX_SHADER);b.isContextLost()?this.failedToCreate=!0:(b.shaderSource(V,z),b.compileShader(V),b.attachShader(this.program,V),this.attributes={},b.linkProgram(this.program),b.deleteShader(V),b.deleteShader(F),this.fixedUniforms=y(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(U=>({u_instanceID:new o.ch(U)}))(t)),(v.includes("TERRAIN")||s.includes("symbol")||s.includes("circle"))&&(this.terrainUniforms=(U=>({u_dem:new o.ch(U),u_dem_prev:new o.ch(U),u_dem_tl:new o.ck(U),u_dem_scale:new o.cj(U),u_dem_tl_prev:new o.ck(U),u_dem_scale_prev:new o.cj(U),u_dem_size:new o.cj(U),u_dem_lerp:new o.cj(U),u_exaggeration:new o.cj(U),u_depth:new o.ch(U),u_depth_size_inv:new o.ck(U),u_depth_range_unpack:new o.ck(U),u_occluder_half_size:new o.cj(U),u_occlusion_depth_offset:new o.cj(U),u_meter_to_dem:new o.cj(U),u_label_plane_matrix_inv:new o.cl(U)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(U=>({u_tile_tl_up:new o.ci(U),u_tile_tr_up:new o.ci(U),u_tile_br_up:new o.ci(U),u_tile_bl_up:new o.ci(U),u_tile_up_scale:new o.cj(U)}))(t)),v.includes("FOG")&&(this.fogUniforms=(U=>({u_fog_matrix:new o.cl(U),u_fog_range:new o.ck(U),u_fog_color:new o.d3(U),u_fog_horizon_blend:new o.cj(U),u_fog_vertical_limit:new o.ck(U),u_fog_temporal_offset:new o.cj(U),u_frustum_tl:new o.ci(U),u_frustum_tr:new o.ci(U),u_frustum_br:new o.ci(U),u_frustum_bl:new o.ci(U),u_globe_pos:new o.ci(U),u_globe_radius:new o.cj(U),u_globe_transition:new o.cj(U),u_is_globe:new o.ch(U),u_viewport:new o.ck(U)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(U=>({u_cutoff_params:new o.d3(U)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(U=>({u_lighting_ambient_color:new o.ci(U),u_lighting_directional_dir:new o.ci(U),u_lighting_directional_color:new o.ci(U),u_ground_radiance:new o.ci(U)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(U=>({u_light_matrix_0:new o.cl(U),u_light_matrix_1:new o.cl(U),u_fade_range:new o.ck(U),u_shadow_normal_offset:new o.ci(U),u_shadow_intensity:new o.cj(U),u_shadow_texel_size:new o.cj(U),u_shadow_map_resolution:new o.cj(U),u_shadow_direction:new o.ci(U),u_shadow_bias:new o.ci(U),u_shadowmap_0:new o.ch(U),u_shadowmap_1:new o.ch(U)}))(t)))}getAttributeLocation(t,s){let d=this.attributes[s];return d===void 0&&(d=this.attributes[s]=t.getAttribLocation(this.program,s)),d}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m]&&d[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m]&&d[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)d[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const m in s)d[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,d,m,y,v,b,E,A,M){const O=t.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;const z=t.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||t._terrain&&t._terrain.renderingToTexture||!kw.includes(this.name))||!(!O.layers3D||!zw.includes(this.name))))return;const F=z.gl,V=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,z);if(!V)return;const U=[...this.fixedDefines,"DEBUG_WIREFRAME"],X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:U});z.program.set(X.program);const Z=(re,we,ge)=>{if(we[re]&&ge[re])for(const ve in we[re])ge[re][ve]&&ge[re][ve].set(ge.program,ve,we[re][ve].current)};A&&A.setUniforms(X.program,z,X.binderUniforms,b,{zoom:E}),Z("fixedUniforms",this,X),Z("terrainUniforms",this,X),Z("globeUniforms",this,X),Z("fogUniforms",this,X),Z("lightsUniforms",this,X),Z("shadowUniforms",this,X),V.bind(),z.setColorMode(new Mn([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],o.ao.transparent,[!0,!0,!0,!1])),z.setDepthMode(new Qt(s.func===F.LESS?F.LEQUAL:s.func,Qt.ReadOnly,s.range)),z.setStencilMode(yn.disabled);const ne=3*v.primitiveLength*2,ae=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const re=M||1;for(let we=0;we<re;++we)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),F.drawElements(F.LINES,ne,F.UNSIGNED_SHORT,ae)}else M&&M>1?F.drawElementsInstanced(F.LINES,ne,F.UNSIGNED_SHORT,ae,M):F.drawElements(F.LINES,ne,F.UNSIGNED_SHORT,ae);y.bind(),z.program.set(this.program),z.setDepthMode(s),z.setStencilMode(d),z.setColorMode(m)}checkUniforms(t,s,d){if(this.fixedDefines.includes(s)){for(const m of Object.keys(d))if(!d[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X){const Z=t.context,ne=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(d),Z.setStencilMode(m),Z.setColorMode(y),Z.setCullFace(v);for(const[me,he]of this.fixedUniformsEntries)he.set(this.program,me,b[me]);V&&V.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:F});const ae={[ne.POINTS]:1,[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[s];this.checkUniforms(E,"RENDER_SHADOWS",this.shadowUniforms);const re=U||[],we=V?V.getPaintVertexBuffers():[],ge=s===ne.TRIANGLES&&M,ve=X&&X>0?1:void 0;for(const me of O.get()){const he=me.vaos||(me.vaos={});if((he[E]||(he[E]=new Iw)).bind(Z,this,A,we,M,me.vertexOffset,re,ve),this.forceManualRenderingForInstanceIDShaders){const Se=X||1;for(let Le=0;Le<Se;++Le)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Le),M?ne.drawElements(s,me.primitiveLength*ae,ne.UNSIGNED_SHORT,me.primitiveOffset*ae*2):ne.drawArrays(s,me.vertexOffset,me.vertexLength)}else X&&X>1?ne.drawElementsInstanced(s,me.primitiveLength*ae,ne.UNSIGNED_SHORT,me.primitiveOffset*ae*2,X):M?ne.drawElements(s,me.primitiveLength*ae,ne.UNSIGNED_SHORT,me.primitiveOffset*ae*2):ne.drawArrays(s,me.vertexOffset,me.vertexLength);ge&&this._drawDebugWireframe(t,d,m,y,M,me,z,F,V,X)}}}function Pv(u,t,s=0){const d=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,u.transform.tileZoom)/d,y=m*(t.tileID.canonical.x+t.tileID.wrap*d),v=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v],u_pattern_transition:s}}const Uf={terrain:0,flat:1},Ow=o.bC(),Vf=(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z)=>{const ne=t.style.light,ae=ne.properties.get("position"),re=[ae.x,ae.y,ae.z],we=o.dO();ne.properties.get("anchor")==="viewport"&&(o.dP(we,-t.transform.angle),o.dQ(re,re,we));const ge=ne.properties.get("color").toPremultipliedRenderColor(null),ve=t.transform,me={u_matrix:u,u_lightpos:re,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+s,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ow,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Uf[A],u_base_type:Uf[M],u_ao:m,u_edge_radius:y,u_width_scale:v,u_flood_light_color:V,u_vertical_scale:U,u_flood_light_intensity:X,u_ground_shadow_factor:Z};return ve.projection.name==="globe"&&(me.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],me.u_zoom_transition=O,me.u_inv_rot_matrix=F,me.u_merc_center=z,me.u_up_dir=ve.projection.upVector(new o.cD(0,0,0),z[0]*o.al,z[1]*o.al),me.u_height_lift=E),me},Ig=(u,t,s,d,m,y)=>({u_matrix:u,u_edge_radius:t,u_width_scale:s,u_vertical_scale:d,u_height_type:Uf[m],u_base_type:Uf[y]}),Mv=(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z)=>{const ne=Vf(u,t,s,d,m,y,v,b,A,M,O,z,F,V,U,X,1,[0,0,0]),ae={u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8};return Object.assign(ne,Pv(t,E,Z),ae)},Su=(u,t,s,d,m,y,v,b,E,A,M)=>({u_matrix:t,u_opacity:s,u_ao_pass:d?1:0,u_meter_to_tile:m,u_ao:y,u_flood_light_intensity:v,u_flood_light_color:b,u_attenuation:E,u_edge_radius:A,u_fb:0,u_fb_size:M,u_dynamic_offset:1}),Cg=(u,t,s)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:s}),Ag=(u,t,s,d,m,y=0)=>Object.assign(Cg(u,t,m),Pv(s,d,y)),Rv=(u,t,s,d)=>({u_matrix:u,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:d}),Pg=(u,t,s,d,m,y,v=0)=>Object.assign(Ag(u,t,s,d,y,v),{u_world:m}),Wl=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),Mc=(u,t,s,d,m)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:d,u_reset_depth:m}),$f=(u,t,s,d,m,y,v,b,E)=>({u_matrix:u,u_normal_matrix:t,u_opacity:s,u_faux_facade_ao_intensity:d,u_camera_pos:m,u_tile_to_meter:y,u_facade_emissive_chance:v,u_flood_light_color:b,u_flood_light_intensity:E}),Dv=u=>({u_matrix:u}),ql=u=>({u_matrix:u}),Mg=(u,t,s,d,m,y,v,b)=>{const E=o.al/y.tileSize;return{u_matrix:u,u_inv_rot_matrix:t,u_camera_to_center_distance:s.getCameraToCenterDistance(b),u_extrude_scale:[s.pixelsToGLUnits[0]/E,s.pixelsToGLUnits[1]/E],u_zoom_transition:d,u_tile_id:v,u_merc_center:m}},Yd=(u,t,s=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:s}),Lv=o.bC(),kv=(u,t,s,d,m,y,v)=>{const b=u.transform,E=b.projection.name==="globe",A=E?o.dR(b.zoom,t.canonical)*b._pixelsPerMercatorPixel:o.ay(s,1,y),M={u_matrix:t.projMatrix,u_extrude_scale:A,u_intensity:v,u_inv_rot_matrix:Lv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){M.u_inv_rot_matrix=d,M.u_merc_center=m,M.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],M.u_zoom_transition=o.aj(b.zoom);const O=m[0]*o.al,z=m[1]*o.al;M.u_up_dir=b.projection.upVector(new o.cD(0,0,0),O,z)}return M};function Gf(u,[t,s,d,m],[y,v]){if(y===v)return[0,0,0,0];const b=255*(u-1)/(u*(v-y));return[t*b,s*b,d*b,m*b]}function Hf(u,t,[s,d]){return s===d?0:.5/u+(t-s)*(u-1)/(u*(d-s))}const zv=(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne,ae,re)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:A,u_fade_t:M.mix,u_opacity:M.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:o.dT(O.paint.get("raster-saturation")),u_contrast_factor:o.dS(O.paint.get("raster-contrast")),u_spin_weights:Ov(O.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:F,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:E,u_colorization_mix:Gf(o.dU,U,Z),u_colorization_offset:Hf(o.dU,X,Z),u_color_ramp:V,u_texture_offset:[ae/(ne+2*ae),ne/(ne+2*ae)],u_texture_res:[ne+2*ae,ne+2*ae],u_emissive_strength:re});function Ov(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const La=.05,Fw=(u,t,s,d,m,y,v,b,E,A,M,O)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:m,u_tl_parent:y,u_scale_parent:A,u_fade_t:M.mix,u_opacity:M.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:v,u_merc_center:b,u_cutoff_params:E}),Nw=(u,t,s,d,m,y,v,b,E,A)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:d,u_color_ramp:y,u_velocity_res:m,u_max_speed:v,u_uv_offset:b,u_data_scale:[255*E[0],255*E[1]],u_data_offset:A,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),Fv=(u,t,s,d,m,y,v,b,E,A)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:d,u_max_speed:m,u_speed_factor:y,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:b,u_data_scale:[255*E[0],255*E[1]],u_data_offset:A,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),Nv=o.bC(),Wf=(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne,ae,re,we,ge,ve)=>{const me=m.transform,he={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(ne),u_rotate_symbol:+s,u_aspect_ratio:me.width/me.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+A,u_elevation_from_sea:E?1:0,u_pitch_with_map:+d,u_texsize:M,u_texsize_icon:O,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nv,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nv,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:ge||0,u_gamma_scale:d?m.transform.getCameraToCenterDistance(ne)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:ae,u_inv_matrix:o.bl(o.bC(),v),u_normal_scale:re,u_lutTexture:eo.LUT};return ne.name==="globe"&&(he.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],he.u_zoom_transition=V,he.u_inv_rot_matrix=X,he.u_merc_center=U,he.u_camera_forward=me._camera.forward(),he.u_ecef_origin=o.dV(me.globeMatrix,F.toUnwrapped()),he.u_tile_matrix=Float32Array.from(me.globeMatrix),he.u_up_vector=Z),he},Kd=(u,t,s,d)=>({u_matrix:u,u_emissive_strength:t,u_opacity:s,u_color:d}),Zl=(u,t,s,d,m,y,v,b,E)=>Object.assign(function(A,M,O,z,F,V){const{width:U,height:X}=z.imageManager.getPixelSize(M),Z=Math.pow(2,V.tileID.overscaledZ),ne=V.tileSize*Math.pow(2,z.transform.tileZoom)/Z,ae=ne*(V.tileID.canonical.x+V.tileID.wrap*Z),re=ne*V.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[U,X],u_pattern_size:O.displaySize,u_pattern_units_to_pixels:F?[z.transform.width,-1*z.transform.height]:[1/o.ay(V,1,z.transform.tileZoom),1/o.ay(V,1,z.transform.tileZoom)],u_pixel_coord_upper:[ae>>16,re>>16],u_pixel_coord_lower:[65535&ae,65535&re]}}(0,y,v,d,b,E),{u_matrix:u,u_emissive_strength:t,u_opacity:s}),Eu=new Float32Array(o.bA([])),Rc=(u,t,s,d,m,y,v,b,E,A,M,O,z,F=[0,0,0],V,U,X)=>{const Z=m.style.light,ne=Z.properties.get("position"),ae=[-ne.x,-ne.y,ne.z],re=o.dO();Z.properties.get("anchor")==="viewport"&&(o.dP(re,-m.transform.angle),o.dQ(ae,ae,re));const we=M.alphaMode==="MASK",ge=Z.properties.get("color").toNonPremultipliedRenderColor(null),ve=z.paint.get("model-ambient-occlusion-intensity"),me=z.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return me.a=z.paint.get("model-color-mix-intensity").constantOr(0),X&&(me.r=X[0],me.g=X[1],me.b=X[2],me.a=X[3]),U&&(me.r=U.color.r,me.g=U.color.g,me.b=U.color.b,me.a=U.colorMix,O=U.emissionStrength,y*=U.opacity),{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:d||Eu,u_lightpos:ae,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_camera_pos:F,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:M.alphaCutoff,u_baseColorFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:E,u_roughnessFactor:A,u_baseColorTexture:eo.BaseColor,u_metallicRoughnessTexture:eo.MetallicRoughness,u_normalTexture:eo.Normal,u_occlusionTexture:eo.Occlusion,u_emissionTexture:eo.Emission,u_lutTexture:eo.LUT,u_color_mix:me.toArray01(),u_aoIntensity:ve,u_emissive_strength:O,u_occlusionTextureTransform:V||[0,0,0,0]}},Rg=(u,t=Eu,s=Eu)=>({u_matrix:u,u_instance:t,u_node_matrix:s}),qf={fillExtrusion:u=>({u_matrix:new o.cl(u),u_lightpos:new o.ci(u),u_lightintensity:new o.cj(u),u_lightcolor:new o.ci(u),u_vertical_gradient:new o.cj(u),u_opacity:new o.cj(u),u_edge_radius:new o.cj(u),u_width_scale:new o.cj(u),u_ao:new o.ck(u),u_height_type:new o.ch(u),u_base_type:new o.ch(u),u_tile_id:new o.ci(u),u_zoom_transition:new o.cj(u),u_inv_rot_matrix:new o.cl(u),u_merc_center:new o.ck(u),u_up_dir:new o.ci(u),u_height_lift:new o.cj(u),u_flood_light_color:new o.ci(u),u_vertical_scale:new o.cj(u),u_flood_light_intensity:new o.cj(u),u_ground_shadow_factor:new o.ci(u)}),fillExtrusionDepth:u=>({u_matrix:new o.cl(u),u_edge_radius:new o.cj(u),u_width_scale:new o.cj(u),u_vertical_scale:new o.cj(u),u_height_type:new o.ch(u),u_base_type:new o.ch(u)}),fillExtrusionPattern:u=>({u_matrix:new o.cl(u),u_lightpos:new o.ci(u),u_lightintensity:new o.cj(u),u_lightcolor:new o.ci(u),u_vertical_gradient:new o.cj(u),u_height_factor:new o.cj(u),u_edge_radius:new o.cj(u),u_width_scale:new o.cj(u),u_ao:new o.ck(u),u_height_type:new o.ch(u),u_base_type:new o.ch(u),u_tile_id:new o.ci(u),u_zoom_transition:new o.cj(u),u_inv_rot_matrix:new o.cl(u),u_merc_center:new o.ck(u),u_up_dir:new o.ci(u),u_height_lift:new o.cj(u),u_image:new o.ch(u),u_texsize:new o.ck(u),u_pixel_coord_upper:new o.ck(u),u_pixel_coord_lower:new o.ck(u),u_tile_units_to_pixels:new o.cj(u),u_opacity:new o.cj(u),u_pattern_transition:new o.cj(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new o.cl(u),u_opacity:new o.cj(u),u_ao_pass:new o.cj(u),u_meter_to_tile:new o.cj(u),u_ao:new o.ck(u),u_flood_light_intensity:new o.cj(u),u_flood_light_color:new o.ci(u),u_attenuation:new o.cj(u),u_edge_radius:new o.cj(u),u_fb:new o.ch(u),u_fb_size:new o.cj(u),u_dynamic_offset:new o.cj(u)}),fill:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_ground_shadow_factor:new o.ci(u)}),fillPattern:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_image:new o.ch(u),u_texsize:new o.ck(u),u_pixel_coord_upper:new o.ck(u),u_pixel_coord_lower:new o.ck(u),u_tile_units_to_pixels:new o.cj(u),u_ground_shadow_factor:new o.ci(u),u_pattern_transition:new o.cj(u)}),fillOutline:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_world:new o.ck(u),u_ground_shadow_factor:new o.ci(u)}),fillOutlinePattern:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_world:new o.ck(u),u_image:new o.ch(u),u_texsize:new o.ck(u),u_pixel_coord_upper:new o.ck(u),u_pixel_coord_lower:new o.ck(u),u_tile_units_to_pixels:new o.cj(u),u_ground_shadow_factor:new o.ci(u),u_pattern_transition:new o.cj(u)}),building:u=>({u_matrix:new o.cl(u),u_normal_matrix:new o.cl(u),u_opacity:new o.cj(u),u_faux_facade_ao_intensity:new o.cj(u),u_camera_pos:new o.ci(u),u_tile_to_meter:new o.cj(u),u_facade_emissive_chance:new o.cj(u),u_flood_light_color:new o.ci(u),u_flood_light_intensity:new o.cj(u)}),buildingBloom:u=>({u_matrix:new o.cl(u)}),buildingDepth:u=>({u_matrix:new o.cl(u)}),elevatedStructuresDepth:u=>({u_matrix:new o.cl(u),u_depth_bias:new o.cj(u)}),elevatedStructures:u=>({u_matrix:new o.cl(u),u_ground_shadow_factor:new o.ci(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new o.cl(u),u_camera_pos:new o.ci(u),u_depth_bias:new o.cj(u),u_height_scale:new o.cj(u),u_reset_depth:new o.cj(u)}),circle:o.dY,collisionBox:u=>({u_matrix:new o.cl(u),u_inv_rot_matrix:new o.cl(u),u_camera_to_center_distance:new o.cj(u),u_extrude_scale:new o.ck(u),u_zoom_transition:new o.cj(u),u_merc_center:new o.ck(u),u_tile_id:new o.ci(u)}),collisionCircle:u=>({u_matrix:new o.cl(u),u_inv_matrix:new o.cl(u),u_camera_to_center_distance:new o.cj(u),u_viewport_size:new o.ck(u)}),debug:u=>({u_color:new o.dB(u),u_matrix:new o.cl(u),u_overlay:new o.ch(u),u_overlay_scale:new o.cj(u)}),clippingMask:u=>({u_matrix:new o.cl(u)}),heatmap:u=>({u_extrude_scale:new o.cj(u),u_intensity:new o.cj(u),u_matrix:new o.cl(u),u_inv_rot_matrix:new o.cl(u),u_merc_center:new o.ck(u),u_tile_id:new o.ci(u),u_zoom_transition:new o.cj(u),u_up_dir:new o.ci(u)}),heatmapTexture:u=>({u_image:new o.ch(u),u_color_ramp:new o.ch(u),u_opacity:new o.cj(u)}),hillshade:u=>({u_matrix:new o.cl(u),u_image:new o.ch(u),u_latrange:new o.ck(u),u_light:new o.ck(u),u_shadow:new o.dB(u),u_highlight:new o.dB(u),u_emissive_strength:new o.cj(u),u_accent:new o.dB(u)}),hillshadePrepare:u=>({u_matrix:new o.cl(u),u_image:new o.ch(u),u_dimension:new o.ck(u),u_zoom:new o.cj(u)}),line:o.dX,linePattern:o.dW,raster:u=>({u_matrix:new o.cl(u),u_normalize_matrix:new o.cl(u),u_globe_matrix:new o.cl(u),u_merc_matrix:new o.cl(u),u_grid_matrix:new o.dC(u),u_tl_parent:new o.ck(u),u_scale_parent:new o.cj(u),u_fade_t:new o.cj(u),u_opacity:new o.cj(u),u_image0:new o.ch(u),u_image1:new o.ch(u),u_brightness_low:new o.cj(u),u_brightness_high:new o.cj(u),u_saturation_factor:new o.cj(u),u_contrast_factor:new o.cj(u),u_spin_weights:new o.ci(u),u_perspective_transform:new o.ck(u),u_raster_elevation:new o.cj(u),u_zoom_transition:new o.cj(u),u_merc_center:new o.ck(u),u_cutoff_params:new o.d3(u),u_colorization_mix:new o.d3(u),u_colorization_offset:new o.cj(u),u_color_ramp:new o.ch(u),u_texture_offset:new o.ck(u),u_texture_res:new o.ck(u),u_emissive_strength:new o.cj(u)}),rasterParticle:u=>({u_matrix:new o.cl(u),u_normalize_matrix:new o.cl(u),u_globe_matrix:new o.cl(u),u_merc_matrix:new o.cl(u),u_grid_matrix:new o.dC(u),u_tl_parent:new o.ck(u),u_scale_parent:new o.cj(u),u_fade_t:new o.cj(u),u_opacity:new o.cj(u),u_image0:new o.ch(u),u_image1:new o.ch(u),u_raster_elevation:new o.cj(u),u_zoom_transition:new o.cj(u),u_merc_center:new o.ck(u),u_cutoff_params:new o.d3(u)}),rasterParticleTexture:u=>({u_texture:new o.ch(u),u_opacity:new o.cj(u)}),rasterParticleDraw:u=>({u_particle_texture:new o.ch(u),u_particle_texture_side_len:new o.cj(u),u_tile_offset:new o.ck(u),u_velocity:new o.ch(u),u_color_ramp:new o.ch(u),u_velocity_res:new o.ck(u),u_max_speed:new o.cj(u),u_uv_offset:new o.ck(u),u_data_scale:new o.ck(u),u_data_offset:new o.cj(u),u_particle_pos_scale:new o.cj(u),u_particle_pos_offset:new o.ck(u)}),rasterParticleUpdate:u=>({u_particle_texture:new o.ch(u),u_particle_texture_side_len:new o.cj(u),u_velocity:new o.ch(u),u_velocity_res:new o.ck(u),u_max_speed:new o.cj(u),u_speed_factor:new o.cj(u),u_reset_rate:new o.cj(u),u_rand_seed:new o.cj(u),u_uv_offset:new o.ck(u),u_data_scale:new o.ck(u),u_data_offset:new o.cj(u),u_particle_pos_scale:new o.cj(u),u_particle_pos_offset:new o.ck(u)}),symbol:u=>({u_is_size_zoom_constant:new o.ch(u),u_is_size_feature_constant:new o.ch(u),u_size_t:new o.cj(u),u_size:new o.cj(u),u_camera_to_center_distance:new o.cj(u),u_rotate_symbol:new o.ch(u),u_aspect_ratio:new o.cj(u),u_fade_change:new o.cj(u),u_matrix:new o.cl(u),u_label_plane_matrix:new o.cl(u),u_coord_matrix:new o.cl(u),u_is_text:new o.ch(u),u_elevation_from_sea:new o.ch(u),u_pitch_with_map:new o.ch(u),u_texsize:new o.ck(u),u_texsize_icon:new o.ck(u),u_texture:new o.ch(u),u_texture_icon:new o.ch(u),u_gamma_scale:new o.cj(u),u_device_pixel_ratio:new o.cj(u),u_tile_id:new o.ci(u),u_zoom_transition:new o.cj(u),u_inv_rot_matrix:new o.cl(u),u_merc_center:new o.ck(u),u_camera_forward:new o.ci(u),u_tile_matrix:new o.cl(u),u_up_vector:new o.ci(u),u_ecef_origin:new o.ci(u),u_is_halo:new o.ch(u),u_icon_transition:new o.cj(u),u_color_adj_mat:new o.cl(u),u_scale_factor:new o.cj(u),u_ground_shadow_factor:new o.ci(u),u_inv_matrix:new o.cl(u),u_normal_scale:new o.cj(u),u_lutTexture:new o.ch(u)}),background:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_opacity:new o.cj(u),u_color:new o.dB(u)}),backgroundPattern:u=>({u_matrix:new o.cl(u),u_emissive_strength:new o.cj(u),u_opacity:new o.cj(u),u_image:new o.ch(u),u_pattern_tl:new o.ck(u),u_pattern_br:new o.ck(u),u_texsize:new o.ck(u),u_pattern_size:new o.ck(u),u_pixel_coord_upper:new o.ck(u),u_pixel_coord_lower:new o.ck(u),u_pattern_units_to_pixels:new o.ck(u)}),terrainRaster:u=>({u_matrix:new o.cl(u),u_image0:new o.ch(u),u_image1:new o.ch(u),u_skirt_height:new o.cj(u),u_ground_shadow_factor:new o.ci(u),u_emissive_texture_available:new o.cj(u)}),skybox:u=>({u_matrix:new o.cl(u),u_sun_direction:new o.ci(u),u_cubemap:new o.ch(u),u_opacity:new o.cj(u),u_temporal_offset:new o.cj(u)}),skyboxGradient:u=>({u_matrix:new o.cl(u),u_color_ramp:new o.ch(u),u_center_direction:new o.ci(u),u_radius:new o.cj(u),u_opacity:new o.cj(u),u_temporal_offset:new o.cj(u)}),skyboxCapture:u=>({u_matrix_3f:new o.dC(u),u_sun_direction:new o.ci(u),u_sun_intensity:new o.cj(u),u_color_tint_r:new o.d3(u),u_color_tint_m:new o.d3(u),u_luminance:new o.cj(u)}),globeRaster:u=>({u_proj_matrix:new o.cl(u),u_globe_matrix:new o.cl(u),u_normalize_matrix:new o.cl(u),u_merc_matrix:new o.cl(u),u_zoom_transition:new o.cj(u),u_merc_center:new o.ck(u),u_image0:new o.ch(u),u_image1:new o.ch(u),u_grid_matrix:new o.dC(u),u_skirt_height:new o.cj(u),u_far_z_cutoff:new o.cj(u),u_frustum_tl:new o.ci(u),u_frustum_tr:new o.ci(u),u_frustum_br:new o.ci(u),u_frustum_bl:new o.ci(u),u_globe_pos:new o.ci(u),u_globe_radius:new o.cj(u),u_viewport:new o.ck(u),u_emissive_texture_available:new o.cj(u)}),globeAtmosphere:u=>({u_frustum_tl:new o.ci(u),u_frustum_tr:new o.ci(u),u_frustum_br:new o.ci(u),u_frustum_bl:new o.ci(u),u_horizon:new o.cj(u),u_transition:new o.cj(u),u_fadeout_range:new o.cj(u),u_atmosphere_fog_color:new o.d3(u),u_high_color:new o.d3(u),u_space_color:new o.d3(u),u_temporal_offset:new o.cj(u),u_horizon_angle:new o.cj(u)}),model:u=>({u_matrix:new o.cl(u),u_lighting_matrix:new o.cl(u),u_normal_matrix:new o.cl(u),u_node_matrix:new o.cl(u),u_lightpos:new o.ci(u),u_lightintensity:new o.cj(u),u_lightcolor:new o.ci(u),u_camera_pos:new o.ci(u),u_opacity:new o.cj(u),u_baseColorFactor:new o.d3(u),u_emissiveFactor:new o.d3(u),u_metallicFactor:new o.cj(u),u_roughnessFactor:new o.cj(u),u_baseTextureIsAlpha:new o.ch(u),u_alphaMask:new o.ch(u),u_alphaCutoff:new o.cj(u),u_baseColorTexture:new o.ch(u),u_metallicRoughnessTexture:new o.ch(u),u_normalTexture:new o.ch(u),u_occlusionTexture:new o.ch(u),u_emissionTexture:new o.ch(u),u_lutTexture:new o.ch(u),u_color_mix:new o.d3(u),u_aoIntensity:new o.cj(u),u_emissive_strength:new o.cj(u),u_occlusionTextureTransform:new o.d3(u)}),modelDepth:u=>({u_matrix:new o.cl(u),u_instance:new o.cl(u),u_node_matrix:new o.cl(u)}),groundShadow:u=>({u_matrix:new o.cl(u),u_ground_shadow_factor:new o.ci(u)}),stars:u=>({u_matrix:new o.cl(u),u_up:new o.ci(u),u_right:new o.ci(u),u_intensity_multiplier:new o.cj(u)}),snowParticle:u=>({u_modelview:new o.cl(u),u_projection:new o.cl(u),u_time:new o.cj(u),u_cam_pos:new o.ci(u),u_velocityConeAperture:new o.cj(u),u_velocity:new o.cj(u),u_horizontalOscillationRadius:new o.cj(u),u_horizontalOscillationRate:new o.cj(u),u_boxSize:new o.cj(u),u_billboardSize:new o.cj(u),u_simpleShapeParameters:new o.ck(u),u_screenSize:new o.ck(u),u_thinningCenterPos:new o.ck(u),u_thinningShape:new o.ci(u),u_thinningAffectedRatio:new o.cj(u),u_thinningParticleOffset:new o.cj(u),u_particleColor:new o.d3(u),u_direction:new o.ci(u)}),rainParticle:u=>({u_modelview:new o.cl(u),u_projection:new o.cl(u),u_time:new o.cj(u),u_cam_pos:new o.ci(u),u_texScreen:new o.ch(u),u_velocityConeAperture:new o.cj(u),u_velocity:new o.cj(u),u_boxSize:new o.cj(u),u_rainDropletSize:new o.ck(u),u_distortionStrength:new o.cj(u),u_rainDirection:new o.ci(u),u_color:new o.d3(u),u_screenSize:new o.ck(u),u_thinningCenterPos:new o.ck(u),u_thinningShape:new o.ci(u),u_thinningAffectedRatio:new o.cj(u),u_thinningParticleOffset:new o.cj(u),u_shapeDirectionalPower:new o.cj(u),u_shapeNormalPower:new o.cj(u),u_mode:new o.cj(u)}),vignette:u=>({u_vignetteShape:new o.ci(u),u_vignetteColor:new o.d3(u)}),occlusion:u=>({u_matrix:new o.cl(u),u_anchorPos:new o.ci(u),u_screenSizePx:new o.ck(u),u_occluderSizePx:new o.ck(u),u_color:new o.d3(u)})};class la{constructor(t,s,d,m){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}la.uniqueIdxCounter=0;const Dg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bv{constructor(t,s,d,m,y,v){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=v,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let d=0;d<this.attributes.length;d++){const m=s.getAttributeLocation(t,this.attributes[d].name);m!==-1&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,d){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],v=s.getAttributeLocation(t,y.name);v!==-1&&t.vertexAttribPointer(v,y.components,t[Dg[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,s,d){for(let m=0;m<this.attributes.length;m++){const y=s.getAttributeLocation(t,this.attributes[m].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jv{constructor(t,s,d,m,y){this.context=t,this.width=s,this.height=d;const v=this.framebuffer=t.gl.createFramebuffer();m>0&&(this.colorAttachment0=new Of(t,v,0)),m>1&&(this.colorAttachment1=new Of(t,v,1)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new wu(t,v):new Wd(t,v))}createColorAttachment(t,s){s===0?this.colorAttachment0=new Of(t,this.framebuffer,0):s===1&&(this.colorAttachment1=new Of(t,this.framebuffer,1))}removeColorAttachment(t,s){const d=this.context.gl;let m;s===0?(m=this.colorAttachment0.get(),this.colorAttachment0=void 0):s===1&&(m=this.colorAttachment1.get(),this.colorAttachment1=void 0),m&&d.deleteTexture(m)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const s=this.colorAttachment0.get();s&&t.deleteTexture(s)}if(this.colorAttachment1){const s=this.colorAttachment1.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class Iu{constructor(t,s){this.gl=t,this.clearColor=new Mw(this),this.clearDepth=new vv(this),this.clearStencil=new pg(this),this.colorMask=new Rf(this),this.depthMask=new mg(this),this.stencilMask=new Pc(this),this.stencilFunc=new _u(this),this.stencilOp=new Gd(this),this.stencilTest=new yu(this),this.depthRange=new xv(this),this.depthTest=new gg(this),this.depthFunc=new wv(this),this.blend=new vu(this),this.blendFunc=new Df(this),this.blendColor=new Lf(this),this.blendEquation=new _g(this),this.cullFace=new kf(this),this.cullFaceSide=new Hd(this),this.frontFace=new bv(this),this.program=new Tv(this),this.activeTexture=new Sv(this),this.viewport=new xu(this),this.bindFramebuffer=new Ev(this),this.bindRenderbuffer=new Rw(this),this.bindTexture=new Dw(this),this.bindVertexBuffer=new Lw(this),this.bindElementBuffer=new yg(this),this.bindVertexArrayOES=new vg(this),this.pixelStoreUnpack=new xg(this),this.pixelStoreUnpackPremultiplyAlpha=new wg(this),this.pixelStoreUnpackFlipY=new Iv(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,d){return new la(this,t,s,d)}createVertexBuffer(t,s,d,m,y){return new Bv(this,t,s,d,m,y)}createRenderbuffer(t,s,d){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,s,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,d,m){return new jv(this,t,s,d,m)}clear({color:t,depth:s,stencil:d,colorMask:m}){const y=this.gl;let v=0;t&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.by(t.blendFunction,Mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Dc;function jt(u,t,s,d,m,y,v){const b=u.context,E=b.gl,A=u.transform,M=[o.aF(A.center.lng),o.aJ(A.center.lat)],O=s.layout.get("symbol-placement"),z=s.layout.get("text-variable-anchor"),F=s.layout.get("icon-rotation-alignment")==="map",V=s.layout.get("text-rotation-alignment")==="map",U=O!=="point",X=[];let Z=0,ne=0;for(let he=0;he<d.length;he++){const Se=d[he],Le=t.getTile(Se),Re=Le.getBucket(s);if(!Re)continue;const qe=Re.getProjection().createInversionMatrix(A,Se.canonical),Ze=[],tt=pf(Se,Re,A),_t=!v&&F&&U,Ue=v&&V&&U,Ae=z&&Re.hasTextData(),Ke=Re.hasIconTextFit()&&Ae&&Re.hasIconData(),$e=_t||Ue||v&&Ae||Ke,lt=Re.projection.name==="globe",Ct=lt?o.aj(A.zoom):0;lt&&(Ze.push("PROJECTION_GLOBE_VIEW"),$e&&Ze.push("PROJECTED_POS_ON_VIEWPORT"));const zt=u.getOrCreateProgram("collisionBox",{defines:Ze});let St=tt;m[0]===0&&m[1]===0||(St=u.translatePosMatrix(tt,Le,m,y));const yt=v?Re.textCollisionBox:Re.iconCollisionBox,Xt=Re.collisionCircleArray;if(Xt.length>0){const Dt=o.bC(),Ft=St;o.cP(Dt,Re.placementInvProjMatrix,A.glCoordMatrix),o.cP(Dt,Dt,Re.placementViewportMatrix),X.push({circleArray:Xt,circleOffset:ne,transform:Ft,invTransform:Dt,projection:Re.getProjection()}),Z+=Xt.length/4,ne=Z}if(!yt)continue;u.terrain&&u.terrain.setupElevationDraw(Le,zt);const Ut=lt?[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z]:[0,0,0];zt.draw(u,E.LINES,Qt.disabled,yn.disabled,u.colorModeForRenderPass(),gn.disabled,Mg(St,qe,A,Ct,M,Le,Ut,Re.getProjection()),s.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,null,A.zoom,null,[yt.collisionVertexBuffer,yt.collisionVertexBufferExt])}if(!v||!X.length)return;const ae=u.getOrCreateProgram("collisionCircle"),re=new o.dZ;re.resize(4*Z),re._trim();let we=0;for(const he of X)for(let Se=0;Se<he.circleArray.length/4;Se++){const Le=4*Se,Re=he.circleArray[Le+0],qe=he.circleArray[Le+1],Ze=he.circleArray[Le+2],tt=he.circleArray[Le+3];re.emplace(we++,Re,qe,Ze,tt,0),re.emplace(we++,Re,qe,Ze,tt,1),re.emplace(we++,Re,qe,Ze,tt,2),re.emplace(we++,Re,qe,Ze,tt,3)}(!Dc||Dc.length<2*Z)&&(Dc=function(he){const Se=2*he,Le=new o.b0;Le.resize(Se),Le._trim();for(let Re=0;Re<Se;Re++){const qe=6*Re;Le.uint16[qe+0]=4*Re+0,Le.uint16[qe+1]=4*Re+1,Le.uint16[qe+2]=4*Re+2,Le.uint16[qe+3]=4*Re+2,Le.uint16[qe+4]=4*Re+3,Le.uint16[qe+5]=4*Re+0}return Le}(Z));const ge=b.createIndexBuffer(Dc,!0),ve=b.createVertexBuffer(re,o.d_.members,!0);for(const he of X){const Se={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(me=A).getCameraToCenterDistance(he.projection),u_viewport_size:[me.width,me.height]};ae.draw(u,E.TRIANGLES,Qt.disabled,yn.disabled,u.colorModeForRenderPass(),gn.disabled,Se,s.id,ve,ge,o.bg.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,A.zoom)}var me;ve.destroy(),ge.destroy()}const Qd=o.bC();function nl(u){const t=u._camera.getWorldToCamera(u.worldSize,1),s=o.aB([],t,u.globeMatrix);o.bl(s,s);const d=[0,0,0],m=[0,1,0,0];return o.aC(m,m,s),d[0]=m[0],d[1]=m[1],d[2]=m[2],o.aw(d,d),d}function Xl({width:u,height:t,anchor:s,textOffset:d,textScale:m},y){const{horizontalAlign:v,verticalAlign:b}=o.c1(s),E=-(v-.5)*u,A=-(b-.5)*t,M=o.c2(s,d);return new o.P((E/m+M[0])*y,(A/m+M[1])*y)}function ln(u,t,s,d,m,y,v,b,E,A){const M=u.text.placedSymbolArray,O=u.text.dynamicLayoutVertexArray,z=u.icon.dynamicLayoutVertexArray,F={},V=u.getProjection(),U=Aa(v,V,m),X=m.elevation,Z=V.upVectorScale(v.canonical,m.center.lat,m.worldSize).metersToTile;O.clear();for(let ne=0;ne<M.length;ne++){const ae=M.get(ne),{tileAnchorX:re,tileAnchorY:we,numGlyphs:ge}=ae,ve=ae.hidden||!ae.crossTileID||u.allowVerticalPlacement&&!ae.placedOrientation?null:d[ae.crossTileID];if(ve){let me=0,he=0,Se=0;const Le=u.elevationType==="road";if(X||Le){const $e=Le?u.getElevationFeatureForText(ne):null,lt=o.bV.getAtTileOffset(v,new o.P(re,we),X,$e),[Ct,zt,St]=V.upVector(v.canonical,re,we);me=lt*Ct*Z,he=lt*zt*Z,Se=lt*St*Z}let[Re,qe,Ze,tt]=Fs(ae.projectedAnchorX+me,ae.projectedAnchorY+he,ae.projectedAnchorZ+Se,s?U:y);const _t=vi(m.getCameraToCenterDistance(V),tt);let Ue=o.bM(u.textSizeData,E,ae)*_t/o.bY;s&&(Ue*=u.tilePixelRatio/b);const Ae=Xl(ve,Ue);s?({x:Re,y:qe,z:Ze}=V.projectTilePoint(re+Ae.x,we+Ae.y,v.canonical),[Re,qe,Ze]=Fs(Re+me,qe+he,Ze+Se,y)):(t&&Ae._rotate(-m.angle),Re+=Ae.x,qe+=Ae.y,Ze=0);const Ke=u.allowVerticalPlacement&&ae.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let $e=0;$e<ge;$e++)o.bO(O,Re,qe,Ze,Ke);A&&ae.associatedIconIndex>=0&&(F[ae.associatedIconIndex]={x:Re,y:qe,z:Ze,angle:Ke})}else oa(ge,O)}if(A){z.clear();const ne=u.icon.placedSymbolArray;for(let ae=0;ae<ne.length;ae++){const re=ne.get(ae),{numGlyphs:we}=re,ge=F[ae];if(re.hidden||!ge)oa(we,z);else{const{x:ve,y:me,z:he,angle:Se}=ge;for(let Le=0;Le<we;Le++)o.bO(z,ve,me,he,Se)}}u.icon.dynamicLayoutVertexBuffer.updateData(z)}u.text.dynamicLayoutVertexBuffer.updateData(O)}function Jd(u,t,s,d,m,y,v={}){const b=s.paint.get("icon-translate"),E=s.paint.get("text-translate"),A=s.paint.get("icon-translate-anchor"),M=s.paint.get("text-translate-anchor"),O=s.layout.get("icon-rotation-alignment"),z=s.layout.get("text-rotation-alignment"),F=s.layout.get("icon-pitch-alignment"),V=s.layout.get("text-pitch-alignment"),U=s.layout.get("icon-keep-upright"),X=s.layout.get("text-keep-upright"),Z=s.paint.get("icon-color-saturation"),ne=s.paint.get("icon-color-contrast"),ae=s.paint.get("icon-color-brightness-min"),re=s.paint.get("icon-color-brightness-max"),we=s.layout.get("symbol-elevation-reference")==="sea",ge=s.layout.get("icon-image-use-theme")==="none",ve=u.context,me=ve.gl,he=u.transform,Se=O==="map",Le=z==="map",Re=F==="map",qe=V==="map",Ze=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const _t=u.depthModeForSublayer(0,Qt.ReadOnly),Ue=new Qt(u.context.gl.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D),Ae=[o.aF(he.center.lng),o.aJ(he.center.lat)],Ke=s.layout.get("text-variable-anchor"),$e=he.projection.name==="globe",lt=[],Ct=[0,-1,0];for(const zt of d){const St=t.getTile(zt),yt=St.getBucket(s);if(!yt||yt.projection.name==="mercator"&&$e||yt.fullyClipped)continue;const Xt=yt.projection.name==="globe",Ut=Xt?o.aj(he.zoom):0,Dt=Aa(zt,yt.getProjection(),he),Ft=he.calculatePixelsToTileUnitsMatrix(St),sn=Ke&&yt.hasTextData(),Tn=yt.hasIconTextFit()&&sn&&yt.hasIconData(),Gn=yt.getProjection().createInversionMatrix(he,zt.canonical),ci=(1<<St.tileID.canonical.z)*o.al/u.transform.worldSize,Yt=mi=>{let ei=[0,0,0];if(mi){const Ln=u.style.directionalLight,Vi=u.style.ambientLight;Ln&&Vi&&(ei=el(u.style,Ln,Vi))}return ei},oi=mi=>{he.depthOcclusionForSymbolsAndCircles&&(s.hasOcclusionOpacityProperties||u.terrain)&&(mi.push("DEPTH_D24"),mi.push("DEPTH_OCCLUSION"))},wn=mi=>{s.lut&&!ge&&(s.lut.texture||(s.lut.texture=new o.d$(u.context,s.lut.image,[s.lut.image.height,s.lut.image.height,s.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+eo.LUT),s.lut.texture&&s.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),mi.push("APPLY_LUT_ON_GPU"))},pi=()=>{const mi=Se&&s.layout.get("symbol-placement")!=="point",ei=[];oi(ei),wn(ei);const Ln=mi||Tn,Vi=yt.elevationType==="road",gr=u.shadowRenderer,tr=Vi&&Re&&!!gr&&gr.enabled,Pi=Yt(tr),$o=Vi&&Re&&!u.terrain?Ue:_t,go=s.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&Re&&ei.push("PITCH_WITH_MAP_TERRAIN"),Xt&&(ei.push("PROJECTION_GLOBE_VIEW"),Ln&&ei.push("PROJECTED_POS_ON_VIEWPORT")),go>0&&yt.hasAnySecondaryIcon&&ei.push("ICON_TRANSITION"),!yt.icon.zOffsetVertexBuffer||Vi&&u.terrain||ei.push("Z_OFFSET"),Z===0&&ne===0&&ae===0&&re===1||ei.push("COLOR_ADJUSTMENT"),yt.sdfIcons&&ei.push("RENDER_SDF"),tr&&ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Vi&&Re&&!u.terrain&&yt.icon.orientationVertexBuffer&&ei.push("ELEVATED_ROADS");const Or=yt.icon.programConfigurations.get(s.id),Io=u.getOrCreateProgram("symbol",{config:Or,defines:ei}),Co=St.imageAtlasTexture?St.imageAtlasTexture.size:[0,0],so=yt.iconSizeData,xs=o.bK(so,he.zoom),Hs=Re||!he.isOrthographic,Jo=Lo(Dt,St.tileID.canonical,Re,Se,he,yt.getProjection(),Ft),hr=kd(Dt,St.tileID.canonical,Re,Se,he,yt.getProjection(),Ft),wr=u.translatePosMatrix(hr,St,b,A,!0),Mi=u.translatePosMatrix(Dt,St,b,A),Ir=Ln?Qd:Jo,lr=Se&&!Re&&!mi;let nr=Ct;!$e&&!he.mercatorFromTransition||Se||(nr=nl(he));const Ws=Xt?nr:Ct,dh=s.getColorAdjustmentMatrix(Z,ne,ae,re),da=Wf(so.kind,xs,lr,Re,u,Mi,Ir,wr,we,!1,Co,[0,0],0,zt,Ut,Ae,Gn,Ws,yt.getProjection(),Pi,ci,dh,go,null),hh=St.imageAtlasTexture?St.imageAtlasTexture:null,zu=s.layout.get("icon-size").constantOr(0)!==1||yt.iconsNeedLinear,Na=yt.sdfIcons||u.options.rotating||u.options.zooming||zu||Hs?me.LINEAR:me.NEAREST,dl=yt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Ou=u.terrain&&Re&&mi?o.bl(o.bC(),Jo):Qd;if(mi&&yt.icon){const ec=o.bV.getAtTileOffsetFunc(zt,he.center.lat,he.worldSize,yt.getProjection()),hl=mf(Dt,St.tileID.canonical,Re,Se,he,yt.getProjection(),Ft),ha=s.layout.get("icon-size-scale-range"),fl=o.aA(u.scaleFactor,ha[0],ha[1]);uv(yt,Dt,u,!1,hl,hr,Re,U,ec,zt,fl)}return{program:Io,buffers:yt.icon,uniformValues:da,atlasTexture:hh,atlasTextureIcon:null,atlasInterpolation:Na,atlasInterpolationIcon:null,isSDF:yt.sdfIcons,hasHalo:dl,depthMode:$o,tile:St,renderWithShadows:tr,labelPlaneMatrixInv:Ou}},Si=()=>{const mi=Le&&s.layout.get("symbol-placement")!=="point",ei=[],Ln=mi||Ke||Tn,Vi=yt.elevationType==="road",gr=u.shadowRenderer,tr=Vi&&qe&&!!gr&&gr.enabled,Pi=Yt(tr),$o=Vi&&qe&&!u.terrain?Ue:_t;u.terrainRenderModeElevated()&&qe&&ei.push("PITCH_WITH_MAP_TERRAIN"),Xt&&(ei.push("PROJECTION_GLOBE_VIEW"),Ln&&ei.push("PROJECTED_POS_ON_VIEWPORT")),!yt.text.zOffsetVertexBuffer||Vi&&u.terrain||ei.push("Z_OFFSET"),yt.iconsInText&&ei.push("RENDER_TEXT_AND_SYMBOL"),ei.push("RENDER_SDF"),tr&&ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Vi&&qe&&!u.terrain&&yt.text.orientationVertexBuffer&&ei.push("ELEVATED_ROADS"),oi(ei);const go=yt.text.programConfigurations.get(s.id),Or=u.getOrCreateProgram("symbol",{config:go,defines:ei});let Io,Co=[0,0],so=null;const xs=yt.textSizeData;yt.iconsInText&&(Co=St.imageAtlasTexture?St.imageAtlasTexture.size:[0,0],so=St.imageAtlasTexture?St.imageAtlasTexture:null,Io=qe||!he.isOrthographic||u.options.rotating||u.options.zooming||xs.kind==="composite"||xs.kind==="camera"?me.LINEAR:me.NEAREST);const Hs=St.glyphAtlasTexture?St.glyphAtlasTexture.size:[0,0],Jo=s.layout.get("text-size-scale-range"),hr=o.aA(u.scaleFactor,Jo[0],Jo[1]),wr=o.bK(xs,he.zoom,hr),Mi=Lo(Dt,St.tileID.canonical,qe,Le,he,yt.getProjection(),Ft),Ir=kd(Dt,St.tileID.canonical,qe,Le,he,yt.getProjection(),Ft),lr=u.translatePosMatrix(Ir,St,E,M,!0),nr=u.translatePosMatrix(Dt,St,E,M),Ws=Ln?Qd:Mi,dh=Le&&!qe&&!mi;let da=Ct;!$e&&!he.mercatorFromTransition||Le||(da=nl(he));const hh=Wf(xs.kind,wr,dh,qe,u,nr,Ws,lr,we,!0,Hs,Co,0,zt,Ut,Ae,Gn,Xt?da:Ct,yt.getProjection(),Pi,ci,null,null,hr),zu=St.glyphAtlasTexture?St.glyphAtlasTexture:null,Na=me.LINEAR,dl=s.paint.get("text-halo-width").constantOr(1)!==0,Ou=u.terrain&&qe&&mi?o.bl(o.bC(),Mi):Qd;if(mi&&yt.text){const ec=o.bV.getAtTileOffsetFunc(zt,he.center.lat,he.worldSize,yt.getProjection()),hl=mf(Dt,St.tileID.canonical,qe,Le,he,yt.getProjection(),Ft);uv(yt,Dt,u,!0,hl,Ir,qe,X,ec,zt,hr)}return{program:Or,buffers:yt.text,uniformValues:hh,atlasTexture:zu,atlasTextureIcon:so,atlasInterpolation:Na,atlasInterpolationIcon:Io,isSDF:!0,hasHalo:dl,depthMode:$o,tile:St,renderWithShadows:tr,labelPlaneMatrixInv:Ou}},xi=yt.icon.segments.get().length,ri=yt.text.segments.get().length,Dn=xi&&!v.onlyText?pi():null,di=ri&&!v.onlyIcons?Si():null,ar=s.paint.get("icon-opacity").constantOr(1),Zi=s.paint.get("text-opacity").constantOr(1);if(Ze&&yt.canOverlap){tt=!0;const mi=ar&&!v.onlyText?yt.icon.segments.get():[],ei=Zi&&!v.onlyIcons?yt.text.segments.get():[];for(const Ln of mi)lt.push({segments:new o.bg([Ln]),sortKey:Ln.sortKey,state:Dn});for(const Ln of ei)lt.push({segments:new o.bg([Ln]),sortKey:Ln.sortKey,state:di})}else v.onlyText||lt.push({segments:ar?yt.icon.segments:new o.bg([]),sortKey:0,state:Dn}),v.onlyIcons||lt.push({segments:Zi?yt.text.segments:new o.bg([]),sortKey:0,state:di})}tt&&lt.sort((zt,St)=>zt.sortKey-St.sortKey);for(const zt of lt){const St=zt.state;if(St)if(u.terrain?u.terrain.setupElevationDraw(St.tile,St.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:St.labelPlaneMatrixInv}):u.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,St.program),ve.activeTexture.set(me.TEXTURE0),St.atlasTexture&&St.atlasTexture.bind(St.atlasInterpolation,me.CLAMP_TO_EDGE,!0),St.atlasTextureIcon&&(ve.activeTexture.set(me.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,me.CLAMP_TO_EDGE,!0)),St.renderWithShadows&&u.shadowRenderer.setupShadows(St.tile.tileID.toUnwrapped(),St.program,"vector-tile"),u.uploadCommonLightUniforms(u.context,St.program),St.hasHalo){const yt=St.uniformValues;yt.u_is_halo=1,Lg(St.buffers,zt.segments,s,u,St.program,St.depthMode,m,y,yt,2),yt.u_is_halo=0}else{if(St.isSDF){const yt=St.uniformValues;St.hasHalo&&(yt.u_is_halo=1,Lg(St.buffers,zt.segments,s,u,St.program,St.depthMode,m,y,yt,1)),yt.u_is_halo=0}Lg(St.buffers,zt.segments,s,u,St.program,St.depthMode,m,y,St.uniformValues,1)}}}function Lg(u,t,s,d,m,y,v,b,E,A){const M=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer,u.orientationVertexBuffer];m.draw(d,d.context.gl.TRIANGLES,y,v,b,gn.disabled,E,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,d.transform.zoom,u.programConfigurations.get(s.id),M,A)}function Uv(u,t){const s=1<<u.canonical.z,d=(t.x*s-u.canonical.x-u.wrap*s)*o.al,m=(t.y*s-u.canonical.y)*o.al,y=o.e8(t.z,t.y);return o.d5(d,m,y)}function Zf(u,t,s,d,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none"||s.paint.get("fill-opacity").constantOr(1)===0)return;const y=u.context.gl,v=new Qt(u.context.gl.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D),b=new Qt(u.context.gl.GREATER,Qt.ReadWrite,u.depthRangeFor3D),E=function(F){let V=.01;return F.isOrthographic&&(V=o.ak(1e-4,V,o.d0(F.pitch>=aa?1:F.pitch/aa))),2*V}(u.transform),A=u.transform.getFreeCameraOptions().position,M="elevatedStructuresDepthReconstruct",O=u.getOrCreateProgram(M,{defines:["DEPTH_RECONSTRUCTION"]}),z=u.getOrCreateProgram(M);for(const F of d){const V=t.getTile(F),U=V.getBucket(s);if(!U)continue;const X=U.elevatedStructures;if(!X)continue;const Z=U.elevationBufferData.heightRange,ne=Uv(F.toUnwrapped(),A),ae=u.translatePosMatrix(F.projMatrix,V,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let re,we,ge,ve;if(m==="initialize"){if(!Z||Z.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;re=Mc(ae,ne,E,1,0),we=v,ge=X.depthSegments,ve=O}else if(m==="reset"){if(!Z||Z.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;re=Mc(ae,ne,0,0,1),we=b,ge=X.maskSegments,ve=O}else if(m==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;re=Mc(ae,ne,E,1,0),we=v,ge=X.depthSegments,ve=z}ve.draw(u,y.TRIANGLES,we,yn.disabled,Mn.disabled,gn.disabled,re,s.id,X.vertexBuffer,X.indexBuffer,ge,s.paint,u.transform.zoom)}}function Xf(u,t,s,d){const{painter:m,sourceCache:y,layer:v,coords:b,colorMode:E,elevationType:A,terrainEnabled:M,pass:O}=u,z=m.context.gl,F=v.paint.get("fill-pattern"),V=v.paint.get("fill-pattern-cross-fade"),U=F.constantOr(null);let X=A;A!=="road"||t&&!M||(X="none");const Z=X==="road",ne=u.painter.shadowRenderer,ae=Z&&!!ne&&ne.enabled,re=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);let we=[0,0,0];if(ae){const he=m.style.directionalLight,Se=m.style.ambientLight;he&&Se&&(we=el(m.style,he,Se))}const ge=F&&F.constantOr(1),ve=m.terrain&&m.terrain.renderingToTexture,me=(he,Se)=>{let Le,Re,qe,Ze,tt;Se?(Le=ge&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",qe=z.LINES):(Le=ge?"fillPattern":"fill",qe=z.TRIANGLES);for(const _t of b){const Ue=y.getTile(_t);if(ge&&!Ue.patternsLoaded())continue;const Ae=Ue.getBucket(v);if(!Ae)continue;const Ke=t?Ae.elevationBufferData:Ae.bufferData;if(Ke.isEmpty())continue;m.prepareDrawTile();const $e=Ke.programConfigurations.get(v.id),lt=m.isTileAffectedByFog(_t),Ct=[],zt=[];Z&&(Ct.push("ELEVATED_ROADS"),zt.push(Ke.elevatedLayoutVertexBuffer)),ae&&Ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ve&&s&&Ct.push("USE_MRT1"),ge&&(m.context.activeTexture.set(z.TEXTURE0),Ue.imageAtlasTexture&&Ue.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers());let St=!1;if(U&&Ue.imageAtlas){const Ft=Ue.imageAtlas,sn=o.e3.from(U),Tn=sn.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Gn=sn.getSecondary(),ci=Ft.patternPositions.get(Tn),Yt=Gn?Ft.patternPositions.get(Gn.scaleSelf(o.o.devicePixelRatio).toString()):null;St=!!ci&&!!Yt,ci&&$e.setConstantPatternPositions(ci,Yt)}V>0&&(St||$e.getPatternTransitionVertexBuffer("fill-pattern"))&&Ct.push("FILL_PATTERN_TRANSITION");const yt=m.getOrCreateProgram(Le,{config:$e,overrideFog:lt,defines:Ct}),Xt=m.translatePosMatrix(_t.projMatrix,Ue,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));ae&&ne.setupShadows(Ue.tileID.toUnwrapped(),yt,"vector-tile");const Ut=v.paint.get("fill-emissive-strength");if(Se){Ze=Ke.lineIndexBuffer,tt=Ke.lineSegments;const Ft=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];Re=Le==="fillOutlinePattern"&&ge?Pg(Xt,Ut,m,Ue,Ft,we,V):Rv(Xt,Ut,Ft,we)}else Ze=Ke.indexBuffer,tt=Ke.triangleSegments,Re=ge?Ag(Xt,Ut,m,Ue,we,V):Cg(Xt,Ut,we);m.uploadCommonUniforms(m.context,yt,_t.toUnwrapped());let Dt=he;(A==="road"&&!M||A==="offset")&&(Dt=re),yt.draw(m,qe,Dt,d||m.stencilModeForClipping(_t),E,gn.disabled,Re,v.id,Ke.layoutVertexBuffer,Ze,tt,v.paint,m.transform.zoom,$e,zt)}};m.renderPass===O&&me(m.depthModeForSublayer(1,m.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly),!1),X==="none"&&m.renderPass==="translucent"&&v.paint.get("fill-antialias")&&me(m.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly),!0)}function Yf(u,t,s,d,m,y,v,b){s.resetLayerRenderingStats(u);const E=u.context,A=E.gl,M=u.transform,O=s.paint.get("fill-extrusion-pattern"),z=s.paint.get("fill-extrusion-pattern-cross-fade"),F=O.constantOr(null),V=O.constantOr(1),U=s.paint.get("fill-extrusion-opacity"),X=u.style.enable3dLights(),Z=s.paint.get(X&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ne=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],ae=s.layout.get("fill-extrusion-edge-radius"),re=ae>0&&!s.paint.get("fill-extrusion-rounded-roof"),we=re?0:ae,ge=M.projection.name==="globe"?o.eb():0,ve=M.projection.name==="globe",me=ve?o.aj(M.zoom):0,he=[o.aF(M.center.lng),o.aJ(M.center.lat)],Se=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Le=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:s.lut).toArray01().slice(0,3),Re=s.paint.get("fill-extrusion-flood-light-intensity"),qe=s.paint.get("fill-extrusion-vertical-scale"),Ze=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,tt=s.paint.get("fill-extrusion-height-alignment"),_t=s.paint.get("fill-extrusion-base-alignment"),Ue=jl(u,s.paint.get("fill-extrusion-cutoff-fade-range")),Ae=[];let Ke;ve&&Ae.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&Ae.push("FAUX_AO"),re&&Ae.push("ZERO_ROOF_RADIUS"),b&&Ae.push("HAS_CENTROID"),Re>0&&Ae.push("FLOOD_LIGHT"),Ue.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),Ze&&Ae.push("RENDER_WALL_MODE");const $e=u.renderPass==="shadow",lt=u.shadowRenderer,Ct=$e&&!!lt,zt=$e?gn.disabled:gn.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let St=[0,0,0];if(lt){const Ut=u.style.directionalLight,Dt=u.style.ambientLight;Ut&&Dt&&(St=el(u.style,Ut,Dt)),$e||(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),lt.useNormalOffset&&Ae.push("NORMAL_OFFSET")),Ke=Ae.concat(["SHADOWS_SINGLE_CASCADE"])}const yt=Ct?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",Xt=s.getLayerRenderingStats();for(const Ut of d){const Dt=t.getTile(Ut),Ft=Dt.getBucket(s);if(!Ft||Ft.projection.name!==M.projection.name)continue;let sn=!1;lt&&(sn=lt.getMaxCascadeForTile(Ut.toUnwrapped())===0);const Tn=u.isTileAffectedByFog(Ut),Gn=Ft.programConfigurations.get(s.id);let ci=!1;if(F&&Dt.imageAtlas){const ri=Dt.imageAtlas,Dn=o.e3.from(F),di=Dn.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),ar=Dn.getSecondary(),Zi=ri.patternPositions.get(di),mi=ar?ri.patternPositions.get(ar.scaleSelf(o.o.devicePixelRatio).toString()):null;ci=!!Zi&&!!mi,Zi&&Gn.setConstantPatternPositions(Zi,mi)}z>0&&(ci||Gn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ae.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yt=u.getOrCreateProgram(yt,{config:Gn,defines:sn?Ke:Ae,overrideFog:Tn});if(u.terrain&&u.terrain.setupElevationDraw(Dt,Yt,{useMeterToDem:!0}),!Ft.centroidVertexBuffer){const ri=Yt.getAttributeLocation(A,"a_centroid_pos");ri!==-1&&A.vertexAttrib2f(ri,0,0)}!$e&&lt&&lt.setupShadows(Dt.tileID.toUnwrapped(),Yt,"vector-tile"),V&&(u.context.activeTexture.set(A.TEXTURE0),Dt.imageAtlasTexture&&Dt.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Gn.updatePaintBuffers());const oi=s.paint.get("fill-extrusion-vertical-gradient"),wn=1/Ft.tileToMeter;let pi;if($e&&lt){if(rl(Dt.tileID,Ft.maxHeight,u))continue;const ri=lt.calculateShadowPassMatrixFromTile(Dt.tileID.toUnwrapped());pi=Ig(ri,we,wn,qe,tt,_t)}else{const ri=u.translatePosMatrix(Ut.expandedProjMatrix,Dt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Dn=M.projection.createInversionMatrix(M,Ut.canonical);pi=V?Mv(ri,u,oi,U,ne,we,wn,Ut,Dt,ge,tt,_t,me,he,Dn,Le,qe,z):Vf(ri,u,oi,U,ne,we,wn,Ut,ge,tt,_t,me,he,Dn,Le,qe,Re,St)}u.uploadCommonUniforms(E,Yt,Ut.toUnwrapped(),null,Ue);let Si=Ft.segments;if(M.projection.name==="mercator"&&!$e&&(Si=Ft.getVisibleSegments(Dt.tileID,u.terrain,u.transform.getFrustum(0)),!Si.get().length))continue;if(Xt)if($e)for(const ri of Si.get())Xt.numRenderedVerticesInShadowPass+=ri.primitiveLength;else for(const ri of Si.get())Xt.numRenderedVerticesInTransparentPass+=ri.primitiveLength;const xi=[];(u.terrain||b)&&xi.push(Ft.centroidVertexBuffer),ve&&xi.push(Ft.layoutVertexExtBuffer),Ze&&xi.push(Ft.wallVertexBuffer),Yt.draw(u,E.gl.TRIANGLES,m,y,v,zt,pi,s.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Si,s.paint,u.transform.zoom,Gn,xi)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}class kg{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function il(u,t,s,d,m,y,v,b,E,A,M,O,z,F,V,U,X,Z,ne,ae){const re=t.context,we=re.gl,ge=t.transform,ve=t.transform.zoom,me=[],he=u.translate,Se=u.translateAnchor,Le=u.edgeRadius,Re=jl(t,u.cutoffFadeRange);M==="clear"?(me.push("CLEAR_SUBPASS"),ae&&(me.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(we.TEXTURE0),ae.bind(we.LINEAR,we.CLAMP_TO_EDGE))):M==="sdf"?me.push("SDF_SUBPASS"):M==="emissive"&&(me.push("USE_MRT1"),re.activeTexture.set(we.TEXTURE0),ae.bind(we.LINEAR,we.CLAMP_TO_EDGE)),Z&&me.push("HAS_CENTROID"),Re.shouldRenderCutoff&&me.push("RENDER_CUTOFF");const qe=(Ze,tt,_t,Ue,Ae)=>{let Ke=me;tt.groundRadiusBuffer!=null&&(Ke=me.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const $e=tt.programConfigurations.get(d.id),lt=t.isTileAffectedByFog(Ze),Ct=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:$e,defines:Ke,overrideFog:lt}),zt=Su(t,Ue,O,A,Ae,[z,F*Ae],V,U,X,ve>=17?0:Le*Ae,ae?ae.size[0]:0),St=[];Z&&St.push(tt.hiddenByLandmarkVertexBuffer),tt.groundRadiusBuffer!=null&&St.push(tt.groundRadiusBuffer),t.uploadCommonUniforms(re,Ct,Ze.toUnwrapped(),null,Re),Ct.draw(t,re.gl.TRIANGLES,y,v,b,E,zt,d.id,tt.vertexBuffer,tt.indexBuffer,_t,d.paint,ve,$e,St)};for(const Ze of m){const tt=s.getTile(Ze),_t=tt.getBucket(d);if(!_t||_t.projection.name!==ge.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;const Ue=_t.groundEffect,Ae=1/_t.tileToMeter;{const Ke=t.translatePosMatrix(Ze.projMatrix,tt,he,Se),$e=Ue.getDefaultSegment();qe(Ze,Ue,$e,Ke,Ae)}if(ne)for(let Ke=0;Ke<4;Ke++){const $e=o.e9[Ke](Ze),lt=s.getTile($e);if(!lt)continue;const Ct=lt.getBucket(d);if(!Ct||Ct.projection.name!==ge.projection.name||!Ct.groundEffect||Ct.groundEffect&&!Ct.groundEffect.hasData())continue;const zt=Ct.groundEffect;let St,yt;Ke===0?(St=[-o.al,0,0],yt=1):Ke===1?(St=[o.al,0,0],yt=0):Ke===2?(St=[0,-o.al,0],yt=3):(St=[0,o.al,0],yt=2);const Xt=zt.regionSegments[yt];if(!Xt)continue;const Ut=new Float32Array(16);o.br(Ut,Ze.projMatrix,St),qe(Ze,zt,Xt,t.translatePosMatrix(Ut,tt,he,Se),Ae)}}}function Bw(u,t,s,d,m,y,v){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const b=y?y.findDEMTileFor(s):null;if(!(b&&b.dem||v))return;y&&b&&b.dem&&d.selfDEMTileTimestamp!==b.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=b.dem._timestamp);const E=Z=>new o.P(Math.ceil((Z+o.ed)*o.ee),0),A=Z=>{const ne=t.getSource().minzoom,ae=we=>{const ge=t.getTileByID(we);if(ge&&ge.hasData())return ge.getBucket(m)},re=[0,-1,1];for(const we of re){if(Z.overscaledZ+we<ne)continue;const ge=ae(Z.calculateScaledKey(Z.overscaledZ+we));if(ge)return ge}},M=[0,0,0],O=(Z,ne)=>(M[0]=Math.min(Z.min.y,ne.min.y),M[1]=Math.max(Z.max.y,ne.max.y),M[2]=o.al-ne.min.x>Z.max.x?ne.min.x-o.al:Z.max.x,M),z=(Z,ne)=>(M[0]=Math.min(Z.min.x,ne.min.x),M[1]=Math.max(Z.max.x,ne.max.x),M[2]=o.al-ne.min.y>Z.max.y?ne.min.y-o.al:Z.max.y,M),F=[(Z,ne)=>O(Z,ne),(Z,ne)=>O(ne,Z),(Z,ne)=>z(Z,ne),(Z,ne)=>z(ne,Z)],V=(Z,ne,ae,re,we,ge,ve)=>{if(!y)return 0;const me=[[ge?ae:Z,ge?Z:ae,0],[ge?ae:ne,ge?ne:ae,0]],he=ve<0?o.al+ve:ve,Se=[ge?he:(Z+ne)/2,ge?(Z+ne)/2:he,0];return ae===0&&ve<0||ae!==0&&ve>0?y.getForTilePoints(we,[Se],!0,re):me.push(Se),y.getForTilePoints(s,me,!0,b),Math.max(me[0][2],me[1][2],Se[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){const ne=d.borderFeatureIndices[Z];if(ne.length===0)continue;const ae=o.e9[Z](s),re=A(ae);if(!(re&&re instanceof o.ea))continue;const we=y?y.findDEMTileFor(ae):null;if(!(we&&we.dem||v)||(y&&we&&we.dem&&d.borderDEMTileTimestamp[Z]!==we.dem._timestamp&&(d.borderDoneWithNeighborZ[Z]=-1,d.borderDEMTileTimestamp[Z]=we.dem._timestamp),d.borderDoneWithNeighborZ[Z]===re.canonical.z))continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();const ge=(Z<2?1:5)-Z,ve=re.borderDoneWithNeighborZ[ge]!==d.canonical.z,me=re.borderFeatureIndices[ge];let he=0;if(d.canonical.z!==re.canonical.z){for(const Se of ne)d.showCentroid(d.featuresOnBorder[Se]);if(ve)for(const Se of me)re.showCentroid(re.featuresOnBorder[Se]);d.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[ge]=d.canonical.z}for(const Se of ne){const Le=d.featuresOnBorder[Se],Re=d.centroidData[Le.centroidDataIndex],qe=Le.borders[Z];let Ze;for(;he<me.length;){Ze=re.featuresOnBorder[me[he]];const tt=Ze.borders[ge];if(tt[1]>qe[0]+3||tt[0]>qe[0]-3)break;re.showCentroid(Ze),he++}if(Ze&&he<me.length){const tt=he;let _t=0;for(;!(Ze.borders[ge][0]>qe[1]-3)&&(_t++,++he!==me.length);)Ze=re.featuresOnBorder[me[he]];Ze=re.featuresOnBorder[me[tt]];let Ue=!1;if(_t>=1){const $e=Ze.borders[ge];Math.abs(qe[0]-$e[0])<3&&Math.abs(qe[1]-$e[1])<3&&(_t=1,Ue=!0,he=tt+1)}else if(_t===0){d.showCentroid(Le);continue}const Ae=re.centroidData[Ze.centroidDataIndex];v&&Ue&&(((U=Re).flags|(X=Ae).flags)&o.ec?(U.flags|=o.ec,X.flags|=o.ec):(U.flags&=~o.ec,X.flags&=~o.ec));const Ke=Le.intersectsCount()>1||Ze.intersectsCount()>1;if(_t>1)he=tt,Re.centroidXY=Ae.centroidXY=new o.P(0,0);else if(we&&we.dem&&!Ke){const $e=F[Z](Re,Ae),lt=Z%2?o.al-1:0,Ct=V($e[0],Math.min(o.al-1,$e[1]),lt,we,ae,Z<2,$e[2]);Re.centroidXY=Ae.centroidXY=E(Ct)}else Ke?Re.centroidXY=Ae.centroidXY=new o.P(0,0):(Re.centroidXY=d.encodeBorderCentroid(Le),Ae.centroidXY=re.encodeBorderCentroid(Ze));d.writeCentroidToBuffer(Re),re.writeCentroidToBuffer(Ae)}else d.showCentroid(Le)}d.borderDoneWithNeighborZ[Z]=re.canonical.z,re.borderDoneWithNeighborZ[ge]=d.canonical.z}var U,X;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const ss=[1,0,0],zg=[0,1,0],Uo=[0,0,1];function rl(u,t,s){const d=s.transform,m=s.shadowRenderer;if(!m)return!0;const y=u.toUnwrapped(),v=d.tileSize*m._cascades[s.currentShadowCascade].scale;let b=t;if(d.elevation){const U=d.elevation.getMinMaxForTile(u);U&&(b+=U.max)}const E=[...m.shadowDirection];E[2]=-E[2];const A=m.computeSimplifiedTileShadowVolume(y,b,v,E);if(!A)return!1;const M=[ss,zg,Uo,E,[E[0],0,E[2]],[0,E[1],E[2]]],O=d.projection.name==="globe",z=d.scaleZoom(v),F=o.cB.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,z,!O),V=m.getCurrentCascadeFrustum();return F.intersectsPrecise(A.vertices,A.planes,M)===0||V.intersectsPrecise(A.vertices,A.planes,M)===0}function eh(u){const{painter:t,source:s,layer:d,coords:m}=u;let y=u.defines;const v=t.context,b=t.renderPass==="shadow",E=t.renderPass==="light-beam",A=t.shadowRenderer,M=o.ef(t.transform.center.lat,t.transform.zoom),O=jl(t,d.paint.get("building-cutoff-fade-range"));O.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),u.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(const z of m){const F=s.getTile(z),V=F.getBucket(d);if(!V)continue;A&&A.getMaxCascadeForTile(z.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const U=V.programConfigurations.get(d.id);let X,Z,ne,ae=t.translatePosMatrix(z.expandedProjMatrix,F,[0,0],"map");if(ae=o.cS(o.bC(),ae,[1,1,u.verticalScale]),b&&A){if(rl(F.tileID,V.maxHeight*M,t))continue;let we=A.calculateShadowPassMatrixFromTile(F.tileID.toUnwrapped());we=o.cS(o.bC(),we,[1,1,u.verticalScale]),ne=ql(we),X=Z=t.getOrCreateProgram("buildingDepth",{config:U,defines:y,overrideFog:!1})}else if(E)X=Z=t.getOrCreateProgram("buildingBloom",{config:U,defines:y,overrideFog:!1}),ne=Dv(ae);else{const we=t.transform.calculatePosMatrix(z.toUnwrapped(),t.transform.worldSize);o.cS(we,we,[1,1,u.verticalScale]);const ge=o.bC();o.cS(ge,we,[1,-1,1/M]),o.bl(ge,ge),o.eg(ge,ge);const ve=t.transform.getFreeCameraOptions().position,me=1<<z.canonical.z;if(ne=$f(ae,ge,u.opacity,u.facadeAOIntensity,[((ve.x-z.wrap)*me-z.canonical.x)*o.al,(ve.y*me-z.canonical.y)*o.al,ve.z*me*o.al],V.tileToMeter,u.facadeEmissiveChance,u.floodLightColor,u.floodLightIntensity),Z=t.getOrCreateProgram("building",{config:U,defines:y,overrideFog:!1}),u.depthOnly===!0)X=Z;else{const he=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);X=t.getOrCreateProgram("building",{config:U,defines:he,overrideFog:!1})}A&&(A.setupShadowsFromMatrix(we,Z,!0),X!==Z&&A.setupShadowsFromMatrix(we,X,!0))}const re=(we,ge)=>{if(E){const ve=we.entranceBloom;ge.draw(t,v.gl.TRIANGLES,u.depthMode,yn.disabled,u.blendMode,gn.disabled,ne,d.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,d.paint,t.transform.zoom,U,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=we.segmentsBucket;let me=[we.layoutNormalBuffer,we.layoutCentroidBuffer,we.layoutColorBuffer,we.layoutFloodLightDataBuffer];we.layoutFacadePaintBuffer&&(me=me.concat([we.layoutFacadeDataBuffer,we.layoutFacadeVerticalRangeBuffer,we.layoutFacadePaintBuffer])),ge.draw(t,v.gl.TRIANGLES,u.depthMode,yn.disabled,u.blendMode,b?gn.disabled:gn.backCW,ne,d.id,we.layoutVertexBuffer,we.indexBuffer,ve,d.paint,t.transform.zoom,U,me)}};t.uploadCommonUniforms(v,Z,z.toUnwrapped(),null,O),V.buildingWithoutFacade&&re(V.buildingWithoutFacade,Z),V.buildingWithFacade&&(X!==Z&&t.uploadCommonUniforms(v,X,z.toUnwrapped(),null,O),re(V.buildingWithFacade,X))}}function Kf(u,t,s,d,m,y,v,b,E,A,M,O,z){const F=u.context.gl,V=u.depthModeForSublayer(1,Qt.ReadOnly,F.LEQUAL,!0),U=.1*(1-(X=M))+3*X;var X;const Z=u._showOverdrawInspector,ne=O,ae=new kg;Z||il(ae,u,t,s,d,V,new yn({func:F.ALWAYS,mask:255},255,255,F.KEEP,F.KEEP,F.REPLACE),new Mn([F.ONE,F.ONE,F.ONE,F.ONE],o.ao.transparent,[!1,!1,!1,!0],F.MIN),gn.disabled,m,"sdf",y,v,b,E,A,U,ne,!1);{const re=Z?yn.disabled:new yn({func:F.EQUAL,mask:255},255,255,F.KEEP,F.DECR,F.DECR),we=Z?u.colorModeForRenderPass():new Mn([F.ONE_MINUS_DST_ALPHA,F.DST_ALPHA,F.ONE,F.ONE],o.ao.transparent,[!0,!0,!0,!0]);il(ae,u,t,s,d,V,re,we,gn.disabled,m,"color",y,v,b,E,A,U,ne,!1)}}function Qf(u){return[u[0]*o.eh,u[1]*o.eh,u[2]*o.eh,0]}function th(u,t,s,d,m,y,v,b,E){const A=d.getSource(),M=s.globeSharedBuffers;if(!M)return;let O,z,F;if(t&&(O=d.getTile(t)),A instanceof o.aU?(z=A.texture,F=o.dK(0,0,s.transform)):O&&t&&(z=O.texture,F=o.dK(t.canonical.z,t.canonical.x,s.transform)),!z||!F)return;u||(F=o.cS(o.bC(),F,[1,-1,1]));const V=s.context,U=V.gl,X=m.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,Z=s.colorModeForDrapableLayerRenderPass(y),ne=v.defines;ne.push("GLOBE_POLES");const ae=new Qt(U.LEQUAL,Qt.ReadWrite,s.depthRangeFor3D),re=Float32Array.from(s.transform.expandedFarZProjMatrix),we=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),z.bind(X,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),z.bind(X,U.CLAMP_TO_EDGE),"useMipmap"in z&&V.extTextureFilterAnisotropic&&s.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const[ge,ve,me,he]=t?M.getPoleBuffers(t.canonical.z,!1):M.getPoleBuffers(0,!0),Se=m.paint.get("raster-elevation");let Le;u?(Le=ge,s.renderDefaultNorthPole=Se!==0):(Le=ve,s.renderDefaultSouthPole=Se!==0);const Re=Qf(v.mix),qe=((tt,_t,Ue,Ae,Ke,$e,lt,Ct,zt,St,yt,Xt,Ut)=>zv(tt,_t,Ue,new Float32Array(16),new Float32Array(9),[0,0],Ae,[0,0],[0,0,0,0],1,{opacity:1,mix:0},$e,[0,0],Ct,2,St,yt,Xt,1,0,Ut))(re,we,F,o.aj(s.transform.zoom),0,m,0,Se,0,Re,v.offset,v.range,y),Ze=s.getOrCreateProgram("raster",{defines:ne});s.uploadCommonUniforms(V,Ze,null),Ze.draw(s,U.TRIANGLES,ae,E,Z,b,qe,m.id,Le,me,he)}function Vv(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),d=s-t,m=.2*u.height,y=t+m;return[t,s,(y-m-t)/d,(y-t)/d]}function ol(u,t,s,d){if(u)return t instanceof Do&&u instanceof df?t.getTextureDescriptor(u,s,!0):{texture:u.texture,mix:Qf(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Bi=o.ei([{name:"a_index",type:"Int16",components:1}]);class Jf{constructor(t,s,d,m){const y={width:d[0],height:d[1],data:null},v=t.gl;this.targetColorTexture=new o.T(t,y,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,y,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,m=s.width*s.height;this.particleTexture0=new o.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new o.ej;y.reserve(m);for(let v=0;v<m;v++)y.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(y,Bi.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Og(u,t,s){if(!u)return null;const d=t.getTextureDescriptor(u,s,!0);if(!d)return null;let{texture:m,mix:y,offset:v,tileSize:b,buffer:E,format:A}=d;if(!m||!A)return null;let M=!1;return A==="uint32"&&(M=!0,y[3]=0,y=Gf(o.ek,y,[0,s.paint.get("raster-particle-max-speed")]),v=Hf(o.ek,v,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[E/(b+2*E),b/(b+2*E)],tileSize:b,scalarData:M,scale:y,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function $v(u){const t=u._nearZ,s=u.projection.farthestPixelDistance(u),d=s-t,m=.2*u.height,y=t+m;return[t,s,(y-m-t)/d,(y-t)/d]}const Gv=new o.ao(1,0,0,1),Hv=new o.ao(0,1,0,1),Wv=new o.ao(0,0,1,1),Lc=new o.ao(1,0,1,1),kc=new o.ao(0,1,1,1);function bt(u,t,s,d,m,y){for(let v=0;v<s.length;v++)if(m){const A=new o.ao(d.r*.8,d.g*.8,d.b*.8,1);Pt(u,t,s[v],d,-1,-1,y),Pt(u,t,s[v],d,-1,1,y),Pt(u,t,s[v],d,1,1,y),Pt(u,t,s[v],d,1,-1,y),Pt(u,t,s[v],A,0,0,y)}else Pt(u,t,s[v],d,0,0,y)}function Pt(u,t,s,d,m,y,v){const b=u.context,E=u.transform,A=b.gl,M=E.projection.name==="globe",O=M?["PROJECTION_GLOBE_VIEW"]:[];let z=o.bz(s.projMatrix);if(M&&o.aj(E.zoom)>0){const Re=o.bj(s.canonical,E),qe=o.el(Re);z=o.aB(new Float32Array(16),E.globeMatrix,qe),o.aB(z,E.projMatrix,z)}const F=o.bC();F[12]+=2*m/(o.o.devicePixelRatio*E.width),F[13]+=2*y/(o.o.devicePixelRatio*E.height),o.aB(z,F,z);const V=u.getOrCreateProgram("debug",{defines:O}),U=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(U,V);const X=Qt.disabled,Z=yn.disabled,ne=u.colorModeForRenderPass(),ae="$debug";b.activeTexture.set(A.TEXTURE0),u.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),M?U._makeGlobeTileDebugBuffers(u.context,E):U._makeDebugTileBoundsBuffers(u.context,E.projection);const re=U._tileDebugBuffer||u.debugBuffer,we=U._tileDebugIndexBuffer||u.debugIndexBuffer,ge=U._tileDebugSegments||u.debugSegments;if(V.draw(u,A.LINE_STRIP,X,Z,ne,gn.disabled,Yd(z,d.toPremultipliedRenderColor(null)),ae,re,we,ge,null,null,null,[U._globeTileDebugBorderBuffer]),v){const Re=U.latestRawTileData,qe=Math.floor((Re&&Re.byteLength||0)/1024);let Ze=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Ze+=` => ${s.overscaledZ}`),Ze+=` ${U.state}`,Ze+=` ${qe}kb`,function(tt,_t){tt.initDebugOverlayCanvas();const Ue=tt.debugOverlayCanvas,Ae=tt.context.gl,Ke=tt.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Ue.width,Ue.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(_t,5,5),Ke.strokeText(_t,5,5),tt.debugOverlayTexture.update(Ue),tt.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(u,Ze)}const ve=t.getTile(s).tileSize,me=512/Math.min(ve,512)*(s.overscaledZ/E.zoom)*.5,he=U._tileDebugTextBuffer||u.debugBuffer,Se=U._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Le=U._tileDebugTextSegments||u.debugSegments;V.draw(u,A.TRIANGLES,X,Z,Mn.alphaBlended,gn.disabled,Yd(z,o.ao.transparent.toPremultipliedRenderColor(null),me),ae,he,Se,Le,null,null,null,[U._globeTileDebugTextBuffer])}function zc(u,t,s,d){Fe(u,0,t+s/2,u.transform.width,s,d)}function dr(u,t,s,d){Fe(u,t-s/2,0,s,u.transform.height,d)}function Fe(u,t,s,d,m,y){const v=u.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*o.o.devicePixelRatio,s*o.o.devicePixelRatio,d*o.o.devicePixelRatio,m*o.o.devicePixelRatio),v.clear({color:y}),b.disable(b.SCISSOR_TEST)}const qv=o.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ep}=qv;function ka(u,t,s,d){u.emplaceBack(t,s,d)}class tp{constructor(t){this.vertexArray=new o.em,this.indices=new o.b0,ka(this.vertexArray,-1,-1,1),ka(this.vertexArray,1,-1,1),ka(this.vertexArray,-1,1,1),ka(this.vertexArray,1,1,1),ka(this.vertexArray,-1,-1,-1),ka(this.vertexArray,1,-1,-1),ka(this.vertexArray,-1,1,-1),ka(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ep),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function Oc(u,t,s,d,m,y){const v=u.context.gl,b=t.paint.get("sky-atmosphere-color"),E=t.paint.get("sky-atmosphere-halo-color"),A=t.paint.get("sky-atmosphere-sun-intensity"),M=((O,z,F,V,U)=>({u_matrix_3f:O,u_sun_direction:z,u_sun_intensity:F,u_color_tint_r:[V.r,V.g,V.b,V.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.eo(o.dO(),d),m,A,b.toPremultipliedRenderColor(null),E.toPremultipliedRenderColor(null));v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),s.draw(u,v.TRIANGLES,Qt.disabled,yn.disabled,Mn.unblended,gn.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Zv=o.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cu{constructor(t){const s=new o.ep;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const d=new o.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Zv.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const jw=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Uw{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xv{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Mn([1,Ma,1,Ma],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Mn([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Uw,this.updateNeeded=!0}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Cu(s);const d=this.params.sizeRange,m=this.params.intensityRange,y=function(M){const O=o.eq(30),z=[];for(let F=0;F<M;++F){const V=2*Math.PI*O(),U=Math.acos(1-2*O())-.5*Math.PI;z.push(o.d5(Math.cos(U)*Math.cos(V),Math.cos(U)*Math.sin(V),Math.sin(U)))}return z}(this.params.starsCount),v=o.eq(300),b=new o.er,E=new o.b0;let A=0;for(let M=0;M<y.length;++M){const O=o.c5([],y[M],200),z=Math.max(0,1+.01*d*(1*v()-.5)),F=Math.max(0,1+.01*m*(1*v()-.5));b.emplaceBack(O[0],O[1],O[2],-1,-1,z,F),b.emplaceBack(O[0],O[1],O[2],1,-1,z,F),b.emplaceBack(O[0],O[1],O[2],1,1,z,F),b.emplaceBack(O[0],O[1],O[2],-1,1,z,F),E.emplaceBack(A+0,A+1,A+2),E.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=s.createVertexBuffer(b,jw.members),this.starsIdx=s.createIndexBuffer(E),this.starsSegments=o.bg.simpleSegment(0,0,b.length,E.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const d=t.context,m=d.gl,y=t.transform,v=new Qt(m.LEQUAL,Qt.ReadOnly,[0,1]),b=o.aj(y.zoom),E=t.style.getLut(s.scope),A=s.properties.get("color-use-theme")==="none",M=s.properties.get("color").toNonPremultipliedRenderColor(A?null:E),O=s.properties.get("high-color-use-theme")==="none",z=s.properties.get("high-color").toNonPremultipliedRenderColor(O?null:E),F=s.properties.get("space-color-use-theme")==="none",V=s.properties.get("space-color").toNonPremultipliedRenderColor(F?null:E),U=5e-4,X=o.es(s.properties.get("horizon-blend"),0,1,U,.25),Z=o.dE(t,d,y)&&X===U?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,ne=t.frameCounter/1e3%1,ae=o.ag(y.globeCenterInViewSpace),re=Math.sqrt(Math.pow(ae,2)-Math.pow(Z,2)),we=Math.acos(re/ae),ge=ve=>{const me=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&me.push("ALPHA_PASS");const he=t.getOrCreateProgram("globeAtmosphere",{defines:me}),Se=((Re,qe,Ze,tt,_t,Ue,Ae,Ke,$e,lt,Ct,zt)=>({u_frustum_tl:Re,u_frustum_tr:qe,u_frustum_br:Ze,u_frustum_bl:tt,u_horizon:_t,u_transition:Ue,u_fadeout_range:Ae,u_atmosphere_fog_color:Ke.toArray01(),u_high_color:$e.toArray01(),u_space_color:lt.toArray01(),u_temporal_offset:Ct,u_horizon_angle:zt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,b,X,M,z,V,ne,we);t.uploadCommonUniforms(d,he);const Le=this.atmosphereBuffer;Le&&he.draw(t,m.TRIANGLES,v,yn.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gn.backCW,Se,ve?"atmosphere_glow_alpha":"atmosphere_glow",Le.vertexBuffer,Le.indexBuffer,Le.segments)};ge(!1),ge(!0)}drawStars(t,s){const d=o.aA(s.properties.get("star-intensity"),0,1);if(d===0)return;const m=t.context,y=m.gl,v=t.transform,b=t.getOrCreateProgram("stars"),E=o.c7([]);o.c9(E,E,-v._pitch),o.c8(E,E,-v.angle),o.c9(E,E,o.an(v._center.lat)),o.et(E,E,-o.an(v._center.lng));const A=o.cc(new Float32Array(16),E),M=o.aB([],v.starsProjMatrix,A),O=o.eo([],A),z=o.eu([],O),F=[0,1,0];o.dQ(F,F,z),o.c5(F,F,this.params.sizeMultiplier);const V=[1,0,0];o.dQ(V,V,z),o.c5(V,V,this.params.sizeMultiplier);const U=(X=F,Z=V,ne=d,{u_matrix:Float32Array.from(M),u_up:X,u_right:Z,u_intensity_multiplier:ne});var X,Z,ne;t.uploadCommonUniforms(m,b),this.starsVx&&this.starsIdx&&b.draw(t,y.TRIANGLES,Qt.disabled,yn.disabled,this.colorModeAlphaBlendedWriteRGB,gn.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class np{constructor(){this.visibleTiles=[]}updateBorders(t,s){const d=[],m=[],y=t._getRenderableCoordinates(!1,!0);for(const E of y){const A=t.getTile(E);if(!A.hasData())continue;const M=A.getBucket(s);M&&(M.isEmpty()||(d.push(E.key),m.push({bucket:M,tileID:E.canonical})))}let v=d.length!==this.visibleTiles.length;if(!v){d.sort();for(let E=0;E<d.length;E++)if(d[E]!==this.visibleTiles[E]){v=!0;break}}if(!v)return;const b=new Set;this.visibleTiles=d,m.sort((E,A)=>E.tileID.z-A.tileID.z||E.tileID.x-A.tileID.x||E.tileID.y-A.tileID.y);for(const E of m){const A=new Array,M=new Array,O=E.bucket;for(const z of O.featuresOnBorder)b.has(z.featureId)?M.push(z.footprintIndex):(b.add(z.featureId),A.push(z.footprintIndex));O.updateFootprintHiddenFlags(A,o.ev,!1),O.updateFootprintHiddenFlags(M,o.ev,!0)}}}function ip(u,t){const s=[...u],d=t.cameraWorldSizeForFog/t.worldSize,m=o.bA([]);return o.cS(m,m,[d,d,1]),o.aB(s,m,s),o.aB(s,t.worldToFogMatrix,s),s}function rp(u,t,s,d,m){const y=s.material,v=d.context,{baseColorTexture:b,metallicRoughnessTexture:E}=y.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:M,emissionTexture:O}=y;function z(V,U,X){if(V&&(u.push(U),v.activeTexture.set(v.gl.TEXTURE0+X),V.gfxTexture)){const{minFilter:Z,magFilter:ne,wrapS:ae,wrapT:re}=V.sampler;V.gfxTexture.bindExtraParam(Z,ne,ae,re)}}z(b,"HAS_TEXTURE_u_baseColorTexture",eo.BaseColor),z(E,"HAS_TEXTURE_u_metallicRoughnessTexture",eo.MetallicRoughness),z(A,"HAS_TEXTURE_u_normalTexture",eo.Normal),z(M,"HAS_TEXTURE_u_occlusionTexture",eo.Occlusion),z(O,"HAS_TEXTURE_u_emissionTexture",eo.Emission),m&&(m.texture||(m.texture=new o.d$(d.context,m.image,[m.image.height,m.image.height,m.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+eo.LUT),m.texture&&m.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(u.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED");const F=d.shadowRenderer;F&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&u.push("NORMAL_OFFSET"))}function op(u,t,s,d,m,y){const v=u.modelOpacity,b=t.context,E=new Qt(t.context.gl.LEQUAL,u.isLightMesh?Qt.ReadOnly:Qt.ReadWrite,t.depthRangeFor3D),A=t.transform,M=u.mesh,O=M.material,z=O.pbrMetallicRoughness,F=t.style.fog;let V;V=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:o.aB([],d.zScaleMatrix,u.nodeModelMatrix),o.aB(V,d.negCameraPosMatrix,V);const U=o.bl([],V);o.eg(U,U);const X=s.paint.get("model-color-use-theme").constantOr("default")==="none",Z=s.paint.get("model-emissive-strength").constantOr(0),ne=Rc(new Float32Array(u.worldViewProjection),new Float32Array(V),new Float32Array(U),null,t,v,z.baseColorFactor,O.emissiveFactor,z.metallicFactor,z.roughnessFactor,O,Z,s,void 0,void 0,u.materialOverride,u.modelColor),ae={defines:[]},re=[],we=t.shadowRenderer;we&&(we.useNormalOffset=!1),rp(ae.defines,re,M,t,X?null:s.lut);let ge=null;if(F){const he=ip(u.nodeModelMatrix,t.transform);if(ge=new Float32Array(he),A.projection.name!=="globe"){const Se=M.aabb.min,Le=M.aabb.max,[Re,qe]=F.getOpacityForBounds(he,Se[0],Se[1],Le[0],Le[1]);ae.overrideFog=Re>=it||qe>=it}}const ve=jl(t,s.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");const me=t.getOrCreateProgram("model",ae);t.uploadCommonUniforms(b,me,null,ge,ve),t.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(u.nodeModelMatrix,me),me.draw(t,b.gl.TRIANGLES,E,m,y,M.material.doubleSided?gn.disabled:gn.backCCW,ne,s.id,M.vertexBuffer,M.indexBuffer,M.segments,s.paint,t.transform.zoom,void 0,re)}function nh(u,t){return u.style._importedAsBasemap?"basemap":t.scope}function Fc(u,t,s,d,m,y,v,b,E,A){const M=u.transform,O=!!t.isGeometryBloom&&t.isGeometryBloom;if(O&&u.renderPass==="shadow")return;const z=M.projection.name==="globe"?o.eD(s,M):[...s];o.aB(z,z,t.globalMatrix);const F=o.aB([],d,z);if(t.meshes)for(const V of t.meshes){const U=b.get(V.material.name);if(U&&U.opacity<=0)continue;if(V.material.alphaMode!=="BLEND"){v.push({mesh:V,depth:0,modelIndex:m,worldViewProjection:F,nodeModelMatrix:z,isLightMesh:O,materialOverride:U,modelOpacity:E,modelColor:A});continue}const X=o.af([],V.centroid,F);!M.isOrthographic&&X[2]<=0||y.push({mesh:V,depth:X[2],modelIndex:m,worldViewProjection:F,nodeModelMatrix:z,isLightMesh:O,materialOverride:U,modelOpacity:E,modelColor:A})}if(t.children)for(const V of t.children)Fc(u,V,s,d,m,y,v,b,E,A)}function ca(u,t,s,d){const m=s.shadowRenderer;if(!m)return;const y=m.getShadowPassDepthMode(),v=m.getShadowPassColorMode(),b=m.calculateShadowPassMatrixFromMatrix(t),E=Rg(b);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,y,yn.disabled,v,gn.disabled,E,d.id,u.vertexBuffer,u.indexBuffer,u.segments,d.paint,s.transform.zoom,void 0,void 0)}function Yv(u,t,s,d,m,y){for(const v of m){const b=Object.assign({},d);b.part=v;const E={type:"Unknown",id:t,properties:b},A={orientation:u.paint.get("model-rotation").evaluate(E,s)};y.set(v,A)}}function Kv(u,t,s,d,m,y){for(const v of m){const b=Object.assign({},d);b.part=v;const E={type:"Unknown",id:t,properties:b},A={color:u.paint.get("model-color").evaluate(E,s),colorMix:u.paint.get("model-color-mix-intensity").evaluate(E,s),opacity:u.paint.get("model-opacity").evaluate(E,s),emissionStrength:u.paint.get("model-emissive-strength").evaluate(E,s)};y.set(v,A)}}function Qv(u,t,s,d,m){let y=!1;for(const b of d)b.modelOpacity!==1&&(op(b,u,t,m[b.modelIndex],yn.disabled,Mn.disabled),y=!0);for(const b of d)op(b,u,t,m[b.modelIndex],b.modelOpacity!==1?u.stencilModeFor3D():yn.disabled,u.colorModeForRenderPass());y&&u.resetStencilClippingMasks();const v=Mn.additive;for(const b of s)op(b,u,t,m[b.modelIndex],yn.disabled,b.isLightMesh?v:u.colorModeForRenderPass())}function Jv(u,t,s){const d=t.updateZoomBasedPaintProperties(),m=function(y,v,b){let E,A,M,O=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&O>0){const z=y.terrain,F=z.findDEMTileFor(b);F&&F.dem?E=o.eF.create(z,b,F):O=0}if(O===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),O===v.validForExaggeration&&(O===0||E&&E._demTile&&E._demTile.tileID===v.validForDEMTile.id&&E._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const z in v.instancesPerModel){const F=v.instancesPerModel[z];for(let V=0;V<F.instancedDataArray.length;++V){const U=(E?O*E.getElevationAt(0|F.instancedDataArray.float32[16*V],0|F.instancedDataArray.float32[16*V+1],!0,!0):0)+F.instancesEvaluatedElevation[V];F.instancedDataArray.float32[16*V+6]=U,A=A?Math.min(v.terrainElevationMin,U):U,M=M?Math.max(v.terrainElevationMax,U):U}}return v.terrainElevationMin=A||0,v.terrainElevationMax=M||0,v.validForExaggeration=O,v.validForDEMTile=E&&E._demTile?{id:E._demTile.tileID,timestamp:E._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,s);(d||m)&&(t.uploaded=!1,t.upload(u.context))}const za={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d9([0,0,0],[o.al,o.al,0])};function Vo(u,t){const s=1<<u.canonical.z,d=t.getFreeCameraOptions().position,m=t.elevation,y=u.canonical.x/s,v=(u.canonical.x+1)/s,b=u.canonical.y/s,E=(u.canonical.y+1)/s;let A=t._centerAltitude;if(m){const F=m.getMinMaxForTile(u);F&&F.max>A&&(A=F.max)}const M=o.aA(d.x,y,v)-d.x,O=o.aA(d.y,b,E)-d.y,z=o.cf(A,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(M*M+O*O+z*z))}function e0(u,t,s,d,m,y,v){const b=u.context,E=u.renderPass==="shadow",A=u.shadowRenderer,M=E&&A?A.getShadowPassDepthMode():new Qt(b.gl.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D),O=u.isTileAffectedByFog(y),z=u.transform.projection.name==="globe";if(s.meshes)for(const F of s.meshes){const V=z?[]:["MODEL_POSITION_ON_GPU"],U=[];let X,Z,ne;const ae=!z&&d.instancedDataArray.length>20;ae&&V.push("INSTANCED_ARRAYS");const re=jl(u,t.paint.get("model-cutoff-fade-range"));if(re.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),E&&A)X=u.getOrCreateProgram("modelDepth",{defines:V}),Z=Rg(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(s.globalMatrix)),ne=A.getShadowPassColorMode();else{rp(V,U,F,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),X=u.getOrCreateProgram("model",{defines:V,overrideFog:O});const ge=F.material,ve=ge.pbrMetallicRoughness,me=t.paint.get("model-opacity").constantOr(1),he=t.paint.get("model-emissive-strength").constantOr(0);Z=Rc(y.expandedProjMatrix,Float32Array.from(s.globalMatrix),new Float32Array(16),null,u,me,ve.baseColorFactor,ge.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,ge,he,t,m),A&&(v.shadowUniformsInitialized?X.setShadowUniformValues(b,A.getShadowUniformValues()):(A.setupShadows(y.toUnwrapped(),X,"model-tile"),v.shadowUniformsInitialized=!0)),ne=re.shouldRenderCutoff||me<1||ge.alphaMode!=="OPAQUE"?Mn.alphaBlended:Mn.unblended}u.uploadCommonUniforms(b,X,y.toUnwrapped(),null,re);const we=F.material.doubleSided?gn.disabled:gn.backCCW;if(ae)U.push(d.instancedDataBuffer),X.draw(u,b.gl.TRIANGLES,M,yn.disabled,ne,we,Z,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,u.transform.zoom,void 0,U,d.instancedDataArray.length);else{const ge=E?"u_instance":"u_normal_matrix";for(let ve=0;ve<d.instancedDataArray.length;++ve)Z[ge]=new Float32Array(d.instancedDataArray.arrayBuffer,64*ve,16),X.draw(u,b.gl.TRIANGLES,M,yn.disabled,ne,we,Z,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,u.transform.zoom,void 0,U)}}if(s.children)for(const F of s.children)e0(u,t,F,d,m,y,v)}const ih=[1,-1,1];function Vw(u,t,s,d){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const y=s.shadowRenderer,v=t.aabb;let b=!0,E=u.maxHeight;if(E===0){let M=0;for(const O in u.instancesPerModel){const z=m.getModel(O,d);z?M=Math.max(M,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):b=!1}E=u.maxScale*M*1.41+u.maxVerticalOffset,b&&(u.maxHeight=E)}v.max[2]=E,v.min[2]+=u.terrainElevationMin,v.max[2]+=u.terrainElevationMax,o.af(v.min,v.min,t.tileMatrix),o.af(v.max,v.max,t.tileMatrix);const A=v.intersects(y.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=A===2),A===0}function qi(u,t){const s=u.uniformValues.u_cutoff_params[0],d=u.uniformValues.u_cutoff_params[1],m=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return d===s||y===m?1:o.aA(((t-s)/(d-s)-m)/(y-m),0,1)}function jn(u,t,s,d){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();o.aB(m,m,u);const y=o.bU(s.min[0],s.min[1],s.min[2],1);let v=o.aC(o.eG(),y,m),b=v,E=v;y[1]=s.max[1],v=o.aC(o.eG(),y,m),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E,y[0]=s.max[0],v=o.aC(o.eG(),y,m),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E,y[1]=s.min[1],v=o.aC(o.eG(),y,m),b=v[1]<b[1]?v:b,E=v[1]>E[1]?v:E;const A=o.aA(d[0],0,1),M=100*t.pixelsPerMeter*o.aA(d[1],0,1),O=o.aA(d[2],0,1),z=o.eH(o.eG(),b,E,A),F=Math.tan(.5*t.fovX),V=-z[2]*F;if(M===0)return z[1]<-Math.abs(V)?O:1;const U=(-Math.abs(V)-z[1])/M,X=(ne,ae,re)=>(1-re)*ne+re*ae,Z=o.aA(X(1,O,U),O,1);return X(1,Z,o.aA((t.pitch-20)/20,0,1))}class t0{}class Yl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,d){{const O=this._storage.get(s.id);if(O)return O.lastUsedFrameIdx=t,O.buf}const m=d.gl,y=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),v=new ArrayBuffer(y),b=new Int16Array(v);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const E=new o.eJ;for(let O=0;O<y/2;O+=3){const z=b[O],F=b[O+1],V=b[O+2];E.emplaceBack(z,F),E.emplaceBack(F,V),E.emplaceBack(V,z)}const A=d.bindVertexArrayOES.current,M=new t0;return M.buf=new la(d,E),M.lastUsedFrameIdx=t,this._storage.set(s.id,M),d.bindVertexArrayOES.set(A),M.buf}update(t){for(const[s,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class Au{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Pu=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class sl{constructor(t){this.revealStart=11,this.revealRange=2}}const Fg=o.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Ng{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new o.eK,b=new o.b0;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),b.emplaceBack(0,1,2),b.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,Fg.members),this.vignetteIdx=t.context.createIndexBuffer(b)}const m=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const v={u_vignetteShape:(y={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Qt.disabled,yn.disabled,Mn.alphaBlended,gn.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,m)}var y}}class Bg{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const d=t.getFreeCameraOptions().position,m=d.toAltitude(),y=d.toLngLat(),v=o.an(y.lng),b=o.an(y.lat),E=t.pixelsPerMeter/s,A=v*o.eM,M=o.eM*Math.log(Math.tan(Math.PI/4+b/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const O=-this._offsetYPrev+M,z=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+A)*E,this._accumulatedOffsetY+=O*E,this._accumulatedElevation+=z*E,this._offsetXPrev=A,this._offsetYPrev=M,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function sp(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function ys(u){const t=o.eq(1323123451230),s=[];for(let d=0;d<u;++d){const m=2*t()-1,y=2*t()-1,v=2*t()-1;s.push(o.d5(m,y,v))}return s}function Ko(u,t,s,d,m){const y=o.aA((m-s)/(d-s),0,1);return(1-y)*u+y*t}class Nc{constructor(t){this._movement=new Bg,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ng,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const m=d.starsProjMatrix,y=o.c7([]);o.c9(y,y,o.an(90)-d._pitch),o.c8(y,y,-d.angle);const v=o.cc(new Float32Array(16),y),b=o.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),E=o.eg([],b),A=o.aB([],E,v),M=Date.now()/1e3;return this._accumulatedTimeFromStart+=(M-this._prevTime)*s,this._prevTime=M,{projectionMatrix:m,modelviewMatrix:A}}}class ap extends Nc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new sl("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=ys(this.particlesCount),m=new o.eN,y=new o.b0;let v=0;const b=o.eq(1323123451230);for(let E=0;E<d.length;++E){const A=d[E],M=[2*b()-1,b(),b(),b()];m.emplaceBack(A[0],A[1],A[2],-1,-1,...M),m.emplaceBack(A[0],A[1],A[2],1,-1,...M),m.emplaceBack(A[0],A[1],A[2],1,1,...M),m.emplaceBack(A[0],A[1],A[2],-1,1,...M),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,Pu.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(s.revealStart>d)return;const m=Ko(0,1,s.revealStart,s.revealStart+s.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let v=[-y.direction.x,y.direction.y,-100];o.aw(v,v);const b=structuredClone(this._vignetteParams);b.strength*=m,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,b.strength=1,b.color=structuredClone(t.style.rain.state.vignetteColor));const E=this.updateOnRender(t,y.timeFactor),A=t.context,M=A.gl,O=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(A,{width:t.width,height:t.height,data:null},M.RGBA8)),y.distortionStrength>0&&(A.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexSubImage2D(M.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const z=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(A,z),A.activeTexture.set(M.TEXTURE0),this.screenTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const F=[y.color.r,y.color.g,y.color.b,y.color.a],V=(U,X)=>{const Z=sp(this._movement.getPosition(),U),ne=y.dropletSizeX,ae=y.dropletSizeX*y.dropletSizeYScale,re=t.width/2,we=t.height/2,ge=Ko(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ve=Ko(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),me=Ko(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),he=(Se={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:U,rainDropletSize:[ne,ae],distortionStrength:y.distortionStrength,rainDirection:v,color:F,screenSize:[O.width,O.height],thinningCenterPos:[re,we],thinningShape:[ge,ve,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:me,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const Le=Math.round(y.intensity*this.particlesCount),Re=o.bg.simpleSegment(0,0,4*Le,2*Le);z.draw(t,M.TRIANGLES,Qt.disabled,yn.disabled,Mn.alphaBlended,gn.disabled,he,"rain_particles",this.particlesVx,this.particlesIdx,Re)};y.distortionStrength>0&&V(y.boxSize,!0),V(y.boxSize,!1),this._vignette.draw(t,b)}}const jg=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ug extends Nc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new sl("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=ys(this.particlesCount),m=new o.eO,y=new o.b0;let v=0;const b=o.eq(1323123451230);for(let E=0;E<d.length;++E){const A=d[E],M=b(),O=b(),z=b(),F=[E/d.length,M,O,z],V=[b(),b()];m.emplaceBack(A[0],A[1],A[2],-1,-1,...F,...V),m.emplaceBack(A[0],A[1],A[2],1,-1,...F,...V),m.emplaceBack(A[0],A[1],A[2],1,1,...F,...V),m.emplaceBack(A[0],A[1],A[2],-1,1,...F,...V),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,jg.members),this.particlesIdx=s.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let d=[-s.direction.x,s.direction.y,-100];o.aw(d,d);const m=structuredClone(this._vignetteParams),y=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(y.revealStart>v)return;const b=Ko(0,1,y.revealStart,y.revealStart+y.revealRange,v);m.strength*=b,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const E=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const A=t.context,M=A.gl,O=t.transform,z=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(A,z),((F,V,U)=>{const X=sp(this._movement.getPosition(),F),Z=O.width/2,ne=O.height/2,ae=Ko(0,U.screenThinning.start,0,1,U.screenThinning.intensity),re=Ko(.001,U.screenThinning.range,0,1,U.screenThinning.intensity),we=Ko(0,U.screenThinning.particleOffset,0,1,U.screenThinning.intensity),ge=(ve={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:U.velocityConeAperture,velocity:U.velocity,horizontalOscillationRadius:U.horizontalOscillationRadius,horizontalOscillationRate:U.horizontalOscillationRate,boxSize:F,billboardSize:1*U.billboardSize,simpleShapeParameters:[U.shapeFadeStart,U.shapeFadePower],screenSize:[O.width,O.height],thinningCenterPos:[Z,ne],thinningShape:[ae,re,Math.pow(10,U.screenThinning.fadePower)],thinningAffectedRatio:U.screenThinning.affectedRatio,thinningParticleOffset:we,color:[U.color.r,U.color.g,U.color.b,U.color.a],direction:d},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const me=Math.round(U.intensity*this.particlesCount),he=o.bg.simpleSegment(0,0,4*me,2*me);this.particlesVx&&this.particlesIdx&&z.draw(t,M.TRIANGLES,Qt.disabled,yn.disabled,Mn.alphaBlended,gn.disabled,ge,"snow_particles",this.particlesVx,this.particlesIdx,he)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Kl={symbol:function(u,t,s,d,m){if(u.renderPass!=="translucent")return;const y=yn.disabled,v=u.colorModeForRenderPass(),b=s.layout.get("text-variable-anchor"),E=s.layout.get("text-size-scale-range"),A=o.aA(u.scaleFactor,E[0],E[1]);b&&function(z,F,V,U,X,Z,ne,ae){const re=F.transform,we=X==="map",ge=Z==="map";for(const ve of z){const me=U.getTile(ve),he=me.getBucket(V);if(!he||!he.text||!he.text.segments.get().length)continue;const Se=o.bK(he.textSizeData,re.zoom,ae),Le=Aa(ve,he.getProjection(),re),Re=re.calculatePixelsToTileUnitsMatrix(me),qe=Lo(Le,me.tileID.canonical,ge,we,re,he.getProjection(),Re),Ze=he.hasIconTextFit()&&he.hasIconData();Se&&ln(he,we,ge,ne,re,qe,ve,Math.pow(2,re.zoom-me.tileID.overscaledZ),Se,Ze)}}(d,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,A);const M=s.paint.get("icon-opacity").constantOr(1)!==0,O=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(M||O)?Jd(u,t,s,d,y,v):(M&&Jd(u,t,s,d,y,v,{onlyIcons:!0}),O&&Jd(u,t,s,d,y,v,{onlyText:!0})),t.map.showCollisionBoxes&&(jt(u,t,s,d,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),jt(u,t,s,d,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,d){if(u.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0,E=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(y.constantOr(1)===0||v.constantOr(1)===0))return;const A=u.context,M=A.gl,O=u.transform,z=!(!u.terrain||!u.terrain.enabled),F=s.layout.get("circle-elevation-reference"),V=u.depthModeForSublayer(0,Qt.ReadOnly),U=new Qt(u.context.gl.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D),X=F==="none"||z?V:U,Z=yn.disabled,ne=u.colorModeForDrapableLayerRenderPass(E),ae=O.projection.name==="globe",re=[o.aF(O.center.lng),o.aJ(O.center.lat)],we=[];for(let ve=0;ve<d.length;ve++){const me=d[ve],he=t.getTile(me),Se=he.getBucket(s);if(!Se||Se.projection.name!==O.projection.name)continue;const Le=Se.programConfigurations.get(s.id),Re=Se.layoutVertexBuffer,qe=Se.globeExtVertexBuffer,Ze=Se.indexBuffer,tt=o.e0(s),_t=[qe],Ue=u.isTileAffectedByFog(me);ae&&tt.push("PROJECTION_GLOBE_VIEW"),tt.push("DEPTH_D24"),u.terrain&&O.depthOcclusionForSymbolsAndCircles&&tt.push("DEPTH_OCCLUSION"),Se.hasElevation&&!u.terrain&&(tt.push("ELEVATED_ROADS"),_t.push(Se.elevatedLayoutVertexBuffer));const Ae=u.getOrCreateProgram("circle",{config:Le,defines:tt,overrideFog:Ue}),Ke=O.projection.createInversionMatrix(O,me.canonical),$e={programConfiguration:Le,program:Ae,layoutVertexBuffer:Re,dynamicBuffers:_t,indexBuffer:Ze,uniformValues:o.e1(u,me,he,Ke,re,s),tile:he};if(b){const lt=Se.segments.get();for(const Ct of lt)we.push({segments:new o.bg([Ct]),sortKey:Ct.sortKey,state:$e})}else we.push({segments:Se.segments,sortKey:0,state:$e})}b&&we.sort((ve,me)=>ve.sortKey-me.sortKey);const ge={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(const ve of we){const{programConfiguration:me,program:he,layoutVertexBuffer:Se,dynamicBuffers:Le,indexBuffer:Re,uniformValues:qe,tile:Ze}=ve.state,tt=ve.segments;u.terrain&&u.terrain.setupElevationDraw(Ze,he,ge),u.uploadCommonUniforms(A,he,Ze.tileID.toUnwrapped()),he.draw(u,M.TRIANGLES,X,Z,ne,gn.disabled,qe,s.id,Se,Re,tt,s.paint,O.zoom,me,Le)}},heatmap:function(u,t,s,d){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,y=m.gl,v=yn.disabled,b=new Mn([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(F,V,U,X){const Z=F.gl,ne=V.width*X,ae=V.height*X;F.activeTexture.set(Z.TEXTURE1),F.viewport.set([0,0,ne,ae]);let re=U.heatmapFbo;if(!re||re&&(re.width!==ne||re.height!==ae)){re&&re.destroy();const we=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,we),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),re=U.heatmapFbo=F.createFramebuffer(ne,ae,1,null),function(ge,ve,me,he,Se,Le){const Re=ge.gl;Re.texImage2D(Re.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,Se,Le,0,Re.RGBA,ge.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),he.colorAttachment0.set(me)}(F,0,we,re,ne,ae)}else Z.bindTexture(Z.TEXTURE_2D,re.colorAttachment0.get()),F.bindFramebuffer.set(re.framebuffer)})(m,u,s,u.transform.projection.name==="globe"?.5:.25),m.clear({color:o.ao.transparent});const E=u.transform,A=E.projection.name==="globe",M=A?["PROJECTION_GLOBE_VIEW"]:[],O=A?gn.frontCCW:gn.disabled,z=[o.aF(E.center.lng),o.aJ(E.center.lat)];for(let F=0;F<d.length;F++){const V=d[F];if(t.hasRenderableParent(V))continue;const U=t.getTile(V),X=U.getBucket(s);if(!X||X.projection.name!==E.projection.name)continue;const Z=u.isTileAffectedByFog(V),ne=X.programConfigurations.get(s.id),ae=u.getOrCreateProgram("heatmap",{config:ne,defines:M,overrideFog:Z}),{zoom:re}=u.transform;u.terrain&&u.terrain.setupElevationDraw(U,ae),u.uploadCommonUniforms(m,ae,V.toUnwrapped());const we=E.projection.createInversionMatrix(E,V.canonical);ae.draw(u,y.TRIANGLES,Qt.disabled,v,b,O,kv(u,V,U,we,z,re,s.paint.get("heatmap-intensity")),s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,u.transform.zoom,ne,A?[X.globeExtVertexBuffer]:null)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,y){const v=m.context,b=v.gl,E=y.heatmapFbo;if(!E)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E.colorAttachment0.get()),v.activeTexture.set(b.TEXTURE1);let A=y.colorRampTexture;A||(A=y.colorRampTexture=new o.T(v,y.colorRamp,b.RGBA8)),A.bind(b.LINEAR,b.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,b.TRIANGLES,Qt.disabled,yn.disabled,m.colorModeForRenderPass(),gn.disabled,((M,O,z,F)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(u,s))},line:function(u,t,s,d){if(u.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const v=s.paint.get("line-emissive-strength").isConstant(),b=s.paint.get("line-emissive-strength").constantOr(0),E=s.paint.get("line-occlusion-opacity"),A=s.layout.get("line-elevation-reference"),M=s.layout.get("line-width-unit")==="meters",O=A==="sea",z=!(!u.terrain||!u.terrain.enabled),F=u.context,V=F.gl;if(s.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const U=s.layout.get("line-cross-slope"),X=U!==void 0,Z=U<1,ne=u.colorModeForDrapableLayerRenderPass(v?b:null),ae=u.terrain&&u.terrain.renderingToTexture,re=ae?1:o.o.devicePixelRatio,we=s.paint.get("line-dasharray"),ge=we.constantOr(1),ve=s.layout.get("line-cap"),me=we.constantOr(null),he=ve.constantOr(null),Se=s.paint.get("line-pattern"),Le=Se.constantOr(1),Re=s.paint.get("line-pattern-cross-fade"),qe=Se.constantOr(null),Ze=s.paint.get("line-opacity").constantOr(1);let tt=!Le&&Ze!==1||u.depthOcclusion&&E>0&&E<1;const _t=s.paint.get("line-gradient"),Ue=Le?"linePattern":"line",Ae=o.e2(s);let Ke;if(ae&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),E!==0&&u.depthOcclusion){const zt=s.paint._values["line-opacity"];zt&&zt.value&&zt.value.kind==="constant"?Ke=zt.value:o.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Ae.push("VARIABLE_LINE_WIDTH"),ae&&(u.emissiveMode!=="dual-source-blending"||v?u.emissiveMode==="mrt-fallback"&&Ae.push("USE_MRT1"):Ae.push("DUAL_SOURCE_BLENDING"));const $e=(zt,St,yt,Xt,Ut,Dt)=>{for(const Ft of zt){const sn=t.getTile(Ft);if(Le&&!sn.patternsLoaded())continue;const Tn=sn.getBucket(s);if(!Tn||Tn.elevationType!=="none"&&!Ut||Tn.elevationType==="none"&&Ut)continue;u.prepareDrawTile();const Gn=[...St],ci=u.shadowRenderer,Yt=Tn.elevationType==="road"&&!!ci&&ci.enabled;let oi=[0,0,0];if(Yt){const Ln=u.style.directionalLight,Vi=u.style.ambientLight;Ln&&Vi&&(oi=el(u.style,Ln,Vi)),Gn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const wn=Tn.programConfigurations.get(s.id);let pi=!1;if(qe&&sn.imageAtlas){const Ln=o.e3.from(qe),Vi=Ln.getPrimary().scaleSelf(re).toString(),gr=sn.imageAtlas.patternPositions.get(Vi),tr=Ln.getSecondary(),Pi=tr?sn.imageAtlas.patternPositions.get(tr.scaleSelf(re).toString()):null;pi=!!gr&&!!Pi,gr&&wn.setConstantPatternPositions(gr,Pi)}Re>0&&(pi||wn.getPatternTransitionVertexBuffer("line-pattern"))&&Gn.push("LINE_PATTERN_TRANSITION");const Si=u.isTileAffectedByFog(Ft),xi=u.getOrCreateProgram(Ue,{config:wn,defines:Gn,overrideFog:Si});if(!Le&&me&&he&&sn.lineAtlas){const Ln=sn.lineAtlas.getDash(me,he);Ln&&wn.setConstantPatternPositions(Ln)}Yt&&ci.setupShadows(sn.tileID.toUnwrapped(),xi,"vector-tile");let[ri,Dn]=s.paint.get("line-trim-offset");(he==="round"||he==="square")&&ri!==Dn&&(ri===0&&(ri-=1),Dn===1&&(Dn+=1));const di=ae?Ft.projMatrix:null,ar=M?1/Tn.tileToMeter/o.ay(sn,1,u.transform.zoom):1,Zi=M?1/Tn.tileToMeter/o.ay(sn,1,Math.floor(u.transform.zoom)):1,mi=Le?o.e4(u,sn,s,di,re,ar,Zi,[ri,Dn],oi,Re):o.e5(u,sn,s,di,Tn.lineClipsArray.length,re,ar,Zi,[ri,Dn],oi);if(_t){const Ln=Tn.gradients[s.id];let Vi=Ln.texture;if(s.gradientVersion!==Ln.version){let gr=256;if(s.stepInterpolant){const tr=t.getSource().maxzoom,Pi=Ft.canonical.z===tr?Math.ceil(1<<u.transform.maxZoom-Ft.canonical.z):1;gr=o.aA(o.e6(Tn.maxLineLength/o.al*1024*Pi),256,F.maxTextureSize)}Ln.gradient=o.e7({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:gr,image:Ln.gradient||void 0,clips:Tn.lineClipsArray}),Ln.texture?Ln.texture.update(Ln.gradient):Ln.texture=new o.T(F,Ln.gradient,V.RGBA8),Ln.version=s.gradientVersion,Vi=Ln.texture}F.activeTexture.set(V.TEXTURE1),Vi.bind(s.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}ge&&(F.activeTexture.set(V.TEXTURE0),sn.lineAtlasTexture&&sn.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),wn.updatePaintBuffers()),Le&&(F.activeTexture.set(V.TEXTURE0),sn.imageAtlasTexture&&sn.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),wn.updatePaintBuffers()),Ut&&!O&&u.terrain.setupElevationDraw(sn,xi),u.uploadCommonUniforms(F,xi,Ft.toUnwrapped());const ei=Ln=>{Ke!=null&&(Ke.value=Ze*E),xi.draw(u,V.TRIANGLES,yt,Ln,ne,gn.disabled,mi,s.id,Tn.layoutVertexBuffer,Tn.indexBuffer,Tn.segments,s.paint,u.transform.zoom,wn,[Tn.layoutVertexBuffer2,Tn.patternVertexBuffer,Tn.zOffsetVertexBuffer]),Ke!=null&&(Ke.value=Ze)};if(tt&&!Ut){const Ln=u.stencilModeForClipping(Ft).ref;Ln===0&&ae&&F.clear({stencil:0});const Vi={func:V.EQUAL,mask:255};mi.u_alpha_discard_threshold=.8,ei(new yn(Vi,Ln,255,V.KEEP,V.KEEP,V.INVERT)),mi.u_alpha_discard_threshold=0,ei(new yn(Vi,Ln,255,V.KEEP,V.KEEP,V.KEEP))}else mi.u_alpha_discard_threshold=tt&&Ut&&Dt?.8:0,ei(Ut?Xt:u.stencilModeForClipping(Ft))}};let lt=u.depthModeForSublayer(0,Qt.ReadOnly);const Ct=new Qt(u.depthOcclusion?V.GREATER:V.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D);if(s.hasNonElevatedBuckets){const zt=!ae&&u.terrain;E!==0&&zt?o.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):zt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):$e(d,Ae,lt,yn.disabled,!1,!0)}if(s.hasElevatedBuckets){A==="hd-road-markup"?z||(lt=Ct,Ae.push("ELEVATED_ROADS")):(Ae.push("ELEVATED"),lt=Ct,X&&Ae.push(Z?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&Ae.push("ELEVATION_REFERENCE_SEA"));const zt=tt?u.stencilModeFor3D():yn.disabled;u.forceTerrainMode=!0,$e(d,Ae,lt,zt,!0,!0),tt&&$e(d,Ae,lt,zt,!0,!1),u.forceTerrainMode=!1}tt&&(u.resetStencilClippingMasks(),ae&&F.clear({stencil:0})),E===0||u.depthOcclusion||ae||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,s,d){const m=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const v=s.paint.get("fill-emissive-strength"),b=u.colorModeForDrapableLayerRenderPass(v),E=s.paint.get("fill-pattern"),A=u.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(o.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let M="none";s.layout.get("fill-elevation-reference")!=="none"?M="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(M="offset");const O=!(!u.terrain||!u.terrain.enabled),z={painter:u,sourceCache:t,layer:s,coords:d,colorMode:b,elevationType:M,terrainEnabled:O,pass:A};if(u.renderPass==="shadow")return void(u.shadowRenderer&&M==="road"&&!O&&function(V){const{painter:U,sourceCache:X,layer:Z,coords:ne}=V,ae=U.context.gl,re=V.painter.shadowRenderer;for(const we of ne){const ge=X.getTile(we),ve=ge.getBucket(Z);if(!ve)continue;const me=ve.elevatedStructures;if(!me||!me.shadowCasterSegments||me.shadowCasterSegments.segments[0].primitiveLength===0)continue;U.prepareDrawTile();const he=ve.bufferData.programConfigurations.get(Z.id),Se=U.isTileAffectedByFog(we),Le=U.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:Se}),Re=re.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());U.uploadCommonUniforms(U.context,Le,we.toUnwrapped());const qe={u_matrix:Re,u_depth_bias:0};Le.draw(U,ae.TRIANGLES,re.getShadowPassDepthMode(),yn.disabled,re.getShadowPassColorMode(),gn.disabled,qe,Z.id,me.vertexBuffer,me.indexBuffer,me.shadowCasterSegments,Z.paint,U.transform.zoom,he)}}(z));const F=u.emissiveMode==="mrt-fallback";if(M!=="offset"){if(Xf(z,!1,F),M==="road"){const V=!O&&u.renderPass==="translucent";V&&Zf(u,t,s,d,"geometry"),Xf(z,!0,F,yn.disabled),V&&function(U){const{painter:X,sourceCache:Z,layer:ne,coords:ae,colorMode:re}=U,we=X.context.gl,ge=U.painter.shadowRenderer,ve=!!ge&&ge.enabled,me=new Qt(X.context.gl.LEQUAL,Qt.ReadOnly,X.depthRangeFor3D);let he=[0,0,0];if(ve){const Le=X.style.directionalLight,Re=X.style.ambientLight;Le&&Re&&(he=el(X.style,Le,Re))}const Se=Le=>{for(const Re of ae){const qe=Z.getTile(Re),Ze=qe.getBucket(ne);if(!Ze)continue;const tt=Ze.elevatedStructures;if(!tt)continue;let _t,Ue;if(Le?(_t=tt.renderableBridgeSegments,Ue=tt.bridgeProgramConfigurations.get(ne.id)):(_t=tt.renderableTunnelSegments,Ue=tt.tunnelProgramConfigurations.get(ne.id)),!_t||_t.segments[0].primitiveLength===0)continue;Ue.updatePaintBuffers(),X.prepareDrawTile();const Ae=X.isTileAffectedByFog(Re),Ke=[];ve&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const $e=X.getOrCreateProgram("elevatedStructures",{config:Ue,overrideFog:Ae,defines:Ke}),lt=X.translatePosMatrix(Re.projMatrix,qe,ne.paint.get("fill-translate"),ne.paint.get("fill-translate-anchor"));ve&&ge.setupShadows(qe.tileID.toUnwrapped(),$e,"vector-tile");const Ct=Wl(lt,he);X.uploadCommonUniforms(X.context,$e,Re.toUnwrapped()),$e.draw(X,we.TRIANGLES,me,yn.disabled,re,gn.backCCW,Ct,ne.id,tt.vertexBuffer,tt.indexBuffer,_t,ne.paint,X.transform.zoom,Ue,[tt.vertexBufferNormal])}};Se(!0),Se(!1)}(z)}}else Xf(z,!1,F,u.stencilModeFor3D())},"fill-extrusion":function(u,t,s,d){const m=s.paint.get("fill-extrusion-opacity"),y=u.context,v=y.gl,b=u.terrain,E=b&&b.renderingToTexture;if(m===0)return;const A=u.emissiveMode==="mrt-fallback",M=u.conflationActive&&u.style.isLayerClipped(s,t.getSource()),O=u.style.order.indexOf(s.fqid);if(M&&function(z,F,V,U,X){for(const Z of U){const ne=F.getTile(Z).getBucket(V);ne&&(ne.updateReplacement(Z,z.replacementSource,X),ne.uploadCentroid(z.context))}}(u,t,s,d,O),b||M)for(const z of d){const F=t.getTile(z).getBucket(s);F&&Bw(u.context,t,z,F,s,b,M)}if(u.renderPass==="shadow"&&u.shadowRenderer){const z=u.shadowRenderer;if(b&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const F=z.getShadowPassDepthMode(),V=z.getShadowPassColorMode();Yf(u,t,s,d,F,yn.disabled,V,M)}else if(u.renderPass==="translucent"){const z=!s.paint.get("fill-extrusion-pattern").constantOr(1),F=s.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!E&&F.a!==0){const V=new Qt(u.context.gl.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D);m===1&&z?Yf(u,t,s,d,V,yn.disabled,Mn.unblended,M):(Yf(u,t,s,d,V,yn.disabled,Mn.disabled,M),Yf(u,t,s,d,V,u.stencilModeFor3D(),u.colorModeForRenderPass(),M),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&z&&(!b&&u.transform.projection.name!=="globe"||E)){const V=s.paint.get("fill-extrusion-opacity"),U=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=s.paint.get("fill-extrusion-flood-light-intensity"),ne=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ne?null:s.lut).toArray01().slice(0,3),re=U>0&&X>0,we=Z>0,ge=(he,Se,Le)=>(1-Le)*he+Le*Se,ve=new kg;ve.translate=s.paint.get("fill-extrusion-translate"),ve.translateAnchor=s.paint.get("fill-extrusion-translate-anchor"),ve.edgeRadius=s.layout.get("fill-extrusion-edge-radius"),ve.cutoffFadeRange=s.paint.get("fill-extrusion-cutoff-fade-range");const me=he=>{const Se=u.depthModeForSublayer(1,Qt.ReadOnly,v.LEQUAL,!0),Le=s.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=ge(.1,3,Le),qe=u._showOverdrawInspector;if(!qe){const Ze=new yn({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),tt=new Mn([v.ONE,v.ONE,v.ONE,v.ONE],o.ao.transparent,[!1,!1,!1,!0],v.MIN);il(ve,u,t,s,d,Se,Ze,tt,gn.disabled,he,"sdf",V,U,X,Z,ae,Re,M,!1)}{const Ze=qe?yn.disabled:new yn({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),tt=qe?u.colorModeForRenderPass():new Mn([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],o.ao.transparent,[!0,!0,!0,!0]);il(ve,u,t,s,d,Se,Ze,tt,gn.disabled,he,"color",V,U,X,Z,ae,Re,M,!1)}};if(E){const he=()=>{const Le=b.drapeBufferSize[0],Re=b.drapeBufferSize[1];let qe=b.framebufferCopyTexture;return qe&&(!qe||qe.size[0]===Le&&qe.size[1]===Re)||(qe&&qe.destroy(),qe=b.framebufferCopyTexture=new o.T(y,new o.q({width:Le,height:Re}),v.RGBA8)),qe.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,Le,Re),qe},Se=(Le,Re,qe)=>{const Ze=u.depthModeForSublayer(1,Qt.ReadOnly,v.LEQUAL,!1),tt=s.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),_t=ge(.1,3,tt);{const Ue=new Mn([v.ONE,v.ONE,v.ONE,v.ONE],o.ao.transparent,[!1,!1,!1,!0]);il(ve,u,t,s,d,Ze,yn.disabled,Ue,gn.disabled,Le,"clear",V,U,X,Z,ae,_t,M,Re)}{const Ue=new yn({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),Ae=new Mn([v.ONE,v.ONE,v.ONE,v.ONE],o.ao.transparent,[!1,!1,!1,!0],v.MIN);il(ve,u,t,s,d,Ze,Ue,Ae,gn.disabled,Le,"sdf",V,U,X,Z,ae,_t,M,Re)}A&&!Le&&(qe=he());{const Ue=Le?v.ZERO:v.ONE_MINUS_DST_ALPHA,Ae=new yn({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Ke=new Mn([Ue,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],o.ao.transparent,[!0,!0,!0,!0]);il(ve,u,t,s,d,Ze,Ae,Ke,gn.disabled,Le,"color",V,U,X,Z,ae,_t,M,Re)}if(!A||Le){const Ue=new Mn([v.ONE,v.ONE,v.ONE,Le?v.ZERO:v.ONE],o.ao.transparent,[!1,!1,!1,!0],Le?v.FUNC_ADD:v.MAX);il(ve,u,t,s,d,Ze,yn.disabled,Ue,gn.disabled,Le,"clear",V,U,X,Z,ae,_t,M,Re,qe)}else{v.drawBuffers([v.NONE,v.COLOR_ATTACHMENT1]);const Ue=new yn({func:v.EQUAL,mask:255},254,255,v.KEEP,v.DECR,v.DECR),Ae=new Mn([v.ONE,v.ONE,v.ONE,v.ONE],o.ao.transparent,[!0,!1,!1,!1],v.MAX);il(ve,u,t,s,d,Ze,Ue,Ae,gn.disabled,Le,"emissive",V,U,X,Z,ae,_t,M,Re,qe),v.drawBuffers([v.COLOR_ATTACHMENT0])}};if(re||we){let Le;u.prepareDrawTile(),A&&!re||(Le=he()),re&&Se(!0,!1,Le),we&&Se(!1,!0,Le)}}else re&&me(!0),we&&me(!1),(re||we)&&u.resetStencilClippingMasks()}}},building:function(u,t,s,d){u.currentLayer<u.firstLightBeamLayer&&(u.firstLightBeamLayer=u.currentLayer);const m=s.paint.get("building-ambient-occlusion-ground-intensity"),y=s.paint.get("building-ambient-occlusion-ground-radius"),v=s.paint.get("building-ambient-occlusion-ground-attenuation"),b=s.paint.get("building-opacity");if(b<=0)return;let E=m>0&&y>0,A=!0;const M=s.paint.get("building-vertical-scale");if(M<=0)return;u.shadowRenderer||(A=!1);const O=u.conflationActive&&u.style.isLayerClipped(s,t.getSource()),z=u.style.order.indexOf(s.fqid);if(function(F,V,U,X,Z,ne){for(const ae of ne){const re=V.getTile(ae).getBucket(U);re&&(Z&&re.updateReplacement(ae,F.replacementSource,X),re.uploadUpdatedIndexBuffer(F.context))}}(u,t,s,z,O,d),function(F,V,U,X){for(const Z of X){const ne=V.getTile(Z).getBucket(U);ne&&ne.needsEvaluation()&&ne.uploadUpdatedColorBuffer(F.context)}}(u,t,s,d),s.resetLayerRenderingStats(u),u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0),u.renderPass==="shadow"&&u.shadowRenderer){const F=u.shadowRenderer,V=[],U=F.getShadowPassDepthMode();eh({painter:u,source:t,layer:s,coords:d,defines:V,blendMode:F.getShadowPassColorMode(),depthMode:U,opacity:b,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(u.renderPass==="translucent"){let F=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];A&&(F=F.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),u.shadowRenderer&&u.shadowRenderer.useNormalOffset&&(F=F.concat("NORMAL_OFFSET"));const V=s.paint.get("building-facade-emissive-chance"),U=s.paint.get("building-ambient-occlusion-intensity"),X=s.paint.get("building-flood-light-intensity"),Z=s.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ne=s.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(Z?null:s.lut).toArray01().slice(0,3),ae=s.paint.get("building-flood-light-ground-attenuation"),re=X>0,we=new Qt(u.context.gl.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D);b<1&&eh({painter:u,source:t,layer:s,coords:d,defines:F,blendMode:Mn.disabled,depthMode:we,opacity:b,verticalScale:M,facadeEmissiveChance:V,facadeAOIntensity:U,floodLightIntensity:X,floodLightColor:ne,depthOnly:!0});const ge=u.colorModeForRenderPass();eh({painter:u,source:t,layer:s,coords:d,defines:F,blendMode:ge,depthMode:we,opacity:b,verticalScale:M,facadeEmissiveChance:V,facadeAOIntensity:U,floodLightIntensity:X,floodLightColor:ne}),E&&Kf(u,t,s,d,!0,b,m,y,X,ne,v,O),re&&Kf(u,t,s,d,!1,b,m,y,X,ne,ae,O)}else if(u.renderPass==="light-beam"){const F=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],V=new Qt(u.context.gl.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D);eh({painter:u,source:t,layer:s,coords:d,defines:F,blendMode:Mn.alphaBlended,depthMode:V,opacity:b,verticalScale:M,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1),u.resetStencilClippingMasks()},hillshade:function(u,t,s,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const m=u.context,y=u.terrain&&u.terrain.renderingToTexture,[v,b]=u.renderPass!=="translucent"||y?[{},d]:u.stencilConfigForOverlap(d);for(const E of b){const A=t.getTile(E);if(A.needsHillshadePrepare&&u.renderPass==="offscreen")Pw(u,A,s);else if(u.renderPass==="translucent"){const M=u.depthModeForSublayer(0,Qt.ReadOnly),O=s.paint.get("hillshade-emissive-strength"),z=u.colorModeForDrapableLayerRenderPass(O),F=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(E):v[E.overscaledZ];Aw(u,E,A,s,M,F,z)}}m.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,s,d,m,y){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const v=u.transform.projection.name==="globe",b=s.paint.get("raster-elevation")!==0,E=b&&v;if(u.renderElevatedRasterBackface&&!E)return;const A=u.context,M=A.gl,O=t.getSource(),z=function(ge,ve,me,he,Se){const Le=ve.paint.get("raster-color"),Re=ge.type==="raster-array",qe=[],Ze=ve.paint.get("raster-resampling"),tt=ve.paint.get("raster-color-mix");let _t=ve.paint.get("raster-color-range");const Ue=[tt[0],tt[1],tt[2],0],Ae=tt[3];let Ke=Ze==="nearest"?he.NEAREST:he.LINEAR;if(Re&&(qe.push("RASTER_ARRAY"),Le||qe.push("RASTER_COLOR"),Ze==="linear"&&qe.push("RASTER_ARRAY_LINEAR"),Ke=he.NEAREST,!_t&&ge.rasterLayers)){const $e=ge.rasterLayers.find(({id:lt})=>lt===ve.sourceLayer);$e&&$e.fields&&$e.fields.range&&(_t=$e.fields.range)}if(_t=_t||[0,1],Le){qe.push("RASTER_COLOR"),me.activeTexture.set(he.TEXTURE2),ve.updateColorRamp(_t);let $e=ve.colorRampTexture;$e||($e=ve.colorRampTexture=new o.T(me,ve.colorRamp,he.RGBA8)),$e.bind(he.LINEAR,he.CLAMP_TO_EDGE)}return Se&&qe.push("USE_MRT1"),{mix:Ue,range:_t,offset:Ae,defines:qe,resampling:Ke}}(O,s,A,M,u.terrain&&u.terrain.renderingToTexture&&u.emissiveMode==="mrt-fallback");if(O instanceof o.aU&&!d.length&&!v)return;const F=s.paint.get("raster-emissive-strength"),V=u.colorModeForDrapableLayerRenderPass(F),U=u.terrain&&u.terrain.renderingToTexture,X=!u.options.moving,Z=s.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;if(O instanceof o.aU&&!d.length&&(O.onNorthPole||O.onSouthPole)){const ge=b?u.stencilModeFor3D():yn.disabled;return void th(!!O.onNorthPole,null,u,t,s,F,z,gn.disabled,ge)}if(!d.length)return;const[ne,ae]=O instanceof o.aU||U?[{},d]:u.stencilConfigForOverlap(d),re=ae[ae.length-1].overscaledZ;E&&z.defines.push("PROJECTION_GLOBE_VIEW"),b&&z.defines.push("RENDER_CUTOFF");const we=(ge,ve,me)=>{for(const he of ge){const Se=he.toUnwrapped(),Le=t.getTile(he);if(U&&(!Le||!Le.hasData()))continue;A.activeTexture.set(M.TEXTURE0);const Re=ol(Le,O,s,z);if(!Re||!Re.texture)continue;const{texture:qe,mix:Ze,offset:tt,tileSize:_t,buffer:Ue}=Re;let Ae,Ke;U?(Ae=Qt.disabled,Ke=he.projMatrix):b?(Ae=new Qt(M.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D),Ke=v?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Se,X)):(Ae=u.depthModeForSublayer(he.overscaledZ-re,s.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,M.LESS),Ke=u.transform.calculateProjMatrix(Se,X));const $e=u.terrain&&U?u.terrain.stencilModeForRTTOverlap(he):ne[he.overscaledZ],lt=y?0:s.paint.get("raster-fade-duration");Le.registerFadeDuration(lt);const Ct=t.findLoadedParent(he,0),zt=Xd(Le,Ct,t,u.transform,lt);let St,yt;!zt.isFading&&Le.refreshedUponExpiration&&(Le.refreshedUponExpiration=!1),u.terrain&&u.terrain.prepareDrawTile(),A.activeTexture.set(M.TEXTURE0),qe.bind(Z,M.CLAMP_TO_EDGE),A.activeTexture.set(M.TEXTURE1),Ct?(Ct.texture&&Ct.texture.bind(Z,M.CLAMP_TO_EDGE),St=Math.pow(2,Ct.tileID.overscaledZ-Le.tileID.overscaledZ),yt=[Le.tileID.canonical.x*St%1,Le.tileID.canonical.y*St%1]):qe.bind(Z,M.CLAMP_TO_EDGE),"useMipmap"in qe&&A.extTextureFilterAnisotropic&&u.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const Xt=u.transform;let Ut;const Dt=b?Vv(Xt):[0,0,0,0];let Ft,sn,Tn,Gn,ci,Yt=0;if(E&&O instanceof o.aU&&O.coordinates.length>3)Ft=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0)))),sn=Float32Array.from(Xt.globeMatrix),Tn=Float32Array.from(o.dF(Xt)),Gn=[o.aF(Xt.center.lng),o.aJ(Xt.center.lat)],Ut=O.elevatedGlobePerspectiveTransform,ci=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(E){const Si=o.dG(he.canonical);Yt=o.dH(Si.getCenter().lat),Ft=Float32Array.from(o.bk(o.dJ(he.canonical))),sn=Float32Array.from(Xt.globeMatrix),Tn=Float32Array.from(o.dF(Xt)),Gn=[o.aF(Xt.center.lng),o.aJ(Xt.center.lat)],Ut=[0,0],ci=Float32Array.from(o.dI(he.canonical,Si,Yt,Xt.worldSize/Xt._pixelsPerMercatorPixel))}else Ut=O instanceof o.aU?O.perspectiveTransform:[0,0],Ft=new Float32Array(16),sn=new Float32Array(9),Tn=new Float32Array(16),Gn=[0,0],ci=new Float32Array(9);const oi=zv(Ke,Ft,sn,Tn,ci,yt||[0,0],o.aj(u.transform.zoom),Gn,Dt,St||1,zt,s,Ut,b?s.paint.get("raster-elevation"):0,2,Ze,tt,z.range,_t,Ue,F),wn=u.isTileAffectedByFog(he),pi=u.getOrCreateProgram("raster",{defines:z.defines,overrideFog:wn});if(u.uploadCommonUniforms(A,pi,Se),O instanceof o.aU){const Si=O.elevatedGlobeVertexBuffer,xi=O.elevatedGlobeIndexBuffer;if(U||!v)O.boundsBuffer&&O.boundsSegments&&pi.draw(u,M.TRIANGLES,Ae,yn.disabled,V,gn.disabled,oi,s.id,O.boundsBuffer,u.quadTriangleIndexBuffer,O.boundsSegments);else if(Si&&xi){const ri=Xt.zoom<=o.c_?O.elevatedGlobeSegments:O.getSegmentsForLongitude(Xt.center.lng);ri&&pi.draw(u,M.TRIANGLES,Ae,yn.disabled,V,ve,oi,s.id,Si,xi,ri)}}else if(E){Ae=new Qt(M.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D);const Si=u.globeSharedBuffers;if(Si){const[xi,ri,Dn]=Si.getGridBuffers(Yt,!1);pi.draw(u,M.TRIANGLES,Ae,me||$e,u.colorModeForRenderPass(),ve,oi,s.id,xi,ri,Dn)}}else{const{tileBoundsBuffer:Si,tileBoundsIndexBuffer:xi,tileBoundsSegments:ri}=u.getTileBoundsBuffers(Le);pi.draw(u,M.TRIANGLES,Ae,$e,V,gn.disabled,oi,s.id,Si,xi,ri)}}if(!(O instanceof o.aU)&&E)for(const he of ge){const Se=he.canonical.y===(1<<he.canonical.z)-1;he.canonical.y===0&&th(!0,he,u,t,s,F,z,ve,me||yn.disabled),Se&&th(!1,he,u,t,s,F,z,ve===gn.frontCW?gn.backCW:gn.frontCW,me||yn.disabled)}};E?we(ae,u.renderElevatedRasterBackface?gn.backCW:gn.frontCW,u.stencilModeFor3D()):we(ae,gn.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,s,d,m,y){u.renderPass==="offscreen"&&function(v,b,E,A){if(!A.length)return;const M=v.context,O=M.gl,z=b.getSource();if(!(z instanceof Do))return;const F=Math.ceil(Math.sqrt(E.paint.get("raster-particle-count")));let V=E.particlePositionRGBAImage;if(!V||V.width!==F){const ae=function(re){const we=re*re,ge=new Uint8Array(4*we),ve=function(he){return he|=0,he=Math.imul(2747636419^he,2654435769),he=Math.imul(he^he>>>16,2654435769),((he=Math.imul(he^he>>>16,2654435769))>>>0)/4294967296},me=1/1.1;for(let he=0;he<we;he++){const Se=me*(ve(2*he+0)+La),Le=me*(ve(2*he+1)+La),Re=255*Se%1,qe=255*Le%1,Ze=Re,tt=Le-qe/255,_t=qe;ge[4*he+0]=255*(Se-Re/255),ge[4*he+1]=255*Ze,ge[4*he+2]=255*tt,ge[4*he+3]=255*_t}return ge}(F);V=E.particlePositionRGBAImage=new o.q({width:F,height:F},ae)}let U=E.particleFramebuffer;U?U.width!==F&&(U.destroy(),U=E.particleFramebuffer=M.createFramebuffer(F,F,1,null)):U=E.particleFramebuffer=M.createFramebuffer(F,F,1,null);const X=[];for(const ae of A){const re=b.getTile(ae);if(!(re instanceof df))continue;const we=Og(re,z,E);if(!we)continue;const ge=[re.tileSize,re.tileSize];let ve=E.tileFramebuffer;ve||(ve=E.tileFramebuffer=M.createFramebuffer(ge[0],ge[1],1,null));let me=re.rasterParticleState;me||(me=re.rasterParticleState=new Jf(M,ae,ge,V));const he=me.update(E.lastInvalidatedAt);me.particleTextureDimension!==F&&me.updateParticleTexture(ae,V);const Se=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=Se;const Le=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=Le,X.push([ae,we,me,he])}if(X.length===0)return;const Z=o.o.now(),ne=E.previousDrawTimestamp?.001*(Z-E.previousDrawTimestamp):.0167;if(E.previousDrawTimestamp=Z,E.hasColorMap()){M.activeTexture.set(O.TEXTURE0+2);let ae=E.colorRampTexture;ae||(ae=E.colorRampTexture=new o.T(M,E.colorRamp,O.RGBA8)),ae.bind(O.LINEAR,O.CLAMP_TO_EDGE)}M.bindFramebuffer.set(E.tileFramebuffer.framebuffer),function(ae,re,we){const ge=ae.context,ve=ge.gl,me=re.tileFramebuffer;ge.activeTexture.set(ve.TEXTURE0);const he={u_texture:0,u_opacity:1.05*(Le=re.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},Se=ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const Re of we){const[,,qe,Ze]=Re;me.colorAttachment0.set(qe.targetColorTexture.texture),ge.viewport.set([0,0,me.width,me.height]),ge.clear({color:o.ao.transparent}),Ze&&(qe.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),Se.draw(ae,ve.TRIANGLES,Qt.disabled,yn.disabled,Mn.alphaBlended,gn.disabled,he,re.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments))}}(v,E,X),function(ae,re,we,ge){const ve=ae.context,me=ve.gl,he=we.tileFramebuffer,Se=ae.transform.projection.name==="globe",Le=we.paint.get("raster-particle-max-speed");for(const Re of ge){const[qe,Ze,tt]=Re;ve.activeTexture.set(me.TEXTURE0+0),Ze.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),he.colorAttachment0.set(tt.targetColorTexture.texture);const _t=ae.getOrCreateProgram("rasterParticleDraw",{defines:Ze.defines,overrideFog:!1});ve.activeTexture.set(me.TEXTURE0+1);const Ue=Ze.scalarData?[]:[0,1,2,3].map($e=>o.e9[$e](qe));Ue.push(qe);const Ae=qe.canonical.x,Ke=qe.canonical.y;for(const $e of Ue){const lt=re.getTile(Se?$e.wrapped():$e);if(!lt)continue;const Ct=lt.rasterParticleState;if(!Ct)continue;const zt=$e.canonical.x+(1<<$e.canonical.z)*($e.wrap-qe.wrap),St=$e.canonical.y;Ct.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);const yt=Nw(1,Ct.particleTexture0.size[0],[zt-Ae,St-Ke],0,Ze.texture.size,2,Le,Ze.textureOffset,Ze.scale,Ze.offset);_t.draw(ae,me.POINTS,Qt.disabled,yn.disabled,Mn.alphaBlended,gn.disabled,yt,we.id,Ct.particleIndexBuffer,void 0,Ct.particleSegment)}}}(v,b,E,X),M.bindFramebuffer.set(E.particleFramebuffer.framebuffer),function(ae,re,we,ge){const ve=ae.context,me=ve.gl,he=re.paint.get("raster-particle-max-speed"),Se=ge*re.paint.get("raster-particle-speed-factor")*.15,Le=function(qe){return Math.pow(qe,6)}(.01+1*re.paint.get("raster-particle-reset-rate-factor")),Re=re.particleFramebuffer;ve.viewport.set([0,0,Re.width,Re.height]);for(const qe of we){const[,Ze,tt]=qe;ve.activeTexture.set(me.TEXTURE0+0),Ze.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),ve.activeTexture.set(me.TEXTURE0+1);const _t=tt.particleTexture0;_t.bind(me.NEAREST,me.CLAMP_TO_EDGE);const Ue=Fv(1,_t.size[0],0,Ze.texture.size,he,Se,Le,Ze.textureOffset,Ze.scale,Ze.offset);Re.colorAttachment0.set(tt.particleTexture1.texture),ve.clear({color:o.ao.transparent}),ae.getOrCreateProgram("rasterParticleUpdate",{defines:Ze.defines}).draw(ae,me.TRIANGLES,Qt.disabled,yn.disabled,Mn.unblended,gn.disabled,Ue,re.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments)}}(v,E,X,ne)}(u,t,s,d),u.renderPass==="translucent"&&(function(v,b,E,A,M){const O=v.context,z=O.gl,F=b.getSource().tileSize,V=5*(1-o.ah(o.cL,o.cL+1,v.transform.zoom))*F+E.paint.get("raster-particle-elevation"),U=!v.options.moving,X=v.transform.projection.name==="globe";if(!A.length)return;const[Z,ne]=v.stencilConfigForOverlap(A),ae=[];X&&ae.push("PROJECTION_GLOBE_VIEW");const re=v.stencilModeFor3D();for(const we of ne){const ge=we.toUnwrapped(),ve=b.getTile(we);if(!ve.rasterParticleState)continue;const me=ve.rasterParticleState,he=100;ve.registerFadeDuration(he);const Se=b.findLoadedParent(we,0),Le=Xd(ve,Se,b,v.transform,he);let Re,qe;v.terrain&&v.terrain.prepareDrawTile(),O.activeTexture.set(z.TEXTURE0),me.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),O.activeTexture.set(z.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Re=Math.pow(2,Se.tileID.overscaledZ-ve.tileID.overscaledZ),qe=[ve.tileID.canonical.x*Re%1,ve.tileID.canonical.y*Re%1]):me.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Ze=X?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(ge,U),tt=v.transform,_t=$v(tt),Ue=o.dG(we.canonical),Ae=o.dH(Ue.getCenter().lat);let Ke,$e,lt,Ct,zt;X?(Ke=Float32Array.from(o.bk(o.dJ(we.canonical))),$e=Float32Array.from(tt.globeMatrix),lt=Float32Array.from(o.dF(tt)),Ct=[o.aF(tt.center.lng),o.aJ(tt.center.lat)],zt=Float32Array.from(o.dI(we.canonical,Ue,Ae,tt.worldSize/tt._pixelsPerMercatorPixel))):(Ke=new Float32Array(16),$e=new Float32Array(9),lt=new Float32Array(16),Ct=[0,0],zt=new Float32Array(9));const St=Fw(Ze,Ke,$e,lt,zt,qe||[0,0],o.aj(v.transform.zoom),Ct,_t,Re||1,Le,V),yt=v.isTileAffectedByFog(we),Xt=v.getOrCreateProgram("rasterParticle",{defines:ae,overrideFog:yt});if(v.uploadCommonUniforms(O,Xt,ge),X){const Ut=new Qt(z.LEQUAL,Qt.ReadOnly,v.depthRangeFor3D),Dt=0,Ft=v.globeSharedBuffers;if(Ft){const[sn,Tn,Gn]=Ft.getGridBuffers(Ae,Dt!==0);Xt.draw(v,z.TRIANGLES,Ut,re,Mn.alphaBlended,v.renderElevatedRasterBackface?gn.frontCCW:gn.backCCW,St,E.id,sn,Tn,Gn)}}else{const Ut=v.depthModeForSublayer(0,Qt.ReadOnly),Dt=Z[we.overscaledZ],{tileBoundsBuffer:Ft,tileBoundsIndexBuffer:sn,tileBoundsSegments:Tn}=v.getTileBoundsBuffers(ve);Xt.draw(v,z.TRIANGLES,Ut,Dt,Mn.alphaBlended,gn.disabled,St,E.id,Ft,sn,Tn)}}v.resetStencilClippingMasks()}(u,t,s,d),u.style.map.triggerRepaint())},background:function(u,t,s,d){const m=s.paint.get("background-color"),y=s.paint.get("background-color-use-theme").constantOr("default")==="none",v=s.paint.get("background-opacity"),b=s.paint.get("background-emissive-strength"),E=s.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const A=u.context,M=A.gl,O=u.transform,z=O.tileSize,F=s.paint.get("background-pattern");let V;if(F!==void 0&&(F===null||(V=u.imageManager.getPattern(o.I.from(F.toString()),s.scope,u.style.getLut(s.scope)),!V)))return;const U=!F&&m.a===1&&v===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==U)return;const X=yn.disabled,Z=u.depthModeForSublayer(0,U==="opaque"?Qt.ReadWrite:Qt.ReadOnly),ne=u.colorModeForDrapableLayerRenderPass(b),ae=F?"backgroundPattern":"background";let re,we=d;we||(re=u.getBackgroundTiles(),we=Object.values(re).map(ve=>ve.tileID)),F&&(A.activeTexture.set(M.TEXTURE0),u.imageManager.bind(u.context,s.scope));const ge=[];if(u.terrain&&u.terrain.renderingToTexture&&u.emissiveMode==="mrt-fallback"&&ge.push("USE_MRT1"),E){const ve=u.getOrCreateProgram(ae,{overrideFog:!1,overrideRtt:!0,defines:ge}),me=new Float32Array(o.bA([])),he=new o.aQ(0,0,0,0,0),Se=F?Zl(me,b,v,u,0,s.scope,V,E,{tileID:he,tileSize:z}):Kd(me,b,v,m.toPremultipliedRenderColor(y?null:s.lut));ve.draw(u,M.TRIANGLES,Z,X,ne,gn.disabled,Se,s.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const ve of we){const me=u.isTileAffectedByFog(ve),he=u.getOrCreateProgram(ae,{overrideFog:me,defines:ge}),Se=ve.toUnwrapped(),Le=d?ve.projMatrix:u.transform.calculateProjMatrix(Se);u.prepareDrawTile();const Re=t?t.getTile(ve):re?re[ve.key]:new Tc(ve,z,O.zoom,u),qe=F?Zl(Le,b,v,u,0,s.scope,V,E,{tileID:ve,tileSize:z}):Kd(Le,b,v,m.toPremultipliedRenderColor(y?null:s.lut));u.uploadCommonUniforms(A,he,Se);const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:tt,tileBoundsSegments:_t}=u.getTileBoundsBuffers(Re);he.draw(u,M.TRIANGLES,Z,X,ne,gn.disabled,qe,s.id,Ze,tt,_t)}},sky:function(u,t,s){const d=u._atmosphere?o.aj(u.transform.zoom):1,m=s.paint.get("sky-opacity")*d;if(m===0)return;const y=u.context,v=s.paint.get("sky-type"),b=new Qt(y.gl.LEQUAL,Qt.ReadOnly,[0,1]),E=u.frameCounter/1e3%1;v==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(A,M,O,z){const F=A.context,V=F.gl;let U=M.skyboxFbo;if(!U){U=M.skyboxFbo=F.createFramebuffer(32,32,1,null),M.skyboxGeometry=new tp(F),M.skyboxTexture=F.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,M.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let ae=0;ae<6;++ae)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(U.framebuffer),F.viewport.set([0,0,32,32]);const X=M.getCenter(A,!0),Z=A.getOrCreateProgram("skyboxCapture"),ne=new Float64Array(16);o.bA(ne),o.en(ne,ne,.5*-Math.PI),Oc(A,M,Z,ne,X,0),o.bA(ne),o.en(ne,ne,.5*Math.PI),Oc(A,M,Z,ne,X,1),o.bA(ne),o.cU(ne,ne,.5*-Math.PI),Oc(A,M,Z,ne,X,2),o.bA(ne),o.cU(ne,ne,.5*Math.PI),Oc(A,M,Z,ne,X,3),o.bA(ne),Oc(A,M,Z,ne,X,4),o.bA(ne),o.en(ne,ne,Math.PI),Oc(A,M,Z,ne,X,5),F.viewport.set([0,0,A.width,A.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(A,M,O,z,F){const V=A.context,U=V.gl,X=A.transform,Z=A.getOrCreateProgram("skybox");V.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,M.skyboxTexture);const ne=((ae,re,we,ge,ve)=>({u_matrix:ae,u_sun_direction:re,u_cubemap:0,u_opacity:ge,u_temporal_offset:ve}))(X.skyboxMatrix,M.getCenter(A,!1),0,z,F);A.uploadCommonUniforms(V,Z),Z.draw(A,U.TRIANGLES,O,yn.disabled,A.colorModeForRenderPass(),gn.backCW,ne,"skybox",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(u,s,b,m,E):v==="gradient"&&u.renderPass==="sky"&&function(A,M,O,z,F){const V=A.context,U=V.gl,X=A.transform,Z=A.getOrCreateProgram("skyboxGradient");M.skyboxGeometry||(M.skyboxGeometry=new tp(V)),V.activeTexture.set(U.TEXTURE0);let ne=M.colorRampTexture;ne||(ne=M.colorRampTexture=new o.T(V,M.colorRamp,U.RGBA8)),ne.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ae=((re,we,ge,ve,me)=>({u_matrix:re,u_color_ramp:0,u_center_direction:we,u_radius:o.an(ge),u_opacity:ve,u_temporal_offset:me}))(X.skyboxMatrix,M.getCenter(A,!1),M.paint.get("sky-gradient-radius"),z,F);A.uploadCommonUniforms(V,Z),Z.draw(A,U.TRIANGLES,O,yn.disabled,A.colorModeForRenderPass(),gn.backCW,ae,"skyboxGradient",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(u,s,b,m,E)},custom:function(u,t,s,d){const m=u.context,y=s.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&s.isDraped(t)){if(u.renderPass==="offscreen"){const v=y.prerender;if(v){if(u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;v.call(y,m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.aj(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else v.call(y,m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const b=y.renderToTile;if(b){const E=d[0].canonical,A={x:E.x+d[0].wrap*(y.wrapTileId?0:1<<E.z),y:E.y,z:E.z};m.setDepthMode(Qt.disabled),m.setStencilMode(yn.disabled),m.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),b.call(y,m.gl,A),m.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),m.setColorMode(u.colorModeForRenderPass()),m.setStencilMode(yn.disabled);const v=y.renderingMode==="3d"?new Qt(u.context.gl.LEQUAL,Qt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Qt.ReadOnly);if(m.setDepthMode(v),u.transform.projection.name==="globe"){const b=u.transform.pointMerc;y.render(m.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.aj(u.transform.zoom),[b.x,b.y],u.transform.pixelsPerMeterRatio)}else y.render(m.gl,u.transform.customLayerMatrix());m.setDirty(),u.setBaseState(),m.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,s,d){if(u.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1),y=s.paint.get("model-elevation-reference"),v=y==="ground",b=y==="ground";if(m===0)return;const E=s.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!E||u.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const A=u.shadowRenderer,M=s.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,M||(A.enabled=!1));const O=()=>{A&&(A.useNormalOffset=!0,M||(A.enabled=!0))},z=t.getSource();if(u.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(re,we,ge,ve,me){const he=re.transform,Se=he.projection.name==="globe",Le=he.getFreeCameraOptions().position;if(!re.modelManager)return;const Re=re.modelManager;ge.modelManager=Re;const qe=re.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ze=ge._unevaluatedLayout._values["model-id"],tt=Object.assign({},ge.layout.get("model-id").parameters),_t=re.style.order.indexOf(ge.fqid),Ue=ge.paint.get("model-opacity").constantOr(1);for(const Ae of ve){const Ke=we.getTile(Ae).getBucket(ge);if(!Ke||Ke.projection.name!==he.projection.name)continue;const $e=Ke.getModelUris();if($e&&!Ke.modelsRequested&&(Re.addModelsFromBucket($e,me),Ke.modelsRequested=!0),Se)tt.zoom=Ae.overscaledZ;else{const Dt=Vo(Ae,he);tt.zoom=Dt}const lt=Ze.possiblyEvaluate(tt);if(Jv(re,Ke,Ae),za.shadowUniformsInitialized=!1,za.useSingleShadowCascade=!!qe&&qe.getMaxCascadeForTile(Ae.toUnwrapped())===0,re.renderPass==="shadow"&&qe){if(re.currentShadowCascade===1&&Ke.isInsideFirstShadowMapFrustum)continue;const Dt=he.calculatePosMatrix(Ae.toUnwrapped(),he.worldSize);if(za.tileMatrix.set(Dt),za.shadowTileMatrix=Float32Array.from(qe.calculateShadowPassMatrixFromMatrix(Dt)),za.aabb.min=[0,0,0],za.aabb.max[0]=za.aabb.max[1]=o.al,za.aabb.max[2]=0,Vw(Ke,za,re,ge.scope))continue}const Ct=1<<Ae.canonical.z,zt=[((Le.x-Ae.wrap)*Ct-Ae.canonical.x)*o.al,(Le.y*Ct-Ae.canonical.y)*o.al,Le.z*Ct*o.al];re.conflationActive&&Object.keys(Ke.instancesPerModel).length>0&&re.style.isLayerClipped(ge,we.getSource())&&Ke.updateReplacement(Ae,re.replacementSource,_t,ge.scope)&&(Ke.uploaded=!1,Ke.upload(re.context));let St=0;const yt=new Array,Xt=new Array,Ut=new Array;for(let Dt in Ke.instancesPerModel){const Ft=Ke.instancesPerModel[Dt];Ft.features.length>0&&!Se&&(Dt=lt.evaluate(Ft.features[0].feature,{}));const sn=Re.getModel(Dt,me);if(sn||Re.hasURLBeenRequested(Dt)||Ke.modelUris.includes(Dt)||(Ke.modelUris.push(Dt),Ke.modelsRequested=!1),sn&&sn.uploaded)if(Se){const Tn=o.c5([],[Le.x,Le.y,Le.z],re.transform.worldSize);o.ew(Tn,Tn);for(let Gn=0;Gn<Ft.instancedDataArray.length;++Gn){const ci=[0,0,0],Yt=[1,1,1],oi=o.ex(),wn=Ft.tileCoordinatesForInstance(Gn),pi=Ft.transformForInstance(Gn);o.ey(Yt,pi),o.ez(oi,pi),o.eA(ci,oi);const Si=Ft.translationForInstance(Gn),xi=new o.aT(0,0);o.eB(Ke.canonical,xi,wn.x,wn.y);const ri=o.bC();o.eC(ri,sn,re.transform,xi,ci,Yt,Si,!0,!1,!1);const Dn=Ft.colorForInstance(Gn),di=o.bA([]),ar=o.ef(xi.lat,re.transform.zoom),Zi=o.bq([],[1,1,1/ar]);o.br(di,di,Tn),Ut.push({zScaleMatrix:Zi,negCameraPosMatrix:di});for(const mi of sn.nodes)Fc(re,mi,ri,re.transform.expandedFarZProjMatrix,St,yt,Xt,sn.materialOverrides,Ue,Dn);++St}}else for(const Tn of sn.nodes)e0(re,ge,Tn,Ft,zt,Ae,za)}if(Se)if(re.renderPass==="shadow"){for(const Dt of Xt)ca(Dt.mesh,Dt.nodeModelMatrix,re,ge);for(const Dt of yt)ca(Dt.mesh,Dt.nodeModelMatrix,re,ge)}else Qv(re,ge,yt,Xt,Ut)}}(u,t,s,d,nh(u,s)),void O();if(!z.loaded())return;if(z.type==="batched-model")return function(re,we,ge,ve){ge.resetLayerRenderingStats(re);const me=re.context,he=re.transform,Se=re.style.fog,Le=re.shadowRenderer;if(he.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${he.projection.name} projection is not yet implemented`);const Re=re.transform.getFreeCameraOptions().position,qe=o.c5([],[Re.x,Re.y,Re.z],re.transform.worldSize),Ze=o.ew([],qe),tt=o.bA([]),_t=o.ef(he.center.lat,he.zoom),Ue=o.bq([],[1,1,1/_t]);o.br(tt,tt,Ze);const Ae=ge.paint.get("model-opacity").constantOr(1),Ke=new Qt(me.gl.LEQUAL,Qt.ReadWrite,re.depthRangeFor3D),$e=new Qt(me.gl.LEQUAL,Qt.ReadOnly,re.depthRangeFor3D),lt=new o.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ct=re.renderPass==="shadow",zt=Ct&&Le?Le.getCurrentCascadeFrustum():he.getFrustum(he.scaleZoom(he.worldSize)),St=ge.paint.get("model-front-cutoff"),yt=St[2]<1,Xt=jl(re,ge.paint.get("model-cutoff-fade-range")),Ut=ge.getLayerRenderingStats();(function(Dt,Ft,sn,Tn){const Gn=Dt.terrain?Dt.terrain.exaggeration():0,ci=Dt.transform.zoom;for(const Yt of Tn){const oi=Ft.getTile(Yt).getBucket(sn);oi&&(oi.setFilter(sn.filter),Dt.conflationActive&&oi.updateReplacement(Yt,Dt.replacementSource),oi.evaluateTransform(Dt,sn),Dt.terrain&&Gn>0&&oi.elevationUpdate(Dt.terrain,Gn,Yt,sn.source),oi.needsReEvaluation(Dt,ci,sn)&&oi.evaluate(sn))}})(re,we,ge,ve),function(){let Dt,Ft,sn;yt?(Dt=ve.length-1,Ft=-1,sn=-1):(Dt=0,Ft=ve.length,sn=1);const Tn=new Float64Array(16),Gn=o.cA(),ci=new o.P(0,0);for(let Yt=Dt;Yt!==Ft;Yt+=sn){const oi=ve[Yt],wn=we.getTile(oi).getBucket(ge);if(!wn||!wn.uploaded)continue;let pi=!1;Le&&(pi=Le.getMaxCascadeForTile(oi.toUnwrapped())===0);const Si=he.calculatePosMatrix(oi.toUnwrapped(),he.worldSize),xi=wn.modelTraits;!Ct&&yt&&(o.bl(Tn,Si),o.af(Gn,qe,Tn),ci.x=Gn[0],ci.y=Gn[1]);const ri=[];wn.setFilter(ge.filter);for(const Dn of wn.getNodesInfo()){if(Dn.hiddenByReplacement||!Dn.node.meshes)continue;const di=Dn.node;let ar=0;re.terrain&&di.elevation&&(ar=di.elevation*re.terrain.exaggeration());const Zi=(()=>{const Io=Dn.aabb;return lt.min=[...Io.min],lt.max=[...Io.max],lt.min[2]+=ar,lt.max[2]+=ar,o.af(lt.min,lt.min,Si),o.af(lt.max,lt.max,Si),lt})(),mi=Dn.evaluatedScale;if(mi[0]<=1&&mi[1]<=1&&mi[2]<=1&&Zi.intersects(zt)===0)continue;if(!Ct&&yt){const Io=.16666666666666666;Dn.cameraCollisionOpacity=qe[0]>Zi.min[0]&&qe[0]<Zi.max[0]&&qe[1]>Zi.min[1]&&qe[1]<Zi.max[1]&&qe[2]*_t<Zi.max[2]&&di.footprint&&o.c0(ci,di.footprint)?Math.max(Dn.cameraCollisionOpacity-Io,0):Math.min(1,Dn.cameraCollisionOpacity+Io)}const ei=[...Si],Ln=1/o.d7(oi.canonical),Vi=di.anchor?di.anchor[0]:0,gr=di.anchor?di.anchor[1]:0;o.br(ei,ei,[Vi*(mi[0]-1)+Dn.evaluatedTranslation[0]*Ln,gr*(mi[1]-1)+Dn.evaluatedTranslation[1]*Ln,ar+Dn.evaluatedTranslation[2]]),o.cq(mi,o.eE)||o.cS(ei,ei,mi);const tr=o.aB([],ei,di.globalMatrix),Pi=o.aB([],he.expandedFarZProjMatrix,tr),$o=o.aB([],he.expandedFarZProjMatrix,ei),go=o.aC([],[Vi,gr,ar,1],Pi)[2];di.hidden=!1;let Or=Ae;Ct||(yt&&(Or*=Dn.cameraCollisionOpacity,Or*=jn(ei,he,Dn.aabb,St)),Or*=qi(Xt,go)),Or!==0?ri.push({nodeInfo:Dn,depth:go,opacity:Or,wvpForNode:Pi,wvpForTile:$o,nodeModelMatrix:tr,tileModelMatrix:ei}):di.hidden=!0}Ct||ri.sort((Dn,di)=>!yt||Dn.opacity===1&&di.opacity===1?Dn.depth<di.depth?-1:1:Dn.opacity===1?-1:di.opacity===1?1:Dn.depth>di.depth?-1:1);for(const Dn of ri){const di=Dn.nodeInfo,ar=di.node;let Zi=o.aB([],Ue,Dn.tileModelMatrix);o.aB(Zi,tt,Zi);const mi=o.bl([],Zi);o.eg(mi,mi),o.cS(mi,mi,ih),Zi=o.aB(Zi,Zi,ar.globalMatrix);const ei=re.renderPass==="light-beam",Ln=ge.paint.get("model-color-use-theme").constantOr("default")==="none",Vi=xi&o.eI.HasMapboxMeshFeatures,gr=Vi?0:di.evaluatedRMEA[0][2];for(let tr=0;tr<ar.meshes.length;++tr){const Pi=ar.meshes[tr],$o=tr===ar.lightMeshIndex;let go=Dn.wvpForNode;if($o){if(!ei&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}go=Dn.wvpForTile}else if(ei)continue;const Or={defines:[]},Io=[];if(!Ct&&Le&&(Le.useNormalOffset=!!Pi.normalBuffer),rp(Or.defines,Io,Pi,re,Ln?null:ge.lut),Vi||Or.defines.push("DIFFUSE_SHADED"),pi&&Or.defines.push("SHADOWS_SINGLE_CASCADE"),Ut&&(Ct?Ut.numRenderedVerticesInShadowPass+=Pi.vertexArray.length:Ut.numRenderedVerticesInTransparentPass+=Pi.vertexArray.length),Ct){ca(Pi,Dn.nodeModelMatrix,re,ge);continue}let Co=null;if(Se){const wr=ip(Dn.nodeModelMatrix,re.transform);if(Co=new Float32Array(wr),he.projection.name!=="globe"){const Mi=Pi.aabb.min,Ir=Pi.aabb.max,[lr,nr]=Se.getOpacityForBounds(wr,Mi[0],Mi[1],Ir[0],Ir[1]);Or.overrideFog=lr>=it||nr>=it}}const so=Pi.material;let xs;so.occlusionTexture&&so.occlusionTexture.offsetScale&&(xs=so.occlusionTexture.offsetScale,Or.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Hs=re.getOrCreateProgram("model",Or);!Ct&&Le&&Le.setupShadowsFromMatrix(Dn.tileModelMatrix,Hs,Le.useNormalOffset),re.uploadCommonUniforms(me,Hs,null,Co);const Jo=so.pbrMetallicRoughness;Jo.metallicFactor=.9,Jo.roughnessFactor=.5;const hr=Rc(new Float32Array(go),new Float32Array(Zi),new Float32Array(mi),new Float32Array(ar.globalMatrix),re,Dn.opacity,Jo.baseColorFactor,so.emissiveFactor,Jo.metallicFactor,Jo.roughnessFactor,so,gr,ge,[0,0,0],xs);!$o&&(di.hasTranslucentParts||Dn.opacity<1)&&Hs.draw(re,me.gl.TRIANGLES,Ke,yn.disabled,Mn.disabled,gn.backCCW,hr,ge.id,Pi.vertexBuffer,Pi.indexBuffer,Pi.segments,ge.paint,re.transform.zoom,void 0,Io),Hs.draw(re,me.gl.TRIANGLES,$o?$e:Ke,yn.disabled,$o||Dn.opacity<1||di.hasTranslucentParts?Mn.alphaBlended:Mn.unblended,gn.backCCW,hr,ge.id,Pi.vertexBuffer,Pi.indexBuffer,Pi.segments,ge.paint,re.transform.zoom,void 0,Io)}}}}()}(u,t,s,d),void O();if(z.type!=="model")return;const F=z.getModels(),V=[],U=u.transform.getFreeCameraOptions().position,X=o.c5([],[U.x,U.y,U.z],u.transform.worldSize);o.ew(X,X);const Z=[],ne=[];let ae=0;for(const re of F){const we=t.getFeatureState("",re.id),ge={type:"Unknown",id:re.id,properties:re.featureProperties},ve=s.paint.get("model-rotation").evaluate(ge,we),me=s.paint.get("model-scale").evaluate(ge,we),he=s.paint.get("model-translation").evaluate(ge,we),Se=s.paint.get("model-opacity").evaluate(ge,we);Yv(s,re.id,we,re.featureProperties,re.nodeOverrideNames,re.nodeOverrides),Kv(s,re.id,we,re.featureProperties,re.materialOverrideNames,re.materialOverrides),re.nodeOverrides.size>0&&re.computeBoundsAndApplyParent(),re.computeModelMatrix(u,ve,me,he,b,v,!1);const Le=o.bA([]),Re=o.ef(re.position.lat,u.transform.zoom),qe=o.bq([],[1,1,1/Re]);o.br(Le,Le,X),V.push({zScaleMatrix:qe,negCameraPosMatrix:Le});for(const Ze of re.nodes)Fc(u,Ze,re.matrix,u.transform.expandedFarZProjMatrix,ae,Z,ne,re.materialOverrides,Se);ae++}if(Z.sort((re,we)=>we.depth-re.depth),u.renderPass!=="shadow")Qv(u,s,Z,ne,V),O();else{for(const re of ne)ca(re.mesh,re.nodeModelMatrix,u,s);for(const re of Z)ca(re.mesh,re.nodeModelMatrix,u,s);O()}}},lp={line:function(u,t,s){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const m of d){const y=t.getTile(m).getBucket(u);if(y&&(y.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,s){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,nh(s,u)));if(d.type==="batched-model"||d.type!=="model")return;const m=d.getModels();for(const y of m)y.upload(s.context)},raster:function(u,t,s){const d=t.getSource();if(!(d instanceof Do&&d.loaded()))return;const m=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const y=u.paint.get("raster-array-band")||d.getInitialBand(m);if(y==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(u.id,y)&&d.prepareTile(b,m,u.id,y)},"raster-particle":function(u,t,s){const d=t.getSource();if(!(d instanceof Do&&d.loaded()))return;const m=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!m)return;const y=u.paint.get("raster-particle-array-band")||d.getInitialBand(m);if(y==null)return;const v=t.getIds().map(b=>t.getTileByID(b));for(const b of v)b.updateNeeded(u.id,y)&&d.prepareTile(b,m,u.id,y)}},vs={fill:Zf},cp={fill:function(u,t,s,d){if(!s.layout||s.layout.get("fill-elevation-reference")==="none"||s.paint.get("fill-opacity").constantOr(1)===0)return;const m=u.context.gl,y=new Qt(m.LEQUAL,Qt.ReadOnly,u.depthRangeFor3D),v=new yn({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),b=u.transform.getFreeCameraOptions().position,E=u.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const A of d){const M=t.getTile(A),O=M.getBucket(s);if(!O)continue;const z=O.elevatedStructures;if(!z||z.depthSegments.segments[0].primitiveLength===0)continue;const F=Uv(A.toUnwrapped(),b),V=u.translatePosMatrix(A.projMatrix,M,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),U=Mc(V,F,0,1,0);E.draw(u,m.TRIANGLES,y,v,Mn.disabled,gn.disabled,U,s.id,z.vertexBuffer,z.indexBuffer,z.depthSegments,s.paint,u.transform.zoom)}}};class up{constructor(t,s,d,m,y){this.context=new Iu(t,s),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const v=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const E of v)this._debugParams.enabledLayers[E]=!0;for(const E of v);this.occlusionParams=new Au,this.setup(),this.numSublayers=os.maxUnderzooming+os.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new pu(this),this._wireframeDebugCache=new Yl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const b=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,b,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=y,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,s){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Eg(this,t));const m=this._terrain;this.transform.elevation=d?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=s.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const y=d+.78*(m-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Eg(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*o.o.devicePixelRatio,this.height=s*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,s=new o.bd;s.emplaceBack(0,0),s.emplaceBack(o.al,0),s.emplaceBack(0,o.al),s.emplaceBack(o.al,o.al),this.tileExtentBuffer=t.createVertexBuffer(s,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const d=new o.bd;d.emplaceBack(0,0),d.emplaceBack(o.al,0),d.emplaceBack(0,o.al),d.emplaceBack(o.al,o.al),this.debugBuffer=t.createVertexBuffer(d,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const m=new o.bd;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const y=new o.b1;y.emplaceBack(0,0,0,0),y.emplaceBack(o.al,0,o.al,0),y.emplaceBack(0,o.al,0,o.al),y.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=t.createVertexBuffer(y,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const v=new o.b0;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const b=new o.be;for(const A of[0,1,3,2,0])b.emplaceBack(A);this.debugIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new o.T(t,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bC();const E=this.context.gl;this.stencilClearMode=new yn({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Qt.disabled,this.stencilClearMode,Mn.disabled,gn.disabled,Zd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,d){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const E of d)if(this._tileClippingMaskIDs[E.key]===void 0){b=!0;break}if(!b)return}this.currentStencilSource=s.id;const m=this.context,y=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(Mn.disabled),m.setDepthMode(Qt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of d){const E=s.getTile(b),A=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:O,tileBoundsSegments:z}=this.getTileBoundsBuffers(E);v.draw(this,y.TRIANGLES,Qt.disabled,new yn({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Mn.disabled,gn.disabled,Zd(b.projMatrix),"$clipping",M,O,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new yn({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new yn({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,d=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const v={};for(let b=0;b<y;b++)v[b+m]=new yn({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[v,d]}return[{[m]:yn.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Mn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Mn.unblended:Mn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Mn([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Mn([s.ONE,s.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,s.ONE_MINUS_SRC_ALPHA],o.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,s,d,m=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Qt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Qt(d||this.context.gl.LEQUAL,s,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),d=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&d!==0&&(this.depthFBO=new jv(this.context,s,d,0,"texture"),this.depthTexture=new o.T(this.context,{width:s,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,d,0,0,s,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const d=o.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(y).filter(Ue=>{const Ae=m[Ue];return!(Ae.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ae.type]});let b=v(),E=!1,A=!1,M=null,O=0,z=!1;for(const Ue of b){const Ae=m[Ue];Ae.visibility!=="none"&&(Ae.type==="circle"?E=!0:Ae.type==="building"?(M=Ae,++O):Ae.type==="symbol"&&(Ae.hasOcclusionOpacityProperties?A=!0:E=!0))}this.updateEmissiveMode();let F=b.map(Ue=>m[Ue]);const V=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();for(const Ue in V){const Ae=V[Ue];Ae.used&&(Ae.prepare(this.context),Ae.getSource().usedInConflation&&++O)}let U=!1;for(const Ue of F)Ue.isHidden(this.transform.zoom)||(Ue.type==="clip"&&(U=!0),this.prepareLayer(Ue));const X={},Z={},ne={},ae={},re={};for(const Ue in V){const Ae=V[Ue];X[Ue]=Ae.getVisibleCoordinates(),Z[Ue]=X[Ue].slice().reverse(),ne[Ue]=Ae.getVisibleCoordinates(!0).reverse(),ae[Ue]=Ae.getShadowCasterCoordinates(),re[Ue]=Ae.sortCoordinatesByDistance(X[Ue])}const we=Ue=>{const Ae=this.style.getLayerSourceCache(Ue);return Ae&&Ae.used?Ae.getSource():null};if(O||U||this._clippingActiveLastFrame){const Ue=[],Ae=[];let Ke=0;for(const $e of F)this.isSourceForClippingOrConflation($e,we($e))&&(Ue.push($e),Ae.push(Ke)),Ke++;if(Ue&&(U||Ue.length>1)||this._clippingActiveLastFrame){U=!1;const $e=[];for(let lt=0;lt<Ue.length;lt++){const Ct=Ue[lt],zt=Ae[lt],St=this.style.getLayerSourceCache(Ct);if(!St||!St.used||!St.getSource().usedInConflation&&Ct.type!=="clip"&&Ct.type!=="building")continue;let yt=o.eQ,Xt=o.b_.None;const Ut=[];let Dt=!0;if(Ct.type==="building")yt=o.eS;else if(Ct.type==="clip"){yt=zt;for(const Ft of Ct.layout.get("clip-layer-types"))Xt|=Ft==="model"?o.b_.Model:Ft==="symbol"?o.b_.Symbol:o.b_.FillExtrusion;for(const Ft of Ct.layout.get("clip-layer-scope"))Ut.push(Ft);Ct.isHidden(this.transform.zoom)?Dt=!1:U=!0}Dt&&$e.push({layer:Ct.fqid,cache:St,order:yt,clipMask:Xt,clipScope:Ut})}this.replacementSource.setSources($e),z=!0}}this._clippingActiveLastFrame=U,z||this.replacementSource.clear(),this.conflationActive=z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ue=0;Ue<F.length;Ue++){const Ae=F[Ue];if(Ae.visibility==="none")continue;const Ke=Ae.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){const $e=we(Ae);$e&&(this.minCutoffZoom=Math.max($e.minzoom,this.minCutoffZoom)),Ae.minzoom&&(this.minCutoffZoom=Math.max(Ae.minzoom,this.minCutoffZoom))}Ae.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ue),this._lastOcclusionLayer=Ue)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ne),this.opaquePassCutoff=0,b=v(),F=b.map(Ue=>m[Ue]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ue in V)for(const Ae of X[Ue]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(Ae)||Ke),ve.addShadowReceiver(Ae.toUnwrapped(),Ke.min,Ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xv(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(me&&!this._snow&&(this._snow=new Ug(this)),!me&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new ap(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),M){this.buildingTileBorderManager||(this.buildingTileBorderManager=new np);const Ue=this.style.getLayerSourceCache(M);this.buildingTileBorderManager.updateBorders(Ue,M)}if(!xr.has(this.context.gl))return;this.renderPass="offscreen";for(const Ue of F){const Ae=t.getLayerSourceCache(Ue);if(!Ue.hasOffscreenPass()||Ue.isHidden(this.transform.zoom))continue;const Ke=Ae?Z[Ae.id]:void 0;(Ue.type==="custom"||Ue.type==="raster"||Ue.type==="raster-particle"||Ue.isSky()||Ke&&Ke.length)&&this.renderLayer(this,Ae,Ue,Ke)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Le=(()=>{if(s.showOverdrawInspector)return o.ao.black;const Ue=this.style.fog;if(Ue&&this.transform.projection.supportsFog){const Ae=this.style.getLut(Ue.scope);if(!Se){const Ke=Ue.properties.get("color-use-theme")==="none",$e=Ue.properties.get("color").toNonPremultipliedRenderColor(Ke?null:Ae).toArray01();return new o.ao(...$e)}if(Se){const Ke=Ue.properties.get("space-color-use-theme")==="none",$e=Ue.properties.get("space-color").toNonPremultipliedRenderColor(Ke?null:Ae).toArray01();return new o.ao(...$e)}}return o.ao.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const Ue=F[this.currentLayer],Ae=t.getLayerSourceCache(Ue);if(Ue.isSky())continue;const Ke=Ae?(Ue.is3D(y)?re:Z)[Ae.id]:void 0;this._renderTileClippingMasks(Ue,Ae,Ke),this.renderLayer(this,Ae,Ue,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const Ue=F[this.currentLayer],Ae=t.getLayerSourceCache(Ue);Ue.isSky()&&this.renderLayer(this,Ae,Ue,Ae?Z[Ae.id]:void 0)}function Re(Ue,Ae){let Ke;return Ae&&(Ke=(Ue.type==="symbol"?ne:Ue.is3D(y)?re:Z)[Ae.id]),Ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<b.length;){const Ue=F[this.currentLayer];if(Ue.type==="raster"||Ue.type==="raster-particle"){const Ae=t.getLayerSourceCache(Ue);this.renderLayer(this,Ae,Ue,Re(Ue,Ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let qe=0;ve&&(qe=ve.getShadowCastingLayerCount());let Ze=!1,tt=-1;for(let Ue=0;Ue<b.length;++Ue){const Ae=F[Ue];Ae.isHidden(this.transform.zoom)||Ae.is3D(y)&&(tt=Ue)}A&&tt===-1&&(E=!0);let _t=!1;for(;this.currentLayer<b.length;){const Ue=F[this.currentLayer],Ae=t.getLayerSourceCache(Ue);if(Ue.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ue)){if(Ue.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Ue.is3D(y)&&!y){const Ke=this.currentLayer,$e=lt=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const Ct=F[this.currentLayer];if(vs[Ct.type]){const zt=this.style.getLayerSourceCache(Ct);vs[Ct.type](this,zt,Ct,Re(Ct,zt),lt)}}};$e("initialize"),$e("reset"),this.currentLayer=Ke,_t=!0}if(E&&!Ze&&this.terrain&&!this.transform.isOrthographic&&(Ze=!0,this.blitDepth()),A&&tt!==-1&&this.currentLayer===tt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ue,Ae,Ae?X[Ae.id]:void 0),this.renderLayer(this,Ae,Ue,Re(Ue,Ae)),!this.terrain&&ve&&qe>0&&Ue.hasShadowPass()&&--qe==0){{this.clearStencil(),this.resetStencilClippingMasks();const Ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const $e=F[this.currentLayer];if(cp[$e.type]){const lt=this.style.getLayerSourceCache($e);cp[$e.type](this,lt,$e,Re($e,lt))}}this.currentLayer=Ke}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){const $e=F[this.currentLayer];if(!$e.hasLightBeamPass())continue;const lt=t.getLayerSourceCache($e);this.renderLayer(this,lt,$e,lt?Z[lt.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ke=this.currentLayer;this.depthOcclusion=!0;for(const $e of this.layersWithOcclusionOpacity){this.currentLayer=$e;const lt=F[this.currentLayer],Ct=t.getLayerSourceCache(lt),zt=Ct?Z[Ct.id]:void 0;this.terrain||this._renderTileClippingMasks(lt,Ct,Ct?X[Ct.id]:void 0),this.renderLayer(this,Ct,lt,zt)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ue=null;F.forEach(Ae=>{const Ke=t.getLayerSourceCache(Ae);Ke&&!Ae.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!Ue||Ue.getSource().maxzoom<Ke.getSource().maxzoom)&&(Ue=Ke)}),Ue&&this.options.showTileBoundaries&&bt(this,Ue,Ue.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ue){const Ae=Ue.transform.padding;zc(Ue,Ue.transform.height-(Ae.top||0),3,Gv),zc(Ue,Ae.bottom||0,3,Hv),dr(Ue,Ae.left||0,3,Wv),dr(Ue,Ue.transform.width-(Ae.right||0),3,Lc);const Ke=Ue.transform.centerPoint;(function($e,lt,Ct,zt){Fe($e,lt-1,Ct-10,2,20,zt),Fe($e,lt-10,Ct-1,20,2,zt)})(Ue,Ke.x,Ue.transform.height-Ke.y,kc)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,d=!s||!s.includes(t.type);if(lp[t.type]&&(d||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);lp[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Kl[d.type](t,s,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,d=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),m.calls++,d.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,d=s.createQuery();this.deferredRenderGpuTimeQueries.push(d),s.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const d in t){const m=t[d],y=this.context.extTimerQuery,v=y.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(m.query),s[d]=v}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let d=0;for(const m of t)d+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return d}translatePosMatrix(t,s,d,m,y){if(!d[0]&&!d[1])return t;const v=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(v){const A=Math.sin(v),M=Math.cos(v);d=[d[0]*M-d[1]*A,d[0]*A+d[1]*M]}const b=[y?d[0]:o.ay(s,d[0],this.transform.zoom),y?d[1]:o.ay(s,d[1],this.transform.zoom),0],E=new Float32Array(16);return o.br(E,t,b),E}saveTileTexture(t){if(t.context!==this.context)return;const s=t.size[0],d=this._tileTextures[s];d?d.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,d){const m=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||y.push("FOG","FOG_DITHERING"),m&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,s){this.cache=this.cache||{};const d=s&&s.defines||[],m=s&&s.config,y=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(d),v=Av.cacheKey(hg[t],t,y,m);return this.cache[v]||(this.cache[v]=new Av(this.context,t,hg[t],m,qf[t],y)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const d=this.style.directionalLight,m=this.style.ambientLight;if(d&&m){const y=((v,b,E)=>{const A=v.properties.get("direction"),M=v.properties.get("color-use-theme")==="none",O=v.properties.get("color").toNonPremultipliedRenderColor(M?null:E.getLut(v.scope)).toArray01(),z=v.properties.get("intensity"),F=b.properties.get("color-use-theme")==="none",V=b.properties.get("color").toNonPremultipliedRenderColor(F?null:E.getLut(b.scope)).toArray01(),U=b.properties.get("intensity"),X=[A.x,A.y,A.z],Z=o.dN(V,U),ne=o.dN(O,z);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:X,u_lighting_directional_color:ne,u_ground_radiance:Tu(X,ne,Z)}})(d,m,this.style);s.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,s,d,m,y){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),E=((A,M,O,z,F,V,U,X,Z,ne,ae,re)=>{const we=A.transform,ge=M.properties.get("color-use-theme")==="none",ve=M.properties.get("color").toNonPremultipliedRenderColor(ge?null:A.style.getLut(M.scope)).toArray01();ve[3]=z;const me=A.frameCounter/1e3%1,[he,Se]=M.properties.get("vertical-range");return{u_fog_matrix:O?we.calculateFogTileMatrix(O):re||A.identityMat,u_fog_range:M.getFovAdjustedRange(we._fov),u_fog_color:ve,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,Se),Se],u_fog_temporal_offset:me,u_frustum_tl:F,u_frustum_tr:V,u_frustum_br:U,u_frustum_bl:X,u_globe_pos:Z,u_globe_radius:ne,u_viewport:ae,u_globe_transition:o.aj(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,v,d,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],m);s.setFogUniformValues(t,E)}y&&s.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)s[m.key]=t[m.key]||new Tc(m,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=it||s[1]>=it}setupDepthForOcclusion(t,s,d){const m=this.context,y=m.gl,v=!!d;var b;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((b=this.depthRangeFor3D)[1]-b[0]),-1-2*b[0]/(b[1]-b[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),m.activeTexture.set(y.TEXTURE0),v||s.setTerrainUniformValues(m,d)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function dp(u,t){let s=!1,d=null;const m=()=>{d=null,s&&(u(),d=setTimeout(m,t),s=!1)};return()=>(s=!0,d||m(),d)}class Vg{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=dp(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=kr(t);if(this._hashName){const d=this._hashName;let m=!1;const y=location.hash.slice(1).split("&").map(v=>{const b=v.split("=")[0];return b===d?(m=!0,`${b}=${s}`):v}).filter(v=>v);return m||y.push(`${d}=${s}`),`#${y.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(s=d)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(d=>isNaN(Number(d)))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function kr(u,t){const s=u.getCenter(),d=Math.round(100*u.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),v=Math.round(s.lng*y)/y,b=Math.round(s.lat*y)/y,E=u.getBearing(),A=u.getPitch();let M=t?`/${v}/${b}/${d}`:`${d}/${b}/${v}`;return(E||A)&&(M+="/"+Math.round(10*E)/10),A&&(M+=`/${Math.round(A)}`),M}const Mu={linearity:.3,easing:o.eT(0,0,.3,1)},$g=Object.assign({deceleration:2500,maxSpeed:1400},Mu),Gg=Object.assign({deceleration:20,maxSpeed:1400},Mu),Bc=Object.assign({deceleration:1e3,maxSpeed:360},Mu),Hg=Object.assign({deceleration:1e3,maxSpeed:90},Mu);class Wg{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.o.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=Oa(s.pan.mag(),d,Object.assign({},$g,t||{}));m.offset=s.pan.mult(y.amount/s.pan.mag()),m.center=this._map.transform.center,Ru(m,y)}if(s.zoom){const y=Oa(s.zoom,d,Gg);m.zoom=this._map.transform.zoom+y.amount,Ru(m,y)}if(s.bearing){const y=Oa(s.bearing,d,Bc);m.bearing=this._map.transform.bearing+o.aA(y.amount,-179,179),Ru(m,y)}if(s.pitch){const y=Oa(s.pitch,d,Hg);m.pitch=this._map.transform.pitch+y.amount,Ru(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Ru(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Oa(u,t,s){const{maxSpeed:d,linearity:m,deceleration:y}=s,v=o.aA(u*m/(t/1e3),-d,d),b=Math.abs(v)/(y*m);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class Qo extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d,m={}){const y=Ve(s.getCanvasContainer(),d),v=s.unproject(y);super(t,Object.assign({point:y,lngLat:v,originalEvent:d},m)),this._defaultPrevented=!1,this.target=s}}class Ql extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){const m=t==="touchend"?d.changedTouches:d.touches,y=nt(s.getCanvasContainer(),m),v=y.map(E=>s.unproject(E)),b=y.reduce((E,A,M,O)=>E.add(A.div(O.length)),new o.P(0,0));super(t,{points:y,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:d}),this._defaultPrevented=!1}}class qg extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class hp{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new qg(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Qo(t.type,this._map,t))}mouseup(t){this._map.fire(new Qo(t.type,this._map,t))}preclick(t){const s=new MouseEvent("preclick",t);this._map.fire(new Qo(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Qo(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Qo(t.type,this._map,t))}mouseover(t){this._map.fire(new Qo(t.type,this._map,t))}mouseout(t){this._map.fire(new Qo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ql(t.type,this._map,t))}touchmove(t){this._map.fire(new Ql(t.type,this._map,t))}touchend(t){this._map.fire(new Ql(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ql(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zg{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Qo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Qo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fp{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Me(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const d=s,m=this._startPos,y=this._lastPos;if(!m||!y||y.equals(d)||!this._box&&d.dist(m)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(m.x,d.x),b=Math.max(m.x,d.x),E=Math.min(m.y,d.y),A=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${E}px)`,this._box.style.width=b-v+"px",this._box.style.height=A-E+"px")})}mouseupWindow(t,s){if(!this._active)return;const d=this._startPos,m=s;if(d&&t.button===0){if(this.reset(),Te(),d.x!==m.x||d.y!==m.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ne(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.z(t,{originalEvent:s}))}}function pp(u,t){const s={};for(let d=0;d<u.length;d++)s[u[d].identifier]=t[d];return s}class n0{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const y=new o.P(0,0);for(const v of m)y._add(v);return y.div(m.length)}(s),this.touches=pp(d,s)))}touchmove(t,s,d){if(this.aborted||!this.centroid)return;const m=pp(d,s);for(const y in this.touches){const v=m[y];(!v||v.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,s,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class mp{constructor(t){this.singleTap=new n0(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,d){this.singleTap.touchstart(t,s,d)}touchmove(t,s,d){this.singleTap.touchmove(t,s,d)}touchend(t,s,d){const m=this.singleTap.touchend(t,s,d);if(m){const y=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(y&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class i0{constructor(){this._zoomIn=new mp({numTouches:1,numTaps:2}),this._zoomOut=new mp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,d){this._zoomIn.touchstart(t,s,d),this._zoomOut.touchstart(t,s,d)}touchmove(t,s,d){this._zoomIn.touchmove(t,s,d),this._zoomOut.touchmove(t,s,d)}touchend(t,s,d){const m=this._zoomIn.touchend(t,s,d),y=this._zoomOut.touchend(t,s,d);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const r0={0:1,2:2},Xg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class gp{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const d=At(t);this._correctButton(t,d)&&(this._lastPoint=s,this._eventButton=d)}mousemoveWindow(t,s){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(m,y){const v=r0[y];return m.buttons===void 0||(m.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(d,s)}}mouseupWindow(t){this._lastPoint&&At(t)===this._eventButton&&(this._moved&&Te(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class o0 extends gp{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Yg extends gp{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Xg[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const d=.8*(s.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Kg extends gp{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Xg[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const d=-.5*(s.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class s0{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,s,d){return this._calculateTransform(t,s,d)}touchmove(t,s,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!o.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,d)}}touchend(t,s,d){this._calculateTransform(t,s,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,d){d.length>0&&(this._active=!0);const m=pp(d,s),y=new o.P(0,0),v=new o.P(0,0);let b=0;for(const A in m){const M=m[A],O=this._touches[A];O&&(y._add(M),v._add(M.sub(O)),b++,m[A]=M)}if(this._touches=m,b<this._minTouches||!v.mag())return;const E=v.div(b);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(b),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class _p{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,d){return{}}touchstart(t,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,d){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[y,v]=m,b=rh(d,s,y),E=rh(d,s,v);if(!b||!E)return;const A=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],A,t)}touchend(t,s,d){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,v=rh(d,s,m),b=rh(d,s,y);v&&b||(this._active&&Te(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rh(u,t,s){for(let d=0;d<u.length;d++)if(u[d].identifier===s)return t[d]}function a0(u,t){return Math.log2(u/t)}class $w extends _p{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(a0(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:a0(this._distance,d),pinchAround:s}}}function l0(u,t){return 180*u.angleWith(t)/Math.PI}class er extends _p{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:l0(this._vector,d),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const m=l0(t,d);return Math.abs(m)<s}}function yp(u){return Math.abs(u.y)>Math.abs(u.x)}class Gw extends _p{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,yp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,d){const m=this._lastPoints;if(!m)return;const y=t[0].sub(m[0]),v=t[1].sub(m[1]);return this._map._cooperativeGestures&&!o.eU()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,v,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5})}gestureBeginsVertically(t,s,d){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return yp(t)&&yp(s)&&v}}const Hw={panStep:100,bearingStep:15,pitchStep:10};class Ww{constructor(){const t=Hw;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,d=0,m=0,y=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:b=>{const E=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:oh,zoom:s?Math.round(E)+s*(t.shiftKey?2:1):E,bearing:b.getBearing()+d*this._bearingStep,pitch:b.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-v*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function oh(u){return u*(2-u)}const Qg=4.000244140625,Jg=1/450;class vp{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Jg,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=o.o.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%Qg==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ve(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Qg?this._wheelZoomRate:this._defaultZoomRate;let M=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&M!==0&&(M=1/M);const O=s(),z=Math.pow(2,O),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*M))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,y=this._easing;let v,b=!1;if(this._type==="wheel"&&m&&y){const A=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),M=y(A);v=o.ak(m,d,M),A<1?this._frameId||(this._frameId=!0):b=!0}else v=d,b=!0;this._active=!0,b&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let E=v-s();return E*this._lastDelta<0&&(E=0),{noInertia:!0,needsRenderFrame:!b,zoomDelta:E,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.eV;if(this._prevEase){const d=this._prevEase,m=(o.o.now()-d.start)/d.duration,y=d.easing(m+.01)-d.easing(m),v=.27/Math.sqrt(y*y+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=o.eT(v,b,.25,1)}return this._prevEase={start:o.o.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class al{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zr{constructor(){this._tap=new mp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=s[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,s,d))}touchmove(t,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,d)}touchend(t,s,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,s,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fa{constructor(t,s,d){this._el=t,this._mousePan=s,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sh{constructor(t,s,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class wp{constructor(t,s,d,m){this._el=t,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ah=u=>u.zoom||u.drag||u.pitch||u.rotate;class qw extends o.z{}class lh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const d=o.av([],s,t);this.radius=o.ag(d[2]<0?o.eX([],d,this.constants):[d[0],d[1],0])}projectRay(t){o.eX(t,t,this.constants),o.aw(t,t),o.eY(t,t,this.constants);const s=o.c5([],t,this.radius);if(s[2]>0){const d=o.c5([],[0,0,1],o.bJ(s,[0,0,1])),m=o.c5([],o.aw([],[s[0],s[1],0]),this.radius),y=o.d8([],s,o.c5([],o.av([],o.d8([],m,d),s),2));s[0]=y[0],s[1]=y[1]}return s}}function bp(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Zw{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wg(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new lh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,v]of this._listeners){const b=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(y,b,v)}}destroy(){for(const[t,s,d]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,d)}}_addDefaultHandlers(t){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new hp(s,t));const m=s.boxZoom=new fp(s,t);this._add("boxZoom",m);const y=new i0,v=new xp;s.doubleClickZoom=new al(v,y),this._add("tapZoom",y),this._add("clickZoom",v);const b=new zr;this._add("tapDragZoom",b);const E=s.touchPitch=new Gw(s);this._add("touchPitch",E);const A=new Yg(t),M=new Kg(t);s.dragRotate=new sh(t,A,M),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const O=new o0(t),z=new s0(s,t);s.dragPan=new Fa(d,O,z),this._add("mousePan",O),this._add("touchPan",z,["touchZoom","touchRotate"]);const F=new er,V=new $w;s.touchZoomRotate=new wp(d,V,F,b),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zg(s));const U=s.scrollZoom=new vp(s,this);this._add("scrollZoom",U,["mousePan"]);const X=s.keyboard=new Ww;this._add("keyboard",X);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&s[Z].enable(t[Z])}_add(t,s,d){this._handlers.push({handlerName:t,handler:s,allowed:d}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ah(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,d){for(const m in t)if(m!==d&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const d of t)this._el.contains(d.target)&&s.push(d);return s}handleEvent(t,s){this._updatingCamera=!0;const d=t.type==="renderFrame",m=d?void 0:t,y={needsRenderFrame:!1},v={},b={},E=t.touches?this._getMapTouches(t.touches):void 0,A=E?nt(this._el,E):d?void 0:Ve(this._el,t);for(const{handlerName:z,handler:F,allowed:V}of this._handlers){if(!F.isEnabled())continue;let U;this._blockedByActive(b,V,z)?F.reset():F[s||t.type]&&(U=F[s||t.type](t,A,E),this.mergeHandlerResult(y,v,U,z,m),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||F.isActive())&&(b[z]=F)}const M={};for(const z in this._previousActiveHandlers)b[z]||(M[z]=m);this._previousActiveHandlers=b,(Object.keys(M).length||bp(y))&&(this._changes.push([y,v,M]),this._triggerRenderFrame()),(Object.keys(b).length||bp(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=y;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(t,s,d,m,y){if(!d)return;Object.assign(t,d);const v={handlerName:m,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(s.zoom=v),d.panDelta!==void 0&&(s.drag=v),d.pitchDelta!==void 0&&(s.pitch=v),d.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},d={};for(const[m,y,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),Object.assign(s,y),Object.assign(d,v);this._updateMapTransform(t,s,d),this._changes=[]}_updateMapTransform(t,s,d){const m=this._map,y=m.transform,v=ne=>[ne.x,ne.y,ne.z];if((ne=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!bp(t)){const ne=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),ne!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&m._stop(!0),!bp(t))return void this._fireEvents(s,d,!0);let{panDelta:b,zoomDelta:E,bearingDelta:A,pitchDelta:M,around:O,aroundCoord:z,pinchAround:F}=t;y._isCameraConstrained&&(E>0&&(E=0),y._isCameraConstrained=!1),F!==void 0&&(O=F),(E||(ne=>s[ne]&&!this._eventsInProgress[ne])("drag"))&&O&&(this._dragOrigin=v(y.pointCoordinate3D(O)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),O=O||m.transform.centerPoint,A&&(y.bearing+=A),M&&(y.pitch+=M),y._updateCameraState();const V=[0,0,0];if(b)if(y.projection.name==="mercator"){const ne=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(O).dir),ae=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(O.sub(b)).dir);V[0]=ae[0]-ne[0],V[1]=ae[1]-ne[1]}else{const ne=y.pointCoordinate(O);if(y.projection.name==="globe"){b=b.rotate(-y.angle);const ae=y._pixelsPerMercatorPixel/y.worldSize;V[0]=-b.x*o.eW(o.a$(ne.y))*ae,V[1]=-b.y*o.eW(y.center.lat)*ae}else{const ae=y.pointCoordinate(O.sub(b));ne&&ae&&(V[0]=ae.x-ne.x,V[1]=ae.y-ne.y)}}const U=y.zoom,X=[0,0,0];if(E){const ne=v(z||y.pointCoordinate3D(O)),ae={dir:o.aw([],o.av([],ne,y._camera.position))};if(ae.dir[2]<0){const re=y.zoomDeltaToMovement(ne,E);o.c5(X,ae.dir,re)}}const Z=o.d8(V,V,X);y._translateCameraConstrained(Z),E&&Math.abs(y.zoom-U)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,d,!0)}_fireEvents(t,s,d){const m=ah(this._eventsInProgress),y=ah(t),v={};for(const M in t){const{originalEvent:O}=t[M];this._eventsInProgress[M]||(v[`${M}start`]=O),this._eventsInProgress[M]=t[M]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const M in v)this._fireEvent(M,v[M]);y&&this._fireEvent("move",y.originalEvent);for(const M in t){const{originalEvent:O}=t[M];this._fireEvent(M,O)}const b={};let E;for(const M in this._eventsInProgress){const{handlerName:O,originalEvent:z}=this._eventsInProgress[M];this._handlersById[O].isActive()||(delete this._eventsInProgress[M],E=s[O]||z,b[`${M}end`]=E)}for(const M in b)this._fireEvent(M,b[M]);const A=ah(this._eventsInProgress);if(d&&(m||y)&&!A){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;M?(O(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:E})):(this._map.fire(new o.z("moveend",{originalEvent:E})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.z(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new qw("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Tp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class e_ extends o.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,d){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},s),d)}panTo(t,s,d){return this.easeTo(Object.assign({center:t},s),d)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,d){return this.easeTo(Object.assign({zoom:t},s),d)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,d){return this.easeTo(Object.assign({bearing:t},s),d)}resetNorth(t,s){return this.rotateTo(0,Object.assign({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=o.aI.convert(t);const d=s&&s.bearing||0,m=s&&s.pitch||0,y=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,y,v,d,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},s,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const d=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return d/m>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,d,m,y,v){const b=t.clone(),E=this._extendCameraOptions(v);b.bearing=m,b.pitch=y;const A=o.aT.convert(s),M=o.aT.convert(d),O=.5*(A.lat+M.lat),z=.5*(A.lng+M.lng),F=o.eZ(O,z),V=o.aw([],F),U=o.aw([],o.bI([],V,[0,1,0])),X=o.bI([],U,V),Z=[U[0],U[1],U[2],0,X[0],X[1],X[2],0,V[0],V[1],V[2],0,0,0,0,1],ne=[F,o.eZ(A.lat,A.lng),o.eZ(M.lat,A.lng),o.eZ(M.lat,M.lng),o.eZ(A.lat,M.lng),o.eZ(O,A.lng),o.eZ(O,M.lng),o.eZ(A.lat,z),o.eZ(M.lat,z)];let ae=o.d9.fromPoints(ne.map($e=>[o.bJ(U,$e),o.bJ(X,$e),o.bJ(V,$e)]));const re=o.af([],ae.center,Z);o.e_(re)===0&&o.e$(re,0,0,1),o.aw(re,re),o.c5(re,re,o.aD),b.center=o.f0(re);const we=b.getWorldToCameraMatrix(),ge=o.bl(new Float64Array(16),we);ae=o.d9.applyTransform(ae,o.aB([],we,Z));const ve=this._extendAABB(ae,b,E,m);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=ve,o.af(re,re,we);const me=.5*(ae.max[2]-ae.min[2]),he=this._minimumAABBFrustumDistance(b,ae),Se=o.c5([],[0,0,1],me),Le=o.d8(Se,re,Se),Re=he+(b.pitch===0?0:o.bG(re,Le)),qe=b.globeCenterInViewSpace,Ze=o.av([],re,[qe[0],qe[1],qe[2]]);o.aw(Ze,Ze),o.c5(Ze,Ze,Re);const tt=o.d8([],re,Ze);o.af(tt,tt,ge);const _t=o.eM/o.aD,Ue=o.ag(tt),Ae=o.cf(Math.max(Ue*_t-o.eM,Number.EPSILON),0),Ke=Math.min(b.zoomFromMercatorZAdjusted(Ae),E.maxZoom);return Ke>.5*(o.c_+o.cL)?(b.setProjection({name:"mercator"}),b.zoom=Ke,this._cameraForBounds(b,s,d,m,y,v)):{center:b.center,zoom:Ke,bearing:m,pitch:y}}_extendAABB(t,s,d,m){const y=.5*((d.padding.left||0)+(d.padding.right||0)),v=.5*((d.padding.top||0)+(d.padding.bottom||0)),b=v,E=y,A=y,M=v,O=s.width-(E+A),z=s.height-(b+M),F=o.av([],t.max,t.min),V=Math.min(O/F[0],z/F[1]),U=Math.min(s.scaleZoom(s.scale*V),d.maxZoom);if(isNaN(U))return null;const X=s.scale/s.zoomScale(U),Z=new o.d9([t.min[0]-E*X,t.min[1]-M*X,t.min[2]],[t.max[0]+A*X,t.max[1]+b*X,t.max[2]]),ne=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new o.P(d.offset.x,d.offset.y):o.P.convert(d.offset)).rotate(-o.an(m));return Z.center[0]-=ne.x*X,Z.center[1]+=ne.y*X,Z}queryTerrainElevation(t,s){const d=this.transform.elevation;return d?(s=Object.assign({},{exaggerated:!0},s),d.getAtPoint(o.ae.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,d,m,y,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,d,m,y,v);const b=t.clone(),E=this._extendCameraOptions(v);b.bearing=m,b.pitch=y;const A=o.aT.convert(s),M=o.aT.convert(d),O=new o.aT(A.lng,M.lat),z=new o.aT(M.lng,A.lat),F=b.project(A),V=b.project(M),U=this.queryTerrainElevation(A),X=this.queryTerrainElevation(M),Z=this.queryTerrainElevation(O),ne=this.queryTerrainElevation(z),ae=[[F.x,F.y,Math.min(U||0,X||0,Z||0,ne||0)],[V.x,V.y,Math.max(U||0,X||0,Z||0,ne||0)]];let re=o.d9.fromPoints(ae);const we=b.getWorldToCameraMatrix(),ge=o.bl(new Float64Array(16),we);re=o.d9.applyTransform(re,we);const ve=this._extendAABB(re,b,E,m);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=ve;const me=.5*o.av([],re.max,re.min)[2],he=this._minimumAABBFrustumDistance(b,re),Se=[0,0,1,0];o.aC(Se,Se,we),o.f1(Se,Se);const Le=o.c5([],Se,he+me),Re=o.d8([],re.center,Le);o.af(re.center,re.center,ge),o.af(Re,Re,ge);const qe=b.unproject(new o.P(re.center[0],re.center[1])),Ze=o.f2(b.projection,qe),tt=Math.pow(2,Ze),_t=Math.min(b._zoomFromMercatorZ(Re[2]*b.pixelsPerMeter*tt/b.worldSize),E.maxZoom);return b.mercatorFromTransition&&_t<.5*(o.c_+o.cL)?(b.setProjection({name:"globe"}),b.zoom=_t,this._cameraForBounds(b,s,d,m,y,v)):{center:qe,zoom:_t,bearing:m,pitch:y}}fitBounds(t,s,d){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,d)}fitScreenCoordinates(t,s,d,m,y){const v=o.P.convert(t),b=o.P.convert(s),E=new o.P(Math.min(v.x,b.x),Math.min(v.y,b.y)),A=new o.P(Math.max(v.x,b.x),Math.max(v.y,b.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,b))return this;const M=this.transform.pointLocation3D(E),O=this.transform.pointLocation3D(A),z=this.transform.pointLocation3D(new o.P(E.x,A.y)),F=this.transform.pointLocation3D(new o.P(A.x,E.y)),V=[Math.min(M.lng,O.lng,z.lng,F.lng),Math.min(M.lat,O.lat,z.lat,F.lat)],U=[Math.max(M.lng,O.lng,z.lng,F.lng),Math.max(M.lat,O.lat,z.lat,F.lat)],X=m&&m.pitch?m.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,V,U,d,X,m);return this._fitInternal(Z,m,y)}_fitInternal(t,s,d){return t?(s=Object.assign(t,s)).linear?this.easeTo(s,d):this.flyTo(s,d):this}jumpTo(t,s){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,v=!1;"zoom"in t&&d.zoom!==+t.zoom&&(m=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=o.aT.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(v=!0,d.pitch=+t.pitch);const b=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(b))if(t.retainPadding===!1){const E=d.clone();E.padding=b,d.setLocationAtPoint(d.center,E.centerPoint)}else d.padding=b;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.z("movestart",s)).fire(new o.z("move",s)),m&&this.fire(new o.z("zoomstart",s)).fire(new o.z("zoom",s)).fire(new o.z("zoomend",s)),y&&this.fire(new o.z("rotatestart",s)).fire(new o.z("rotate",s)).fire(new o.z("rotateend",s)),v&&this.fire(new o.z("pitchstart",s)).fire(new o.z("pitch",s)).fire(new o.z("pitchend",s)),this.fire(new o.z("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Tp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const d=this.transform;if(!d.projection.supportsFreeCamera)return o.w(Tp),this;this.stop();const m=d.zoom,y=d.pitch,v=d.bearing;d.setFreeCameraOptions(t);const b=m!==d.zoom,E=y!==d.pitch,A=v!==d.bearing;return this.fire(new o.z("movestart",s)).fire(new o.z("move",s)),b&&this.fire(new o.z("zoomstart",s)).fire(new o.z("zoom",s)).fire(new o.z("zoomend",s)),A&&this.fire(new o.z("rotatestart",s)).fire(new o.z("rotate",s)).fire(new o.z("rotateend",s)),E&&this.fire(new o.z("pitchstart",s)).fire(new o.z("pitch",s)).fire(new o.z("pitchend",s)),this.fire(new o.z("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:o.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,m=this.getZoom(),y=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in t?+t.zoom:m,A="bearing"in t?this._normalizeBearing(t.bearing,y):y,M="pitch"in t?+t.pitch:v,O=this._extendPadding(t.padding),z=o.P.convert(t.offset);let F,V,U;if(d.projection.name==="globe"){const Se=o.ae.fromLngLat(d.center),Le=z.rotate(-d.angle);Se.x+=Le.x/d.worldSize,Se.y+=Le.y/d.worldSize;const Re=Se.toLngLat(),qe=o.aT.convert(t.center||Re);this._normalizeCenter(qe),F=d.centerPoint.add(Le),V=new o.P(Se.x,Se.y).mult(d.worldSize),U=new o.P(o.aF(qe.lng),o.aJ(qe.lat)).mult(d.worldSize).sub(V)}else{F=d.centerPoint.add(z);const Se=d.pointLocation(F),Le=o.aT.convert(t.center||Se);this._normalizeCenter(Le),V=d.project(Se),U=d.project(Le).sub(V)}const X=d.zoomScale(E-m);let Z,ne;t.around&&(Z=o.aT.convert(t.around),ne=d.locationPoint(Z));const ae=this._zooming||E!==m,re=this._rotating||y!==A,we=this._pitching||M!==v,ge=!d.isPaddingEqual(O),ve=t.retainPadding===!1?d.clone():d,me=Se=>Le=>{if(ae&&(Se.zoom=o.ak(m,E,Le)),re&&(Se.bearing=o.ak(y,A,Le)),we&&(Se.pitch=o.ak(v,M,Le)),ge&&(ve.interpolatePadding(b,O,Le),F=ve.centerPoint.add(z)),Z)Se.setLocationAtPoint(Z,ne);else{const Re=Se.zoomScale(Se.zoom-m),qe=E>m?Math.min(2,X):Math.max(.5,X),Ze=Math.pow(qe,1-Le),tt=Se.unproject(V.add(U.mult(Le*Ze)).mult(Re));Se.setLocationAtPoint(Se.renderWorldCopies?tt.wrap():tt,F)}return t.preloadOnly||this._fireMoveEvents(s),Se};if(t.preloadOnly){const Se=this._emulate(me,t.duration,d);return this._preloadTiles(Se),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ae,this._rotating=re,this._pitching=we,this._padding=ge,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,he),this._ease(me(d),Se=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(s,Se)},t),this}_prepareEase(t,s,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||d.moving||this.fire(new o.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new o.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new o.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new o.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.z("move",t)),this._zooming&&this.fire(new o.z("zoom",t)),this._rotating&&this.fire(new o.z("rotate",t)),this._pitching&&this.fire(new o.z("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.z("zoomend",t)),m&&this.fire(new o.z("rotateend",t)),y&&this.fire(new o.z("pitchend",t)),this.fire(new o.z("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const $e=o.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo($e,s)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eV},t);const d=this.transform,m=this.getZoom(),y=this.getBearing(),v=this.getPitch(),b=this.getPadding(),E="zoom"in t?o.aA(+t.zoom,d.minZoom,d.maxZoom):m,A="bearing"in t?this._normalizeBearing(t.bearing,y):y,M="pitch"in t?+t.pitch:v,O=this._extendPadding(t.padding),z=d.zoomScale(E-m),F=o.P.convert(t.offset);let V=d.centerPoint.add(F);const U=d.pointLocation(V),X=o.aT.convert(t.center||U);this._normalizeCenter(X);const Z=d.project(U),ne=d.project(X).sub(Z);let ae=t.curve;const re=Math.max(d.width,d.height),we=re/z,ge=ne.mag();if("minZoom"in t){const $e=o.aA(Math.min(t.minZoom,m,E),d.minZoom,d.maxZoom),lt=re/d.zoomScale($e-m);ae=Math.sqrt(lt/ge*2)}const ve=ae*ae;function me($e){const lt=(we*we-re*re+($e?-1:1)*ve*ve*ge*ge)/(2*($e?we:re)*ve*ge);return Math.log(Math.sqrt(lt*lt+1)-lt)}function he($e){return(Math.exp($e)-Math.exp(-$e))/2}function Se($e){return(Math.exp($e)+Math.exp(-$e))/2}const Le=me(0);let Re=function($e){return Se(Le)/Se(Le+ae*$e)},qe=function($e){return re*((Se(Le)*(he(lt=Le+ae*$e)/Se(lt))-he(Le))/ve)/ge;var lt},Ze=(me(1)-Le)/ae;if(Math.abs(ge)<1e-6||!isFinite(Ze)){if(Math.abs(re-we)<1e-6)return this.easeTo(t,s);const $e=we<re?-1:1;Ze=Math.abs(Math.log(we/re))/ae,qe=function(){return 0},Re=function(lt){return Math.exp($e*ae*lt)}}t.duration="duration"in t?+t.duration:1e3*Ze/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const tt=y!==A,_t=M!==v,Ue=!d.isPaddingEqual(O),Ae=t.retainPadding===!1?d.clone():d,Ke=$e=>lt=>{const Ct=lt*Ze,zt=1/Re(Ct);$e.zoom=lt===1?E:m+$e.scaleZoom(zt),tt&&($e.bearing=o.ak(y,A,lt)),_t&&($e.pitch=o.ak(v,M,lt)),Ue&&(Ae.interpolatePadding(b,O,lt),V=Ae.centerPoint.add(F));const St=lt===1?X:$e.unproject(Z.add(ne.mult(qe(Ct))).mult(zt));return $e.setLocationAtPoint($e.renderWorldCopies?St.wrap():St,V),$e._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),$e};if(t.preloadOnly){const $e=this._emulate(Ke,t.duration,d);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=tt,this._pitching=_t,this._padding=Ue,this._prepareEase(s,!1),this._ease(Ke(d),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,s)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,s,d){d.animate===!1||d.duration===0?(t(1),s()):(this._easeStart=o.o.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.bT(t,-180,180);const d=Math.abs(t-s);return Math.abs(t-360-s)<d&&(t-=360),Math.abs(t+360-s)<d&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const d=t.lng-s.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,d){const m=Math.ceil(15*s/1e3),y=[],v=t(d.clone());for(let b=0;b<=m;b++){const E=v(b/m);y.push(E.clone())}return y}_preloadTiles(t,s){}}class ch{constructor(t={}){this.options=t,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const m=te("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",d),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const d=s.reduce((m,y,v)=>(y.value&&(m+=`${y.key}=${y.value}${v<s.length-1?"&":""}`),m),"?");t.href=`${o.e.FEEDBACK_URL}/${d}#${kr(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const y=s[m];if(y.used){const v=y.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let v=y+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.map(m=>function(y){const v=new DOMParser().parseFromString(y,"text/html");return Array.from(v.body.querySelectorAll("*")).forEach(b=>{const E=b.textContent||"";if(b.tagName!=="A")return void b.replaceWith(v.createTextNode(E));const A=b.getAttribute("href");if(!A||!/^(https?:|mailto:)/i.test(A))return void b.replaceWith(v.createTextNode(E));const M=v.createElement("a");M.href=A,M.textContent=E,M.rel="noopener nofollow";const O=b.getAttribute("class");O&&(M.className=O),b.replaceWith(M)}),v.body.innerHTML}(m)).join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uh{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=te("div","mapboxgl-ctrl");const s=te("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const d=t[s].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Du{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",s=>this._onIndoorUpdate(s)),this._container}_createButton(t,s){const d=te("button",t,this._container);return d.type="button",d.addEventListener("click",s),d}_createSeparator(){return te("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,s){this._map&&(t.setAttribute("aria-label",s),t.textContent=s)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const s=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",s&&Array.from(this._container.children).forEach(d=>d.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const s=this._map;this._model&&s&&s._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});te("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,s){for(let d=0;d<t.length;d++){const m=t[d],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(m.id)});this._setButtonTitle(y,m.zIndex.toString()),this._model&&m.id===this._model.selectedFloorId&&s&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),d<t.length-1&&this._createSeparator()}}}class ll{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const m of d)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class cl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=o.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,d){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+d}}const ul={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Jl extends o.z{constructor(t,s,d,m){const{point:y,lngLat:v,originalEvent:b,target:E}=t;super(t.type,{point:y,lngLat:v,originalEvent:b,target:E}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=d,this.feature=m}}class ua{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=s.filter;let m=s.type;d&&this.filters.set(t,o.b6(d)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const y=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):y.size===0&&this.map.on(m,this.handleType),y.size===0&&this.interactionsByType.set(m,y),y.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const d=this.interactionsByType.get(s);return d?d.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(s);d&&(d.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const d=[];for(const[m,y]of s)y.target&&d.push({targetId:m,target:y.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const d=new Map;for(const[m,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||d.set(y.id,y);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!s;s=s||this.queryTargets(t.point,m);let v=!1;const b=new Set;for(const E of s){for(const[A,M]of m){if(!M.target)continue;const O=E.variants?E.variants[A]:null;if(O){for(const z of O){if(uu(z,E,b,A))continue;const F=new o.dx(E,z),V=wc(z,E,A);y&&F.id!==void 0&&(F.state=this.map.getFeatureState(F));const U=d?this.prevHoveredFeatures.get(V):null,X=new Jl(t,A,M,F),Z=U?U.stop:M.handler(X);if(d&&this.hoveredFeatures.set(V,{feature:E,stop:Z}),Z!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[E,A]of m){const{handler:M,target:O}=A;if(!O&&M(new Jl(t,E,A,null))!==!1)break}}}function Xw(u,t){if(Array.isArray(u)&&Array.isArray(t)){const s=new Set(u),d=new Set(t);return s.size===d.size&&u.every(m=>d.has(m))}return o.by(u,t)}const Yw={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Kw={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qw{constructor(t,s,d=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Yg({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Kg({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Me()}move(t,s){const d=this.map,m=this.mouseRotate.mousemoveWindow(t,s),y=m&&m.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,s),b=v&&v.pitchDelta;b&&d.setPitch(d.getPitch()+b)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ve(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ve(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=nt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=nt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function t_(u,t,s){if(u=new o.aT(u.lng,u.lat),t){const d=new o.aT(u.lng-360,u.lat),m=new o.aT(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),v=s.locationPoint3D(u).distSqr(t),b=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(d).distSqr(t)<v&&(b||Math.abs(d.lng-s.center.lng)<y)?u=d:s.locationPoint3D(m).distSqr(t)<v&&(b||Math.abs(m.lng-s.center.lng)<y)&&(u=m)}for(;Math.abs(u.lng-s.center.lng)>180;){const d=s.locationPoint3D(u);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const Eo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Vs={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Sp extends o.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=Object.assign({element:t},s)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:m="#3FB1CE",scale:y=1,draggable:v=!1,clickTolerance:b=0,rotation:E=Vs.rotation,rotationAlignment:A=Vs.rotationAlignment,pitchAlignment:M=Vs.pitchAlignment,occludedOpacity:O=Vs.occludedOpacity,altitude:z=Vs.altitude}=t||{};this._anchor=d,this._color=m,this._scale=y,this._draggable=v,this._clickTolerance=b,this._rotation=E,this._rotationAlignment=A,this._pitchAlignment=M,this._occludedOpacity=O,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",U=>{U.preventDefault()}),this._element.addEventListener("mousedown",U=>{U.preventDefault()});const F=this._element.classList;for(const U in Eo)F.remove(`mapboxgl-marker-anchor-${U}`);F.add(`mapboxgl-marker-anchor-${this._anchor}`);const V=t&&t.className?t.className.trim().split(/\s+/):[];F.add(...V),this._popup=null}_createDefaultMarker(){const t=te("div"),s=le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=le("radialGradient",{id:"shadowGradient"},le("defs",{},s));le("stop",{offset:"10%","stop-opacity":.4},d),le("stop",{offset:"100%","stop-opacity":.05},d),le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Vs.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,d=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,d=this._element;this._popup&&(s===d||d.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const d=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const y=m.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(s,this._altitude);let m;t._showingGlobe()&&o.f5(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Eo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,d=this.getPitchAlignment();if(!s||!t||d!=="map")return"";if(!s._showingGlobe()){const E=s.getPitch();return E?`rotateX(${E}deg)`:""}const m=o.cX(o.f6(s.transform,this._lngLat)),y=t.sub(o.f7(s.transform)),v=Math.abs(y.x)+Math.abs(y.y);if(v===0)return"";const b=m/v;return`rotateX(${-y.y*b}deg) rotateY(${y.x*b}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let d=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const y=s.project(new o.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=s.project(new o.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);d=o.cX(Math.atan2(v.y,v.x))-90}else d=-s.getBearing();else if(m==="horizon"){const y=o.ah(4,6,s.getZoom()),v=o.f7(s.transform);v.y+=y*s.transform.height;const b=t.sub(v),E=o.cX(Math.atan2(b.y,b.x));d=(E>90?E-270:E+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=t_(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const d=this._pointerdownPos,m=this._positionDelta;if(d&&m){if(!this._isDragging){const y=this._clickTolerance||s._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,d=this._pos;s&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Vs.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Vs.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Vs.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Vs.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Jw={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Lu={maxWidth:100,unit:"metric"},n_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},$s={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Gs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jc(u=new o.P(0,0),t="bottom"){if(typeof u=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new o.P(0,u);case"top-left":return new o.P(s,s);case"top-right":return new o.P(-s,s);case"bottom":return new o.P(0,-u);case"bottom-left":return new o.P(s,-s);case"bottom-right":return new o.P(-s,-s);case"left":return new o.P(u,0);case"right":return new o.P(-u,0)}return new o.P(0,0)}return u instanceof o.P||Array.isArray(u)?o.P.convert(u):o.P.convert(u[t]||[0,0])}return{version:N,supported:be.supported,setRTLTextPlugin:o.fb,getRTLTextPluginStatus:o.fa,Map:class extends e_{constructor(u){q.mark(B.create);const t=u;if((u=Object.assign({},Yw,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&o.f3(window)&&(u.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new og(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new ll,this._domRenderTaskQueue=new ll,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},ul,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new st(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const s=document.getElementById(u.container);if(!s)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=s}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Zw(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||o.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),u.hash&&(this._hash=new Vg(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const s=u.bounds;s&&(this.resize(),this.fitBounds(s,Object.assign({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new ch({customAttribution:u.customAttribution})),this._logoControl=new uh,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.z(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.z(`${s.dataType}dataloading`,s))}),this._interactions=new ua(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.z("movestart",u)).fire(new o.z("move",u)),this.fire(new o.z("resize",u)),t&&this.fire(new o.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(o.aI.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let s;t==="globe"&&u.zoom>=o.cL?(u.setMercatorFromTransition(),s=!0):t==="mercator"&&u.zoom<o.cL&&(u.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;const s=this.transform.mercatorFromTransition;t=u.name==="globe"&&this.transform.zoom>=o.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate();const d=this.transform.getProjection().name==="mercator"&&s!==this.transform.mercatorFromTransition;return(t||d)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(o.aT.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(o.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,s){const d=m=>{let y=[];if(Array.isArray(t)){const v=t.filter(b=>this.getLayer(b));y=v.length?this.queryRenderedFeatures(m,{layers:v}):[]}else y=this.queryRenderedFeatures(m,{target:t});return y};if(u==="mouseenter"||u==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:v=>{const b=d(v.point);b.length?m||(m=!0,s.call(this,new Qo(u,this,v.originalEvent,{features:b}))):m=!1},mouseout:()=>{m=!1}}}}if(u==="mouseleave"||u==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:b=>{d(b.point).length?m=!0:m&&(m=!1,s.call(this,new Qo(u,this,b.originalEvent)))},mouseout:b=>{m&&(m=!1,s.call(this,new Qo(u,this,b.originalEvent)))}}}}{const m=y=>{const v=d(y.point);v.length&&(y.features=v,s.call(this,y),delete y.features)};return{listener:s,targets:t,delegates:{[u]:m}}}}on(u,t,s){if(typeof t=="function"||s===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(u,t,s){if(typeof t=="function"||s===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,s);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(u,t,s){if(typeof t=="function"||s===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[u]:void 0;return d&&(m=>{for(let y=0;y<m.length;y++){const v=m[y];if(v.listener===s&&Xw(v.targets,t)){for(const b in v.delegates)this.off(b,v.delegates[b]);return m.splice(y,1),this}}})(d),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof o.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(u,void 0,this.transform),v=this.style.queryRenderedFeatureset(u,void 0,this.transform);return y.concat(v)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let m=[];return d&&(m=m.concat(this.style.queryRenderedFeatures(u,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),m}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}queryRasterValue(u,t,s){return this._isValidId(u)?this.style.queryRasterValue(u,t,s):Promise.resolve(null)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(s,d)=>{if(s){const m=typeof s=="string"?s:s instanceof Error?s.message:s.error;o.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const s=Object.assign({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new Us(this,s).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Us(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dr(u)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:s=1,sdf:d=!1,stretchX:m,stretchY:y,content:v}={}){this._lazyInitEmptyStyle();const b=o.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:E,height:A,data:M}=o.o.getImageData(t);this.style.addImage(b,{data:new o.q({width:E,height:A},M),pixelRatio:s,stretchX:m,stretchY:y,content:v,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:A}=t,M=t;this.style.addImage(b,{data:new o.q({width:E,height:A},new Uint8Array(M.data)),pixelRatio:s,stretchX:m,stretchY:y,content:v,sdf:d,usvg:!1,version:0,userImage:M}),M.onAdd&&M.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const s=o.I.from(u),d=this.style.getImage(s);if(!d)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.o.getImageData(t):t,{width:y,height:v,data:b}=m;if(y===void 0||v===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||v!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const E=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let A=!1;d.usvg?(d.data=new o.q({width:y,height:v},new Uint8Array(b)),d.usvg=!1,d.icon=void 0,A=!0):d.data.replace(b,E),this.style.updateImage(s,d,A)}hasImage(u){return u?!!this.style&&!!this.style.getImage(o.I.from(u)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(o.I.from(u))}loadImage(u,t){o.n(this._requestManager.transformRequest(u,o.R.Image),(s,d)=>{t(s,d instanceof HTMLImageElement?o.o.getImageData(d):d)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(s=>this.fire(new o.y(new Error("Failed to add import",s)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,s){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,s),this._update(!0)):this}setFilter(u,t,s={}){return this._isValidId(u)?(this.style.setFilter(u,t,s),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,s,d={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,s,d),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,s,d={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,s,d),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}setLayerProperty(u,t,s,d={}){return this._isValidId(u)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(u,t,s,d),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,s){return this.style.setConfigProperty(u,t,s),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aT.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_selectIndoorFloor(u){this.indoor.selectFloor(u)}_setIndoorActiveFloorsVisibility(u){this.indoor.setActiveFloorsVisibility(u)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Du),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,d,m,y=this._container;for(;y&&(!d||!m);){const v=window.getComputedStyle(y).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(d=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),y=y.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new gv(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=te("div","mapboxgl-canvas-container",u);this._canvas=te("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=te("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{d[m]=te("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=o.o.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=Object.assign({},be.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Sr(t,!0),this.painter=new up(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(t)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new o.z("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,d=o.o.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,M=this.transform.pitch,O=o.o.now(),z=new o.ac(A,{now:O,fadeDuration:y,pitch:M,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d);const b=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),b&&(this._placementDirty=b.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,q.mark(B.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const A=o.o.now()-d;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const M=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new o.z("gpu-timing-frame",{cpuTime:A,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(A);this.fire(new o.z("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(A);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:M}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const A=this.idle();if(A&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,q.mark(B.fullLoad),this._performanceMetricsCollection&&li(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;const v=Math.abs(m-y);if(v>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),s(y);this._averageElevation.easeTo(y,u,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),s(y)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){Qr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Ht||u.status===401)){const t=this.painter.context.gl;Sr(t,!1),this._logoControl instanceof uh&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Yn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&nn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&_n(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){An(this._requestManager._customAccessToken)}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,d=s.createFramebuffer();function m(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,d),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,s){let d=s[1]-s[0];const m=u.length/4;for(let y=0;y<t.length;y++){const v=t[y];let b=0;for(let E=0;E<v.length;E+=4)v[E]===u[E]&&v[E+1]===u[E+1]&&v[E+2]===u[E+2]&&v[E+3]===u[E+3]&&(b+=1);d+=(s[y+2]-s[y+1])*(1-b/m)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),xr.delete(this.painter.context.gl),Ar.remove(),mn.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=o.o.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return o.bw(t,(s,d)=>s._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this.style&&u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,t){o.f4(u,t)}get version(){return N}},NavigationControl:class{constructor(u={}){this.options=Object.assign({},Kw,u),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),s=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qw(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const s=te("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.E{constructor(u={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Jw,u),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=dp(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,u(s)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:u.coords,timestamp:u.timestamp},u.toJSON?{toJSON:u.toJSON.bind(u)}:{}))),this._finish()}}_updateCamera(u){const t=new o.aT(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,d=this._map.getBearing(),m=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new o.aT(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=o.cf(1,u._center.lat)*u.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Sp({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sp({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ch,ScaleControl:class{constructor(u={}){this.options=Object.assign({},Lu,u),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,d=t._containerWidth/2-u/2,m=t.unproject([d,s]),y=t.unproject([d+u,s]),v=m.distanceTo(y);if(this.options.unit==="imperial"){const b=3.2808*v;b>5280?this._setScale(u,b/5280,"mile"):this._setScale(u,b,"foot")}else this.options.unit==="nautical"?this._setScale(u,v/1852,"nautical-mile"):v>=1e3?this._setScale(u,v/1e3,"kilometer"):this._setScale(u,v,"meter")}_setScale(u,t,s){this._map._requestDomTask(()=>{const d=function(y){const v=Math.pow(10,`${Math.floor(y)}`.length-1);let b=y/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A}(b),v*b}(t),m=d/t;this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(d):`${d}&nbsp;${n_[s]}`,this._container.style.width=u*m+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Du,Popup:class extends o.E{constructor(u){super(),this.options=Object.assign(Object.create($s),u),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=o.aT.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),s=document.createElement("body");let d;for(s.innerHTML=u;d=s.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const s=this._closeButton=te("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,d=this._pos;if(!t||!s||!d)return"bottom";const m=s.offsetWidth,y=s.offsetHeight,v=d.x<m/2,b=d.x>t.transform.width-m/2;if(d.y+u<y)return v?"top-left":b?"top-right":"top";if(d.y>t.transform.height-y){if(v)return"bottom-left";if(b)return"bottom-right"}return v?"left":b?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let d=this._container;if(d||(d=this._container=te("div","mapboxgl-popup",t.getContainer()),this._tip=te("div","mapboxgl-popup-tip",d),d.appendChild(s)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=t_(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const m=this._pos=this._trackPointer&&u instanceof o.P?u:t.project(this._lngLat,this._altitude),y=jc(this.options.offset),v=this._anchor=this._getAnchor(y.y),b=jc(this.options.offset,v),E=m.add(b).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Eo[v]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=o.f5(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Gs);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Sp,Style:Us,LngLat:o.aT,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:jo,Evented:o.E,config:o.e,prewarm:o.f9,clearPrewarmedResources:o.f8,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(u){o.e.ACCESS_TOKEN=u},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(u){o.e.API_URL=u},get workerCount(){return o.fi.workerCount},set workerCount(u){o.fi.workerCount=u},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){o.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){o.fh(u)},get workerUrl(){return o.fg.workerUrl},set workerUrl(u){o.fg.workerUrl=u},get workerClass(){return o.fg.workerClass},set workerClass(u){o.fg.workerClass=u},get workerParams(){return o.fg.workerParams},set workerParams(u){o.fg.workerParams=u},get dracoUrl(){return o.ff()},set dracoUrl(u){o.fe(u)},get meshoptUrl(){return o.fd()},set meshoptUrl(u){o.fc(u)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var R=w;return R})})(MN);var jZ=MN.exports;const ym=RS(jZ),DN={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Aradhana Business Park Boundary"},geometry:{type:"Polygon",coordinates:[[[72.87164999790367,21.23467198982084],[72.87132065026869,21.23498156692991],[72.87085023018331,21.23453771058966],[72.8711747711726,21.23419925905024],[72.87164999790367,21.23467198982084]]]}}]},Mx=[[72.88638384002304,21.18693643432666],[72.8865758983353,21.18627221433158],[72.88862142140012,21.18654325550465],[72.88849713957224,21.18722347804809]],RD=i=>{const h=i.slice(0,4).map(([o,N])=>({lng:o,lat:N,sum:o+N,diff:N-o})),g=h.reduce((o,N)=>o.diff>N.diff?o:N),w=h.reduce((o,N)=>o.diff<N.diff?o:N),S=h.reduce((o,N)=>o.sum>N.sum?o:N),R=h.reduce((o,N)=>o.sum<N.sum?o:N);return[[g.lng,g.lat],[S.lng,S.lat],[w.lng,w.lat],[R.lng,R.lat]]},Rx=(i,l,h)=>{let w=i.slice(0,4);return l&&(w=[w[1],w[0],w[3],w[2]]),h&&(w=[w[3],w[2],w[1],w[0]]),w};function UZ(){const{projects:i,updateProject:l,isAdmin:h}=Xa(),g=G.useRef(null),w=G.useRef(null),S=G.useRef(null),R=G.useRef([]),[o,N]=G.useState("/aradhana.png"),[B,q]=G.useState("/aradhana.png"),[Y,J]=G.useState(1),[ie,be]=G.useState(1),[te,le]=G.useState(0),[ce,oe]=G.useState(!1),[ue,Me]=G.useState(!1),[Ne,je]=G.useState(!0),[Te,Ve]=G.useState(()=>RD(Mx));G.useEffect(()=>{let ze=!1,He=null;const mt=B;return(async()=>{try{const $t=await aw(o);if(ze)return;He=$t,q($t)}catch{if(ze)return;q("")}})(),()=>{ze=!0,mt&&mt.startsWith("blob:")&&mt!==He&&URL.revokeObjectURL(mt)}},[o]);const[nt,At]=G.useState("");G.useEffect(()=>{!nt&&i.length>0&&At(i[0].id)},[i,nt]);const cn=()=>{if(!Te||Te.length!==4)throw new Error("Please set all 4 corners");const ze=w.current,He=Rx(Te,ce,ue);if(!ze||ie===1&&te===0)return He;const mt=He.map(([nn,Zn])=>ze.project({lng:nn,lat:Zn})),$t=mt.reduce((nn,Zn)=>nn+Zn.x,0)/mt.length,Gt=mt.reduce((nn,Zn)=>nn+Zn.y,0)/mt.length,Kt=te*Math.PI/180,mn=Math.cos(Kt),Yn=Math.sin(Kt);return mt.map(nn=>{const Zn=(nn.x-$t)*ie,_n=(nn.y-Gt)*ie,En=$t+Zn*mn-_n*Yn,An=Gt+Zn*Yn+_n*mn,Kn=ze.unproject([En,An]);return[Kn.lng,Kn.lat]})},qt=()=>{if(!h){cr.error("Only admin can save map configuration");return}if(!nt){cr.error("Please select a project");return}if(!Ne||!o){l(nt,{mapConfig:void 0}),cr.success("Map removed from project");return}try{const ze=cn();l(nt,{mapConfig:{imageUrl:o,corners:ze,opacity:Y,flipH:!1,flipV:!1}}),cr.success("Map saved to project")}catch(ze){cr.error(ze instanceof Error?ze.message:"Could not save map")}};G.useEffect(()=>{const ze="pk.eyJ1IjoicHJpeWFuc2kxMjMiLCJhIjoiY21qc2U1aGFvMXRkbjNjc2Rxd2g5b3JhNyJ9.GEWdpin_PmhRD07hQt7OGQ";ym.accessToken=ze},[]),G.useEffect(()=>{if(w.current||!g.current)return;const ze=new ym.Map({container:g.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[0,0],zoom:1.4,pitch:45,bearing:0,projection:"globe",antialias:!0});return w.current=ze,ze.on("load",()=>{ze.setFog({range:[-1,2],color:"white","high-color":"#add8e6","space-color":"#000000","star-intensity":.3});const He=performance.now(),mt=4e3,$t=()=>{performance.now()-He<mt?(ze.jumpTo({bearing:ze.getBearing()+.4}),S.current=requestAnimationFrame($t)):(S.current&&(cancelAnimationFrame(S.current),S.current=null),ze.stop(),Gt())},Gt=async()=>{const Kt=Yn=>new Promise(hi=>{ze.once("moveend",()=>hi()),ze.flyTo(Yn)});await Kt({center:[78.9629,20.5937],zoom:4,pitch:0,bearing:0,duration:2500,essential:!0}),await Kt({center:[71.1924,22.2587],zoom:7,duration:2e3,essential:!0}),await Kt({center:[72.8311,21.1702],zoom:15,pitch:0,bearing:0,duration:2e3,essential:!0}),ze.stop(),ze.setBearing(0),ze.setPitch(0);const mn=RD(Mx);ze.getSource("boundary")||ze.addSource("boundary",{type:"geojson",data:DN}),ze.getLayer("boundary-mask")||ze.addLayer({id:"boundary-mask",type:"fill",source:"boundary",paint:{"fill-color":"#000","fill-opacity":0}}),ze.getSource("land-boundary")||ze.addSource("land-boundary",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[...Mx,Mx[0]]]}}}),ze.getLayer("land-fill")||ze.addLayer({id:"land-fill",type:"fill",source:"land-boundary",paint:{"fill-color":"#0DA2E7","fill-opacity":.4}}),Ve(mn)};$t()}),()=>{S.current&&cancelAnimationFrame(S.current),R.current.forEach(He=>He.remove()),R.current=[],ze.remove(),w.current=null}},[]),G.useEffect(()=>{const ze=w.current;if(!ze||!Te||Te.length!==4)return;const He=()=>{var _n,En;const mt="aradhana-image",$t="aradhana-layer";if(!Ne){ze.getLayer($t)&&ze.removeLayer($t),ze.getSource(mt)&&ze.removeSource(mt),R.current.forEach(An=>An.remove()),R.current=[];return}if(!o){ze.getLayer($t)&&ze.removeLayer($t),ze.getSource(mt)&&ze.removeSource(mt),R.current.forEach(An=>An.remove()),R.current=[];return}const Gt=An=>{if(ie===1&&te===0)return An;const Kn=An.map(([Di,uo])=>ze.project({lng:Di,lat:uo})),li=Kn.reduce((Di,uo)=>Di+uo.x,0)/Kn.length,Ar=Kn.reduce((Di,uo)=>Di+uo.y,0)/Kn.length,Qr=te*Math.PI/180,xr=Math.cos(Qr),Sr=Math.sin(Qr);return Kn.map(Di=>{const uo=(Di.x-li)*ie,Rs=(Di.y-Ar)*ie,qo=li+uo*xr-Rs*Sr,ps=Ar+uo*Sr+Rs*xr,ho=ze.unproject([qo,ps]);return[ho.lng,ho.lat]})},Kt=Rx(Te,ce,ue),mn=Gt(Kt),Yn=ze.getSource(mt),hi=!!(Yn&&typeof Yn.updateImage=="function"),nn=!!(Yn&&typeof Yn.setCoordinates=="function");Yn&&(hi||nn)?hi?(_n=Yn.updateImage)==null||_n.call(Yn,{url:B,coordinates:mn}):((En=Yn.setCoordinates)==null||En.call(Yn,mn),ze.getLayer($t)&&ze.removeLayer($t),ze.removeSource(mt),ze.addSource(mt,{type:"image",url:B,coordinates:mn})):(ze.getLayer($t)&&ze.removeLayer($t),ze.getSource(mt)&&ze.removeSource(mt),ze.addSource(mt,{type:"image",url:B,coordinates:mn})),ze.getLayer($t)?ze.setPaintProperty($t,"raster-opacity",Y):ze.addLayer({id:$t,source:mt,type:"raster",paint:{"raster-opacity":Y}});const Zn=["#ff3b30","#34c759","#007aff","#ffcc00"];R.current.length===0?R.current=mn.map((An,Kn)=>{const li=new ym.Marker({draggable:!0,color:Zn[Kn]}).setLngLat(An).addTo(ze);return li.on("dragend",()=>{const Ar=R.current.map(Qr=>{const xr=Qr.getLngLat();return[xr.lng,xr.lat]});be(1),le(0),Ve(Rx(Ar,ce,ue))}),li}):R.current.forEach((An,Kn)=>{mn[Kn]&&An.setLngLat(mn[Kn])})};if(ze.isStyleLoaded()){He();return}ze.once("load",He)},[o,Y,Te,te,ie,ce,ue,Ne]);const Ht=ze=>new Promise((He,mt)=>{const $t=new Image;$t.onload=()=>He(),$t.onerror=()=>mt(new Error("The source image could not be decoded")),$t.src=ze}),st=ze=>{if(!ze)return;if(!["image/png","image/jpeg"].includes(ze.type)){cr.error("Please upload a PNG or JPEG image (SVG/WEBP/HEIC not supported)");return}const mt=URL.createObjectURL(ze);Ht(mt).then(async()=>{const $t=`map:aradhana:${Date.now()}`,Gt=await UW(ze,$t);N(Gt),je(!0)}).catch(()=>{cr.error("Could not load image. Please use PNG/JPEG. Note: SVG is not supported by Mapbox.")}).finally(()=>{URL.revokeObjectURL(mt)})},Tt=()=>{je(!1);const ze=w.current;if(!ze)return;const He="aradhana-image",mt="aradhana-layer";ze.getLayer(mt)&&ze.removeLayer(mt),ze.getSource(He)&&ze.removeSource(He),R.current.forEach($t=>$t.remove()),R.current=[]},xt=(ze,He,mt)=>{const $t=Number(mt);Number.isNaN($t)||(be(1),le(0),Ve(Gt=>{const Kt=Gt.map(mn=>[...mn]);return Kt[ze]?(He==="lng"&&(Kt[ze][0]=$t),He==="lat"&&(Kt[ze][1]=$t),Kt):Gt}))},kt=()=>{const ze=w.current;if(!ze||!Te||Te.length!==4)return;const He=Rx(Te,ce,ue),mt=He.map(hi=>hi[0]),$t=He.map(hi=>hi[1]),Gt=Math.min(...mt),Kt=Math.max(...mt),mn=Math.min(...$t),Yn=Math.max(...$t);ze.fitBounds([[Gt,mn],[Kt,Yn]],{padding:80,duration:1200})};return L.jsxs("div",{style:{position:"fixed",inset:0},children:[L.jsx("div",{ref:g,style:{position:"absolute",inset:0,width:"100vw",height:"100vh"}}),L.jsxs("div",{style:{position:"absolute",top:12,left:12,width:360,padding:12,borderRadius:10,background:"rgba(0,0,0,0.65)",color:"#fff",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, Arial",zIndex:10},children:[L.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Image Editor"}),L.jsx("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:"Upload image"}),L.jsx("input",{type:"file",accept:"image/*",onChange:ze=>{var He;return st((He=ze.target.files)==null?void 0:He[0])},style:{width:"100%",marginBottom:10}}),L.jsx("button",{type:"button",onClick:kt,style:{width:"100%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer",marginBottom:10},children:"Fly to image"}),L.jsx("button",{type:"button",onClick:Tt,style:{width:"100%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(255,0,0,0.18)",color:"#fff",cursor:"pointer",marginBottom:10},children:"Delete image"}),L.jsxs("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:["Opacity: ",Y.toFixed(2)]}),L.jsx("input",{type:"range",min:0,max:1,step:.01,value:Y,onChange:ze=>J(Number(ze.target.value)),style:{width:"100%",marginBottom:10}}),L.jsxs("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:["Scale: ",ie.toFixed(2)]}),L.jsx("input",{type:"range",min:.5,max:2,step:.01,value:ie,onChange:ze=>be(Number(ze.target.value)),style:{width:"100%",marginBottom:10}}),L.jsxs("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:["Rotation: ",te.toFixed(0),""]}),L.jsx("input",{type:"range",min:-180,max:180,step:1,value:te,onChange:ze=>le(Number(ze.target.value)),style:{width:"100%",marginBottom:10}}),L.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[L.jsx("button",{type:"button",onClick:()=>oe(ze=>!ze),style:{flex:1,padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:ce?"rgba(255,255,255,0.22)":"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer"},children:"Flip H"}),L.jsx("button",{type:"button",onClick:()=>Me(ze=>!ze),style:{flex:1,padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:ue?"rgba(255,255,255,0.22)":"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer"},children:"Flip V"})]}),L.jsx("div",{style:{fontSize:12,opacity:.9,marginBottom:8},children:"Corners (TL, TR, BR, BL)"}),L.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:Te.map((ze,He)=>L.jsxs("div",{style:{padding:10,borderRadius:10,background:"rgba(255,255,255,0.08)"},children:[L.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:8},children:He===0?"TL":He===1?"TR":He===2?"BR":"BL"}),L.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:4},children:"Lng"}),L.jsx("input",{value:ze[0],onChange:mt=>xt(He,"lng",mt.target.value),style:{width:"100%",marginBottom:8,padding:6,borderRadius:8,border:"1px solid rgba(255,255,255,0.2)",background:"#fff",color:"#111"}}),L.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:4},children:"Lat"}),L.jsx("input",{value:ze[1],onChange:mt=>xt(He,"lat",mt.target.value),style:{width:"100%",padding:6,borderRadius:8,border:"1px solid rgba(255,255,255,0.2)",background:"#fff",color:"#111"}})]},He))}),h&&L.jsxs("div",{style:{marginTop:12},children:[L.jsx("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:"Save to project"}),L.jsx("select",{value:nt,onChange:ze=>At(ze.target.value),style:{width:"100%",marginBottom:10,padding:8,borderRadius:8,border:"1px solid rgba(255,255,255,0.2)",background:"#fff",color:"#111"},children:i.map(ze=>L.jsx("option",{value:ze.id,children:ze.name},ze.id))}),L.jsx("button",{type:"button",onClick:qt,style:{width:"100%",padding:"10px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(13,162,231,0.22)",color:"#fff",cursor:"pointer"},children:"Save"})]})]})]})}const DD=i=>i,LD=[[72.88638384002304,21.18693643432666],[72.8865758983353,21.18627221433158],[72.88862142140012,21.18654325550465],[72.88849713957224,21.18722347804809]],bh=i=>{const h=i.slice(0,4).map(([o,N])=>({lng:o,lat:N,sum:o+N,diff:N-o})),g=h.reduce((o,N)=>o.diff>N.diff?o:N),w=h.reduce((o,N)=>o.diff<N.diff?o:N),S=h.reduce((o,N)=>o.sum>N.sum?o:N),R=h.reduce((o,N)=>o.sum<N.sum?o:N);return[[g.lng,g.lat],[S.lng,S.lat],[w.lng,w.lat],[R.lng,R.lat]]},Dx=(i,l,h)=>{let w=[...i];return l&&(w=[w[1],w[0],w[3],w[2]]),h&&(w=[w[3],w[2],w[1],w[0]]),w};function VZ(){const{projectId:i}=GO(),l=Zm(),{projects:h,currentProject:g,setCurrentProject:w,updateProject:S,isAdmin:R}=Xa(),o=G.useRef(null),N=G.useRef(null),B=G.useRef([]),q=G.useRef(!1);G.useEffect(()=>{if(!i)return;const st=h.find(xt=>xt.id===i)||null;if(w(st),!st){l("/");return}!st.mapConfig&&fetch(DD(`/api/projects/${i}`)).then(xt=>xt.ok?xt.json():null).then(xt=>{xt&&xt.id===i&&w(xt)}).catch(()=>{})},[i,h,w,l]);const Y=G.useMemo(()=>{var st;return g&&(((st=g.mapConfig)==null?void 0:st.imageUrl)||g.layoutImage)||"/aradhana.png"},[g]),[J,ie]=G.useState(Y),[be,te]=G.useState(""),[le,ce]=G.useState(!0),[oe,ue]=G.useState(1),[Me,Ne]=G.useState(!1),[je,Te]=G.useState(!1),[Ve,nt]=G.useState(()=>bh(LD));G.useEffect(()=>{var st,Tt,xt,kt,ze;g&&(ie(((st=g.mapConfig)==null?void 0:st.imageUrl)||g.layoutImage||"/aradhana.png"),ue(((Tt=g.mapConfig)==null?void 0:Tt.opacity)??1),Ne(((xt=g.mapConfig)==null?void 0:xt.flipH)??!1),Te(((kt=g.mapConfig)==null?void 0:kt.flipV)??!1),nt(bh(((ze=g.mapConfig)==null?void 0:ze.corners)??LD)))},[g]),G.useEffect(()=>{q.current=!1},[g==null?void 0:g.id,J]),G.useEffect(()=>{let st=!1,Tt=null;const xt=be;return(async()=>{ce(!0),console.log("Starting image resolution for:",J);try{const kt=await aw(J);if(st)return;Tt=kt,console.log("Image resolution result:",kt),!kt&&J.startsWith("s3:")?(console.warn("S3 image failed to load, using fallback image"),te("/aradhana.png")):te(kt),ce(!1)}catch(kt){if(console.warn("Failed to resolve map image:",kt),st)return;te("/aradhana.png"),ce(!1)}})(),()=>{st=!0,xt&&xt.startsWith("blob:")&&xt!==Tt&&URL.revokeObjectURL(xt)}},[J]),G.useEffect(()=>{const st="pk.eyJ1IjoicHJpeWFuc2kxMjMiLCJhIjoiY21qc2U1aGFvMXRkbjNjc2Rxd2g5b3JhNyJ9.GEWdpin_PmhRD07hQt7OGQ";ym.accessToken=st},[]),G.useEffect(()=>{if(!g||!o.current||N.current)return;const st=new ym.Map({container:o.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[0,0],zoom:1.2,pitch:0,bearing:0,antialias:!0});return N.current=st,st.on("load",()=>{st.getSource("boundary")||st.addSource("boundary",{type:"geojson",data:DN}),st.getLayer("boundary-mask")||st.addLayer({id:"boundary-mask",type:"fill",source:"boundary",paint:{"fill-color":"#000","fill-opacity":0}})}),()=>{B.current.forEach(Tt=>Tt.remove()),B.current=[],st.remove(),N.current=null}},[g]),G.useEffect(()=>{const st=N.current;if(!st)return;const Tt="project-image",xt="project-image-layer",kt=()=>{var mt,$t;if(console.log("Map applyUpdate called:",{imageUrl:J,isImageLoading:le,resolvedImageUrl:be}),!J||le||!be){console.log("Skipping map update - conditions not met:",{imageUrl:J,isImageLoading:le,resolvedImageUrl:be}),st.getLayer(xt)&&st.removeLayer(xt),st.getSource(Tt)&&st.removeSource(Tt),B.current.forEach(Gt=>Gt.remove()),B.current=[];return}console.log("Proceeding with map update, resolvedImageUrl:",be);const ze=bh(Ve),He=Dx(ze,Me,je);try{const Gt=st.getSource(Tt),Kt=!!(Gt&&typeof Gt.updateImage=="function"),mn=!!(Gt&&typeof Gt.setCoordinates=="function");if(Gt&&(Kt||mn)?Kt?(console.log("Updating existing image source with URL:",be),(mt=Gt.updateImage)==null||mt.call(Gt,{url:be,coordinates:He})):(($t=Gt.setCoordinates)==null||$t.call(Gt,He),st.getLayer(xt)&&st.removeLayer(xt),st.removeSource(Tt),console.log("Adding new image source with URL:",be),st.addSource(Tt,{type:"image",url:be,coordinates:He})):(st.getLayer(xt)&&st.removeLayer(xt),st.getSource(Tt)&&st.removeSource(Tt),console.log("Adding new image source with URL:",be),st.addSource(Tt,{type:"image",url:be,coordinates:He})),st.getLayer(xt)?st.setPaintProperty(xt,"raster-opacity",oe):st.addLayer({id:xt,source:Tt,type:"raster",paint:{"raster-opacity":oe}}),!R)return;const Yn=["#ff3b30","#34c759","#007aff","#ffcc00"];B.current.length===0?B.current=He.map((hi,nn)=>{const Zn=new ym.Marker({draggable:!0,color:Yn[nn]}).setLngLat(hi).addTo(st);return Zn.on("dragend",()=>{const _n=B.current.map(En=>{const An=En.getLngLat();return[An.lng,An.lat]});nt(bh(Dx(_n,Me,je)))}),Zn}):B.current.forEach((hi,nn)=>{He[nn]&&hi.setLngLat(He[nn])})}catch(Gt){console.error("Failed to update map image:",Gt),st.getLayer(xt)&&st.removeLayer(xt),st.getSource(Tt)&&st.removeSource(Tt),B.current.forEach(Kt=>Kt.remove()),B.current=[]}};if(st.isStyleLoaded()){kt();return}st.once("load",kt)},[J,be,le,oe,Ve,Me,je,R]);const At=st=>{if(!st)return;if(!["image/png","image/jpeg"].includes(st.type)){cr.error("Please upload a PNG or JPEG image");return}const xt=10*1024*1024;if(st.size>xt){cr.error("Image is too large (max 10MB)");return}(async()=>{try{const ze=(st.name.split(".").pop()||"").toLowerCase().replace(/[^a-z0-9]/g,""),He=await fetch(DD("/api/storage/presign-upload"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentType:st.type,prefix:"project-maps",ext:ze})});if(!He.ok)throw new Error("Could not prepare upload");const mt=await He.json();if(!(mt!=null&&mt.key)||!(mt!=null&&mt.url))throw new Error("Could not prepare upload");if(!(await fetch(mt.url,{method:"PUT",headers:{"Content-Type":st.type},body:st})).ok)throw new Error("Upload failed");ie(`s3:${mt.key}`)}catch{cr.error("Image upload failed")}})()},cn=(st,Tt,xt)=>{const kt=Number(xt);Number.isNaN(kt)||nt(ze=>{const He=ze.map(mt=>[...mt]);return Tt==="lng"&&(He[st][0]=kt),Tt==="lat"&&(He[st][1]=kt),He})},qt=()=>{const st=N.current;if(!st)return;const Tt=Dx(bh(Ve),Me,je),xt=Tt.map(Gt=>Gt[0]),kt=Tt.map(Gt=>Gt[1]),ze=Math.min(...xt),He=Math.max(...xt),mt=Math.min(...kt),$t=Math.max(...kt);st.fitBounds([[ze,mt],[He,$t]],{padding:80,duration:900})};G.useEffect(()=>{const st=N.current;if(!st||!g||!J||le||q.current)return;const Tt=()=>{if(q.current)return;const xt=Dx(bh(Ve),Me,je),kt=xt.map(Kt=>Kt[0]),ze=xt.map(Kt=>Kt[1]),He=Math.min(...kt),mt=Math.max(...kt),$t=Math.min(...ze),Gt=Math.max(...ze);st.fitBounds([[He,$t],[mt,Gt]],{padding:80,duration:1e4}),q.current=!0};if(st.isStyleLoaded()){Tt();return}st.once("load",Tt)},[g,J,le,Ve,Me,je]);const Ht=()=>{g&&(S(g.id,{mapConfig:{imageUrl:J,corners:bh(Ve),opacity:oe,flipH:Me,flipV:je}}),cr.success("Map saved"))};return g?le?L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:L.jsxs("div",{className:"flex flex-col items-center gap-4",children:[L.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"}),L.jsx("div",{className:"text-muted-foreground",children:"Loading map..."})]})}):!R&&!g.mapConfig&&!g.layoutImage?L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-6",children:L.jsxs("div",{className:"max-w-lg text-center",children:[L.jsx("div",{className:"text-xl font-semibold text-foreground",children:"Map not available"}),L.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:"Admin has not saved a map for this project yet."}),L.jsx("div",{className:"mt-6",children:L.jsx(Oi,{variant:"outline",onClick:()=>l(`/project/${g.id}`),children:"Back"})})]})}):L.jsxs("div",{style:{position:"fixed",inset:0},children:[L.jsx("div",{ref:o,style:{position:"absolute",inset:0,width:"100vw",height:"100vh"}}),L.jsxs("div",{style:{position:"absolute",top:12,right:12,zIndex:10,display:"flex",gap:8},children:[L.jsx(Oi,{variant:"outline",onClick:()=>l(`/project/${g.id}`),children:"Back"}),R&&L.jsx(Oi,{onClick:Ht,children:"Save"})]}),R&&L.jsxs("div",{style:{position:"absolute",top:12,left:12,width:"min(360px, calc(100vw - 24px))",maxHeight:"calc(100vh - 24px)",overflowY:"auto",padding:12,borderRadius:10,background:"rgba(0,0,0,0.65)",color:"#fff",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, Arial",zIndex:10},children:[L.jsx("div",{style:{fontWeight:700,marginBottom:10},children:"Project Map"}),L.jsx("div",{style:{marginBottom:10},children:L.jsx(Oi,{onClick:Ht,className:"w-full",children:"Save Map"})}),L.jsx("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:"Upload image"}),L.jsx("input",{type:"file",accept:"image/*",onChange:st=>{var Tt;return At((Tt=st.target.files)==null?void 0:Tt[0])},style:{width:"100%",marginBottom:10,color:"#fff",background:"rgba(0,0,0,0.7)",borderRadius:10,padding:8,border:"1px solid rgba(255,255,255,0.25)"}}),L.jsx("button",{type:"button",onClick:qt,style:{width:"100%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer",marginBottom:10},children:"Fly to image"}),L.jsxs("div",{style:{fontSize:12,opacity:.9,marginBottom:6},children:["Opacity: ",oe.toFixed(2)]}),L.jsx("input",{type:"range",min:0,max:1,step:.01,value:oe,onChange:st=>ue(Number(st.target.value)),style:{width:"100%",marginBottom:10}}),L.jsxs("div",{style:{display:"flex",gap:10,marginBottom:10},children:[L.jsx("button",{type:"button",onClick:()=>Ne(st=>!st),style:{flex:1,padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:Me?"rgba(255,255,255,0.22)":"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer"},children:"Flip H"}),L.jsx("button",{type:"button",onClick:()=>Te(st=>!st),style:{flex:1,padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:je?"rgba(255,255,255,0.22)":"rgba(255,255,255,0.12)",color:"#fff",cursor:"pointer"},children:"Flip V"})]}),L.jsx("div",{style:{fontSize:12,opacity:.9,marginBottom:8},children:"Corners (TL, TR, BR, BL)"}),L.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},children:Ve.map((st,Tt)=>L.jsxs("div",{style:{padding:10,borderRadius:10,background:"rgba(255,255,255,0.08)"},children:[L.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:8},children:Tt===0?"TL":Tt===1?"TR":Tt===2?"BR":"BL"}),L.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:4},children:"Lng"}),L.jsx("input",{value:st[0],onChange:xt=>cn(Tt,"lng",xt.target.value),style:{width:"100%",marginBottom:8,padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.8)",color:"#fff",outline:"none"}}),L.jsx("div",{style:{fontSize:11,opacity:.8,marginBottom:4},children:"Lat"}),L.jsx("input",{value:st[1],onChange:xt=>cn(Tt,"lat",xt.target.value),style:{width:"100%",padding:"8px 10px",borderRadius:10,border:"1px solid rgba(255,255,255,0.25)",background:"rgba(0,0,0,0.8)",color:"#fff",outline:"none"}})]},Tt))})]})]}):L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:L.jsxs("div",{className:"flex flex-col items-center gap-4",children:[L.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"}),L.jsx("div",{className:"text-muted-foreground",children:"Loading project..."})]})})}function $Z(){const{login:i}=Xa(),l=Zm(),[h,g]=G.useState(""),[w,S]=G.useState(""),[R,o]=G.useState(!1),[N,B]=G.useState(!1),q=async Y=>{Y.preventDefault(),B(!0),await i(h,w)?(cr.success("Login successful!"),l("/dashboard")):cr.error("Invalid credentials"),B(!1)};return L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:L.jsxs("div",{className:"w-full max-w-md",children:[L.jsxs(Oi,{variant:"ghost",size:"sm",onClick:()=>l("/"),className:"mb-6 text-muted-foreground hover:text-foreground",children:[L.jsx(RE,{className:"w-4 h-4 mr-2"}),"Back to Home"]}),L.jsxs("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-sm",children:[L.jsxs("div",{className:"text-center mb-8",children:[L.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center mx-auto mb-4",children:L.jsx(zm,{className:"w-8 h-8 text-primary"})}),L.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Welcome Back"}),L.jsx("p",{className:"text-muted-foreground mt-2",children:"Sign in to manage your real estate projects"})]}),L.jsxs("form",{onSubmit:q,className:"space-y-5",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"email",children:"Email Address"}),L.jsxs("div",{className:"relative mt-1.5",children:[L.jsx(Oz,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),L.jsx(rr,{id:"email",type:"email",value:h,onChange:Y=>g(Y.target.value),placeholder:"you@example.com",className:"pl-10",required:!0})]})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"password",children:"Password"}),L.jsxs("div",{className:"relative mt-1.5",children:[L.jsx(LE,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),L.jsx(rr,{id:"password",type:R?"text":"password",value:w,onChange:Y=>S(Y.target.value),placeholder:"",className:"pl-10 pr-10",required:!0}),L.jsx("button",{type:"button",onClick:()=>o(!R),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:R?L.jsx(Lz,{className:"w-4 h-4"}):L.jsx(DE,{className:"w-4 h-4"})})]})]}),L.jsx(Oi,{type:"submit",className:"w-full",disabled:N,children:N?L.jsxs("span",{className:"flex items-center gap-2",children:[L.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin"}),"Signing in..."]}):"Sign In"})]}),L.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-6",children:["Don't have an account?"," ",L.jsx(Ih,{to:"/register",className:"text-primary hover:underline",children:"Create one"})]})]}),L.jsx("p",{className:"text-center text-sm text-muted-foreground mt-6",children:"Secure login protected by industry-standard encryption"})]})})}function GZ(){const{user:i,register:l}=Xa(),h=Zm(),[g,w]=G.useState(""),[S,R]=G.useState(""),[o,N]=G.useState(""),[B,q]=G.useState(!1),[Y,J]=G.useState(!1);G.useEffect(()=>{i&&h("/dashboard",{replace:!0})},[i,h]);const ie=async be=>{if(be.preventDefault(),S.length<6){cr.error("Password must be at least 6 characters");return}if(S!==o){cr.error("Passwords do not match");return}if(J(!0),!await l(g,S)){cr.error("Cannot register this email or account already exists"),J(!1);return}cr.success("Account created! Please login."),h("/login",{replace:!0}),J(!1)};return L.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:L.jsxs("div",{className:"w-full max-w-md",children:[L.jsxs(Oi,{variant:"ghost",size:"sm",onClick:()=>h("/"),className:"mb-6 text-muted-foreground hover:text-foreground",children:[L.jsx(RE,{className:"w-4 h-4 mr-2"}),"Back to Home"]}),L.jsxs("div",{className:"bg-card border border-border rounded-2xl p-8 shadow-sm",children:[L.jsxs("div",{className:"text-center mb-8",children:[L.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 border border-primary/20 flex items-center justify-center mx-auto mb-4",children:L.jsx(zm,{className:"w-8 h-8 text-primary"})}),L.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Create Account"}),L.jsx("p",{className:"text-muted-foreground mt-2",children:"Register to access your dashboard"})]}),L.jsxs("form",{onSubmit:ie,className:"space-y-5",children:[L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"reg-email",children:"Email Address"}),L.jsxs("div",{className:"relative mt-1.5",children:[L.jsx(Oz,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),L.jsx(rr,{id:"reg-email",type:"email",value:g,onChange:be=>w(be.target.value),placeholder:"you@example.com",className:"pl-10",required:!0})]})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"reg-password",children:"Password"}),L.jsxs("div",{className:"relative mt-1.5",children:[L.jsx(LE,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),L.jsx(rr,{id:"reg-password",type:B?"text":"password",value:S,onChange:be=>R(be.target.value),placeholder:"",className:"pl-10 pr-10",required:!0}),L.jsx("button",{type:"button",onClick:()=>q(!B),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:B?L.jsx(Lz,{className:"w-4 h-4"}):L.jsx(DE,{className:"w-4 h-4"})})]})]}),L.jsxs("div",{children:[L.jsx(Gi,{htmlFor:"reg-confirm",children:"Confirm Password"}),L.jsx(rr,{id:"reg-confirm",type:B?"text":"password",value:o,onChange:be=>N(be.target.value),placeholder:"",className:"mt-1.5",required:!0})]}),L.jsx(Oi,{type:"submit",className:"w-full",disabled:Y,children:Y?L.jsxs("span",{className:"flex items-center gap-2",children:[L.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin"}),"Creating..."]}):"Create Account"})]}),L.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-6",children:["Already have an account?"," ",L.jsx(Ih,{to:"/login",className:"text-primary hover:underline",children:"Login"})]})]}),L.jsx("p",{className:"text-center text-sm text-muted-foreground mt-6",children:"By creating an account you agree to the terms."})]})})}const HZ=()=>{const i=qm();return G.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),L.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:L.jsxs("div",{className:"text-center",children:[L.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),L.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),L.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},WZ=new LH,qZ=()=>L.jsx(zH,{client:WZ,children:L.jsx(cH,{children:L.jsxs(HW,{children:[L.jsx(B8,{}),L.jsx(_$,{}),L.jsx(RW,{children:L.jsxs(SW,{children:[L.jsx(qc,{path:"/",element:L.jsx(CD,{})}),L.jsx(qc,{path:"/dashboard",element:L.jsx(CD,{})}),L.jsx(qc,{path:"/project/:projectId",element:L.jsx(BZ,{})}),L.jsx(qc,{path:"/project/:projectId/map",element:L.jsx(VZ,{})}),L.jsx(qc,{path:"/aradhana-map",element:L.jsx(UZ,{})}),L.jsx(qc,{path:"/login",element:L.jsx($Z,{})}),L.jsx(qc,{path:"/register",element:L.jsx(GZ,{})}),L.jsx(qc,{path:"*",element:L.jsx(HZ,{})})]})})]})})});tz(document.getElementById("root")).render(L.jsx(qZ,{}));
